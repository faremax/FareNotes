## æ•°ç»„çš„æ‰©å±•

- `Array,from()`
å°†ç±»æ•°ç»„å¯¹è±¡å’Œå¯éå†å¯¹è±¡è½¬åŒ–ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚
```js
var arrayLike = {
  '0' : 'a',
  '1' : 'b',
  '2' : 'c',
  'length': 3
}

var arr;
//ES5
arr = [].slice.call(arrayLike);    //arr=['a', 'b', 'c']

//ES6
arr = Array.from(arrayLike);    //arr=['a', 'b', 'c']
```
å’Œå®ƒç±»ä¼¼çš„æ˜¯æ‰©å±•è¿ç®—ç¬¦ï¼Œä¸€æ ·å¯ä»¥å®ç°è¯¥åŠŸèƒ½(è¦æ±‚å¯¹è±¡å…·æœ‰éå†å™¨æ¥å£)ï¼š
```js
function(){
  var arg = [...arguments];   //è½¬åŒ– arguments ä¸ºæ•°ç»„
}
```
Array.from() æ¥å—ç¬¬äºŒå‚æ•°(å‡½æ•°)ï¼Œç”¨æ¥æ˜ å°„ç»“æœï¼Œç›¸å½“äº map, å¹¶ä¸”å¯ä»¥ç”¨ç¬¬ä¸‰ä¸ªå‚æ•°ç»‘å®š this:
```js
Array.from(obj, func, context);
//ç­‰ä»·äº
Array.from(obj).map(func, context);
```
æŠ€å·§ï¼Œç”¨ Array.from() æŒ‡å®šå‡½æ•°è¿è¡Œæ¬¡æ•°ï¼š
```js
var i = 0;
Array.from({length:3}, ()=>i++);   //[0,1,2]
```

- `Array.of()`
å°†å¤šä¸ªå€¼ç»„æˆæ•°ç»„ï¼š
```js
Array.of(2,3,5);   //[2,3,5]
Array.of(2);   //[2]
Array.of();   //[]
Array.of(undefined);   //[undefined]
```

- `Array.prototype.copyWithin()`
å‡½æ•°å‚æ•°æ˜¯ `Array.prototype.copyWithin(target, start=0, end=this.length)`, å¯¹å½“å‰æ•°ç»„ï¼Œä»æˆªå–ä¸‹æ ‡ä¸º start åˆ° end çš„å€¼ï¼Œä»target ä½ç½®å¼€å§‹è¦†ç›– `this` ä¸­çš„å€¼ã€‚å¦‚æœ start æˆ– end ä¸ºè´Ÿæ•°åˆ™å€’æ•°ã€‚
```js
[1,2,3,4,5].copyWithin(0,3,4);   //[4,2,3,4,5]

[1,2,3,4,5].copyWithin(0,-2,-1);   //[4,2,3,4,5]

[].copyWithin.call({length:5,3:1},0,3);   //{0:1,3:1,length:5}

var i32a = new Int32Array([1,2,3,4,5]);
i32a.copyWithin(0,2);   //[3,4,5,4,5]
```

- `Array.prototype.find()`, `Array.prototype.findIndex()`
è¿™ä¸¤ä¸ªå‡½æ•°çš„å‚æ•°éƒ½æ˜¯å›è°ƒå‡½æ•°ã€‚éå†æ•°ç»„ï¼Œæ‰¾åˆ°ç¬¦åˆæ¡ä»¶(å›è°ƒå‡½æ•°è¿”å›ä¸ºtrue)çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œfind()è¿”å›å…¶å€¼ï¼Œ`findIndex()`è¿”å›å…¶ä¸‹æ ‡ã€‚å¦‚æœæ²¡æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å€¼`find()`è¿”å›undefinedï¼Œ`findIndex()`è¿”å›-1ã€‚
```js
[1,2,-3,4].find((item) => item < 0);   //-3
[1,2,-3,4].findIndex((item) => item < 0);   //2

[NaN].findIndex(y => y !== y);   //0
[NaN].indexOf(NaN);   //-1, indexOf æ‰¾ä¸åˆ° NaN
```
è¿™ä¸¤ä¸ªå‡½æ•°è¿˜æ¥å—ç¬¬äºŒå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå›è°ƒå‡½æ•°ä¸­çš„ this

- `Array.prototype.fill()`
å®Œæ•´å½¢å¼ï¼š`Array.prototype.fill(value, start=0, end=this.length)`ï¼Œå¯¹æ•°ç»„ start åˆ° end ç›´æ¥éƒ¨åˆ†å¡«å…… valueï¼Œè¦†ç›–åŸæœ‰å€¼ã€‚
```js
[1,2,3,4,5].fill('a',2,4);    //[1,2,'a','a',5];
var arr = new Array(5).fill(0);   //arr = [0,0,0,0,0];
```

- `Array.prototype.entries()`,`Array.prototype.keys()`,`Array.prototype.values()`
è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œç”¨æ¥éå†æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªéå†å™¨ï¼Œä¾› `for...of` ä½¿ç”¨ï¼Œå…¶ä¸­ `keys()`æ˜¯å¯¹é”®çš„éå†ï¼Œ`values()` æ˜¯å¯¹å€¼çš„éå†ï¼Œ`entires()`æ˜¯å¯¹é”®å€¼å¯¹çš„éå†ã€‚babel å·²å®ç°
```js
var a = ['a','b','c'];

for(let item of a.values()){
  console.log(item);     //ä¾æ¬¡è¾“å‡º 'a', 'b', 'c'
}

for(let key of a.keys()){
  console.log(key);     //ä¾æ¬¡è¾“å‡º 0, 1, 2
}
for(let pair of a.entries()){
  console.log(pair);     //ä¾æ¬¡è¾“å‡º [0,'a'],[1,'b'],[2,'c']
}
```
å½“ç„¶ä¹Ÿå¯ä»¥ç”¨éå†å™¨çš„ next() æ–¹æ³•éå†
```js
var a = ['a','b','c'];
var values = a.values();
console.log(values.next().value);   //'a'
console.log(values.next().value);   //'b'
console.log(values.next().value);   //'c'
```

- `Array.prototype.includes()`
è¿™æ˜¯ä¸ª ES7 çš„æ–¹æ³•ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰æŸä¸ªå€¼ï¼Œå«æœ‰åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚å¯ä»¥ç”¨ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šæŸ¥æ‰¾èµ·å§‹ç‚¹(å°äº0å€’æ•°)ã€‚
```js
//è¯¥æ–¹æ³•åŒæ ·å¯ä»¥æ‰¾åˆ° NaNï¼Œè€Œ indexOf ä¸è¡Œ
[1,2,NaN].includes(NaN);   //true
[1,2,3,4,5].includes(2, 3);  //false
```

- æ•°ç»„çš„ç©ºä½
æˆ‘ä»¬æ¯”è¾ƒä»¥ä¸‹ä¸¤ä¸ªæ•°ç»„ï¼š
```js
var empty = new Array(3);  //[,,,]
var unempty = new Array(3).fill(undefined);   //[undefined,undefined,undefined]

console.log(0 in empty);     //false
console.log(0 in unempty);   //true
```
å¾ˆæ˜æ˜¾ï¼Œä¸€ä¸ªå®Œå…¨ç©ºçš„æ•°ç»„æ˜¯æ²¡æœ‰ä¸œè¥¿çš„ï¼Œè€Œå¡«å……äº†`undefined`çš„æ•°ç»„å¹¶ä¸æ˜¯ç©ºçš„ã€‚
ç»“åˆ ES5, å‘ç°ä¸åŒå‡½æ•°æ–¹æ³•å¯¹ç©ºä½å¤„ç†æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ï¼š
-- `forEach()`, `filter()`, `every()`, `some()` ä¼šå¿½ç•¥ç©ºå€¼
-- `map()`, `copyWithin()` ä¼šä¿ç•™ç©ºå€¼ï¼Œä½†ä¸åšå¤„ç†
-- `join()`, `toString()`, ä¼šæŠŠç©ºå€¼å¤„ç†ä¸ºç©ºå­—ç¬¦ä¸²
-- `fill()` ä¸åŒºåˆ†ç©ºå€¼ä¸éç©ºå€¼
-- `Array.from()`, æ‰©å±•è¿ç®—ç¬¦(...), `for...of`, `entires()`, `keys()`,`values()`, `find()`, `findIndex()` ä¼šè§†ç©ºå€¼ä¸º `undefined`
å¦‚æœä½ è®°ä¸ä½è¿™äº›ï¼Œæˆ–è€…ä¸ºäº†ç¨‹åºçš„å¥å£®æ€§ï¼Œå¯ç»´æŠ¤æ€§ï¼Œå°½é‡é¿å…åœ¨æ•°ç»„ä¸­å‡ºç°ç©ºå€¼ã€‚
ä¸¾ä¸ªå®ä¾‹ï¼Œç†è§£ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼š
> æ–°å»ºä¸€ä¸ªé•¿ä¸º200çš„æ•°ç»„ï¼Œå¹¶åˆå§‹åŒ–æ¯ä¸ªä½ç½®çš„å€¼ç­‰äºå…¶ç´¢å¼•
```js
//é”™è¯¯æ–¹æ³•
var arr = new Array(200).map(function(item, index){
  return index;
});
console.log(arr);    //[undefined Ã— 200]
```
```js
//æ­£ç¡®åšæ³•
var arr = new Array(200).join().split(',').map(function(item, index){
  return index;
});
console.log(arr);    //[1,2,3,...,200]
```

- æ•°ç»„æ¨å¯¼
è¿™æ˜¯ä¸€ä¸ª ES7 çš„åŠŸèƒ½ï¼Œæš‚æ—¶è¿˜æ²¡èƒ½å®ç°ã€‚æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸‹å®ƒå¦‚ä½•æ¨å¯¼çš„ï¼š
```js
var a1 = [1,2,3,4];
var a2 = [for( i of a1) i * 2];   //a2=[2,4,6,8]
```
ä¸éš¾çœ‹å‡ºï¼Œæ•°ç»„ a2 é€šè¿‡ `for...of` ç›´æ¥ä» a1 ç”Ÿæˆã€‚ä½†æ˜¯å®ƒçš„åŠŸèƒ½ä¸ä»…ä»…è¿™ä¹ˆç®€å•ï¼Œè¿˜å¯ä»¥æœ‰ if æ¡ä»¶ï¼š
```js
var a1 = [1,2,3,4];
var a3 = [for( i of a1) if(i > 2) i * 2];   //a3=[6,8]
```
è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„ç”¨æ•°ç»„æ¨å¯¼æ¨¡æ‹Ÿ `map()`,`filter()` æ–¹æ³•äº†ã€‚æ¯”å¦‚ä¸Šé¢2ä¸ªä¾‹å­ç­‰ä»·äºï¼š
```js
var a1 = [1,2,3,4];
var a2 = a1.map( (i) => i * 2 );
var a3 = a1.filter( (i) => i > 2 ).map( (i) => i * 2 );
```
å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥ç”¨å¤šä¸ª `for...of` æ„æˆå¾ªç¯åµŒå¥—ï¼š
```js
var a = ['x1','x2'];
var b = ['y1','y2'];

[for(i of a) for(j of b), console.log(i+','+j)];
//è¾“å‡º
//['x1','y1']
//['x1','y2']
//['x2','y1']
//['x2','y2']
```
æ•°ç»„æ¨å¯¼ç”± `[]` æ„å»ºäº†ä¸€ä¸ªä½œç”¨åŸŸï¼Œå…¶å†…éƒ¨æ–°å»ºçš„å˜é‡ï¼Œç­‰åŒäºç”¨ let å…³é”®å­—å£°æ˜çš„å˜é‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå­—ç¬¦ä¸²ä¹Ÿå¯ä»¥è¢«è§†ä¸ºæ•°ç»„ï¼Œæ‰€ä»¥åŒæ ·å¯ä»¥ä½¿ç”¨æ•°ç»„æ¨å¯¼ï¼š
```js
[for(c of 'abcde'). c+'.'].join('');  //"a.2.3.4.5."
```

## äºŒè¿›åˆ¶æ•°ç»„

è¿™ä¸ªéƒ¨åˆ†å¦‚æœæ²¡æœ‰Cè¯­è¨€å’Œè®¡ç®—æœºåŸºç¡€ä¼šæ¯”è¾ƒéš¾ç†è§£ï¼Œå¦‚æœå®åœ¨ç†è§£ä¸äº†å¯ä»¥æ”¶è—å®ƒï¼Œæ—¥åå†çœ‹ã€‚

äºŒè¿›åˆ¶æ•°ç»„å…¶å®å¾ˆæ—©å°±æœ‰äº†ï¼Œä¸è¿‡ä¸ºäº† WebGL ä¸­ï¼Œæ•°æ®å¯ä»¥é«˜æ•ˆå’Œæ˜¾å¡äº¤æ¢æ•°æ®ã€‚åˆ†ä¸º3ç±»ï¼š
- ArrayBufferï¼šä»£è¡¨å†…å­˜ä¸­çš„ä¸€æ®µäºŒè¿›åˆ¶æ•°æ®ï¼›
- TypedArrayï¼šè¯»å†™ç®€å•çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚ Uint8Array, Int16Array, Float32Array ç­‰9ç±»ï¼›
- DataViewï¼šè¯»å†™å¤æ‚çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚ Uint8, Int16, Float32 ç­‰8ç±»ï¼›

æ•°æ®ç±»å‹ | å­—èŠ‚é•¿åº¦ | å«ä¹‰ | å¯¹åº” C è¯­è¨€ç±»å‹ | TypedArray ç±»å‹ | DataView ç±»å‹
--- | --- | --- | --- | --- | ---
Int8 | 1 | 8ä½æœ‰ç¬¦å·æ•´æ•° | char | Int8Array | Int8
Uint8 | 1 | 8ä½æ— ç¬¦å·æ•´æ•° | unsigned char | Uint8Array | Uint8
Uint8C | 1 | 8ä½æ— ç¬¦å·æ•´æ•°(è‡ªåŠ¨è¿‡æ»¤æº¢å‡º) | unsigned char | Uint8ClampedArray | ä¸æ”¯æŒ
Int16 | 2 | 16ä½æœ‰ç¬¦å·æ•´æ•° | short | Int16Array | Int16
Uint16 | 2 | 16ä½æ— ç¬¦å·æ•´æ•° | unsigned short | Uint16Array | Uint16
Int32 | 4 | 32ä½æœ‰ç¬¦å·æ•´æ•° | int | Int32Array | Int32
Uint32 | 4 | 32ä½æ— ç¬¦å·æ•´æ•° | unsigned int | Uint32Array | Uint32
Float32 | 4 | 32ä½æµ®ç‚¹æ•° | float | Float32Array | Float32
Float64 | 8 | 64ä½æµ®ç‚¹æ•° | double | Float64Array | Float64

### ArrayBuffer

ArrayBuffer ä»£è¡¨å†…å­˜ä¸­çš„ä¸€æ®µäºŒè¿›åˆ¶æ•°æ®ï¼Œæˆ‘ä»¬æ²¡æ³•ç›´æ¥æ“ä½œï¼Œéœ€è¦åˆ©ç”¨è§†å›¾(TypedArray,DataView)æŒ‰ä¸€å®šæ ¼å¼è§£è¯»äºŒè¿›åˆ¶æ•°æ®ã€‚ä½†æˆ‘ä»¬ä¾ç„¶å¯ä»¥æ„é€ ä¸€æ®µå†…å­˜æ¥å­˜æ”¾äºŒè¿›åˆ¶æ•°æ®:
```js
var buf = new ArrayBuffer(32);  //åˆ†é…32ä¸ªå­—èŠ‚çš„å†…å­˜å­˜æ”¾æ•°æ®, é»˜è®¤å…¨0
var dataview = new DataView(buf);   //å°†è¿™æ®µå†…å­˜è½¬ä¸ºè§†å›¾
dataview.getUint8(0);   //å¾—åˆ°ç¬¬ä¸€ä¸ª8å­—èŠ‚çš„å€¼(æ— ç¬¦å·)ï¼Œ0
```

 è¿™é‡Œéœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œåˆ†é…å†…å­˜ç©ºé—´ä¸è¦å¤ªå¤§ï¼æ¯•ç«Ÿä½ çš„å†…å­˜æ˜¯æœ‰é™çš„ã€‚
 å…¶æ¬¡ï¼Œæ— è®ºä½¿ç”¨ä»€ä¹ˆè§†å›¾ï¼Œå…¶å®ä¾‹åŒ–çš„å†…å­˜å¦‚æœå…±äº«ï¼Œæ‰€æœ‰çš„å†™å…¥æ“ä½œä¼šä¿®æ”¹æ¯ä¸€ä¸ªè§†å›¾ï¼Œå› ä¸ºå†…å­˜å…±ç”¨çš„ï¼š
 ```js
var buf = new ArrayBuffer(32);
var view16 = new Int16Array(buf);
var viewu8 = new Uint8Array(buf);

console.log(viewu8[0]);   //0
view16[0]=-1;
console.log(viewu8[0]);   //255
 ```
 è¿™é‡Œä¹‹æ‰€ä»¥å¾—åˆ°255ï¼Œæ˜¯å› ä¸ºå†…å­˜å…±ç”¨å¯¼è‡´çš„ï¼Œä½†ä¸ºä½•ä¸æ˜¯-1ï¼ŸInt16Array æ˜¯æœ‰ç¬¦å·ç±»å‹çš„ï¼Œè¿™æ ·äºŒè¿›åˆ¶çš„æœ€é«˜ä½ç”¨ä½œç¬¦å·ä½ï¼Œè´Ÿæ•°è®°ä¸º1:`1000 0000 0000 0001`,ä¹‹åçš„æ•°å­—ç”¨ç§»ç å­˜å‚¨ï¼Œå¾—åˆ°-1çš„äºŒè¿›åˆ¶ä¸ºï¼š`1111 1111 1111 1111`, ä¹‹ååˆ©ç”¨Uint8Arrayè¯»å–æ— ç¬¦å·çš„å‰8ä½ï¼Œå¾—åˆ°`1111 1111`è¿™ä¸ªè®¡ç®—ä¸ºåè¿›åˆ¶ä¸º $2^8-1=255$ã€‚å…·ä½“å…³äºæ•°åˆ¶è½¬æ¢å’Œåç è¡¥ç è¿™é‡Œä¸å†å±•å¼€ï¼Œå¦åˆ™å°±è·‘åäº†ã€‚

ArrayBuffer å¯¹è±¡ä¹Ÿæœ‰å‡ ä¸ªæ–¹æ³•å’Œå±æ€§:
- byteLength: å¾—åˆ°å†…å­˜åŒºåŸŸçš„å­—èŠ‚é•¿åº¦
```js
const N = 32;
var buf = new ArrayBuffer(N);
if(buf.byteLength === N){
  //åˆ†é…æˆåŠŸ
} else {
  //åˆ†é…å¤±è´¥
}
```

- slice(start=0, end=this.byteLength): åˆ†é…æ–°å†…å­˜ï¼Œå¹¶æŠŠå…ˆæœ‰å†…å­˜ start åˆ° end éƒ¨åˆ†å¤åˆ¶è¿‡å»ï¼Œè¿”å›è¿™æ®µæ–°å†…å­˜åŒºåŸŸ
```js
var buf = new ArrayBuffer(32);
var newBuf = buf.slice(0,3);
```

- isView(view): åˆ¤æ–­ä¼ å…¥çš„ view æ˜¯å¦å½“å‰ buffer çš„è§†å›¾ï¼Œæ˜¯åˆ™è¿”å› true, å¦åˆ™ falseã€‚è¯¥æ–¹æ³•æš‚æ— æ³•ä½¿ç”¨ã€‚
```js
var buf1 = new ArrayBuffer(32);
var buf2 = new ArrayBuffer(32);
var buf1View = new Int8Array(buf1);
var buf2View = new Int8Array(buf2);

buf1.isView(buf1View);   //true
buf1.isView(buf2View);   //false
```

### TypedArray

å…·æœ‰ä¸€ä¸ªæ„é€ å‡½æ•° DataView(), æ¥å—ä¸€ä¸ªArrayBufferå‚æ•°,è§†å›¾åŒ–è¯¥æ®µå†…å­˜ï¼›æˆ–æ¥å—ä¸€ä¸ªæ•°ç»„å‚æ•°ï¼Œå®ä¾‹åŒ–è¯¥æ•°ç»„ä¸ºäºŒè¿›åˆ¶å†…å®¹ã€‚å¾—åˆ°çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨`[]`è®¿é—®æ¯ä¸ªä½ç½®çš„å†…å®¹ï¼Œæœ‰`length`å±æ€§ã€‚å…¶æ„é€ å‡½æ•°æœ‰9ä¸ªï¼š

æ•°æ®ç±»å‹ | å­—èŠ‚é•¿åº¦ | å«ä¹‰ | å¯¹åº” C è¯­è¨€ç±»å‹ | TypedArray ç±»å‹æ„é€ å‡½æ•°
--- | --- | --- | --- | ---
Int8 | 1 | 8ä½æœ‰ç¬¦å·æ•´æ•° | char | Int8Array()
Uint8 | 1 | 8ä½æ— ç¬¦å·æ•´æ•° | unsigned char | Uint8Array()
Uint8C | 1 | 8ä½æ— ç¬¦å·æ•´æ•°(è‡ªåŠ¨è¿‡æ»¤æº¢å‡º) | unsigned char | Uint8ClampedArray()
Int16 | 2 | 16ä½æœ‰ç¬¦å·æ•´æ•° | short | Int16Array()
Uint16 | 2 | 16ä½æ— ç¬¦å·æ•´æ•° | unsigned short | Uint16Array()
Int32 | 4 | 32ä½æœ‰ç¬¦å·æ•´æ•° | int | Int32Array()
Uint32 | 4 | 32ä½æ— ç¬¦å·æ•´æ•° | unsigned int | Uint32Array()
Float32 | 4 | 32ä½æµ®ç‚¹æ•° | float | Float32Array()
Float64 | 8 | 64ä½æµ®ç‚¹æ•° | double | Float64Array()

ä»¥ä¸Š9ä¸ªä¼šå¯¹å†…å­˜è¿›è¡Œä¸åŒä½æ•°çš„æ ¼å¼åŒ–ï¼Œä»¥å¾—åˆ°å¯¹åº”ç±»å‹å€¼çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸åŒäºæ™®é€šæ•°ç»„ï¼Œå®ƒä¸æ”¯æŒç¨€ç–æ•°ç»„ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œè€Œä¸”åŒä¸€ä¸ªæ•°ç»„åªèƒ½å­˜æ”¾åŒä¸€ä¸ªç±»å‹çš„å˜é‡ã€‚

ä»¥ä¸Šæ¯ä¸ªæ„é€ å‡½æ•°éƒ½å¯¹åº”å¦‚ä¸‹å½¢å¼çš„å‚æ•°ï¼š
```js
(buffer, start=0, len=buffer.byteLength-start*8)
```
å¯ä»¥æŒ‡å®šåºåˆ—åŒ–å…¶ä¸­ startåˆ° endéƒ¨åˆ†çš„äºŒè¿›åˆ¶æ•°æ®ã€‚æ³¨æ„è¿™é‡ŒæŒ‡å®šçš„èŒƒå›´å¿…é¡»å’Œæ•°ç»„ç±»å‹æ‰€åŒ¹é…ï¼Œä¸èƒ½å‡ºç°ç±»ä¼¼`new Int32Array(buffer,2,2)`çš„æƒ…å†µã€‚å¦‚æœä½ è§‰å¾—è¿™ä¸ªä¸ç¬¦åˆä½ çš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ DataViewã€‚

å¦‚æœä½ è§‰å¾—ä¸Šé¢çš„å†™æ³•å¤æ‚ï¼Œå¯ä»¥ä¸å†™ new ArrayBufferï¼Œç›´æ¥ä½¿ç”¨ TypedArrayï¼Œä½†æ³¨æ„å‚æ•°çš„æ„ä¹‰ä¸ä¸€æ ·ï¼š
```js
var f64a = new Float64Array(4);    //åˆ†é…32ä¸ªå­—èŠ‚ï¼Œå¹¶ä½œä¸ºdoubleç±»å‹ä½¿ç”¨ã€‚ 32 = 64 / 8 * 4
```

TypedArrayçš„æ„é€ å‡½æ•°è¿˜æ¥å—å¦ä¸€ä¸ªTypedArrayä½œä¸ºå‚æ•°ï¼Œå¼€è¾Ÿæ–°å†…å­˜å¤åˆ¶å…¶å€¼å¹¶æ”¹å˜ç±»å‹ï¼Œå¯¹åŸè§†å›¾å’Œbuffer ä¸æ„æˆå½±å“ï¼Œä¹Ÿä¸å…±ç”¨å†…å­˜ã€‚
TypeArrayçš„æ„é€ å‡½æ•°è¿˜æ¥å—å¦ä¸€ä¸ªArrayä½œä¸ºå‚æ•°ï¼Œå¼€è¾Ÿæ–°å†…å­˜å¤åˆ¶å…¶å€¼ï¼Œå¯¹åŸæ•°ç»„ä¸æ„æˆå½±å“ï¼Œä¹Ÿä¸å…±ç”¨å†…å­˜ã€‚

å½“ç„¶åˆ©ç”¨ä¸€ä¸‹æ–¹æ³•ï¼Œå¯ä»¥æŠŠ TypedArray è½¬æ¢ä¸ºæ™®é€šæ•°ç»„ï¼š
```js
var arr = [].slice.call(typedArray);
```

TypedArrayå…·æœ‰é™¤äº†`concat()`ä»¥å¤–çš„å…¨éƒ¨æ•°ç»„æ–¹æ³•ï¼Œå½“ç„¶ï¼Œå®ƒä¹Ÿå…·æœ‰ iteratorï¼Œå¯ä»¥ç”¨ for...of éå†ã€‚
ä»¥ä¸‹æ˜¯ TypedArray ç‰¹æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼š

- bufferå±æ€§ï¼šè¿”å›è¯¥è§†å›¾å¯¹äºçš„äºŒè¿›åˆ¶å†…å­˜åŒºåŸŸ
- BYTES_PER_ELEMENTå±æ€§ï¼šæ˜¯ä¸ªå¸¸æ•°ï¼Œè¡¨ç¤ºæ•°ç»„ä¸­æ¯ä¸ªå€¼çš„å­—èŠ‚å¤§å°ï¼Œä¸åŒè§†å›¾çš„è¿”å›å€¼ä¸ä¸Šæ–¹è¡¨æ ¼ä¸€è‡´
- byteLength: è¿”å›è¯¥è§†å›¾å¯¹äºçš„å†…å­˜å¤§å°ï¼Œåªè¯»
- byteOffset: è¿”å›è¯¥è§†å›¾ä»å¯¹åº” buffer çš„å“ªä¸ªå­—èŠ‚å¼€å§‹ï¼Œåªè¯»
- set(arr_or_typeArray, start=0): åœ¨å†…å­˜å±‚é¢ï¼Œä»arr_or_typeArray çš„ start ä¸‹æ ‡å¼€å§‹å¤åˆ¶æ•°ç»„åˆ°å½“ç„¶ typeArray
- subarray(start=0,end=this.length),æˆªå– startåˆ° endéƒ¨åˆ†å­æ•°ç»„,ä½†æ˜¯å’ŒåŸæ•°ç»„å…±ç”¨å†…å­˜
- from(): æ¥å—ä¸€ä¸ªå¯éå†å‚æ•°ï¼Œè½¬ä¸ºè¯¥è§†å›¾å®ä¾‹
- of(): å°†å‚æ•°åˆ—è¡¨è½¬ä¸ºè¯¥è§†å›¾å®ä¾‹

å°æŠ€å·§ï¼Œè½¬æ¢å­—ç¬¦ä¸²å’Œ ArrayBuffer
```js
//è¯¥æ–¹æ³•ä»…é™è½¬æ¢ utf-16 çš„å­—ç¬¦ä¸²
function ab2str(buf){
  return String.fromCharCode.apply(null, new Uint16Array(buf));
}
function str2ab(str){
  var len = str.length;
  var view = new Uint16Array(len);
  for(let i = 0; i < len; i++){
    view[i] = str.charCodeAt(i);
  }
  return view.buffer;
}
var str = "Hello world";
var buf = str2ab(str);
var view = new Uint16Array(buf);
for(var i = 0; i < view.length; i++){
  console.log(String.fromCharCode(view[i]));   //ä¸€æ¬¡è¾“å‡º"Hello world"çš„æ¯ä¸ªå­—æ¯
}
console.log(ab2str(buf));    //"Hello world"
```

> è¿™é‡Œæ‰©å±•ä¸€äº›ç¼–ç çŸ¥è¯†ï¼Œæˆ‘ä»¬çŸ¥é“è®¡ç®—æœºé‡Œé¢å­˜å‚¨çš„æ˜¯äºŒè¿›åˆ¶ï¼Œå¹¶ä¸”å­˜å‚¨çš„æœ€å°å•ä½æ˜¯å­—èŠ‚ã€‚ä½†æ˜¯ä¸åŒçš„ç³»ç»Ÿå­˜å‚¨æ–¹å¼ä¸åŒï¼Œåˆ†ä¸ºé«˜ä½ä¼˜å…ˆå’Œä½ä½ä¼˜å…ˆã€‚æ¯”å¦‚ 20170101 è¿™ä¸ªæ•°å­—ï¼Œå…¶åå…­è¿›åˆ¶è¡¨ç¤ºä¸º 0x0133C575, åœ¨ä½ä½ä¼˜å…ˆçš„ç³»ç»Ÿä¸­å­˜å‚¨æ–¹å¼ä¸º `0x75 0xC5 0x33 0x01`, è€Œåœ¨é«˜ä½ä¼˜å…ˆçš„ç³»ç»Ÿä¸­å­˜å‚¨æ–¹å¼ä¸º `0x01 0x33 0xC5 0x75`ã€‚ç”±äºå¤§å¤šæ•°è®¡ç®—æœºé‡‡ç”¨ä½ä½ä¼˜å…ˆçš„æ–¹å¼ï¼Œæ‰€ä»¥ ES6 é‡‡ç”¨æ˜¯ä¹Ÿæ˜¯ä½ä½ä¼˜å…ˆçš„æ–¹å¼ï¼Œä½†é‡åˆ°é«˜ä½ä¼˜å…ˆçš„æ•°æ®æ—¶ï¼Œå°±ä¸èƒ½ç®€å•çš„ç›´æ¥é‚£æ¥ä½¿ç”¨ï¼Œå…·ä½“ä½¿ç”¨ä¼šåœ¨ DataView ä¸­ä»‹ç»ï¼Œè¿™é‡Œè¯´æ˜ä¸€ç§åˆ¤æ–­ä½ä½ä¼˜å…ˆ(little endian)è¿˜æ˜¯é«˜ä½ä¼˜å…ˆ(big endian)çš„æ–¹æ³•:

è¿˜æœ‰éœ€è¦æ³¨æ„çš„æ˜¯æ•°æ®æº¢å‡ºï¼Œè¿™ä¸ªä¹Ÿæ˜¯éœ€è¦æ•°åˆ¶æ–¹é¢åŸºç¡€æ¯”è¾ƒå¥½ç†è§£ï¼Œè¿™é‡Œä¸è¿‡å¤šå±•å¼€äº†ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼š
Uint8 åªèƒ½è¡¨ç¤º8ä½æ— ç¬¦å·æ•´æ•°ï¼Œæœ€å¤§æ˜¯`1111 1111`, ä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„ 0~255ï¼›Int8å› ä¸ºæœ‰äº†ç¬¦å·ä½ï¼Œåªèƒ½è¡¨ç¤ºåè¿›åˆ¶-128~127ï¼Œå¦‚æœç»™å®ƒçš„å€¼ä¸åœ¨è¿™ä¸ªèŒƒå›´å†…å°±ä¼šå‘ç”Ÿæº¢å‡ºï¼Œå¾—åˆ°ä¸€ä¸ªä½ æ„æƒ³ä¸åˆ°ä½†æƒ…ç†ä¹‹ä¸­çš„å€¼
```js
var view1 = new Uint8Array(2);
view1[0] = 256;   //256 äºŒè¿›åˆ¶æ˜¯ 1 0000 0000 ç”±äºæ•°æ®åªèƒ½å®¹çº³8ä¸ªå€¼ï¼Œè¿›ä½1å°±ä¸¢äº†
view1[1] = -1;    //ä¹‹å‰è¯´è¿‡-1 äºŒè¿›åˆ¶(è¡¥ç )ä¸º 1111 1111(å…¨1), ä½œä¸ºæ— ç¬¦å·æ•°8ä¸ª1å°±æ˜¯255

console.log(view1[0]);   //0
console.log(view1[1]);   //255

var view2 = new Int8Array(2);
view2[0] = 128;   //ç”±äºç¬¦å·ä½æº¢å‡ºï¼Œç³»ç»Ÿè‡ªåŠ¨ç”¨32ä½è®¡ç®—è¿™ä¸ªæ•°1 000 0000 0000 0000 0000 0000 1000 0000ï¼Œå–ç¬¦å·ä½å’Œæœ€å8ä½å¾—åˆ°-128
view2[1] = -128;  //ç”±äºç¬¦å·ä½æº¢å‡ºï¼Œç³»ç»Ÿè‡ªåŠ¨ç”¨32ä½è®¡ç®—è¿™ä¸ªæ•°0 111 1111 1111 1111 1111 1111 0111 1111ï¼Œå–ç¬¦å·ä½å’Œæœ€å8ä½å¾—åˆ°127
console.log(view2[0]);   //-128
console.log(view2[1]);   //127
```

ä¸ºäº†é˜²æ­¢è¿™æ ·çš„æƒ…å†µï¼Œjs æœ‰ä¸€ä¸ª Unit8ClampedArray, ä½¿æ•´æ•°æ–¹å‘çš„æº¢å‡ºå€¼ä¸º255ï¼Œ0æ–¹å‘çš„æ˜“æ¥šå¿—ä¸º0ã€‚æ³¨æ„è¿™æ˜¯ä¸ªæ— ç¬¦å·çš„ç±»å‹ï¼›
```js
var view = new Uint8ClampedArray(2);
view[0] = 256;
view[1] = -1;

console.log(view[0]);   //255
console.log(view[1]);   //0
```

### å¤åˆè§†å›¾

åˆ’åˆ†ä¸€å— buffer ä½¿ç”¨å¾—åˆ° C è¯­è¨€ä¸­çš„ç»“æ„ä½“
```js
var buf = new ArrayBuffer(24);
var name = new Uint8Array(buf, 0, 16);
var gender = new Uint8Array(buf, 16, 1);
var age = new Uint16Array(buf, 18, 1);
var score = new Float32Array(buf,20,1);
```
ç›¸å½“äºä»¥ä¸‹ Cè¯­è¨€ä»£ç 
```cpp
struct Person{
  char name[16];
  char gender;
  int age;
  float score;
}
```

å…±ç”¨ä¸€å— buffer ä½¿ç”¨å¾—åˆ° C è¯­è¨€ä¸­çš„è”åˆä½“
```js
var buf = new ArrayBuffer(8);
var num = new Uint16Array(buf);
var dotNum = new Float64Array(buf);
```
ç›¸å½“äºä»¥ä¸‹ Cè¯­è¨€ä»£ç 
```cpp
union Example{
  int num[4];
  double dotNum;
}

```

### DataView

å…·æœ‰ä¸€ä¸ªæ„é€ å‡½æ•° DataView(), æ¥å—ä¸€ä¸ªArrayBufferå‚æ•°,è§†å›¾åŒ–è¯¥æ®µå†…å­˜ã€‚æ¯•ç«Ÿå½“ä¸€æ®µå†…å­˜æœ‰å¤šç§æ•°æ®æ—¶ï¼Œå¤åˆè§†å›¾ä¹Ÿä¸æ˜¯é‚£ä¹ˆæ–¹ä¾¿ï¼Œè¿™æ—¶é€‚åˆä½¿ç”¨ DataView è§†å›¾ã€‚å…¶æ¬¡ DataView å¯ä»¥è‡ªå®šä¹‰é«˜ä½ä¼˜å…ˆå’Œä½ä½ä¼˜å…ˆï¼Œè¿™æ ·å¯ä»¥è¯»å–çš„æ•°æ®å°±æ›´å¤šäº†ã€‚
DataViewæ„é€ å‡½æ•°å½¢å¼å¦‚ä¸‹,è¿™ä¸€ç‚¹å’Œ TypedArray ä¸€è‡´ï¼š
```js
(buffer, start=0, len=buffer.byteLength-start*8)
```

å®ƒå…·æœ‰ä»¥ä¸‹æ–¹æ³•æ ¼å¼åŒ–è¯»å– buffer ä¸­çš„ä¿¡æ¯ï¼š

- getInt8(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 1 ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª8ä½æœ‰ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- getUint8(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 1 ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª8ä½æ— ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- getInt16(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 2 ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª16ä½æœ‰ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- getUint16(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 2 ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª16ä½æ— ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- getInt32(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 4 ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª32ä½æœ‰ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- getUint32(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 4 ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- getFloat32(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 4 ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª32ä½æµ®ç‚¹æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- getFloat64(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 8 ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª64ä½æµ®ç‚¹æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›


å®ƒå…·æœ‰ä»¥ä¸‹æ–¹æ³•æ ¼å¼åŒ–å†™å…¥ buffer ä¸­çš„ä¿¡æ¯ï¼š

- setInt8(start,value,isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 1 ä¸ªå­—èŠ‚çš„8ä½æœ‰ç¬¦å·æ•´æ•°valueï¼›ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- setUint8(start,value,isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 1 ä¸ªå­—èŠ‚çš„8ä½æ— ç¬¦å·æ•´æ•°valueï¼›ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- setInt16(start,value,isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 2 ä¸ªå­—èŠ‚çš„16ä½æœ‰ç¬¦å·æ•´æ•°valueï¼›ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- setUint16(start,value,isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 2 ä¸ªå­—èŠ‚çš„16ä½æ— ç¬¦å·æ•´æ•°valueï¼›ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- setInt32(start,value,isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 4 ä¸ªå­—èŠ‚çš„32ä½æœ‰ç¬¦å·æ•´æ•°valueï¼›ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- setUint32(start,value,isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 4 ä¸ªå­—èŠ‚çš„32ä½æ— ç¬¦å·æ•´æ•°valueï¼›ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- setFloat32(start,value,isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 4 ä¸ªå­—èŠ‚çš„32ä½æµ®ç‚¹æ•°valueï¼›ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›
- setFloat64(start,value,isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 8 ä¸ªå­—èŠ‚çš„64ä½æµ®ç‚¹æ•°valueï¼›ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆï¼Œä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆï¼›

å®ƒå…·æœ‰ä»¥ä¸‹å±æ€§å’Œæ–¹æ³•ï¼š

- bufferå±æ€§ï¼šè¿”å›è¯¥è§†å›¾å¯¹äºçš„äºŒè¿›åˆ¶å†…å­˜åŒºåŸŸ
- byteLength: è¿”å›è¯¥è§†å›¾å¯¹äºçš„å†…å­˜å¤§å°ï¼Œåªè¯»
- byteOffset: è¿”å›è¯¥è§†å›¾ä»å¯¹åº” buffer çš„å“ªä¸ªå­—èŠ‚å¼€å§‹ï¼Œåªè¯»

å¦‚æœä½ ä¸çŸ¥é“è®¡ç®—æœºä½¿ç”¨çš„æ˜¯é«˜ä½ä¼˜å…ˆè¿˜æ˜¯ä½ä½ä¼˜å…ˆï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œåˆ¤æ–­ï¼š
```js
//æ–¹æ³•1
const BIG_ENDIAN = Symbol('BIG_ENDIAN');
const LITTLE_ENDIAN = Symbol('LITTLE_ENDIAN');
function getPlatformEndianness(){
  let arr32 =  Uint32Array.of(0x12345678);
  let arr8 = new Uint8Array(arr32.buffer);
  switch((arr8[0]*0x1000000)+(arr8[1]*0x10000)+(arr8[2]*0x100)+arr8[3]){
    case 0x12345678: return BIG_ENDIAN;
    case 0x78563412: return LITTLE_ENDIAN;
    default: throw new Error("unknow Endianness");
  }
}

//æ–¹æ³•2
window.isLittleEndian = (function(){
  var buffer = new ArrayBuffer(2);
  new DataView(buffer).setInt16(0, 256, true);
  return new Int16Array(buffer)[0] === 256;
}());
```

## æ­£åˆ™è¡¨è¾¾å¼æ‰©å±•

- æ„é€ å‡½æ•°æ”¯æŒä¼ å…¥æ­£åˆ™å¾—åˆ°æ‹·è´ï¼ŒåŒæ—¶å¯ä»¥ç”¨ç¬¬äºŒå‚ä¿®æ”¹ä¿®é¥°ç¬¦
```js
var reg = /^abc/ig;
var newReg_ig = new RegExp(reg);      //newReg_ig = /^abc/ig;
var newReg_g = new RegExp(reg,'g');      //newReg_g = /^abc/g;
```

- å¼•å…¥æ–°çš„ä¿®é¥°ç¬¦
ES5ä¸­çš„ä¿®é¥°ç¬¦æœ‰3ä¸ª, åŠ ä¸Š ES6 çš„ä¿®é¥°ç¬¦ï¼Œä¸€å…±5ä¸ªï¼š

ä¿®é¥°ç¬¦ | æè¿° | æè¿°
--- | --- | ---
m | multiline | å¤šè¡Œæ¨¡å¼
i | ignore case | å¿½ç•¥å¤§å°å†™æ¨¡å¼
g | global match | å…¨å±€åŒ¹é…æ¨¡å¼
u | unicode | unicodeæ¨¡å¼
y | sticky | ç²˜è¿æ¨¡å¼

unicode æ¨¡å¼
ä¸ºäº†å…¼å®¹ 4 è‡ªå·± unicode, æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸‹æƒ…å†µä½¿ç”¨è¯¥æ¨¡å¼
```js
//æƒ…å†µ1ï¼š
/^\uD83D/.test("\uD83D\uDC2A");   //true, å¾ˆæ˜æ˜¾è¿™ä¸ªæ˜¯ä¸å¯¹çš„, å› ä¸º \uD83D\uDC2A æ˜¯ä¸€ä¸ªå­—ï¼Œä¸èƒ½æ‹†å¼€
/^\uD83D/u.test("\uD83D\uDC2A");   //false

//æƒ…å†µ2
var s = "ğ ®·";
/^.$/.test(s);     //false, é€šé…ç¬¦ . ä¸èƒ½åŒ¹é…32ä½unicode
/^.$/u.test(s);     //true

//æƒ…å†µ3
var s = "ğ ®·a";
/\u{63}/.test(s);     //false, ä¸èƒ½ä½¿ç”¨{}å½¢å¼çš„ unicodeï¼Œè¢«ç”µè„‘è®¤ä¸º u å‡ºç°63æ¬¡
/\u{63}/u.test(s);     //false, å³ä½¿ç”¨äº† u ä¹Ÿä¸€æ ·
//ä¸ºäº†é¿å…è¿™ç§è¯¯è§£ï¼Œåˆç†ä½¿ç”¨ u ä¿®é¥°ç¬¦

//æƒ…å†µ3
var s = "ğ ®·";
/^\S$/.test(s);     //false, \S æ— æ³•ç›‘æµ‹åˆ°32ä½ unicode
/^\S$/u.test(s);     //true
```

å½“ç„¶è¿™ä¸ªé‡Œé¢è¿˜æ˜¯æœ‰å‘çš„ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªï¼š
```js
var k1 = "\u004B";
var k2 = "\u212A";

/[a-z]/i.test(k1);     //true
/[a-z]/iu.test(k1);     //true
/[a-z]/i.test(k2);     //false
/[a-z]/iu.test(k2);     //true
```
ç¬¬ä¸‰ä¸ªè¾“å‡ºå±…ç„¶æ˜¯ falseï¼Ÿæ ¹æœ¬æ²¡æœ‰32ä½ unicode å‘€ï¼Œå¹²å˜›ç”¨uä¿®é¥°ï¼Ÿ å…¶å® `"\u004B"` å’Œ `"\u212A"` éƒ½æ˜¯ `K`(å‰ä¸€ä¸ªæ˜¯çœŸ Kï¼Œåä¸€ä¸ªæ˜¯å‡çš„ï¼‰ï¼Œåšä¸»ä¹Ÿä¸çŸ¥é“ä¸ºå•¥ä¼šè¿™æ ·ï¼

y ä¿®é¥°ç¬¦

å’Œå…¨å±€ä¿®é¥°ç¬¦(g)ç±»ä¼¼ï¼Œæ‰§è¡Œå…¨å±€åŒ¹é…ï¼Œä½† g åªæœ‰å‰©ä½™ä½ç½®å­˜åœ¨åŒ¹é…å³å¯ï¼Œy åˆ™å¿…é¡»ä¸­ä¸Šæ¬¡åŒ¹é…çš„ä¸‹ä¸€ä¸ªå­—æ¯å¼€å§‹ã€‚
```js
var s = 'aaa_aa_a';
var r1 = /a+/g;
var r2 = /a+/y;

r1.exec(s);  //["aaa"], å‰©ä½™å­—ç¬¦æ˜¯ '_aa_a'
r2.exec(s);  //["aaa"], å‰©ä½™å­—ç¬¦æ˜¯ '_aa_a'

r1.exec(s);  //["aa"], é™å®šèµ·å§‹ç‚¹ï¼Œå¾—åˆ° aaï¼Œ å‰©ä½™å­—ç¬¦æ˜¯ '_a'
r2.exec(s);  //null, å¿…é¡»ä»å‰©ä½™å­—ç¬¦çš„ç¬¬ä¸€ä¸ªå°±åŒ¹é…åˆ°ï¼Œç›¸å½“äº /^a+/g, ç”±äºåŒ¹é…ä¸åˆ°è¿”å› nullï¼ŒåŒæ—¶å°† lastIndex ç½® 0

r1.exec(s);  //["a"], å‰©ä½™å­—ç¬¦æ˜¯ ''
r2.exec(s);  //["aaa"], å‰©ä½™å­—ç¬¦æ˜¯ '_aa_a'
```
yä¿®é¥°ç¬¦å°±æ˜¯ä¸ºäº†è®©èµ·å§‹ä½ç½®åŒ¹é… ^ åœ¨å…¨å±€æœ‰æ•ˆæ‰è®¾è®¡ä½¿ç”¨çš„ã€‚

ä¸æ­¤åŒæ—¶ï¼Œes6 ä¸­çš„ `RegExp.prototype` ä¹ŸåŠ å…¥äº†ä¸€äº›æ–°çš„å±æ€§:
```js
var reg = /^abc/uy;
reg.sticky;   //true, åˆ¤æ–­regæ˜¯å¦æ˜¯ç²˜è¿æ¨¡å¼
reg.unicode;  //true, åˆ¤æ–­regæ˜¯å¦æ˜¯unicodeæ¨¡å¼
reg.flags;    //'uy', å¾—åˆ°å…¶å…¨éƒ¨ä¿®é¥°ç¬¦æ„æˆçš„å­—ç¬¦ä¸²
reg.source;   //'^abc' å¾—åˆ°æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²
var str="^abc."
RegExp.escape(str);  //\^abc\. å¾—åˆ°æ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²è½¬è¯‘å†™æ³•
```

## å‡½æ•°çš„æ‰©å±•

### å‚æ•°é»˜è®¤å€¼

ES5ä¸­è®¾ç½®é»˜è®¤å€¼éå¸¸ä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬è¿™æ ·å†™ï¼š
```js
function fun(a){
  a = a || 2;
  console.log(a);
}
fun();   //2
fun(0);  //2
fun(1);  //1
```
ä»¥ä¸Šå†™æ³•ï¼Œå¦‚æœä¼ å…¥äº†å‚æ•°,ä½†è¿™ä¸ªå‚æ•°å¯¹åº”å€¼çš„å¸ƒå°”å‹æ˜¯ falseï¼Œå°±ä¸èµ·ä½œç”¨äº†ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥åˆ¤æ–­ `arguments.length` æ˜¯å¦ä¸º0æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½†æ¯ä¸ªå‡½æ•°è¿™æ ·å†™å°±å¤ªå•°å—¦äº†ï¼Œå°¤å…¶å‚æ•°æ¯”è¾ƒå¤šçš„æ—¶å€™ã€‚åœ¨ ES6 ä¸­æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™åœ¨å‚æ•°è¡¨ä¸­ï¼Œå¦‚æœå®é™…è°ƒç”¨ä¼ é€’äº†å‚æ•°ï¼Œå°±ç”¨è¿™ä¸ªä¼ è¿‡æ¥çš„å‚æ•°ï¼Œå¦åˆ™ç”¨é»˜è®¤å‚æ•°ã€‚åƒè¿™æ ·ï¼š
```js
function fun(a=2){
  console.log(a);
}
fun();   //2
fun(0);  //0
fun(1);  //1
```
å…¶å®å‡½æ•°é»˜è®¤å‚æ•°è¿™ä¸€ç‚¹æœ€å¼ºå¤§çš„åœ°æ–¹åœ¨äºå¯ä»¥å’Œè§£æ„èµ‹å€¼ç»“åˆä½¿ç”¨ï¼š
```js
//å‚æ•°ä¼ é€’
function f([x,y,z=4]){
  return [x+1,y+2,z+3];
}
var [a,b,c] = f([1,2]);  //a=2,b=4,c=7
[[1,2],[3,4]].map(([a,b]) => a + b);   //è¿”å› [3,7]
```
é€šè¿‡ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸éš¾å‘ç°ï¼Œä¸ä»…å¯ä»¥ç”¨è§£æ„çš„æ–¹æ³•è®¾ç½®åˆå§‹å€¼ï¼Œè¿˜å¯ä»¥è¿›è¡Œå‚æ•°ä¼ é€’ã€‚å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡å½¢å¼çš„è§£æ„èµ‹å€¼ã€‚å¦‚æœä¼ å…¥çš„å‚æ•°æ— æ³•è§£æ„ï¼Œå°±ä¼šæŠ¥é”™ï¼š
```js
function fun1({a=1, b=5, c='A'}){
  console.log(c + (a + b));
}
fun1({});   //'A6'
fun1();     //TypeError,å› ä¸ºæ— æ³•è§£æ„
//ä½†è¿™æ ·è®¾è®¡å‡½æ•°å¯¹ä½¿ç”¨å‡½æ•°çš„ç å†œå¾ˆä¸å‹å¥½
//æ‰€ä»¥ï¼ŒæŠ€å·§ï¼š
function fun2({a=1, b=5, c='A'}={}){
  console.log(c + (a + b));
}
fun2();     //'A6'
```
æ³¨æ„ï¼Œå…¶å®è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œä½†ä¸å¦‚è¿™ä¸ªå¥½ï¼Œæˆ‘ä»¬æ¯”è¾ƒå¦‚ä¸‹ï¼š
```js
//fun1 æ¯” fun2 å¥½ï¼Œä¸ä¼šäº§ç”Ÿä»¥å¤–çš„ undefined
function fun1({a=1, b=5, c='A'}={}){
  console.log(c + (a + b));
}
function fun2({a, b, c}={a:1, b:5, c:'A'}){
  console.log(c + (a + b));
}
//ä¼ äº†å‚æ•°ï¼Œä½†æ²¡ä¼ å…¨éƒ¨å‚æ•°å°±ä¼šå‡ºé—®é¢˜
fun1({a:8});     //'A13'
fun2({a:8});     //NaN
```

ä¸è¿‡è¿™é‡Œå¼ºçƒˆå»ºè®®ï¼Œå°†å…·æœ‰é»˜è®¤å€¼çš„å‚æ•°æ’åœ¨å‚æ•°åˆ—è¡¨çš„åé¢ã€‚å¦åˆ™è°ƒç”¨æ—¶ä¾ç„¶éœ€è¦ä¼ å‚ï¼š
```js
function f1(a=1, b){
  console.log(a + b);
}
function f2(a, b=1){
  console.log(a + b);
}
f2(2);   //3
f1(,2);  //æŠ¥é”™
f1(undefined, 2);  //3, æ³¨æ„è¿™é‡Œä¸èƒ½ç”¨ null è§¦å‘é»˜è®¤å€¼
```

- å‡½æ•°çš„ length å±æ€§
è¿™ä¸ªå±æ€§ES6 ä¹‹å‰å°±æ˜¯å­˜åœ¨çš„ï¼Œè®°å¾—lengthè¡¨ç¤ºé¢„è®¡ä¼ å…¥çš„å½¢å‚ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é»˜è®¤å€¼çš„å½¢å‚ä¸ªæ•°:
```js
(function(a){}).length;   //1
(function(a = 5){}).length;   //0
(function(a,b,c=5){}).length;   //2
(function(...args){}).length;   //0ï¼Œrestå‚æ•°ä¹Ÿä¸è®¡å…¥ length
```

## rest å‚æ•°

rest å‚æ•°å½¢å¼ä¸º `...å˜é‡å`ï¼Œå®ƒä¼šå°†å¯¹åº”çš„å…¨éƒ¨å®é™…ä¼ é€’çš„å˜é‡æ”¾å…¥æ•°ç»„ä¸­, å¯ä»¥ç”¨å®ƒæ¥æ›¿ä»£ argumentsï¼š
```js
function f(...val){
  console.log(val.join());
}
f(1,2);      //[1,2]
f(1,2,3,4);  //[1,2,3,4]

function g(a, ...val){
  console.log(val.join());
}
g(1,2);      //[2]
g(1,2,3,4);  //[2,3,4]
```
å¦åˆ™è¿™ä¸ªå‡½æ•° g ä½ çš„è¿™æ ·å®šä¹‰å‡½æ•°ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼š
```js
function g(a){
  console.log([].slice.call(arguments,1).join());
}
```

è¿™é‡Œéœ€è¦æ³¨æ„2ç‚¹ï¼š
- restå‚æ•°å¿…é¡»æ˜¯å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œå®ƒçš„åé¢ä¸èƒ½å†å®šä¹‰å‚æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
- restå‚æ•°ä¸è®¡å…¥å‡½æ•°çš„ length å±æ€§ä¸­

### æ‰©å±•è¿ç®—ç¬¦

æ‰©å±•è¿ç®—ç¬¦ç±»ä¼¼ restè¿ç®—ç¬¦çš„é€†è¿ç®—ï¼Œç”¨ `...` è¡¨ç¤º, æ”¾åœ¨ä¸€ä¸ª(ç±»)æ•°ç»„å‰ï¼Œå°†è¯¥æ•°ç»„å±•å¼€æˆç‹¬ç«‹çš„å…ƒç´ åºåˆ—ï¼š
```js
console.log(1,...[2,3,4],5);  //è¾“å‡º1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5
```

æ‰©å±•è¿ç®—ç¬¦çš„ç”¨å¤„å¾ˆå¤šï¼š
- å¯ä»¥ç”¨äºå¿«é€Ÿæ”¹å˜ç±»æ•°ç»„å¯¹è±¡ä¸ºæ•°ç»„å¯¹è±¡,ä¹Ÿæ˜¯ç”¨äºå…¶ä»–å¯éå†å¯¹è±¡ï¼š
```js
[...document.querySelectorAll('li')];   //[<li>,<li>,<li>];
```

- ç»“åˆ rest å‚æ•°ä½¿å‡½æ•°äº‹åŠåŠŸå€ï¼š
```js
function push(arr, ...val){
  return arr.push(...val);      //è°ƒç”¨å‡½æ•°æ—¶ï¼Œå°†æ•°ç»„å˜ä¸ºåºåˆ—
}
```

- æ›¿ä»£ apply å†™æ³•
```js
var arr = [1,2,3];
var max = Math.max(...arr);   //3

var arr2 = [4,5,6];
arr.push(...arr2);     //[1,2,3,4,5,6]

new Date(...[2013,1,1]);   //ri Feb 01 2013 00:00:00 GMT+0800 (CST)
```

- è¿æ¥,åˆå¹¶æ•°ç»„
```js
var more = [4,5];
var arr = [1,2,3, ...more];    //[1,2,3,4,5]

var a1 = [1,2];
var a2 = [3,4];
var a3 = [5,6];
var a = [...a1, ...a2, ...a3];     //[1,2,3,4,5,6]
```

- è§£æ„èµ‹å€¼
```js
var a = [1,2,3,4,5];
var [a1, ...more] = a;      //a1 = 1, more = [2,3,4,5]
//æ³¨æ„ï¼Œæ‰©å±•è¿ç®—ç¬¦å¿…é¡»æ”¾åœ¨è§£æ„èµ‹å€¼çš„ç»“å°¾ï¼Œå¦åˆ™æŠ¥é”™
```

- å­—ç¬¦ä¸²æ‹†åˆ†
```js
var str = "hello";
var alpha = [...str];    //alpha = ['h','e','l','l','o']

[...'x\uD83D\uDE80y'].length;   //3,  æ­£ç¡®å¤„ç†32ä½ unicode å­—ç¬¦

```

### name å±æ€§

name å±æ€§è¿”å›å‡½æ•°çš„åå­—ï¼Œå¯¹äºåŒ¿åå‡½æ•°è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚ä¸è¿‡å¯¹äºè¡¨è¾¾å¼æ³•å®šä¹‰çš„å‡½æ•°ï¼ŒES5 å’Œ ES6æœ‰å·®åˆ«ï¼š
```js
var fun = function(){}
fun.name;     //ES5: "", ES6:  "fun"

(function(){}).name;   //""
```

å¯¹äºæœ‰2ä¸ªåå­—çš„å‡½æ•°ï¼Œè¿”å›åè€…,ES5 å’Œ ES6æ²¡æœ‰å·®åˆ«:
```js
var fun  = function baz(){}
fun.name;        //baz
```

å¯¹äº Function æ„é€ å‡½æ•°å¾—åˆ°çš„å‡½æ•°ï¼Œè¿”å› `anonymous`ï¼š
```js
new Function("fun").name;    //"anonymous"
new Function().name;    //"anonymous"
(new Function).name;    //"anonymous"
```

å¯¹äº bind è¿”å›çš„å‡½æ•°ï¼ŒåŠ ä¸Š `bound ` å‰ç¼€
```js
function f(){}
f.bind({}).name;   //"bound f"

(function(){}).bind({}).name;    //"bound "

(new Function).bind({}).name;    //"bound anonymous"
```

### ç®­å¤´å‡½æ•°

ç®­å¤´å‡½æ•°çš„å½¢å¼å¦‚ä¸‹ï¼š
```js
var fun = (å‚æ•°åˆ—è¡¨) => {å‡½æ•°ä½“};
```
å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°(ä¸”ä¸æŒ‡å®šé»˜è®¤å€¼)ï¼Œå‚æ•°åˆ—è¡¨çš„åœ†æ‹¬å·å¯ä»¥çœç•¥ï¼›(å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œåœ†æ‹¬å·ä¸èƒ½çœç•¥)
å¦‚æœåªæœ‰ä¸€ä¸ª return è¯­å¥ï¼Œé‚£ä¹ˆå‡½æ•°ä½“çš„èŠ±æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥ï¼ŒåŒæ—¶çœç•¥ return å…³é”®å­—ã€‚
```js
var fun = value => value + 1;
//ç­‰åŒäº
var fun = function(value){
  return value + 1;
}
```
```js
var fun = () => 5;
//ç­‰åŒäº
var fun = function(){
  return 5;
}
```
å¦‚æœç®­å¤´å‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼æœ‰å¯¹è±¡ï¼Œåº”è¯¥ç”¨ `()` æ‹¬èµ·æ¥ï¼š
```js
var fun = n => ({name: n});
var fun = ({num1=1,num2=3}={}) => num1 + num2;
```

çœ‹å®Œä¹‹å‰çš„éƒ¨åˆ†,ç®­å¤´å‡½æ•°åº”è¯¥ä¸é™Œç”Ÿäº†ï¼š
```js
var warp = (...val) => val;
var arr1 = warp(2,1,3);              //[2,1,3]
var arr2 = arr1.map(x => x * x);     //[4,1,9]
arr2.sort((a, b) => a - b);          //[1,4,9]
```

ä½¿ç”¨ç®­å¤´å‡½æ•°åº”æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š
- ä¸å¯ä»¥å°†å‡½æ•°å½“åšæ„é€ å‡½æ•°è°ƒç”¨ï¼Œå³ä¸èƒ½ä½¿ç”¨ new å‘½ä»¤ï¼›
- ä¸å¯ä»¥åœ¨ç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ yield è¿”å›å€¼ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨è¿‡ Generator å‡½æ•°ï¼›
- å‡½æ•°ä½“å†…ä¸å­˜åœ¨ arguments å‚æ•°ï¼›
- å‡½æ•°ä½“å†…éƒ¨ä¸æ„æˆç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œå†…éƒ¨çš„ this å’Œå®šä¹‰æ—¶å€™çš„ä¸Šä¸‹æ–‡ä¸€è‡´;ä½†å¯ä»¥é€šè¿‡ call, apply, bind æ”¹å˜å‡½æ•°ä¸­çš„ thisã€‚å…³äºä½œç”¨åŸŸï¼Œé›†ä¸­åœ¨ES6å‡½æ•°æ‰©å±•çš„æœ€åè®¨è®ºã€‚

ä¸¾å‡ ä¸ªç®­å¤´å‡½æ•°çš„å®ä¾‹ï¼š
å®ä¾‹1ï¼šå®ç°åŠŸèƒ½å¦‚: `insert(2).into([1,3]).after(1)`æˆ–`insert(2).into([1,3]).before(3)`è¿™æ ·çš„å‡½æ•°ï¼š
```js
var insert = value => ({
  into: arr => ({
    before: val => {
      arr.splice(arr.indexOf(val), 0, value);
      return arr;
    },
    after: val => {
      arr.splice(arr.indexOf(val) + 1, 0, value);
      return arr;
    }
  })
});
console.log(insert(2).into([1,3]).after(1));
console.log(insert(2).into([1,3]).before(3));
```

å®ä¾‹2: æ„å»ºä¸€ä¸ªç®¡é“(å‰ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºæ˜¯åä¸€ä¸ªå‡½æ•°çš„è¾“å…¥):
```js
var pipe = (...funcs) => (init_val) => funcs.reduce((a,b) => b(a), init_val);

//å®ç° 2 çš„ (3+2) æ¬¡æ–¹
var plus = a => a + 2;
pipe(plus, Math.pow.bind(null,2))(3);         //32
```

å®ä¾‹3: å®ç° ğœ† æ¼”ç®—
```js
//fix = ğœ†f.(ğœ†x.f(ğœ†v.x(x)(v)))(ğœ†x.f(ğœ†v.x(x)(v)))
var fix = f => (x => f(v => x(x)(v)))(x => f(v => x(x)(v)));
```

### å‡½æ•°ç»‘å®š

ES7 ä¸­æå‡ºäº†å‡½æ•°ç»‘å®šè¿ç®—ï¼Œåœ¨ Babel ä¸­å·²ç»å®ç°ã€‚å…å»æˆ‘ä»¬ä½¿ç”¨ call, bind, apply çš„å„ç§ä¸æ–¹ä¾¿, å½¢å¼å¦‚ä¸‹:
```cpp
objName::funcName
```
ä»¥ä¸‹å‡ ç»„è¯­å¥ä¸¤ä¸¤ç­‰åŒ
```js
var newFunc = obj::func;
//ç›¸å½“äº
var newFunc = func.bind(obj);

var result = obj::func(...arguments);
//ç›¸å½“äº
var result = func.apply(obj, arguments);
```

å¦‚æœ `::` å·¦è¾¹çš„å¯¹è±¡åŸæœ¬å°±æ˜¯å³è¾¹æ–¹æ³•ä¸­çš„ this, å·¦è¾¹å¯ä»¥çœç•¥
```js
var fun = obj::obj.func;
//ç›¸å½“äº
var fun = ::obj.func;
//ç›¸å½“äº
var fun = obj.func.bind(obj);
```

`::` è¿ç®—è¿”å›çš„è¿˜æ˜¯å¯¹è±¡ï¼Œå¯ä»¥è¿›è¡Œé“¾å¼è°ƒç”¨ï¼š
```js
$('.my-class')::find('p')::text("new text");
//ç›¸å½“äº
$('.my-class').find('p').text("new text");
```

### å°¾è°ƒç”¨ä¼˜åŒ–

å°¾è°ƒç”¨æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µï¼ŒæŒ‡åœ¨å‡½æ•°æœ€åè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚
```js
//æ˜¯å°¾è°ƒç”¨
function a(){
  return g();
}
function b(p){
  if(p>0){
    return m();
  }
  return n();
}
function c(){
  return c();
}

//ä»¥ä¸‹ä¸æ˜¯å°¾è°ƒç”¨
function d(){
  var b1 = g();
  return b1;
}
function e(){
  g();
}
function f(){
  return g() + 1;
}
```

å°¾è°ƒç”¨çš„ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹å°±æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†å‡½æ•°å°¾éƒ¨è°ƒç”¨çš„å‡½æ•°æ”¾åœ¨è¯¥å‡½æ•°å¤–é¢(åé¢)ï¼Œè€Œä¸æ”¹å˜ç¨‹åºå®ç°ç»“æœã€‚è¿™æ ·å¯ä»¥å‡å°‘å‡½æ•°è°ƒç”¨æ ˆçš„å¼€é”€ã€‚
è¿™æ ·çš„ä¼˜åŒ–åœ¨ ES6 çš„ä¸¥æ ¼æ¨¡å¼ä¸­è¢«å¼ºåˆ¶å®ç°äº†ï¼Œæˆ‘ä»¬éœ€è¦åšçš„ä»…ä»…æ˜¯åœ¨ä½¿ç”¨æ—¶å€™åˆ©ç”¨å¥½è¿™ä¸ªä¼˜åŒ–ç‰¹æ€§ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªé˜¶ä¹˜å‡½æ•°ï¼š
```js
function factorial(n){
  if(n <= 1) return 1;
  return n * factorial(n - 1);
}
factorial(5);     //120
```
è¿™ä¸ªå‡½æ•°è®¡ç®— n çš„é˜¶ä¹˜, å°±è¦åœ¨å†…å­˜ä¿ç•™ n ä¸ªå‡½æ•°è°ƒç”¨è®°å½•ï¼Œç©ºé—´å¤æ‚åº¦ O(n), å¦‚æœ n å¾ˆå¤§å¯èƒ½ä¼šæº¢å‡ºã€‚æ‰€ä»¥è¿›è¡Œä¼˜åŒ–å¦‚ä¸‹ï¼š
```js
"use strict";
function factorial(n, result = 1){
  if(n <= 1) return result;
  return factorial(n - 1, n * result);
}
factorial(5);     //120
```
å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æŸ¯é‡ŒåŒ–ï¼š
```js
var factorial = (function factor(result, n){
  if(n <= 1) return result;
  return factor(n * result, n - 1);
}).bind(null,1);
factorial(5);     //120
```

### å‡½æ•°çš„å°¾é€—å·

è¿™ä¸ªä»…ä»…æ˜¯ä¸€ä¸ªææ¡ˆï¼šä¸ºäº†æ›´å¥½åœ°è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œåœ¨å‡½æ•°å‚æ•°å°¾éƒ¨åŠ ä¸€ä¸ªé€—å·ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°æ—¥åä¼šè¢«ä¿®æ”¹ï¼Œä¾¿äºç‰ˆæœ¬æ§åˆ¶å™¨è·Ÿè¸ªã€‚ç›®å‰å¹¶æœªå®ç°ã€‚

### ä½œç”¨åŸŸ

è¿™é‡Œä»…ä»…è®¨è®º ES6 ä¸­çš„å˜é‡ä½œç”¨åŸŸã€‚é™¤äº† let å’Œ const å®šä¹‰çš„çš„å˜é‡å…·æœ‰å—çº§ä½œç”¨åŸŸä»¥å¤–ï¼Œ`var` å’Œ `function` ä¾æ—§éµå®ˆè¯æ³•ä½œç”¨åŸŸ, è¯æ³•ä½œç”¨åŸŸå¯ä»¥å‚è€ƒåšä¸»çš„å¦ä¸€ç¯‡æ–‡ç« [javascriptå‡½æ•°ã€ä½œç”¨åŸŸé“¾ä¸é—­åŒ…](http://blog.csdn.net/faremax/article/details/53201809)

é¦–å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼š
```js
var x = 1;
function f(x, y=x){
  console.log(y);
}
f(2);    //2
```
è¿™ä¸ªä¾‹å­è¾“å‡ºäº†2ï¼Œå› ä¸º y åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå‡½æ•°å†…éƒ¨çš„ x å·²ç»å®šä¹‰å¹¶å®Œæˆèµ‹å€¼äº†ï¼Œæ‰€ä»¥ï¼Œ`y = x` ä¸­çš„ `x` å·²ç»æ˜¯å‡½æ•°çš„å±€éƒ¨å˜é‡ x äº†ï¼Œè€Œä¸æ˜¯å…¨å±€çš„ xã€‚å½“ç„¶ï¼Œå¦‚æœå±€éƒ¨ x å˜é‡åœ¨ y å£°æ˜ä¹‹åå£°æ˜å°±æ²¡é—®é¢˜äº†ã€‚
```js
var x = 1;
function f(y=x){
  let x = 2
  console.log(y);
}
f();    //1
```

é‚£å¦‚æœå‡½æ•°çš„é»˜è®¤å‚æ•°æ˜¯å‡½æ•°å‘¢ï¼Ÿçƒ§è„‘çš„è¦æ¥äº†ï¼š
```js
var foo = "outer";
function f(x){
  return foo;
}
function fun(foo, func = f){
  console.log(func());
}
fun("inner");   //"outer"
```
å¦‚æœåŸºç¡€å¥½ï¼Œé‚£å°±æ ¹æœ¬è°ˆä¸ä¸Šä¸çƒ§è„‘ã€‚å› ä¸ºï¼Œå‡½æ•°ä¸­çš„ä½œç”¨åŸŸå–å†³äºå‡½æ•°å®šä¹‰çš„åœ°æ–¹ï¼Œå‡½æ•°ä¸­çš„ this å–å†³äºå‡½æ•°è°ƒç”¨çš„æ–¹å¼ã€‚ï¼ˆæ•²é»‘æ¿ï¼‰
ä½†å¦‚æœè¿™æ ·å†™ï¼Œå°±æ˜¯ inner äº†, å› ä¸ºfuncé»˜è®¤å‡½æ•°å®šä¹‰çš„æ—¶å€™ funå†…çš„ foo å·²ç»å­˜åœ¨äº†ã€‚
```js
var foo = "outer";
function fun(foo, func = function(x){
  return foo;
}){
  console.log(func());
}
fun("inner");   //"inner"
```

æŠ€å·§ï¼šåˆ©ç”¨é»˜è®¤å€¼ä¿è¯å¿…éœ€çš„å‚æ•°è¢«ä¼ å…¥ï¼Œè€Œå‡å°‘å¯¹å‚æ•°å­˜åœ¨æ€§çš„éªŒè¯ï¼š
```js
function throwErr(){
  throw new Error("Missing Parameter");
}
function fun(necessary = throwErr()){
  //...å¦‚æœå‚æ•°necessaryæ²¡æœ‰æ”¶åˆ°å°±ä½¿ç”¨å‚æ•°ï¼Œä»è€Œæ‰§è¡Œå‡½æ•°æŠ›å‡ºé”™è¯¯
}

//å½“ç„¶ä¹Ÿå¯ä»¥è¿™æ ·è¡¨ç¤ºä¸€ä¸ªå‚æ•°æ˜¯å¯é€‰çš„
function fun(optional = undefined){
  //...
}
```

ç®­å¤´å‡½æ•°çš„ä½œç”¨åŸŸå’Œå®šä¹‰æ—¶çš„ä¸Šä¸‹æ–‡ä¸€è‡´ï¼Œä½†å¯ä»¥é€šè¿‡è°ƒç”¨æ–¹å¼æ”¹å˜ï¼š
```js
window && (window.name = "global") || (global.name = "global");
var o = {
  name: 'obj-o',
  foo: function (){
    setTimeout(() => {console.log(this.name);}, 500);
  }
}

var p = {
  name: 'obj-p',
  foo: function (){
    setTimeout(function(){console.log(this.name);}, 1000);
  }
}

o.foo();    //"obj-o"
p.foo();    //"global"

var temp = {
  name: 'obj-temp'
}

o.foo.bind(temp)();     //"obj-temp"
o.foo.call(temp);     //"obj-temp"
o.foo.apply(temp);     //"obj-temp"

p.foo.bind(temp)();     //"global"
p.foo.call(temp);     //"global"
p.foo.apply(temp);     //"global"
```

## å¯¹è±¡çš„æ‰©å±•

- å…è®¸ä½¿ç”¨å·²æœ‰å¯¹è±¡èµ‹å€¼å®šä¹‰å¯¹è±¡å­—é¢é‡ï¼Œå¹¶ä¸”åªå†™å˜é‡åå³å¯
```js
var name = "Bob";
var getName = function(){console.log(this.name);};

var person = {name, getName};
//ç›¸å½“äº
//var person = {
//name: "Bob",
//getName: function(){console.log(this.name);}
//}
person.getName();   //"Bob"
```

- å¯ä»¥åƒå®šä¹‰å­˜å–å™¨é‚£æ ·å®šä¹‰æ–¹æ³•
```js
var o = {
  _age: 10,
  _score: 60,
  age(num){
    if(num > 0) {
      this._age = num;
      return this;
    }
    return this._age;
  },
  get score(){
    return this._score;
  }
};

console.log(o.age());    //10
o.age(15);
console.log(o.age());    //15
console.log(o.score);    //60
o.score = 100;           //TypeError
```
æ³¨æ„ï¼Œä»¥ä¸‹ä»£ç æ˜¯ç­‰åŒçš„ï¼š
```js
var obj = {
  class () {}       //å¹¶ä¸ä¼šå› ä¸º class æ˜¯å…³é”®å­—è€Œè§£æé”™è¯¯
};
//ç­‰ä»·äº
var obj = {
  'class': function() {}
};
```
å¦‚æœä¸€ä¸ªæ–¹æ³•æ˜¯ Generator å‡½æ•°ï¼Œéœ€è¦åœ¨å‰é¢åŠ  `*`:
```js
var obj = {
  time: 1,
  *gen(){
    yield "hello " + time;
    time++;
  }
}
```

- å±æ€§åè¡¨è¾¾å¼
js æœ¬æ¥å¯ä»¥è¿™æ · `obj['k'+'ey']` è®¿é—®ä¸€ä¸ªå¯¹è±¡å±æ€§ï¼Œç°åœ¨ä¹Ÿå¯ä»¥è¿™æ ·å®šä¹‰å±æ€§äº†ï¼š
```js
var key1 = "name";
var key2 = "age";

var o = {
  [key1]: "Bob",
  [key2]: 18,
  ['first' + key1]: "Ellen"
};
o.name;    //"Bob"
o.age;     //18
o.firstname;   //"Ellen"
```
æ³¨æ„ï¼šè¯¥æ–¹æ³•ä¸èƒ½å’Œä¸Šä¸€å°èŠ‚ä½¿ç”¨å·²æœ‰æ ‡è¯†ç¬¦å®šä¹‰å¯¹è±¡å­—é¢é‡çš„æ–¹æ³•æ··åˆä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼›
```js
//é”™è¯¯ç”¨æ³•
var foo = 'bar';
var bar = 'abc';
var baz = {[foo]};  //æŠ¥é”™
```

- æ–¹æ³•çš„ name å±æ€§
å‡½æ•°æœ‰ name å±æ€§ï¼Œæ–¹æ³•ä¹Ÿå°±æœ‰ name å±æ€§ã€‚ä¸€èˆ¬æ–¹æ³• name è¿”å›å‡½æ•°å(ä¸åŒ…æ‹¬å¯¹è±¡å)ï¼Œå¯¹äºå­˜å–å™¨æ–¹æ³•ï¼Œæ²¡æœ‰ name å±æ€§ï¼š
```js
var o = {
  _age: 10,
  _score: 60,
  _name: "Bob",
  _firstname: "Ellen",
  set age(num){
    if(num > 0) {
      this._age = num;
      return this;
    }
  },
  get age(){
    return this._age;
  },
  get score(){
    return this._score;
  },
  name(n){
    if(!n) return this._name + ' ' + this._firstname;
    this._name = n;
    return this;
  },
  set firstname(n){
    if(n) this._firstname = n;
    return this;
  }
};
console.log(o.name.name);      //"name"
console.log(o.age.name);       //undefined
console.log(o.score.name);     //undefined
console.log(o.firstname);      //undefinedï¼Œæ‰€ä»¥ set å‡½æ•°æ›´ä¸ä¼šæœ‰ name å±æ€§
```
å¦‚æœå¯¹è±¡çš„æ–¹æ³•æ˜¯ä¸ª symbolï¼Œname å±æ€§ä¸ºç©ºå­—ç¬¦ä¸² `""` ï¼š
```js
var sym1 = new Symbol("description of sym1");
var sym2 = new Symbol();
var o = {
  [sym1](){},
  [sym2](){},
};
o[sym1].name;    //""
o[sym2].name;    //""
```

- é™æ€æ–¹æ³•
1. Object.is(a,b): æ¯”è¾ƒa,bä¸¤ä¸ªå€¼æ˜¯å¦ä¸¥æ ¼ç›¸ç­‰ï¼Œç›¸å½“äº `===`, ä½†æœ‰ä¸€ç‚¹ä¸ä¸€æ ·ï¼š
```js
-0 === +0;     //true
NaN === NaN;   //false

Object.is(-0, +0);     //false
Object.is(NaN, NaN);   //true
```
2. Object.assign(target, source1,source2,...): å°†æ¯ä¸ª source å¯¹è±¡è‡ªèº«çš„å¯æšä¸¾å±æ€§å¤åˆ¶åˆ° target å¯¹è±¡ä¸Šï¼Œä¸åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„å±æ€§å’Œä¸å¯æšä¸¾å±æ€§ã€‚åªæœ‰æœ‰ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œå°±ä¼šæŠ›å‡º TypeError é”™è¯¯ã€‚é‡åˆ°åŒåå±æ€§ï¼Œæ’åœ¨åé¢çš„ä¼šè¦†ç›–å‰é¢çš„ï¼š
```js
var target = {a:1,b:2};
var source1 = {a:3,c:3};
var source2 = {a:2,d:0};
Object.assign(target, source1, source2);
console.log(target);      //{a: 2, b: 2, c: 3, d: 0}
```
å¯¹äºå±æ€§åæ˜¯ symbol çš„å¯æšä¸¾å±æ€§ä¹Ÿä¼šè¢«å¤åˆ¶ï¼š
```js
Object.assign({a:'b'}, {[Symbol('c')]:'d'});    //{a: "b", Symbol(c): "d"}
```
å¯¹äºåŒåå±æ€§å­˜åœ¨åµŒå¥—å¯¹è±¡ï¼Œå¤–å±‚ä¼šè¢«ç›´æ¥æ›¿æ¢ï¼š
```js
Object.assign({a:{b:'c',d:'e'}}, {a:{b:'hello'}});     //{a:{b:'hello'}}
```
å¯ä»¥ç”¨ Object.assignå¤„ç†æ•°ç»„ï¼Œä½†ä¼šè§†å…¶ä¸ºå¯¹è±¡ï¼š
```js
Object.assign([1,2,3], [4,5]);     //[4, 5, 3]
```
æŠ€å·§ï¼šä¸ºå¯¹è±¡æ·»åŠ å±æ€§æ–¹æ³•
```js
Object.assign(String.prototype, {
  newProperty: "value",
  newFunction: function(){}
})
```
æŠ€å·§ï¼šå…‹éš†å¯¹è±¡
```js
Object.assign({}ï¼Œorigin);
```
æŠ€å·§ï¼šä¸ºå¯¹è±¡æ·»åŠ å±æ€§æ–¹æ³•
```js
Object.assign(target, ...source);
```
æŠ€å·§ï¼šä¸ºå¯¹è±¡æ·»åŠ å±æ€§æ–¹æ³•
```js
const DEFAULT_OPTION = {   //é»˜è®¤å€¼
  a: 1,
  b: 2
};
function processContent(newOption){
  return Object.assign({}, DEFAULT_OPTION, newOption);
}
//è®¾ç½®å±æ€§åº”è¯¥æ˜¯åŸºæœ¬ç±»å‹ï¼Œå¦åˆ™ä¼šå› ä¸ºæ·±æ‹·è´å‡ºé—®é¢˜
```

### å¯¹è±¡å±æ€§çš„å¯æšä¸¾æ€§ä¸éå†

ä»¥ä¸‹6ä¸ªæ“ä½œä¼šå¿½ç•¥ä¸å¯æšä¸¾çš„å±æ€§

- for...inå¾ªç¯
- Object.keys()
- JSON.stringify()
- Object.assign()
- Reflect.enumerate()
- æ‰©å±•è¿ç®—ç¬¦ `...`

ä»¥ä¸‹4ä¸ªæ–¹æ³•ä¸å¿½ç•¥ä¸å¯æšä¸¾å±æ€§

- Object.getOwnPropertyNames()
- Object.getOwnPropertySymbols()
- Reflect.ownKeys()

ä»¥ä¸Š9ä¸ªæ–¹æ³•ä¸­ï¼Œåªæœ‰2ä¸ªä¼šæ“ä½œåŒ…å«ç»§æ‰¿åˆ°çš„å±æ€§

- for...inå¾ªç¯
- Reflect.enumerate()

ä»¥ä¸Š9ä¸ªæ–¹æ³•ä¸­ï¼Œåªæœ‰1ä¸ªæ–¹æ³•å¯ä»¥è·å¾— Symbol å±æ€§

- Object.getOwnPropertySymbols()

é™¤æ­¤ä¹‹å¤–éœ€è¦å¼ºè°ƒçš„æ˜¯ ES6 ä¸­ï¼Œæ‰€æœ‰ class çš„åŸå‹æ–¹æ³•éƒ½æ˜¯ä¸å¯æšä¸¾çš„ï¼š
```js
Object.getOwnPropertyDescriptor(class{foo(){}}.prototype, foo).enumerable;  //false
```

ES6 èµ·ï¼Œæœ‰äº†7ä¸­éå†å±æ€§çš„æ–¹æ³•ï¼š

- for...in: å¾ªç¯éå†å¯¹è±¡è‡ªèº«å’Œç»§æ‰¿åˆ°çš„å¯æšä¸¾å±æ€§ï¼Œä¸åŒ…æ‹¬ Symbol å±æ€§
- Object.keys(obj): è¿”å›åŒ…å«è‡ªèº«å¯æšä¸¾å±æ€§çš„å±æ€§åæ•°ç»„ï¼Œä¸åŒ…å« Symbol å±æ€§
- Object.getOwnPropertyNames(obj): åŒä¸Šï¼Œä½†åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§
- Object.getOwnPropertySymbols(obj): è¿”å›è‡ªèº«æ‰€æœ‰ Symbol å±æ€§åçš„æ•°ç»„ï¼ŒåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§
- Reflect.ownKey(obj): è¿”å›è‡ªèº«æ‰€æœ‰å±æ€§åæ•°ç»„ï¼ŒåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§å’Œ Symbol å±æ€§å
- Reflect.enumerate(): è¿”å›ä¸€ä¸ª Iterator, ç”¨æ¥éå†å¯¹è±¡è‡ªèº«åŠç»§æ‰¿åˆ°çš„å¯æšä¸¾å±æ€§ï¼Œä¸åŒ…æ‹¬ Symbol å±æ€§ï¼›å’Œ for...in ä¸€æ ·
- for...of: åªèƒ½éå†å…·æœ‰ Iterator æ¥å£çš„å¯¹è±¡ï¼Œå…·ä½“ä½œç”¨èŒƒå›´ç”± iterator å†³å®šï¼Œéå†æ²¡æœ‰ iterator çš„å¯¹è±¡ä¼šæŠ¥é”™

ä»¥ä¸Šæ–¹æ³•é™¤äº† for...of ä»¥å¤–ï¼Œéå†é¡ºåºä¸ºï¼š

- é¦–å…ˆéå†æ‰€æœ‰å±æ€§åä¸ºæ•°å­—çš„å±æ€§ï¼ŒæŒ‰æ•°å­—å¤§å°æ’åºï¼›
- å…¶æ¬¡éå†æ‰€æœ‰å±æ€§åä¸ºå­—ç¬¦ä¸²çš„å±æ€§ï¼ŒæŒ‰å±æ€§ç”Ÿæˆæ—¶é—´æ’åºï¼›
- æœ€åéå†æ‰€æœ‰å±æ€§åä¸º Symbol çš„å±æ€§ï¼ŒæŒ‰å±æ€§ç”Ÿæˆæ—¶é—´æ’åºï¼›

### å¯¹è±¡çš„__proto__å±æ€§

è¿™æ˜¯ä¸ªå¾ˆè€å¾ˆè€çš„å±æ€§ï¼Œåœ¨å¤§å®¶æƒ³æœŸå¾…ä¸‹ï¼ŒES6ç»ˆäºæŠŠå®ƒå†™è¿›å»äº†ï¼Œå—¯ï¼Ÿ...æ˜¯å†™è¿›é™„å½•äº†ã€‚è¿™ä¸ªå±æ€§ç”¨æ¥è¯»å†™å½“å‰çš„å¯¹è±¡çš„åŸå‹å¯¹è±¡`obj.constructor.prototype`

ä»æœ¬è´¨ä¸Šæ¥è®²ï¼Œ`__proto__` æ˜¯å®šä¹‰åœ¨`Object.prototype` ä¸Šçš„ä¸€ä¸ªå­˜å–å™¨å‡½æ•°ï¼š
```js
function isObject(a){
  return Object(a) === a;
}
Object.defineProperty(Object.prototype, '__proto__', {
  get(){
    let _thisObj = Object(this);
    return Object.getPrototypeOf(_thisObj);
  },
  set(proto){
    if(this == null) throw new TypeError();
    if(!isObject(this) || !isObject(proto)) return undefined;
    let status = Object.setPrototypeOf(this, proto);
    if(! status) throw new TypeError();
  }
});
```

ä½†æ˜¯ï¼Œè¿˜æ˜¯ä¸å»ºè®®ä½¿ç”¨è¿™ä¸ªä¸œè¥¿ï¼Œæ¯•ç«Ÿçœ‹å®ƒè¿™åå­—å°±æ˜¯ä¸ªå†…éƒ¨å±æ€§ï¼Œå› ä¸ºå®ƒæœ‰äº†ä¸åŠ ï¼Œä½†ä¸ä¿è¯æ‰€ä»¥ç»ˆç«¯éƒ½èƒ½ç”¨ï¼Œæ‰€ä»¥ES6æ¨èç”¨ä¸‹é¢è¿™ä¸¤ä¸ªå±æ€§ï¼š
```js
Object.setPrototypeOf(obj, newProto);   //å†™
Object.getPrototypeOf(obj);   //è¯»
```
ç®€å•ä¸¾ä¸€ä¸ªä¾‹å­ï¼š
```js
function Rectangle(){}
var rec = new Rectangle();
Object.getPrototypeOf(rec) === Rectangle.prototype;    //true
Object.setPrototypeOf(rec, Object.prototype);
Object.getPrototypeOf(rec) === Rectangle.prototype;    //false
```

å½“ç„¶å¦‚æœä½ æŠŠä¸€ä¸ªå¯¹è±¡çš„åŸå‹è®¾ç½®æˆäº† null, ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªæ˜¯ï¼Œå®ƒä¸å…·å¤‡ä»»ä½•ä½ å¬è¯´è¿‡çš„æ–¹æ³•äº†ï¼š
```js
var o = Object.setPrototypeOf({}, null);
//ç­‰ä»·äº var o = {'__proto__': null};
Object.getPrototypeOf(o);                //null
o.toString();                    //TypeError: o.toString is not a function
```

### å¯¹è±¡çš„æ‰©å±•è¿ç®—ç¬¦

è¿™æ˜¯ ES7 çš„ä¸€ä¸ªææ¡ˆ, babelå¯ä»¥ä½¿ç”¨å™¨éƒ¨åˆ†åŠŸèƒ½ä½¿ç”¨ã€‚

- restå‚æ•°
ç”¨æ³•å’Œæ•°ç»„ä¸­å¾ˆç±»ä¼¼ï¼Œè¿™é‡Œä¸å†è¿‡å¤šèµ˜è¿°ï¼Œç›´æ¥çœ‹å‡ ä¸ªä¾‹å­å§ï¼š
```js
var {x,y,...z}  = {x: 1, y: 2, a: 3, d: 4}; //x=1, y=2, z={a: 3, d: 4}
```
å€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œ å¯¹è±¡çš„restå‚æ•°å½¢å¼æ‰§è¡Œçš„æ˜¯æµ…æ‹·è´ï¼Œèµ‹å€¼å¾—åˆ°çš„æ˜¯åŸå¯¹è±¡çš„å¼•ç”¨ï¼š
```js
let obj = {a: {b: 1}};
let {...x} = obj;
obj.a.b = 2;
console.log(x.a.b);    //2
```
æ­¤å¤– rest ä¸ä¼šå¤åˆ¶ä¸å¯æšä¸¾å±æ€§å’Œç»§æ‰¿è‡ªåŸå‹çš„å±æ€§ï¼š
```js
var p = {a: 0};
var o = {b: 2};
var o = Object.defineProperty(o, "foo", {
  value: 2,
  configurable: true,
  enumerable: false,
  writable: true
});
Object.setPrototypeOf(o, p);
var u = { ...p };
console.log(u);    //{b:2}
```

- æ‰©å±•è¿ç®—ç¬¦
å¤åˆ¶å‚æ•°å¯¹è±¡æ‰€æœ‰å¯éå†å±æ€§åˆ°å½“å‰å¯¹è±¡ä¸­:
```js
var o1 = {a: 1, b: 2};
var n = { ...o1 };    //n={a: 1, b: 2};
//ç›¸å½“äº
var n = Object.assign({}, o1);
```
å¯ä»¥ç”¨æ‰©å±•è¿ç®—ç¬¦åˆå¹¶å¤šä¸ªå¯¹è±¡, æ’åçš„å±æ€§ä¼šè¦†ç›–ä¹‹å‰çš„å±æ€§ï¼š
```js
var source0 = {a:1,b:2};
var source1 = {a:3,c:3};
var source2 = {a:2,d:0};
Object.assign(target, source1, source2);
var target = {...source0, ...source1, ...source2};
console.log(target);      //{a: 2, b: 2, c: 3, d: 0}
```
æ³¨æ„ä¸€ç‚¹ï¼šå¦‚æœæ‰©å±•è¿ç®—ç¬¦çš„å‚æ•°å¯¹è±¡æœ‰ get æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼š
```js
var a = {o:1,p:2,m:4};
var withoutError = {
  ...a,
  get x(){
    throw new Error();
  }
};           //ä¸æŠ¥é”™
var withError = {
  ...a,
  ...{get x(){
    throw new Error();
  }}
};           //æŠ¥é”™
```
å¦‚æœæ‰©å±•å¯¹è±¡æ˜¯ null æˆ– undefinedï¼Œä¼šè¢«å¿½ç•¥ï¼Œä¸æŠ¥é”™
```js
var o = { ...null,  ...undefined};    //ä¸æŠ¥é”™
console.log(o);    //{}
```

## Symbol

### SymbolåŸºæœ¬ç±»å‹
Symbol æ˜¯ä¸€ç§è§£å†³å‘½åå†²çªçš„å·¥å…·ã€‚è¯•æƒ³æˆ‘ä»¬ä»¥å‰å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ–¹æ³•çš„æ—¶å€™æ€»æ˜¯è¦æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåå˜é‡ï¼š
```js
if(String && String.prototype && String.prototype.getCodeWith){
  String.prototype.getCodeWith = function(){};
}
```
å¯æ˜¯è¿™æ ·å†™ï¼Œå³ä¾¿å·²å­˜åœ¨åŒåæ–¹æ³•ï¼Œä½†ä»–ä»¬å®ç°çš„åŠŸèƒ½ä¸ä¸€å®šä¸€æ ·ï¼Œè€Œä¸”å‡½æ•°çš„æ¥å£ä¹Ÿä¸ä¸€å®šé€‚åˆè‡ªå·±ã€‚è¿™æ ·æˆ‘ä»¬å°±ä¸å¾—ä¸å†ç»™è‡ªå·±çš„å‡½æ•°èµ·ä¸ªå…¶ä»–çš„åå­—ï¼Œå¯ä»¥ä¸‡ä¸€åˆå­˜åœ¨å‘¢ï¼Ÿ

äºæ˜¯å¼•å…¥äº† Symolï¼Œç”¨æ¥äº§ç”Ÿä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä½ å¯ä»¥æ”¾å¿ƒçš„ä½¿ç”¨å®ƒã€‚
å®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œä½œä¸ºè¯¥æ ‡è¯†ç¬¦çš„æè¿°:
```js
var sym = Symbol("Discription");
var temp = Symbol("Discription");
console.log(sym);             //Symbol(Discription)
console.log(sym.valueOf());   //Symbol(Discription)
console.log(sym.toString());  //"Symbol(Discription)""
console.log(sym == temp);     //false
```

æè¿°ç¬¦æ˜¯ç”¨æ¥å¸®åŠ©å¼€å‘äººå‘˜åŒºåˆ«ä¸åŒæ˜¯ symbolï¼Œä¸å…·å¤‡å…¶ä»–æ„ä¹‰, æ‰€ä»¥ symbol å€¼åªæœ‰`toString()`å’Œ`valueOf()` æ–¹æ³•ã€‚
Symbol ä½œä¸ºä¸€ä¸ªåŸºæœ¬ç±»å‹å­˜åœ¨äº js ä¸­ã€‚è¿™æ ·ï¼Œjs å°±æœ‰äº†6ä¸ªåŸºæœ¬ç±»å‹: `null`, `undefined`, `Boolean`, `Number`, `String`, `Symbol` å’Œ1ä¸ªå¤æ‚ç±»å‹: `Object`
ä½¿ç”¨ Symbol éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:
- Symbol å’Œ null, undefined ä¸€æ ·ä¸å…·æœ‰æ„é€ å‡½æ•°ï¼Œä¸èƒ½ç”¨ new è°ƒç”¨ã€‚
- Symbol å€¼ä¸èƒ½è½¬ä¸ºæ•°å­—ï¼Œæ‰€ä»¥ä¸èƒ½å‚ä¸ä»»ä½•ç®—æœ¯ï¼Œé€»è¾‘è¿ç®—
- Symbol è™½ç„¶æœ‰ toString() ä½† toString å¾—åˆ°çš„ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨äºå­—ç¬¦ä¸²é“¾æ¥ï¼Œä¸èƒ½ç”¨äºæ¨¡æ¿å­—ç¬¦ä¸²
- Symbol å¯ä»¥è½¬æ¢ä¸º Boolean, ç”¨åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Œä½†æ‰€æœ‰ Symbol éƒ½æ˜¯é€»è¾‘ true
- Symbol ä½œä¸ºå±æ€§åæ—¶ï¼Œè¯¥å±æ€§æ˜¯å…¬å¼€çš„ï¼Œä¸æ˜¯ç§æœ‰çš„

### Symbolç”¨ä½œå±æ€§å

è¿™ä¸ªåº”è¯¥ä¸é™Œç”Ÿäº†,å’Œæ™®é€šæ ‡è¯†ç¬¦ç”¨æ³•ç±»ä¼¼ï¼Œåªæ˜¯ä¸èƒ½ä½¿ç”¨`.`è®¿é—®å’Œå®šä¹‰ï¼Œå¿…é¡»ä½¿ç”¨`[]`ï¼š
```js
var sym = Symbol("abc");
var fun = Symbol("getSym");

var a = {};
a[sym] = 1;

var b = {
  [sym]: 1,
  [fun](){
    console.log(this[sym]);
  }
};

var c = Object.defineProperty({}, sym, {value: 1});

a[sym];   //1
b[sym];   //1
c[sym];   //1
b[fun]();  //1
```

å½“ç„¶ä¹Ÿå¯ä»¥å®šä¹‰ä¸€äº›å¸¸é‡ï¼Œå°±åƒè‹±è¯­ä¸­ Symbol ä»£è¡¨ä¸€ç§è±¡å¾ï¼Œä¸€ä¸ªç¬¦å·ï¼š
```js
var log = {
  DEBUG: Symbol('debug'),
  ERROR: Symbol('error'),
  WARNING: Symbol('warning'),
}
```
éœ€è¦æ³¨æ„ï¼ŒSymbol å±æ€§åªæœ‰`Object.getOwnPropertySymbols(obj)` å’Œ `Reflect.ownKey(obj)` å¯ä»¥éå†åˆ°ï¼š
- Object.getOwnPropertySymbols(obj): è¿”å›è‡ªèº«æ‰€æœ‰ Symbol å±æ€§åçš„æ•°ç»„ï¼ŒåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§
- Reflect.ownKey(obj): è¿”å›è‡ªèº«æ‰€æœ‰å±æ€§åæ•°ç»„ï¼ŒåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§å’Œ Symbol å±æ€§å
```js
var sym = Symbol("pro");
var o = {
  a: 1,
  b: 2,
  [sym]: 3
}
Object.getOwnPropertySymbols(o);     //[Symbol(pro)]
Reflect.ownKeys(o);                  //["a", "b", Symbol(pro)]
```
æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ„é€ ä¸€äº›éç§æœ‰çš„å†…éƒ¨å˜é‡ï¼š
```js
var size = Symbol('size');
class Collection{
  constructor(){
    this[size] = 0;
  }
  add(num){
    this[this[size]] = item;
    this[size]++;
  }
  static sizeOf(instance){
    return instance[size];
  }
}
var x = new Collection();
console.log(Collection.sizeOf(x));     //0
x.add("foo");
console.log(Collection.sizeOf(x));     //1

console.log(Object.keys(x));     //['0']
console.log(Object.getOwnPropertyNames(x));   //['0']
console.log(Object.getOwnPropertySymbols(x));   //[Symbol(size)]
```

### Symbolçš„é™æ€æ–¹æ³•

- Symbol.for("string"): ç™»è®°å¹¶é‡ç”¨ä¸€ä¸ª symbol å€¼
```js
Symbol.for("aa") === Symbol.for("aa");    //true
Symbol("aa") === Symbol("aa");            //false
```

- Symbol.keyFor(symbol): è¿”å›ä¸€ä¸ªå·²ç™»è®°çš„ Symbol æè¿°, æœªç™»è®°çš„ Symbol è¿”å› undefined
```js
var s1 = Symbol.for("aa");
var s2 = Symbol("aa");
Symbol.keyFor(s1);    //"aa"
Symbol.keyFor(s2);    //undefined
```
æ³¨æ„ Symbol çš„ç™»è®°æ˜¯å…¨å±€çš„ï¼š
```js
iframe = document.createElement('iframe');
iframe.src = String(window.location);
document.body.appendChild(iframe);
iframe.contentWindow.Symbol.for("aa") === Symbol.for("aa");    //true
```

### å†…ç½®çš„ Symbol å€¼

ES6 æä¾›äº†12ä¸ªå†…ç½®çš„ Symbol å€¼ï¼Œè¿™12ä¸ªå€¼ï¼Œéƒ½æ˜¯å¯¹è±¡çš„ï¼Œä¸”éƒ½ä¸å¯æšä¸¾ã€ä¸å¯é…ç½®ã€ä¸å¯ä¿®æ”¹ã€‚å› ä¸ºå®ƒä»¬å…·æœ‰å…¶ç‰¹æ®Šæ„ä¹‰ï¼š

1. Symbol.hasInstance: æŒ‡å‘ä¸€ä¸ªå†…éƒ¨æ–¹æ³•ã€‚åˆ¤æ–­å¯¹è±¡æ˜¯å¦æŸä¸ªæ„é€ å‡½æ•°çš„å®ä¾‹ï¼Œinstanceof è¿ç®—ç¬¦ä¼šè°ƒç”¨å®ƒ
2. Symbol.isConcatSpreadable: æ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡å±æ€§ã€‚å¦‚æœä¸º false è¯¥å±æ€§åœ¨ concat è¿‡ç¨‹ä¸ä¼šè¢«å±•å¼€ã€‚æ•°ç»„å¯¹è±¡è¯¥å±æ€§é»˜è®¤å€¼ä¸º true, ç±»æ•°ç»„å¯¹è±¡è¯¥å±æ€§é»˜è®¤å€¼ä¸º false
```js
var arr = [3,4];
[1,2].concat(arr);   //[1,2,3,4]
arr[Symbol.isConcatSpreadable] = false;
[1,2].concat(arr);   //[1,2,[3,4]]
```
<!--å¯¹äºä¸€ä¸ªç±»è€Œè¨€ï¼Œè¯¥å±æ€§å¿…é¡»è¿”å› boolean ç±»å‹
```js
class A1 extends Array{
  [Symbol.isConcatSpreadable](){
    return true;
  }
}
class A2 extends Array{
  [Symbol.isConcatSpreadable](){
    return false;
  }
}
let a1 = new A1();
a1[0] = 3;
a1[1] = 4;
let a2 = new A2();
a2[0] = 5;
a2[1] = 6;
[1,2].concat(a1).concat(a2);  //
```
-->
3. Symbol.species: æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ã€‚å°†å¯¹è±¡ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œç³»ç»Ÿå†…éƒ¨ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å³ï¼Œå½“ this.constructor[Symbol.species]å­˜åœ¨æ—¶ï¼Œä»¥æ­¤ä¸ºæ„é€ å‡½æ•°æ„å»ºå¯¹è±¡ã€‚
4. Symbol.match: æŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å½“æ‰§è¡Œ `str.match(obj)` çš„æ—¶å€™, å¦‚æœ obj å­˜åœ¨è¯¥å±æ€§ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å¹¶è¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼
```js
String.prototype.match(searchValue);
//ç›¸å½“äº
SearchValue[Symbol.match](this);
//å®ä¾‹
class myMatch{
  constructor(str){
    this.content = str;
  }
  [Symbol.match](str){
    return this.content.indexOf(str);
  }
}
'e'.match(new myMatch("Hello"));    //1
```

5. Symbol.replace: æŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å’Œä¸Šä¸€ä¸ªæ–¹æ³•ç±»ä¼¼çš„ï¼Œå½“æ‰§è¡Œ `str.replace(obj,replaceValue)` çš„æ—¶å€™, å¦‚æœ obj å­˜åœ¨è¯¥å±æ€§ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å¹¶è¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼
```js
String.prototype.replace(searchValue, replaceValue);
//ç›¸å½“äº
SearchValue[Symbol.replace](this, replaceValue);
```
6. Symbol.search: æŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å’Œä¸Šä¸€ä¸ªæ–¹æ³•ç±»ä¼¼çš„ï¼Œå½“æ‰§è¡Œ `str.search(obj)` çš„æ—¶å€™, å¦‚æœ obj å­˜åœ¨è¯¥å±æ€§ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å¹¶è¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼
```js
String.prototype.search(searchValue);
//ç›¸å½“äº
SearchValue[Symbol.search](this);
```
7. Symbol.split: æŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å’Œä¸Šä¸€ä¸ªæ–¹æ³•ç±»ä¼¼çš„ï¼Œå½“æ‰§è¡Œ `str.split(obj,limit)` çš„æ—¶å€™, å¦‚æœ obj å­˜åœ¨è¯¥å±æ€§ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å¹¶è¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼
```js
String.prototype.split(seperator,limit);
//ç›¸å½“äº
seperator[Symbol.split](this,limit);
```
8. Symbol.iterator: æŒ‡å‘é»˜è®¤çš„éå†å™¨æ–¹æ³•ã€‚å¯¹è±¡åœ¨ for...of ä¸­é»˜è®¤è°ƒç”¨è¯¥æ–¹æ³•ã€‚
```js
class Collector{
  constructor(...vals){
    this.nums = vals;
  }
  *[Symbol.iterator](){
    let i = this.nums.length;
    while(i){
      i--;
      yield this.nums[i];
    }
  }
}
var collector = new Collector(1,2,3,4,5);
for(let value of collector){
  console.log(value);        //ä¾æ¬¡è¾“å‡º 5 4 3 2 1
}
```
9. Symbol.toPrimitive: æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ã€‚å¯¹è±¡è¢«è½¬ä¸ºåŸå§‹ç±»å‹å€¼æ—¶ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä»‹ç»ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œå¯é€‰å‚æ•°ï¼š

- "number": æ­¤æ—¶è½¬æ¢æˆæ•°å€¼ï¼Œåº”è¿”å›æ•°å€¼ç±»å‹
- "string": æ­¤æ—¶è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œåº”è¿”å›å­—ç¬¦ä¸²ç±»å‹
- "default": æ­¤æ—¶è½¬æ¢æˆæ•°å€¼æˆ–å­—ç¬¦ä¸²ï¼Œåº”è¿”å›æ•°å€¼æˆ–å­—ç¬¦ä¸²ç±»å‹

```js
var obj = {
  [Symbol.toPrimitive](hint){
    switch(hint){
      case 'number': return 1234;
      case 'string': return 'hello';
      case 'default': return 'default';
      default: throw new Error();
    }
  }
};
console.log(obj.toString());     //[object Object]
console.log(obj.valueOf());      //{
console.log(2 * obj);            //2468
console.log(2 + obj);            //2default
console.log(obj === "hello");    //false
console.log(String(obj));        //hello
```
10. Symbol.unscopables: è¯¥è¯»å–å™¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ã€‚æŒ‡å®šäº†åœ¨ä½¿ç”¨ withè¯­å¥ æ—¶ï¼Œé‚£äº›å±æ€§è¢« with ç¯å¢ƒæ’é™¤(æ— æ³•è®¿é—®)
```js
//ä¾‹1
console.log(Array.prototype[Symbol.unscopables]);    //è¾“å‡ºå¦‚ä¸‹,æ•°ç»„å¯¹è±¡åœ¨ with ä¸­ä¸èƒ½è®¿é—®è¿™äº›å±æ€§æ–¹æ³•
//{
//copyWithin: true,
//entries: true,
//fill: true,
//find: true,
//findIndex: true,
//includes: true,
//keys: true
//}
```
```js
//ä¾‹2
//æ²¡æœ‰ unscopables æ—¶
class MyClass{
  foo(){return 1}
}
var foo = () => 2;
with(MyClass.prototype){
  foo();    //1
}

//æœ‰ unscopable æ—¶
var foo = () => 2;
class MyClass{
  foo(){return 1;}
  get [Symbol.unscopables](){
    return {foo:true};
  }
}
with(MyClass.prototype){
  foo();    //2
}
```
11. Symbol.toStringTag: æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ã€‚è¯¥æ–¹æ³•æŒ‡å‘å‡½æ•°åæ˜¯å¯¹è±¡ toString è¿”å›å€¼ `[object Array]` ä¸­ `Array` éƒ¨åˆ†ã€‚
```js
var b = {
  [Symbol.toStringTag]:"Hello"
};
console.log(b.toString());    //"[object Hello]"
```
ES6 æ–°å¢çš„ Symbol.toStringTag å¦‚ä¸‹ï¼š

- JSON["Symbol.toStringTag"]: 'JSON'
- Math["Symbol.toStringTag"]: 'Math'
- Moduleå¯¹è±¡ M["Symbol.toStringTag"]: 'Module'
- ArrayBuffer.prototype["Symbol.toStringTag"]: 'ArrayBuffer'
- DataView.prototype["Symbol.toStringTag"]: 'DataView'
- Map.prototype["Symbol.toStringTag"]: 'Map'
- Promise.prototype["Symbol.toStringTag"]: 'Promise'
- Set.prototype["Symbol.toStringTag"]: 'Set'
- %TypedArray%.prototype["Symbol.toStringTag"]: 'Uint8Array'ç­‰9ç§
- WeakMap.prototype["Symbol.toStringTag"]: 'WeakMap'
- WeakSet.prototype["Symbol.toStringTag"]: 'WeakSet'
- %MapIteratorPrototype%["Symbol.toStringTag"]: 'Map Iterator'
- %SetIteratorPrototype%["Symbol.toStringTag"]: 'Set Iterator'
- %StringIteratorPrototype%["Symbol.toStringTag"]: 'String Iterator'
- Symbol.prototype["Symbol.toStringTag"]: 'Symbol'
- Generator.prototype["Symbol.toStringTag"]: 'Generator'
- GeneratorFunction.prototype["Symbol.toStringTag"]: 'GeneratorFunction'

## Reflect å¯¹è±¡

Reflect å¯¹è±¡æœ‰ä¸€ä¸‹ä½œç”¨ï¼š
1. å°† Objectå¯¹è±¡çš„ä¸€äº›æ˜æ˜¾å±äºè¯­è¨€å±‚é¢çš„æ–¹æ³•éƒ¨ç½²åœ¨ Reflect ä¸Š
2. ä¿®æ”¹æŸäº› Object å¯¹è±¡çš„æ–¹æ³•ä½¿å…¶æ›´åˆç†ã€‚æ¯”å¦‚ `Object.defineProperty` é‡åˆ°æ— æ³•å®šä¹‰å±æ€§æ—¶ä¼šæŠ›å‡ºé”™è¯¯ï¼Œè€Œ `Reflect.defineProperty` ä¼šè¿”å› false
3. æŠŠæ‰€ä»¥ object çš„æ“ä½œéƒ½æ›¿æ¢æˆå‡½æ•°è¡Œä¸ºï¼Œæ¯”å¦‚ç”¨ `Reflect.has(obj,name)` æ›¿æ¢ `name in obj`
4. ä¿è¯åªè¦æ˜¯ Proxy æœ‰çš„æ–¹æ³•å°±ä¸€å®šå¯ä»¥åœ¨ Reflect ä¸Šæ‰¾åˆ°ç›¸åŒçš„æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥åœ¨å®ç° proxy æ—¶æ–¹ä¾¿çš„å®Œæˆé»˜è®¤è¡Œä¸ºã€‚æ¢è¨€ä¹‹ï¼Œæ— è®º proxy æ€ä¹ˆä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œä½ æ€»å¯ä»¥åœ¨ Reflect ä¸Šæ‰¾åˆ°çœŸæ­£é»˜è®¤çš„è¡Œä¸º

ä»£ç†åœ¨æ·»åŠ é¢å¤–çš„åŠŸèƒ½æ—¶ï¼Œåˆ©ç”¨ Reflect ä¿è¯äº†åŸå§‹åŠŸèƒ½çš„å®ç°ã€‚ä¸¾ä¸ªä¾‹å­ï¼š
```js
var loggedObj = new Proxy({}, {
  get(target,propKey){
    console.log(`getting ${target}.${propKey}`);  //å½“ç„¶ä½ æœ€å¥½æŠŠæ“ä½œè®°å½•åˆ°ä¸€ä¸ª log ä¸­
    return Reflect.get(target,propKey);
  }
});
```

Reflectæœ‰ä»¥ä¸‹æ–¹æ³•ï¼š

- Reflect.getOwnPropertyDescriptor(target, propKey)
ç­‰åŒäº `ObjectgetOwnPropertyDescriptor(target, propKey)`
- Reflect.defineProperty(target,propKey,desc)
ç­‰åŒäº `Object.defineProperty(target,propKey,desc)`
- Reflect.getOwnPropertyNames(target)
ç­‰åŒäº `Object.getOwnPropertyNames(target)`
- Reflect.getPrototypeOf(target)
ç­‰åŒäº `Object.getPrototypeOf(target)`
- Reflect.setPrototypeOf(target, proto)
ç­‰åŒäº `Object.setPrototypeOf(target, proto)`
- Reflect.deleteProperty(target, propKey)
ç­‰åŒäº `delete target.propKey`
- Reflect.enumerate(target)
ç­‰åŒäº `for ... in target`
- Reflect.freeze(target)
ç­‰åŒäº `Object.freeze(target)`
- Reflect.seal(target)
ç­‰åŒäº `Object.seal(target)`
- Reflect.preventExtensions(target)
ç­‰åŒäº `Object.preventExtensions(target)`
- Reflect.isFrozen(target)
ç­‰åŒäº `Object.isFrozen(target)`
- Reflect.isSealed(target)
ç­‰åŒäº `Object.isSealed(target)`
- Reflect.isExtensible(target)
ç­‰åŒäº `Object.isExtensible(target)`
- Reflect.has(target, propKey)
ç­‰åŒäº `propkey in object`
- Reflect.hasOwn(target, propKey)
ç­‰åŒäº `target.hasOwnProperty(propKey)`
- Reflect.ownKeys(target)
éå†å¾—åˆ°targetè‡ªèº«æ‰€æœ‰å±æ€§ï¼ŒåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼Œä¸åŒ…æ‹¬ Symbol å±æ€§
- Reflect.get(target,propKey, receiver = target)
å¦‚æœ propKey æ˜¯ä¸ªè¯»å–å™¨ï¼Œåˆ™è¯»å–å™¨ä¸­çš„ this ç»‘å®šåˆ° receiver
```js
var per = {
  bar: function(){console.log("per-bar")}
}
var obj = {
  get foo(){ this.bar(); },
  bar: function (){console.log("obj-bar")}
};
Reflect.get(obj, "foo", per);    //"per-bar"
```
- Reflect.set(target,propKey, value, receiver = target)
å¦‚æœ propKey æ˜¯ä¸ªè¯»å–å™¨ï¼Œåˆ™è¯»å–å™¨ä¸­çš„ this ç»‘å®šåˆ° receiver
- Reflect.apply(target, thisArg, args)
ç­‰åŒäº `Function.prototype.apply.call(target, thisArg, args)` å³ `thisArg.target(args)`
- Reflect.construct(target,args)
ç­‰åŒäº `new target(...args)`

æ³¨æ„ä»¥ä¸Šæ–¹æ³•ä¸­ï¼Œ`Reflect.set()`, `Reflect.defineProperty()`, `Reflect.freeze()`, `Reflect.seal()`, `Reflect.preventExtensions()` åœ¨æˆåŠŸæ—¶è¿”å› true, å¤±è´¥æ—¶è¿”å› falseã€‚å¯¹åº”çš„ Object æ–¹æ³•å¤±è´¥æ—¶ä¼šæŠ›å‡ºé”™è¯¯ã€‚

## Proxy å¯¹è±¡

Proxy ç”¨æ¥ä¿®æ”¹æŸäº›é»˜è®¤æ“ä½œï¼Œç­‰åŒäºåœ¨è¯­è¨€å±‚é¢åšå‡ºä¿®æ”¹ã€‚æ‰€ä»¥å±äºä¸€ç§å…ƒç¼–ç¨‹(meta programming), å³å¯¹ç¼–ç¨‹è¯­è¨€è¿›è¡Œç¼–ç¨‹ã€‚å­—é¢ç†è§£ä¸ºProxyä»£ç†äº†æŸäº›é»˜è®¤çš„æ“ä½œã€‚
å…¶ä½¿ç”¨æ ¼å¼å¦‚ä¸‹ï¼š
```js
var proxy = new Proxy(target, handler);
```
targetæ˜¯è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼Œhandlerä¹Ÿæ˜¯ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å®šåˆ¶æ‹¦æˆªè¡Œä¸ºï¼Œå†…éƒ¨å®šä¹‰æ¯ä¸ªè¢«ä»£ç†çš„è¡Œä¸ºã€‚
æ³¨æ„ï¼š

- å¦‚æœå¸Œæœ›è¿™ä¸ªä»£ç†æœ‰æ•ˆï¼Œéœ€è¦åœ¨ proxy å¯¹è±¡ä¸Šè°ƒç”¨å±æ€§æ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨ target ä¸Šè°ƒç”¨
- å¦‚æœæŒ‡å®š handler ä¸ºç©ºå¯¹è±¡ï¼Œé‚£ä¹ˆå¾—åˆ°å¯¹è±¡å’ŒåŸå¯¹è±¡ä¸€æ ·
- å¾—åˆ°çš„ proxy æ˜¯ target çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰ä»£ç†ï¼Œåœ¨ proxy ä¸Šçš„ä¿®æ”¹å’Œåœ¨ target ä¸Šçš„ä¿®æ”¹ç­‰åŒ

çœ‹ä¸€ä¸ªç®€å•çš„å®ä¾‹
```js
var proxy = new Proxy({},{
  get: function(target, key){
    return 35;
  }
});
console.log(proxy.time);    //35
console.log(proxy.name);    //35
console.log(proxy.title);    //35
//è¢«ä»£ç†çš„å¯¹è±¡æ— è®ºè¾“å…¥ä»€ä¹ˆå±æ€§éƒ½è¿”å›35
```

å®é™…ä¸Šï¼Œproxy å¯¹è±¡ä¹Ÿå¯ä»¥è¢«ç»§æ‰¿ï¼š
```js
var proxy = new Proxy({},{
  get: function(target, key){
    return 35;
  }
});
var obj = Object.create(proxy);
obj.time = 20;
console.log(obj.time);    //20
console.log(obj.name);    //35
```

æ„Ÿå—ä¸€ä¸‹å®ƒçš„å¨åŠ›ï¼š
```js
var obj = new Proxy({}, {
  get: function(target, key, receiver){
    console.log(`getting ${key} ...`);
    return Reflect.get(target, key, receiver);
  },
  set: function(target, key, value, receiver){
    console.log(`setting ${key} ...`);
    return Reflect.set(target, key, value, receiver);
  }
});

obj.count = 1;            //setting count ...
++obj.count;              //getting count ...
                          //setting count ...
console.log(obj.count);   //getting count ...
                          //2
```
å¯ä»¥çœ‹å‡ºæ¥ï¼Œhandlerå¯¹è±¡ä¸­ get æ–¹æ³•è¡¨ç¤ºå±æ€§çš„è®¿é—®è¯·æ±‚ï¼Œset æ–¹æ³•è¡¨ç¤ºå±æ€§çš„å†™å…¥è¯·æ±‚ã€‚
å½“ç„¶ä¸ä»…ä»… get å’Œ setï¼Œ æˆ‘ä»¬å¯ä»¥å®šä¹‰ä»¥ä¸‹æ‹¦æˆªå‡½æ•°ï¼š

- get(target, propKey, receiver = target)
æ‹¦æˆªå¯¹è±¡çš„è¯»å–å±æ€§ã€‚å½“ target å¯¹è±¡è®¾ç½®äº† propKey å±æ€§çš„ get å‡½æ•°æ—¶ï¼Œreceiver ç»‘å®š get å‡½æ•°çš„ thisã€‚è¿”å›å€¼ä»»æ„
- set(target, propKey, value, receiver = target)
æ‹¦æˆªå¯¹è±¡çš„å†™å…¥å±æ€§ã€‚è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- has(target, propKey)
æ‹¦æˆª propKey in proxy æ“ä½œç¬¦ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- deleteProperty(target, propKey)
æ‹¦æˆª delete proxy[propKey] æ“ä½œç¬¦ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- enumerate(target)
æ‹¦æˆª for(let i in proxy) éå†å™¨ï¼Œè¿”å›ä¸€ä¸ªéå†å™¨
- hasOwn(target, propKey)
æ‹¦æˆª proxy.hasOwnProperty('foo')ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- ownKeys(target)
æ‹¦æˆª Object.getOwnPropertyNames(proxy), Object.getOwnPropertySymbols(proxy), Object.keys(proxy)ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›å¯¹è±¡æ‰€æœ‰è‡ªèº«å±æ€§ï¼ŒåŒ…æ‹¬ä¸å¯éå†å±æ€§ï¼Œä¸åŒ…æ‹¬ Symbleå±æ€§ï¼Œä½†æ˜¯`Object.keys(proxy)`ä¸åº”è¯¥åŒ…æ‹¬ä¸å¯éå†å±æ€§
- getOwnPropertyDescriptor(target, propKey)
æ‹¦æˆª Object.getOwnPropertyDescriptor(proxy, propKey)ï¼Œè¿”å›å…¶å±æ€§æè¿°ç¬¦
- defineProperty(target, propKey, propDesc)
æ‹¦æˆª Object.defineProperty(proxy, propKey, propDesc), Object.defineProperties(proxy, propDesc)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- preventExtensions(target)
æ‹¦æˆª Object.preventExtensions(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- getPrototypeOf(target)
æ‹¦æˆª Object.getPrototypeOf(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡
- isExtensible(target)
æ‹¦æˆª Object.isExtensible(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- setPrototypeOf(target, proto)
æ‹¦æˆª Object.setPrototypeOf(proxy, proto)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- apply(target, object, args)
æ‹¦æˆªå¯¹ proxy å®ä¾‹çš„å‡½æ•°æ“ä½œï¼ŒåŒ…æ‹¬ proxy(...args),proxy.call(object, ...args),proxy.apply(object, args)
- construct(target, args, proxy)
æ‹¦æˆªç”¨ new è°ƒç”¨ proxy å‡½æ•°çš„æ“ä½œï¼Œconstruct()è¿”å›çš„ä¸æ˜¯å¯¹è±¡ä¼šæŠ¥é”™

ä»¥ä¸‹åˆ—ä¸¾ä¸€äº› Proxy çš„å®ä¾‹

è®¿é—®å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§æŠ¥é”™
```js
var obj = new Proxy({}, {
  get: function(target, key){
    if(key in target){
      return Reflect.get(target, key);
    } else {
      throw new ReferenceError(`"${key}" is not in object`);
    }
  }
});
obj.look = "picture";
console.log(obj.look);     //"picture"
console.log(obj.sleep);    //ReferenceError: "sleep" is not in object
```

æ•°ç»„ç´¢å¼•ä¸ºè´Ÿæ—¶è¿”å›å€’æ•°ä½ç½®çš„å€¼
```js
var origin = [10,20];
var arr = new Proxy(origin, {
  get(target, key){
    let index = parseInt(key);
    if(index < 0){
      index = target.length + index;
      if(index < 0) return undefined;
    }
    return Reflect.get(target, index);
  }
});
console.log(arr[0]);     //10
console.log(arr[1]);     //20
console.log(arr[2]);     //undefined
console.log(arr[-1]);    //20
console.log(arr[-4]);    //undefined
```

ä¿æŠ¤å¯¹è±¡å†…ä»¥ "_" å¼€å¤´çš„å±æ€§ä¸ºç§æœ‰å±æ€§:
```js
var o = {
  "_name": "Bob",
  "age": 13,
  "_fun": function(){
    console.log("_fun is called");
  }
};
var obj = new Proxy(o, {
  get(target, key){
    if(key.charAt(0) === '_'){
      return undefined;
    }
    return Reflect.get(target, key);
  },
  set(target, key, value){
    if(key.charAt(0) === '_'){
      throw new Error('Cannot define a property begin with "_"');
    }
    return  Reflect.set(target, key, value);
  },
  has(target,key){
    if(key.charAt(0) === '_'){
      return false;
    }
    return Reflect.has(target, key);
  },
  deleteProperty(target,key){
    if(key.charAt(0) === '_'){
      return false;
    } else {
      Reflect.deleteProperty(..arguments);
    }
  },
  apply(target,ctx,args){
    if(target.name.charAt(0) === '_'){
      throw new TypeError(`${target.name} is not defined`);
    } else {
      Reflect apply(...arguments);
    }
  },
  defineProperty(target,key,desc){
    if(key.charAt(0) === '_'){
      return new Error(`cannot define property begin with "_"`);
    } else {
      Reflect.defineProperty(..arguments);
    }
  },
  setPrototypeOf(target,proto){
    throw new TypeError(`Cannot change the proto of ${target}`);
  },
  construct(target,ctx,args){
    if(target.name.charAt(0) === '_'){
      throw new TypeError(`${target.name} is not defined`);
    } else {
      Reflect construct(...arguments);
    }
  }
});

console.log(obj.age);    //13
obj.age = 20;
console.log(obj.age);    //20
console.log(obj._name);  //undefined
obj._hobby = "Coding";   //Error: Cannot define a property begin with "_"
_name in key             //false
delete obj._name;
Object.defineProperty(obj,"_hobby",{
  value: "Coding"
});
Object.defineProperties(obj,{
  '_hobby': {
    value: "Coding"
  }
});
obj._fun();
var a = new obj._fun();
obj.__proto__ = {};     //Cannot define a property begin with "_"
Object.setPrototypeOf(obj,{})    //Cannot change the proto of obj
```

å½“ç„¶ä¸æ˜¯æ‰€æœ‰ proxy ä»£ç†éƒ½ä¸å¯å–æ¶ˆï¼Œä¸‹é¢æ–¹æ³•è®¾ç½®çš„ä»£ç†æ˜¯å¯ä»¥é€šè¿‡å®šä¹‰ä»£ç†æ—¶è¿”å›çš„revokeå‡½æ•°å–æ¶ˆï¼š
```js
var a = {
  name:"Bob"
};
var {proxy, revoke} = Proxy.revocable(a, {
  get(target,key){
    return undefined;
  }
});
proxy.name;   //undefined;
revoke();
proxy.name;   //TypeError: Cannot perform 'get' on a proxy that has been revoked
```

## Set ä¸ Map

### Set

Set æ˜¯ä¸€ç§é›†åˆç»“æ„ï¼Œç‰¹å¾å’Œæ•°å­¦ä¸­çš„ä¸€è‡´ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š

- åŒä¸€ä¸ªé›†åˆä¸­ä¸èƒ½æœ‰ç›¸åŒå…ƒç´ 
- set å¯ä»¥å­˜æ”¾ä¸åŒç±»å‹çš„æ•°æ®

ä½†ä½¿ç”¨è¿‡ç¨‹ä¸­è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

- å­˜å…¥ set çš„æ•°æ®ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢ï¼Œå³'5'å’Œ 5 æ˜¯ä¸ä¸€æ ·çš„
- å†…éƒ¨é‡‡ç”¨ä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒå…ƒç´ ï¼Œä½†-0ç­‰äº+0ï¼ŒNaNä¹Ÿç­‰äºNaN

å®šä¹‰èšåˆå’Œå®šä¹‰å…¶ä»–æ•°æ®ç»“æ„ä¸€æ ·ï¼Œå…¶æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªæ•°ç»„,é›†åˆæˆ–ç±»æ•°ç»„å¯¹è±¡åˆå§‹åŒ–ï¼š
```js
var set1 = new Set();
var set2 = new Set([1,2,3,3,4,4,5]);
console.log(set1);   //Set(0) {}
console.log(set2);   //Set(5) {1, 2, 3, 4, 5}
```

Setç»“æ„å…·æœ‰ä»¥ä¸‹å±æ€§å’Œæ–¹æ³•ï¼Œç”±äºå’Œæ•°ç»„æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œä¸ç»†ç»†åˆ—ä¸¾

- sizeå±æ€§: å½“å‰é›†åˆçš„å…ƒç´ æ•°é‡ï¼Œç›¸å½“äºæ•°ç»„ç†Ÿæ‚‰çš„length
- constructorå±æ€§: Set()

- add()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„push()æ–¹æ³•ï¼Œä½†åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°
- delete()æ–¹æ³•: åˆ é™¤é›†åˆä¸­çš„ä¸€ä¸ªå€¼
- has()æ–¹æ³•: åˆ¤æ–­æ•°ç»„çš„ä¸­æ˜¯å¦å«æœ‰æŸä¸ªå€¼
- clear()æ–¹æ³•: æ¸…ç©ºå½“å‰æ•°ç»„
- keys()æ–¹æ³•: è¿”å›é”®åçš„éå†å™¨ï¼Œå’Œæ•°ç»„keys()æ–¹æ³•ä¸€æ ·
- values()æ–¹æ³•: è¿”å›å€¼çš„éå†å™¨ï¼Œå’Œæ•°ç»„values()æ–¹æ³•ä¸€æ ·
- entires()æ–¹æ³•: è¿”å›é”®å€¼å¯¹çš„éå†å™¨ï¼Œå’Œæ•°ç»„entires()æ–¹æ³•ä¸€æ ·
- forEach()æ–¹æ³•: ä½¿ç”¨å›è°ƒå‡½æ•°éå†é›†åˆæˆå‘˜ï¼Œå’Œæ•°ç»„forEach()æ–¹æ³•ä¸€æ ·
- map()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„map()æ–¹æ³•
- filter()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„filter()æ–¹æ³•

Setçš„é»˜è®¤éå†å™¨éå†çš„æ˜¯å€¼ï¼š
```js
Set.prototype[Symbol.iterator] === Set.prototype.values;   //true
```

é›†åˆè¿ç®—ï¼š

- å¹¶é›†
```js
var a = new Set([1,2,3]);
var b = new Set([2,4,5]);
var union = new Set([...a, ...b]);    //[1,2,3,4,5]
```
- äº¤é›†
```js
var a = new Set([1,2,3]);
var b = new Set([2,4,5]);
var intersect = new Set([...a].filter(item => b.has(item)));  //[2]
```
- å·®é›†
```js
var a = new Set([1,2,3]);
var b = new Set([2,4,5]);
var diffsect = new Set([...a].filter(item => !b.has(item)));  //[1,3]
```
### WeakSet

WeakSet å’Œ Setç±»ä¼¼ï¼Œä½†æ˜¯å…·æœ‰ä»¥ä¸‹åŒºåˆ«:

- WeakSet çš„å…ƒç´ åªèƒ½æ˜¯å¯¹è±¡ï¼Œä¸èƒ½æ˜¯åˆ«çš„ç±»å‹
- WeakSet çš„å…ƒç´ æ— æ³•è¢«å¼•ç”¨ï¼Œå…¶å…ƒç´ ä¸å…·æœ‰åˆ«çš„å¼•ç”¨æ—¶ï¼ŒGC ä¼šç«‹åˆ»é‡Šæ”¾å¯¹è±¡çš„å†…å­˜èµ„æºï¼Œå› æ­¤ WeakSet ä¸èƒ½è¢«éå†ã€‚

å®šä¹‰WeakSetå’Œå®šä¹‰å…¶ä»–æ•°æ®ç»“æ„ä¸€æ ·ï¼Œå…¶æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªæ•°ç»„,é›†åˆæˆ–ç±»æ•°ç»„å¯¹è±¡åˆå§‹åŒ–ï¼š
```js
var set1 = new WeakSet();
var set2 = new WeakSet([[1,2],[3,3],[4,4,5]]);
console.log(set1);   //WeakSet(0) {}
console.log(set2);   //WeakSet {(2) [1, 2], (2) [3, 3], (3) [4, 4, 5]}
```

WeakSet æ²¡æœ‰ size å±æ€§ï¼Œæœ‰å¦‚ä¸‹3ä¸ªæ–¹æ³•ï¼š

- add()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„push()æ–¹æ³•ï¼Œä½†åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°
- delete()æ–¹æ³•: åˆ é™¤é›†åˆä¸­çš„ä¸€ä¸ªå€¼
- has()æ–¹æ³•: åˆ¤æ–­æ•°ç»„çš„ä¸­æ˜¯å¦å«æœ‰æŸä¸ªå€¼
- clear()æ–¹æ³•: æ¸…ç©ºå½“å‰æ•°ç»„
- keys()æ–¹æ³•: è¿”å›é”®åçš„éå†å™¨ï¼Œå’Œæ•°ç»„keys()æ–¹æ³•ä¸€æ ·ï¼Œç”¨äº for...of å¾ªç¯
- values()æ–¹æ³•: è¿”å›å€¼çš„éå†å™¨ï¼Œå’Œæ•°ç»„values()æ–¹æ³•ä¸€æ ·ï¼Œç”¨äº for...of å¾ªç¯
- entires()æ–¹æ³•: è¿”å›é”®å€¼å¯¹çš„éå†å™¨ï¼Œå’Œæ•°ç»„entires()æ–¹æ³•ä¸€æ ·ï¼Œç”¨äº for...of å¾ªç¯
- forEach()æ–¹æ³•: ä½¿ç”¨å›è°ƒå‡½æ•°éå†é›†åˆæˆå‘˜ï¼Œå’Œæ•°ç»„forEach()æ–¹æ³•ä¸€æ ·
- map()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„map()æ–¹æ³•
- filter()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„filter()æ–¹æ³•

WeakSet ä¸èƒ½éå†ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¸´æ—¶å­˜å‚¨DOMèŠ‚ç‚¹ï¼Œè¿™æ ·ä¸å¿…æ‹…å¿ƒå†…å­˜æ³„æ¼ï¼š
```js
//ä¾‹
const foos = new WeakSet();
class Foo{
  constructor(){
    foos.add(this);
  }
  method(){
    if(!foos.has(this)){
      throw new TypeError(`"foo.prototype.method" is only called by object of Foo`);
    }
    console.log(`"Foo.prototype.method" has been called`);
  }
}
var obj = new Foo();
obj.method();          //Foo.prototype.method" has been called
obj.method.call({});   //typeError: "foo.prototype.method" is only called by object of Foo
```

### Map

js ä¸­çš„å¯¹è±¡æ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œä½†æ˜¯é”®åªèƒ½æ˜¯å­—ç¬¦ä¸²å…¶å®å¹¶ä¸æ–¹ä¾¿ã€‚Mapç»“æ„æœ¬è´¨å’Œå¯¹è±¡ä¸€æ ·ï¼Œåªæ˜¯é”®åå¯ä»¥ä½¿ç”¨å„ç§ç±»å‹çš„å€¼ã€‚å¦‚æœè¿™ä¹ˆç†è§£ï¼Œé‚£ä¹ˆMapå°±æ˜¯ä¸€ç§å€¼-å€¼å¯¹è€Œä¸æ˜¯é”®-å€¼å¯¹ï¼Œè¿™ä¸€ç‚¹ç±»ä¼¼hashç»“æ„ï¼š
```js
var o = {name: "Bob"};
var map = new Map();
map.set(o, "hello");
console.log(map.get(o));   //"hello"
```

æ„é€  Map ç»“æ„çš„æ„é€ å‡½æ•°æ¥å—æ•°ç»„ï¼Œå¯¹è±¡ç­‰ç±»å‹ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°ï¼š
```js
var map = new Map([["name","Bob"], ["age", 12]]);
map.get("name");    //"Bob"
map.get("age");     //12
```

mapå…·æœ‰å¦‚ä¸‹å±æ€§å’Œæ–¹æ³•ï¼š

- size å±æ€§: è¿”å› map ä¸­å…ƒç´ çš„æ•°é‡ï¼Œç±»ä¼¼æ•°ç»„çš„ length

- set(key, value)æ–¹æ³•: å‘mapä¸­æ·»åŠ å€¼-å€¼å¯¹
- get(key)æ–¹æ³•: è¯»å–mapä¸­çš„å€¼
- delete(key, value)æ–¹æ³•: åˆ é™¤mapä¸­çš„å€¼-å€¼å¯¹
- has(key)æ–¹æ³•: åˆ¤æ–­æŸä¸ªé”®åæ˜¯å¦å­˜åœ¨
- clear()æ–¹æ³•: æ¸…ç©ºå½“å‰ map ä¸­æ‰€ä»¥æ•°æ®
- keys()æ–¹æ³•: è¿”å›é”®åçš„éå†å™¨ï¼Œå’Œæ•°ç»„keys()æ–¹æ³•ç±»ä¼¼ï¼Œç”¨äº for...of å¾ªç¯
- values()æ–¹æ³•: è¿”å›å€¼çš„éå†å™¨ï¼Œå’Œæ•°ç»„values()æ–¹æ³•ç±»ä¼¼ï¼Œç”¨äº for...of å¾ªç¯
- entires()æ–¹æ³•: è¿”å›å€¼-å€¼å¯¹çš„éå†å™¨ï¼Œå’Œæ•°ç»„entires()æ–¹æ³•ç±»ä¼¼ï¼Œç”¨äº for...of å¾ªç¯
- forEach()æ–¹æ³•: ä½¿ç”¨å›è°ƒå‡½æ•°éå†é›†åˆæˆå‘˜ï¼Œå’Œæ•°ç»„forEach()æ–¹æ³•ç±»ä¼¼

```js
var o = {name: "Bob"};
var map = new Map();
map.set(o, "hello");
console.log(map.get(o));   //"hello"
map.set(o, "world");       //é‡å¤å®šä¹‰ï¼Œè¦†ç›–ä¹‹å‰çš„å®šä¹‰
console.log(map.get(o));   //"world"
console.log(map.get({name: "Bob"}));   //undefined, ä¸åŒçš„å¯¹è±¡å¼•ç”¨ä¸è®¤ä¸ºæ˜¯åŒä¸€ä¸ªå¯¹è±¡
map.delete(o);             //åˆ é™¤å¯¹è±¡å±æ€§ o
console.log(map.get(o));   //undefined
```

ä»ä¸Šæ–¹çš„ä¾‹å­ä¸éš¾å‘ç°ï¼Œä¸åŒçš„å¯¹è±¡å±æ€§å¯¹äº map æ¥è¯´å°±æ˜¯ä¸åŒçš„ï¼Œä¸ç®¡å†…éƒ¨çš„å†…å®¹æ˜¯å¦ä¸€è‡´ã€‚è¿™å’Œå¯¹è±¡çš„ === æ¯”è¾ƒæ˜¯ä¸€æ ·çš„é“ç†ï¼Œå¸¦æ¥çš„å¥½å¤„æ˜¯æˆ‘ä»¬ä¸ç”¨æ‹…å¿ƒå’Œä¼š map åŸæœ‰å±æ€§é‡åï¼Œè€Œç›´æ¥å‘ map æ·»åŠ å¯¹è±¡å±æ€§å³å¯ã€‚

æ³¨æ„ undefinedï¼ŒNaNå’Œ null ä¹Ÿå¯ä»¥ä½œä¸º map çš„é”®å
```js
var map = new Map();
map.set(undefined, 1);
map.set(null, 2);
map.set(NaN, 3);
console.log(map.get(undefined));        //1
console.log(map.get(null));        //2
console.log(map.get(NaN));        //3
```

ä½†ä½¿ç”¨è¿‡ç¨‹ä¸­è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

- å­˜å…¥ map çš„æ•°æ®ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢ï¼Œå³'5'å’Œ 5 æ˜¯ä¸ä¸€æ ·çš„, {} å’Œ {}ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚
- å†…éƒ¨é‡‡ç”¨ä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒå…ƒç´ ï¼Œä½†-0ç­‰äº+0ï¼ŒNaNä¹Ÿç­‰äºNaNã€‚

map çš„é»˜è®¤éå†å™¨æ˜¯ entries()
```js
Map.prototype[Symbol.iterator] === Map.prototype.entries;   //true
```

å¦å¤–è¿™é‡Œéœ€è¦æ ¼å¤–å¼ºè°ƒçš„æ˜¯ï¼š

- Setä¸­çš„ has æ–¹æ³•æ˜¯åˆ¤æ–­**é”®å€¼**æ˜¯å¦å­˜åœ¨çš„ï¼Œå¦‚ ` Set.prototype.has(value)`, `WeakSet.prototype.has(value)`
- Mapä¸­çš„ has æ–¹æ³•æ˜¯åˆ¤æ–­**é”®å**æ˜¯å¦å­˜åœ¨çš„ï¼Œå¦‚ ` Map.prototype.has(key)`, `WeakMap.prototype.has(key)`, `Reflect.has(target, propertyKey)`

Mapè§£æ„è½¬æ¢æŠ€å·§ï¼š

- Map è½¬ Array
```js
var map = new Map([[1,'one'], [2, 'two'], [3, 'three']]);
var keyArr = [...map.keys()];          //[1,2,3]
var valueArr = [...map.values()];      //['one','two','three']
var entriesArr = [...map.entries()];   //[[1,'one'], [2, 'two'], [3, 'three']]
var arr = [...map];                    //[[1,'one'], [2, 'two'], [3, 'three']]
```
- Map è½¬ Object(ä¸ºé˜²æ­¢ä¸å¿…è¦çš„é”™è¯¯ï¼Œç›´æ¥ä¸¢å¼ƒä¸æ˜¯å­—ç¬¦ä¸²ä¸ºé”®çš„å±æ€§)
```js
function map2arr(map){
  var o = {};
  for(let [key, value] of map.entries()){
    if(typeof key === 'string'){
      o[key] = value;
    }
  }
  return o;
}
var map = new Map([[1,'one'], [2, 'two'], ['three', 3], ['four', 4]]);
map2arr(map);    //Object {three: 3, four: 4}
```
- Map è½¬ JSON
```js
var map = new Map([[1,'one'], [2, 'two'], ['three', 3], ['four', 4]]);
JSON.stringify([...map]);    //"[[1,"one"],[2,"two"],["three",3],["four",4]]"
```

### WeakMap

WeakMap å’Œ map ç±»ä¼¼ï¼Œä¸è¿‡å®ƒåªæ¥å—å¯¹è±¡ä½œä¸ºé”®åï¼Œnullé™¤å¤–ã€‚è¯•æƒ³ï¼Œå¦‚æœå¯¹è±¡ o æ˜¯ä¸€ä¸ª mapçš„å±æ€§ï¼Œå¦‚æœè¯¥å¯¹è±¡è¢«é‡Šæ”¾äº†ï¼Œé‚£è¿™ä¸ª map å±æ€§ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚è§£å†³è¿™ä¸ªé—®é¢˜å°±æ˜¯ä½¿ç”¨ WeakMapï¼š
```js
var o = {name: "Bob"};
var map = new WeakMap();
map.set(o, 12);
console.log(map.get(o));    //12
o = null;
console.log(map.get(o));    //undefined
```

WeakMapçš„å¯¹è±¡å±æ€§åï¼Œä¸è®¡å…¥ GCï¼Œæ‰€ä»¥å½“å¯¹è±¡ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿™ä¸ª weakmap ä¸­ç›¸åº”çš„é”®å€¼å¯¹å°±è¢«åˆ é™¤äº†ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä»£ç å¯¹äº map å¯ä»¥å¾—åˆ°ä¸€æ ·çš„è¾“å‡ºã€‚é‚£æ˜¯å› ä¸ºæœ€åä¸€è¡Œç›¸å½“äº`console.log(map.get(null))`, æˆ‘ä»¬æ²¡æœ‰å®šä¹‰ null å¯¹åº”çš„å€¼ï¼Œæ‰€ä»¥å¾—åˆ° undefined, å…¶å®å†…å­˜æ³„éœ²çš„éšæ‚£ä¾ç„¶å­˜åœ¨ï¼š
```js
var o = {name: "Bob"};
var map = new Map();
map.set(o, 12);
console.log(map.get(o));    //12
o = null;
console.log(map.size);      //1
```

WeakMap å’Œ WeakSet ç±»ä¼¼ï¼Œç”±äºä¸è®¡å…¥ GC å›æ”¶æœºåˆ¶ï¼Œæ‰€ä»¥ä¸æ”¯æŒéå†æ“ä½œï¼Œä¹Ÿä¸æ”¯æŒè¢«æ¸…ç©ºï¼Œæ‰€ä»¥ WeakMap åªæœ‰ä»¥ä¸‹ 4 ä¸ªæ–¹æ³•ï¼Œæ²¡æœ‰ size å±æ€§ï¼š

- set(key, value)æ–¹æ³•: å‘weakMapä¸­æ·»åŠ å€¼-å€¼å¯¹
- get(key)æ–¹æ³•: è¯»å–mapä¸­çš„å€¼
- delete(key, value)æ–¹æ³•: åˆ é™¤weakMapä¸­çš„å€¼-å€¼å¯¹
- has(key)æ–¹æ³•: åˆ¤æ–­æŸä¸ªé”®åæ˜¯å¦å­˜åœ¨

## iterator

### for...of

`for...of` å¯ä»¥éå†å…·æœ‰ iterator çš„å¯¹è±¡ï¼Œå…·ä½“æœ‰ä¸€ä¸‹å‡ ç§å½¢å¼ï¼š
```js
for(let [key, value] of obj){
  //å¾—åˆ°é”®å€¼å¯¹
}
for(let [key] of obj){
  //å¾—åˆ°é”®å
}
for(let [, value] of obj){
  //å¾—åˆ°å€¼
}
```

## æ•°ç»„çš„æ‰©å±•

- `Array, from()`
å°†ç±»æ•°ç»„å¯¹è±¡å’Œå¯éå†å¯¹è±¡è½¬åŒ–ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚
```js
var arrayLike = {
  '0' : 'a',
  '1' : 'b',
  '2' : 'c',
  'length': 3
}

var arr;
//ES5
arr = [].slice.call(arrayLike);    //arr=['a', 'b', 'c']

//ES6
arr = Array.from(arrayLike);    //arr=['a', 'b', 'c']
```
å’Œå®ƒç±»ä¼¼çš„æ˜¯æ‰©å±•è¿ç®—ç¬¦, ä¸€æ ·å¯ä»¥å®ç°è¯¥åŠŸèƒ½(è¦æ±‚å¯¹è±¡å…·æœ‰éå†å™¨æ¥å£):
```js
function(){
  var arg = [...arguments];   //è½¬åŒ– arguments ä¸ºæ•°ç»„
}
```
Array.from() æ¥å—ç¬¬äºŒå‚æ•°(å‡½æ•°), ç”¨æ¥æ˜ å°„ç»“æœ, ç›¸å½“äº map, å¹¶ä¸”å¯ä»¥ç”¨ç¬¬ä¸‰ä¸ªå‚æ•°ç»‘å®š this:
```js
Array.from(obj, func, context);
//ç­‰ä»·äº
Array.from(obj).map(func, context);
```
æŠ€å·§, ç”¨ Array.from() æŒ‡å®šå‡½æ•°è¿è¡Œæ¬¡æ•°:
```js
var i = 0;
Array.from({length: 3}, ()=>i++);   //[0, 1, 2]
```

å»ºè®®ï¼šä½¿ç”¨Array.fromæ–¹æ³•ï¼Œå°†ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡è½¬ä¸ºæ•°ç»„ã€‚

- `Array.of()`
å°†å¤šä¸ªå€¼ç»„æˆæ•°ç»„:
```js
Array.of(2, 3, 5);   //[2, 3, 5]
Array.of(2);   //[2]
Array.of();   //[]
Array.of(undefined);   //[undefined]
```

- `Array.prototype.copyWithin()`
å‡½æ•°å‚æ•°æ˜¯ `Array.prototype.copyWithin(target, start=0, end=this.length)`, å¯¹å½“å‰æ•°ç»„, ä»æˆªå–ä¸‹æ ‡ä¸º start åˆ° end çš„å€¼, ä»target ä½ç½®å¼€å§‹è¦†ç›– `this` ä¸­çš„å€¼ã€‚å¦‚æœ start æˆ– end ä¸ºè´Ÿæ•°åˆ™å€’æ•°ã€‚
```js
[1, 2, 3, 4, 5].copyWithin(0, 3, 4);   //[4, 2, 3, 4, 5]

[1, 2, 3, 4, 5].copyWithin(0, -2, -1);   //[4, 2, 3, 4, 5]

[].copyWithin.call({length: 5, 3: 1}, 0, 3);   //{0: 1, 3: 1, length: 5}

var i32a = new Int32Array([1, 2, 3, 4, 5]);
i32a.copyWithin(0, 2);   //[3, 4, 5, 4, 5]
```

- `Array.prototype.find()`, `Array.prototype.findIndex()`
è¿™ä¸¤ä¸ªå‡½æ•°çš„å‚æ•°éƒ½æ˜¯å›è°ƒå‡½æ•°ã€‚éå†æ•°ç»„, æ‰¾åˆ°ç¬¦åˆæ¡ä»¶(å›è°ƒå‡½æ•°è¿”å›ä¸ºtrue)çš„ç¬¬ä¸€ä¸ªå€¼, find()è¿”å›å…¶å€¼, `findIndex()`è¿”å›å…¶ä¸‹æ ‡ã€‚å¦‚æœæ²¡æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å€¼`find()`è¿”å›undefined, `findIndex()`è¿”å›-1ã€‚
```js
[1, 2, -3, 4].find((item) => item < 0);   //-3
[1, 2, -3, 4].findIndex((item) => item < 0);   //2

[NaN].findIndex(y => y !== y);   //0
[NaN].indexOf(NaN);   //-1, indexOf æ‰¾ä¸åˆ° NaN
```
è¿™ä¸¤ä¸ªå‡½æ•°è¿˜æ¥å—ç¬¬äºŒå‚æ•°, ç”¨æ¥ç»‘å®šå›è°ƒå‡½æ•°ä¸­çš„ this

- `Array.prototype.fill()`
å®Œæ•´å½¢å¼: `Array.prototype.fill(value, start=0, end=this.length)`, å¯¹æ•°ç»„ start åˆ° end ç›´æ¥éƒ¨åˆ†å¡«å…… value, è¦†ç›–åŸæœ‰å€¼ã€‚
```js
[1, 2, 3, 4, 5].fill('a', 2, 4);    //[1, 2, 'a', 'a', 5];
var arr = new Array(5).fill(0);   //arr = [0, 0, 0, 0, 0];
```

- `Array.prototype.entries()`, `Array.prototype.keys()`, `Array.prototype.values()`
è¿™ä¸‰ä¸ªæ–¹æ³•, ç”¨æ¥éå†æ•°ç»„, è¿”å›ä¸€ä¸ªéå†å™¨, ä¾› `for...of` ä½¿ç”¨, å…¶ä¸­ `keys()`æ˜¯å¯¹é”®çš„éå†, `values()` æ˜¯å¯¹å€¼çš„éå†, `entires()`æ˜¯å¯¹é”®å€¼å¯¹çš„éå†ã€‚babel å·²å®ç°
```js
var a = ['a', 'b', 'c'];

for(let item of a.values()){
  console.log(item);     //ä¾æ¬¡è¾“å‡º 'a', 'b', 'c'
}

for(let key of a.keys()){
  console.log(key);     //ä¾æ¬¡è¾“å‡º 0, 1, 2
}
for(let pair of a.entries()){
  console.log(pair);     //ä¾æ¬¡è¾“å‡º [0, 'a'], [1, 'b'], [2, 'c']
}
```
å½“ç„¶ä¹Ÿå¯ä»¥ç”¨éå†å™¨çš„ next() æ–¹æ³•éå†
```js
var a = ['a', 'b', 'c'];
var values = a.values();
console.log(values.next().value);   //'a'
console.log(values.next().value);   //'b'
console.log(values.next().value);   //'c'
```

- `Array.prototype.includes()`
è¿™æ˜¯ä¸ª ES7 çš„æ–¹æ³•, åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰æŸä¸ªå€¼, å«æœ‰åˆ™è¿”å› true, å¦åˆ™è¿”å› falseã€‚å¯ä»¥ç”¨ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šæŸ¥æ‰¾èµ·å§‹ç‚¹(å°äº0å€’æ•°)ã€‚
```js
//è¯¥æ–¹æ³•åŒæ ·å¯ä»¥æ‰¾åˆ° NaN, è€Œ indexOf ä¸è¡Œ
[1, 2, NaN].includes(NaN);   //true
[1, 2, 3, 4, 5].includes(2, 3);  //false
```

- æ•°ç»„çš„ç©ºä½
æˆ‘ä»¬æ¯”è¾ƒä»¥ä¸‹ä¸¤ä¸ªæ•°ç»„:
```js
var empty = new Array(3);  //[, , , ]
var unempty = new Array(3).fill(undefined);   //[undefined, undefined, undefined]

console.log(0 in empty);     //false
console.log(0 in unempty);   //true
```

ç»“åˆæ‰‹å†Œå†…å®¹å¦‚ä¸‹å°±å¾ˆå¥½ç†è§£è¿™ä¸ªé—®é¢˜ï¼š
> â€œArray elements may be elided at the beginning, middle or end of the element list. Whenever a comma in the element list is not preceded by
an AssignmentExpression (i.e., a comma at the beginning or after another comma), the missing array element contributes to the length of the
Array and increases the index of subsequent elements. Elided array elements are not defined. If an element is elided at the end of an array,
that element does not contribute to the length of the Array.â€
<small>æ‘˜è‡ª<a href="http://www.ecma-international.org/ecma-262/6.0/" target="_blank">ECMAScriptÂ® 2015 Language Specification</a></small>

ç¿»è¯‘å¦‚ä¸‹ã€‚
>"æ•°ç»„æˆå‘˜å¯ä»¥çœç•¥ã€‚åªè¦é€—å·å‰é¢æ²¡æœ‰ä»»ä½•è¡¨è¾¾å¼ï¼Œæ•°ç»„çš„lengthå±æ€§å°±ä¼šåŠ 1ï¼Œå¹¶ä¸”ç›¸åº”å¢åŠ å…¶åæˆå‘˜çš„ä½ç½®ç´¢å¼•ã€‚è¢«çœç•¥çš„æˆå‘˜ä¸ä¼šè¢«å®š
ä¹‰ã€‚å¦‚æœè¢«çœç•¥çš„æˆå‘˜æ˜¯æ•°ç»„æœ€åä¸€ä¸ªæˆå‘˜ï¼Œåˆ™ä¸ä¼šå¯¼è‡´æ•°ç»„lengthå±æ€§å¢åŠ ã€‚â€

å¾ˆæ˜æ˜¾, ä¸€ä¸ªå®Œå…¨ç©ºçš„æ•°ç»„æ˜¯æ²¡æœ‰ä¸œè¥¿çš„, è€Œå¡«å……äº†`undefined`çš„æ•°ç»„å¹¶ä¸æ˜¯ç©ºçš„ã€‚
ç»“åˆ ES5, å‘ç°ä¸åŒå‡½æ•°æ–¹æ³•å¯¹ç©ºä½å¤„ç†æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„:
-- `forEach()`, `filter()`, `every()`, `some()` ä¼šå¿½ç•¥ç©ºå€¼
-- `map()`, `copyWithin()` ä¼šä¿ç•™ç©ºå€¼, ä½†ä¸åšå¤„ç†
-- `join()`, `toString()`, ä¼šæŠŠç©ºå€¼å¤„ç†ä¸ºç©ºå­—ç¬¦ä¸²
-- `fill()` ä¸åŒºåˆ†ç©ºå€¼ä¸éç©ºå€¼
-- `Array.from()`, æ‰©å±•è¿ç®—ç¬¦(...), `for...of`, `entires()`, `keys()`, `values()`, `find()`, `findIndex()` ä¼šè§†ç©ºå€¼ä¸º `undefined`
å¦‚æœä½ è®°ä¸ä½è¿™äº›, æˆ–è€…ä¸ºäº†ç¨‹åºçš„å¥å£®æ€§, å¯ç»´æŠ¤æ€§, å°½é‡é¿å…åœ¨æ•°ç»„ä¸­å‡ºç°ç©ºå€¼ã€‚
ä¸¾ä¸ªå®ä¾‹, ç†è§£ä¸€ä¸‹è¿™ä¸ªé—®é¢˜:
> æ–°å»ºä¸€ä¸ªé•¿ä¸º200çš„æ•°ç»„, å¹¶åˆå§‹åŒ–æ¯ä¸ªä½ç½®çš„å€¼ç­‰äºå…¶ç´¢å¼•
```js
//é”™è¯¯æ–¹æ³•
var arr = new Array(200).map(function(item, index){
  return index;
});
console.log(arr);    //[undefined Ã— 200]
```
```js
//æ­£ç¡®åšæ³•
var arr = new Array(200).join().split(', ').map(function(item, index){
  return index;
});
console.log(arr);    //[1, 2, 3, ..., 200]
```

- æ•°ç»„æ¨å¯¼
è¿™æ˜¯ä¸€ä¸ª ES7 çš„åŠŸèƒ½, æš‚æ—¶è¿˜æ²¡èƒ½å®ç°ã€‚æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸‹å®ƒå¦‚ä½•æ¨å¯¼çš„:
```js
var a1 = [1, 2, 3, 4];
var a2 = [for( i of a1) i * 2];   //a2=[2, 4, 6, 8]
```
ä¸éš¾çœ‹å‡º, æ•°ç»„ a2 é€šè¿‡ `for...of` ç›´æ¥ä» a1 ç”Ÿæˆã€‚ä½†æ˜¯å®ƒçš„åŠŸèƒ½ä¸ä»…ä»…è¿™ä¹ˆç®€å•, è¿˜å¯ä»¥æœ‰ if æ¡ä»¶:
```js
var a1 = [1, 2, 3, 4];
var a3 = [for( i of a1) if(i > 2) i * 2];   //a3=[6, 8]
```
è¿™æ ·, æˆ‘ä»¬å¯ä»¥ç®€å•çš„ç”¨æ•°ç»„æ¨å¯¼æ¨¡æ‹Ÿ `map()`, `filter()` æ–¹æ³•äº†ã€‚æ¯”å¦‚ä¸Šé¢2ä¸ªä¾‹å­ç­‰ä»·äº:
```js
var a1 = [1, 2, 3, 4];
var a2 = a1.map( (i) => i * 2 );
var a3 = a1.filter( (i) => i > 2 ).map( (i) => i * 2 );
```
å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥ç”¨å¤šä¸ª `for...of` æ„æˆå¾ªç¯åµŒå¥—:
```js
var a = ['x1', 'x2'];
var b = ['y1', 'y2'];

[for(i of a) for(j of b), console.log(i+', '+j)];
//è¾“å‡º
//['x1', 'y1']
//['x1', 'y2']
//['x2', 'y1']
//['x2', 'y2']
```
æ•°ç»„æ¨å¯¼ç”± `[]` æ„å»ºäº†ä¸€ä¸ªä½œç”¨åŸŸ, å…¶å†…éƒ¨æ–°å»ºçš„å˜é‡, ç­‰åŒäºç”¨ let å…³é”®å­—å£°æ˜çš„å˜é‡ã€‚é™¤æ­¤ä¹‹å¤–, å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥è¢«è§†ä¸ºæ•°ç»„, æ‰€ä»¥åŒæ ·å¯ä»¥ä½¿ç”¨æ•°ç»„æ¨å¯¼:
```js
[for(c of 'abcde'). c+'.'].join('');  //"a.2.3.4.5."
```

## äºŒè¿›åˆ¶æ•°ç»„

è¿™ä¸ªéƒ¨åˆ†å¦‚æœæ²¡æœ‰Cè¯­è¨€å’Œè®¡ç®—æœºåŸºç¡€ä¼šæ¯”è¾ƒéš¾ç†è§£, å¦‚æœå®åœ¨ç†è§£ä¸äº†å¯ä»¥æ”¶è—å®ƒ, æ—¥åå†çœ‹ã€‚

äºŒè¿›åˆ¶æ•°ç»„å…¶å®å¾ˆæ—©å°±æœ‰äº†, ä¸è¿‡ä¸ºäº† WebGL ä¸­, æ•°æ®å¯ä»¥é«˜æ•ˆå’Œæ˜¾å¡äº¤æ¢æ•°æ®ã€‚åˆ†ä¸º3ç±»:
- ArrayBuffer: ä»£è¡¨å†…å­˜ä¸­çš„ä¸€æ®µäºŒè¿›åˆ¶æ•°æ®;
- TypedArray: è¯»å†™ç®€å•çš„äºŒè¿›åˆ¶æ•°æ®, å¦‚ Uint8Array, Int16Array, Float32Array ç­‰9ç±»;
- DataView: è¯»å†™å¤æ‚çš„äºŒè¿›åˆ¶æ•°æ®, å¦‚ Uint8, Int16, Float32 ç­‰8ç±»;

æ•°æ®ç±»å‹ | å­—èŠ‚é•¿åº¦ | å«ä¹‰ | å¯¹åº” C è¯­è¨€ç±»å‹ | TypedArray ç±»å‹ | DataView ç±»å‹
--- | --- | --- | --- | --- | ---
Int8 | 1 | 8ä½æœ‰ç¬¦å·æ•´æ•° | char | Int8Array | Int8
Uint8 | 1 | 8ä½æ— ç¬¦å·æ•´æ•° | unsigned char | Uint8Array | Uint8
Uint8C | 1 | 8ä½æ— ç¬¦å·æ•´æ•°(è‡ªåŠ¨è¿‡æ»¤æº¢å‡º) | unsigned char | Uint8ClampedArray | ä¸æ”¯æŒ
Int16 | 2 | 16ä½æœ‰ç¬¦å·æ•´æ•° | short | Int16Array | Int16
Uint16 | 2 | 16ä½æ— ç¬¦å·æ•´æ•° | unsigned short | Uint16Array | Uint16
Int32 | 4 | 32ä½æœ‰ç¬¦å·æ•´æ•° | int | Int32Array | Int32
Uint32 | 4 | 32ä½æ— ç¬¦å·æ•´æ•° | unsigned int | Uint32Array | Uint32
Float32 | 4 | 32ä½æµ®ç‚¹æ•° | float | Float32Array | Float32
Float64 | 8 | 64ä½æµ®ç‚¹æ•° | double | Float64Array | Float64

### ArrayBuffer

ArrayBuffer ä»£è¡¨å†…å­˜ä¸­çš„ä¸€æ®µäºŒè¿›åˆ¶æ•°æ®, æˆ‘ä»¬æ²¡æ³•ç›´æ¥æ“ä½œ, éœ€è¦åˆ©ç”¨è§†å›¾(TypedArray, DataView)æŒ‰ä¸€å®šæ ¼å¼è§£è¯»äºŒè¿›åˆ¶æ•°æ®ã€‚ä½†æˆ‘ä»¬ä¾ç„¶å¯ä»¥æ„é€ ä¸€æ®µå†…å­˜æ¥å­˜æ”¾äºŒè¿›åˆ¶æ•°æ®:
```js
var buf = new ArrayBuffer(32);  //åˆ†é…32ä¸ªå­—èŠ‚çš„å†…å­˜å­˜æ”¾æ•°æ®, é»˜è®¤å…¨0
var dataview = new DataView(buf);   //å°†è¿™æ®µå†…å­˜è½¬ä¸ºè§†å›¾
dataview.getUint8(0);   //å¾—åˆ°ç¬¬ä¸€ä¸ª8å­—èŠ‚çš„å€¼(æ— ç¬¦å·), 0
```

 è¿™é‡Œéœ€è¦å¼ºè°ƒçš„æ˜¯, åˆ†é…å†…å­˜ç©ºé—´ä¸è¦å¤ªå¤§ï¼æ¯•ç«Ÿä½ çš„å†…å­˜æ˜¯æœ‰é™çš„ã€‚
 å…¶æ¬¡, æ— è®ºä½¿ç”¨ä»€ä¹ˆè§†å›¾, å…¶å®ä¾‹åŒ–çš„å†…å­˜å¦‚æœå…±äº«, æ‰€æœ‰çš„å†™å…¥æ“ä½œä¼šä¿®æ”¹æ¯ä¸€ä¸ªè§†å›¾, å› ä¸ºå†…å­˜å…±ç”¨çš„:
 ```js
var buf = new ArrayBuffer(32);
var view16 = new Int16Array(buf);
var viewu8 = new Uint8Array(buf);

console.log(viewu8[0]);   //0
view16[0]=-1;
console.log(viewu8[0]);   //255
 ```
 è¿™é‡Œä¹‹æ‰€ä»¥å¾—åˆ°255, æ˜¯å› ä¸ºå†…å­˜å…±ç”¨å¯¼è‡´çš„, ä½†ä¸ºä½•ä¸æ˜¯-1ï¼ŸInt16Array æ˜¯æœ‰ç¬¦å·ç±»å‹çš„, è¿™æ ·äºŒè¿›åˆ¶çš„æœ€é«˜ä½ç”¨ä½œç¬¦å·ä½, è´Ÿæ•°è®°ä¸º1: `1000 0000 0000 0001`, ä¹‹åçš„æ•°å­—ç”¨ç§»ç å­˜å‚¨, å¾—åˆ°-1çš„äºŒè¿›åˆ¶ä¸º: `1111 1111 1111 1111`, ä¹‹ååˆ©ç”¨Uint8Arrayè¯»å–æ— ç¬¦å·çš„å‰8ä½, å¾—åˆ°`1111 1111`è¿™ä¸ªè®¡ç®—ä¸ºåè¿›åˆ¶ä¸º $2^8-1=255$ã€‚å…·ä½“å…³äºæ•°åˆ¶è½¬æ¢å’Œåç è¡¥ç è¿™é‡Œä¸å†å±•å¼€, å¦åˆ™å°±è·‘åäº†ã€‚

ArrayBuffer å¯¹è±¡ä¹Ÿæœ‰å‡ ä¸ªæ–¹æ³•å’Œå±æ€§:
- byteLength: å¾—åˆ°å†…å­˜åŒºåŸŸçš„å­—èŠ‚é•¿åº¦
```js
const N = 32;
var buf = new ArrayBuffer(N);
if(buf.byteLength === N){
  //åˆ†é…æˆåŠŸ
} else {
  //åˆ†é…å¤±è´¥
}
```

- slice(start=0, end=this.byteLength): åˆ†é…æ–°å†…å­˜, å¹¶æŠŠå…ˆæœ‰å†…å­˜ start åˆ° end éƒ¨åˆ†å¤åˆ¶è¿‡å», è¿”å›è¿™æ®µæ–°å†…å­˜åŒºåŸŸ
```js
var buf = new ArrayBuffer(32);
var newBuf = buf.slice(0, 3);
```

- isView(view): åˆ¤æ–­ä¼ å…¥çš„ view æ˜¯å¦å½“å‰ buffer çš„è§†å›¾, æ˜¯åˆ™è¿”å› true, å¦åˆ™ falseã€‚è¯¥æ–¹æ³•æš‚æ— æ³•ä½¿ç”¨ã€‚
```js
var buf1 = new ArrayBuffer(32);
var buf2 = new ArrayBuffer(32);
var buf1View = new Int8Array(buf1);
var buf2View = new Int8Array(buf2);

buf1.isView(buf1View);   //true
buf1.isView(buf2View);   //false
```

### TypedArray

å…·æœ‰ä¸€ä¸ªæ„é€ å‡½æ•° DataView(), æ¥å—ä¸€ä¸ªArrayBufferå‚æ•°, è§†å›¾åŒ–è¯¥æ®µå†…å­˜; æˆ–æ¥å—ä¸€ä¸ªæ•°ç»„å‚æ•°, å®ä¾‹åŒ–è¯¥æ•°ç»„ä¸ºäºŒè¿›åˆ¶å†…å®¹ã€‚å¾—åˆ°çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„, å¯ä»¥ç›´æ¥ä½¿ç”¨`[]`è®¿é—®æ¯ä¸ªä½ç½®çš„å†…å®¹, æœ‰`length`å±æ€§ã€‚å…¶æ„é€ å‡½æ•°æœ‰9ä¸ª:

æ•°æ®ç±»å‹ | å­—èŠ‚é•¿åº¦ | å«ä¹‰ | å¯¹åº” C è¯­è¨€ç±»å‹ | TypedArray ç±»å‹æ„é€ å‡½æ•°
--- | --- | --- | --- | ---
Int8 | 1 | 8ä½æœ‰ç¬¦å·æ•´æ•° | char | Int8Array()
Uint8 | 1 | 8ä½æ— ç¬¦å·æ•´æ•° | unsigned char | Uint8Array()
Uint8C | 1 | 8ä½æ— ç¬¦å·æ•´æ•°(è‡ªåŠ¨è¿‡æ»¤æº¢å‡º) | unsigned char | Uint8ClampedArray()
Int16 | 2 | 16ä½æœ‰ç¬¦å·æ•´æ•° | short | Int16Array()
Uint16 | 2 | 16ä½æ— ç¬¦å·æ•´æ•° | unsigned short | Uint16Array()
Int32 | 4 | 32ä½æœ‰ç¬¦å·æ•´æ•° | int | Int32Array()
Uint32 | 4 | 32ä½æ— ç¬¦å·æ•´æ•° | unsigned int | Uint32Array()
Float32 | 4 | 32ä½æµ®ç‚¹æ•° | float | Float32Array()
Float64 | 8 | 64ä½æµ®ç‚¹æ•° | double | Float64Array()

ä»¥ä¸Š9ä¸ªä¼šå¯¹å†…å­˜è¿›è¡Œä¸åŒä½æ•°çš„æ ¼å¼åŒ–, ä»¥å¾—åˆ°å¯¹åº”ç±»å‹å€¼çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸åŒäºæ™®é€šæ•°ç»„, å®ƒä¸æ”¯æŒç¨€ç–æ•°ç»„, é»˜è®¤å€¼ä¸º0, è€Œä¸”åŒä¸€ä¸ªæ•°ç»„åªèƒ½å­˜æ”¾åŒä¸€ä¸ªç±»å‹çš„å˜é‡ã€‚

ä»¥ä¸Šæ¯ä¸ªæ„é€ å‡½æ•°éƒ½å¯¹åº”å¦‚ä¸‹å½¢å¼çš„å‚æ•°:
```js
(buffer, start=0, len=buffer.byteLength-start*8)
```
å¯ä»¥æŒ‡å®šåºåˆ—åŒ–å…¶ä¸­ startåˆ° endéƒ¨åˆ†çš„äºŒè¿›åˆ¶æ•°æ®ã€‚æ³¨æ„è¿™é‡ŒæŒ‡å®šçš„èŒƒå›´å¿…é¡»å’Œæ•°ç»„ç±»å‹æ‰€åŒ¹é…, ä¸èƒ½å‡ºç°ç±»ä¼¼`new Int32Array(buffer, 2, 2)`çš„æƒ…å†µã€‚å¦‚æœä½ è§‰å¾—è¿™ä¸ªä¸ç¬¦åˆä½ çš„éœ€æ±‚, å¯ä»¥ä½¿ç”¨ DataViewã€‚

å¦‚æœä½ è§‰å¾—ä¸Šé¢çš„å†™æ³•å¤æ‚, å¯ä»¥ä¸å†™ new ArrayBuffer, ç›´æ¥ä½¿ç”¨ TypedArray, ä½†æ³¨æ„å‚æ•°çš„æ„ä¹‰ä¸ä¸€æ ·:
```js
var f64a = new Float64Array(4);    //åˆ†é…32ä¸ªå­—èŠ‚, å¹¶ä½œä¸ºdoubleç±»å‹ä½¿ç”¨ã€‚ 32 = 64 / 8 * 4
```

TypedArrayçš„æ„é€ å‡½æ•°è¿˜æ¥å—å¦ä¸€ä¸ªTypedArrayä½œä¸ºå‚æ•°, å¼€è¾Ÿæ–°å†…å­˜å¤åˆ¶å…¶å€¼å¹¶æ”¹å˜ç±»å‹, å¯¹åŸè§†å›¾å’Œbuffer ä¸æ„æˆå½±å“, ä¹Ÿä¸å…±ç”¨å†…å­˜ã€‚
TypeArrayçš„æ„é€ å‡½æ•°è¿˜æ¥å—å¦ä¸€ä¸ªArrayä½œä¸ºå‚æ•°, å¼€è¾Ÿæ–°å†…å­˜å¤åˆ¶å…¶å€¼, å¯¹åŸæ•°ç»„ä¸æ„æˆå½±å“, ä¹Ÿä¸å…±ç”¨å†…å­˜ã€‚

å½“ç„¶åˆ©ç”¨ä¸€ä¸‹æ–¹æ³•, å¯ä»¥æŠŠ TypedArray è½¬æ¢ä¸ºæ™®é€šæ•°ç»„:
```js
var arr = [].slice.call(typedArray);
```

TypedArrayå…·æœ‰é™¤äº†`concat()`ä»¥å¤–çš„å…¨éƒ¨æ•°ç»„æ–¹æ³•, å½“ç„¶, å®ƒä¹Ÿå…·æœ‰ iterator, å¯ä»¥ç”¨ for...of éå†ã€‚
ä»¥ä¸‹æ˜¯ TypedArray ç‰¹æœ‰çš„å±æ€§å’Œæ–¹æ³•:

- bufferå±æ€§: è¿”å›è¯¥è§†å›¾å¯¹äºçš„äºŒè¿›åˆ¶å†…å­˜åŒºåŸŸ
- BYTES_PER_ELEMENTå±æ€§: æ˜¯ä¸ªå¸¸æ•°, è¡¨ç¤ºæ•°ç»„ä¸­æ¯ä¸ªå€¼çš„å­—èŠ‚å¤§å°, ä¸åŒè§†å›¾çš„è¿”å›å€¼ä¸ä¸Šæ–¹è¡¨æ ¼ä¸€è‡´
- byteLength: è¿”å›è¯¥è§†å›¾å¯¹äºçš„å†…å­˜å¤§å°, åªè¯»
- byteOffset: è¿”å›è¯¥è§†å›¾ä»å¯¹åº” buffer çš„å“ªä¸ªå­—èŠ‚å¼€å§‹, åªè¯»
- set(arr_or_typeArray, start=0): åœ¨å†…å­˜å±‚é¢, ä»arr_or_typeArray çš„ start ä¸‹æ ‡å¼€å§‹å¤åˆ¶æ•°ç»„åˆ°å½“ç„¶ typeArray
- subarray(start=0, end=this.length), æˆªå– startåˆ° endéƒ¨åˆ†å­æ•°ç»„, ä½†æ˜¯å’ŒåŸæ•°ç»„å…±ç”¨å†…å­˜
- from(): æ¥å—ä¸€ä¸ªå¯éå†å‚æ•°, è½¬ä¸ºè¯¥è§†å›¾å®ä¾‹
- of(): å°†å‚æ•°åˆ—è¡¨è½¬ä¸ºè¯¥è§†å›¾å®ä¾‹

å°æŠ€å·§, è½¬æ¢å­—ç¬¦ä¸²å’Œ ArrayBuffer
```js
//è¯¥æ–¹æ³•ä»…é™è½¬æ¢ utf-16 çš„å­—ç¬¦ä¸²
function ab2str(buf){
  return String.fromCharCode.apply(null, new Uint16Array(buf));
}
function str2ab(str){
  var len = str.length;
  var view = new Uint16Array(len);
  for(let i = 0; i < len; i++){
    view[i] = str.charCodeAt(i);
  }
  return view.buffer;
}
var str = "Hello world";
var buf = str2ab(str);
var view = new Uint16Array(buf);
for(var i = 0; i < view.length; i++){
  console.log(String.fromCharCode(view[i]));   //ä¸€æ¬¡è¾“å‡º"Hello world"çš„æ¯ä¸ªå­—æ¯
}
console.log(ab2str(buf));    //"Hello world"
```

> è¿™é‡Œæ‰©å±•ä¸€äº›ç¼–ç çŸ¥è¯†, æˆ‘ä»¬çŸ¥é“è®¡ç®—æœºé‡Œé¢å­˜å‚¨çš„æ˜¯äºŒè¿›åˆ¶, å¹¶ä¸”å­˜å‚¨çš„æœ€å°å•ä½æ˜¯å­—èŠ‚ã€‚ä½†æ˜¯ä¸åŒçš„ç³»ç»Ÿå­˜å‚¨æ–¹å¼ä¸åŒ, åˆ†ä¸ºé«˜ä½ä¼˜å…ˆå’Œä½ä½ä¼˜å…ˆã€‚æ¯”å¦‚ 20170101 è¿™ä¸ªæ•°å­—, å…¶åå…­è¿›åˆ¶è¡¨ç¤ºä¸º 0x0133C575, åœ¨ä½ä½ä¼˜å…ˆçš„ç³»ç»Ÿä¸­å­˜å‚¨æ–¹å¼ä¸º `0x75 0xC5 0x33 0x01`, è€Œåœ¨é«˜ä½ä¼˜å…ˆçš„ç³»ç»Ÿä¸­å­˜å‚¨æ–¹å¼ä¸º `0x01 0x33 0xC5 0x75`ã€‚ç”±äºå¤§å¤šæ•°è®¡ç®—æœºé‡‡ç”¨ä½ä½ä¼˜å…ˆçš„æ–¹å¼, æ‰€ä»¥ ES6 é‡‡ç”¨æ˜¯ä¹Ÿæ˜¯ä½ä½ä¼˜å…ˆçš„æ–¹å¼, ä½†é‡åˆ°é«˜ä½ä¼˜å…ˆçš„æ•°æ®æ—¶, å°±ä¸èƒ½ç®€å•çš„ç›´æ¥é‚£æ¥ä½¿ç”¨, å…·ä½“ä½¿ç”¨ä¼šåœ¨ DataView ä¸­ä»‹ç», è¿™é‡Œè¯´æ˜ä¸€ç§åˆ¤æ–­ä½ä½ä¼˜å…ˆ(little endian)è¿˜æ˜¯é«˜ä½ä¼˜å…ˆ(big endian)çš„æ–¹æ³•:

è¿˜æœ‰éœ€è¦æ³¨æ„çš„æ˜¯æ•°æ®æº¢å‡º, è¿™ä¸ªä¹Ÿæ˜¯éœ€è¦æ•°åˆ¶æ–¹é¢åŸºç¡€æ¯”è¾ƒå¥½ç†è§£, è¿™é‡Œä¸è¿‡å¤šå±•å¼€äº†ã€‚ä¸¾ä¸€ä¸ªä¾‹å­:
Uint8 åªèƒ½è¡¨ç¤º8ä½æ— ç¬¦å·æ•´æ•°, æœ€å¤§æ˜¯`1111 1111`, ä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„ 0~255; Int8å› ä¸ºæœ‰äº†ç¬¦å·ä½, åªèƒ½è¡¨ç¤ºåè¿›åˆ¶-128~127, å¦‚æœç»™å®ƒçš„å€¼ä¸åœ¨è¿™ä¸ªèŒƒå›´å†…å°±ä¼šå‘ç”Ÿæº¢å‡º, å¾—åˆ°ä¸€ä¸ªä½ æ„æƒ³ä¸åˆ°ä½†æƒ…ç†ä¹‹ä¸­çš„å€¼
```js
var view1 = new Uint8Array(2);
view1[0] = 256;   //256 äºŒè¿›åˆ¶æ˜¯ 1 0000 0000 ç”±äºæ•°æ®åªèƒ½å®¹çº³8ä¸ªå€¼, è¿›ä½1å°±ä¸¢äº†
view1[1] = -1;    //ä¹‹å‰è¯´è¿‡-1 äºŒè¿›åˆ¶(è¡¥ç )ä¸º 1111 1111(å…¨1), ä½œä¸ºæ— ç¬¦å·æ•°8ä¸ª1å°±æ˜¯255

console.log(view1[0]);   //0
console.log(view1[1]);   //255

var view2 = new Int8Array(2);
view2[0] = 128;   //ç”±äºç¬¦å·ä½æº¢å‡º, ç³»ç»Ÿè‡ªåŠ¨ç”¨32ä½è®¡ç®—è¿™ä¸ªæ•°1 000 0000 0000 0000 0000 0000 1000 0000, å–ç¬¦å·ä½å’Œæœ€å8ä½å¾—åˆ°-128
view2[1] = -128;  //ç”±äºç¬¦å·ä½æº¢å‡º, ç³»ç»Ÿè‡ªåŠ¨ç”¨32ä½è®¡ç®—è¿™ä¸ªæ•°0 111 1111 1111 1111 1111 1111 0111 1111, å–ç¬¦å·ä½å’Œæœ€å8ä½å¾—åˆ°127
console.log(view2[0]);   //-128
console.log(view2[1]);   //127
```

ä¸ºäº†é˜²æ­¢è¿™æ ·çš„æƒ…å†µ, js æœ‰ä¸€ä¸ª Unit8ClampedArray, ä½¿æ•´æ•°æ–¹å‘çš„æº¢å‡ºå€¼ä¸º255, 0æ–¹å‘çš„æ˜“æ¥šå¿—ä¸º0ã€‚æ³¨æ„è¿™æ˜¯ä¸ªæ— ç¬¦å·çš„ç±»å‹;
```js
var view = new Uint8ClampedArray(2);
view[0] = 256;
view[1] = -1;

console.log(view[0]);   //255
console.log(view[1]);   //0
```

### å¤åˆè§†å›¾

åˆ’åˆ†ä¸€å— buffer ä½¿ç”¨å¾—åˆ° C è¯­è¨€ä¸­çš„ç»“æ„ä½“
```js
var buf = new ArrayBuffer(24);
var name = new Uint8Array(buf, 0, 16);
var gender = new Uint8Array(buf, 16, 1);
var age = new Uint16Array(buf, 18, 1);
var score = new Float32Array(buf, 20, 1);
```
ç›¸å½“äºä»¥ä¸‹ Cè¯­è¨€ä»£ç 
```cpp
struct Person{
  char name[16];
  char gender;
  int age;
  float score;
}
```

å…±ç”¨ä¸€å— buffer ä½¿ç”¨å¾—åˆ° C è¯­è¨€ä¸­çš„è”åˆä½“
```js
var buf = new ArrayBuffer(8);
var num = new Uint16Array(buf);
var dotNum = new Float64Array(buf);
```
ç›¸å½“äºä»¥ä¸‹ Cè¯­è¨€ä»£ç 
```cpp
union Example{
  int num[4];
  double dotNum;
}

```

### DataView

å…·æœ‰ä¸€ä¸ªæ„é€ å‡½æ•° DataView(), æ¥å—ä¸€ä¸ªArrayBufferå‚æ•°, è§†å›¾åŒ–è¯¥æ®µå†…å­˜ã€‚æ¯•ç«Ÿå½“ä¸€æ®µå†…å­˜æœ‰å¤šç§æ•°æ®æ—¶, å¤åˆè§†å›¾ä¹Ÿä¸æ˜¯é‚£ä¹ˆæ–¹ä¾¿, è¿™æ—¶é€‚åˆä½¿ç”¨ DataView è§†å›¾ã€‚å…¶æ¬¡ DataView å¯ä»¥è‡ªå®šä¹‰é«˜ä½ä¼˜å…ˆå’Œä½ä½ä¼˜å…ˆ, è¿™æ ·å¯ä»¥è¯»å–çš„æ•°æ®å°±æ›´å¤šäº†ã€‚
DataViewæ„é€ å‡½æ•°å½¢å¼å¦‚ä¸‹, è¿™ä¸€ç‚¹å’Œ TypedArray ä¸€è‡´:
```js
(buffer, start=0, len=buffer.byteLength-start*8)
```

å®ƒå…·æœ‰ä»¥ä¸‹æ–¹æ³•æ ¼å¼åŒ–è¯»å– buffer ä¸­çš„ä¿¡æ¯:

- getInt8(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 1 ä¸ªå­—èŠ‚, è¿”å›ä¸€ä¸ª8ä½æœ‰ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- getUint8(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 1 ä¸ªå­—èŠ‚, è¿”å›ä¸€ä¸ª8ä½æ— ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- getInt16(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 2 ä¸ªå­—èŠ‚, è¿”å›ä¸€ä¸ª16ä½æœ‰ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- getUint16(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 2 ä¸ªå­—èŠ‚, è¿”å›ä¸€ä¸ª16ä½æ— ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- getInt32(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 4 ä¸ªå­—èŠ‚, è¿”å›ä¸€ä¸ª32ä½æœ‰ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- getUint32(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 4 ä¸ªå­—èŠ‚, è¿”å›ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- getFloat32(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 4 ä¸ªå­—èŠ‚, è¿”å›ä¸€ä¸ª32ä½æµ®ç‚¹æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- getFloat64(start, isLittleEndian): ä» start å­—èŠ‚å¤„è¯»å– 8 ä¸ªå­—èŠ‚, è¿”å›ä¸€ä¸ª64ä½æµ®ç‚¹æ•°, ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;


å®ƒå…·æœ‰ä»¥ä¸‹æ–¹æ³•æ ¼å¼åŒ–å†™å…¥ buffer ä¸­çš„ä¿¡æ¯:

- setInt8(start, value, isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 1 ä¸ªå­—èŠ‚çš„8ä½æœ‰ç¬¦å·æ•´æ•°value; ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- setUint8(start, value, isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 1 ä¸ªå­—èŠ‚çš„8ä½æ— ç¬¦å·æ•´æ•°value; ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- setInt16(start, value, isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 2 ä¸ªå­—èŠ‚çš„16ä½æœ‰ç¬¦å·æ•´æ•°value; ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- setUint16(start, value, isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 2 ä¸ªå­—èŠ‚çš„16ä½æ— ç¬¦å·æ•´æ•°value; ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- setInt32(start, value, isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 4 ä¸ªå­—èŠ‚çš„32ä½æœ‰ç¬¦å·æ•´æ•°value; ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- setUint32(start, value, isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 4 ä¸ªå­—èŠ‚çš„32ä½æ— ç¬¦å·æ•´æ•°value; ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- setFloat32(start, value, isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 4 ä¸ªå­—èŠ‚çš„32ä½æµ®ç‚¹æ•°value; ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;
- setFloat64(start, value, isLittleEndian): åœ¨ startä½ç½®å†™å…¥ 8 ä¸ªå­—èŠ‚çš„64ä½æµ®ç‚¹æ•°value; ç¬¬äºŒå‚é»˜è®¤ä¸º false è¡¨ç¤ºä½¿ç”¨é«˜ä½ä¼˜å…ˆ, ä¸º true è¡¨ç¤ºä½ä½ä¼˜å…ˆ;

å®ƒå…·æœ‰ä»¥ä¸‹å±æ€§å’Œæ–¹æ³•:

- bufferå±æ€§: è¿”å›è¯¥è§†å›¾å¯¹äºçš„äºŒè¿›åˆ¶å†…å­˜åŒºåŸŸ
- byteLength: è¿”å›è¯¥è§†å›¾å¯¹äºçš„å†…å­˜å¤§å°, åªè¯»
- byteOffset: è¿”å›è¯¥è§†å›¾ä»å¯¹åº” buffer çš„å“ªä¸ªå­—èŠ‚å¼€å§‹, åªè¯»

å¦‚æœä½ ä¸çŸ¥é“è®¡ç®—æœºä½¿ç”¨çš„æ˜¯é«˜ä½ä¼˜å…ˆè¿˜æ˜¯ä½ä½ä¼˜å…ˆ, ä¹Ÿå¯ä»¥è‡ªè¡Œåˆ¤æ–­:
```js
//æ–¹æ³•1
const BIG_ENDIAN = Symbol('BIG_ENDIAN');
const LITTLE_ENDIAN = Symbol('LITTLE_ENDIAN');
function getPlatformEndianness(){
  let arr32 =  Uint32Array.of(0x12345678);
  let arr8 = new Uint8Array(arr32.buffer);
  switch((arr8[0]*0x1000000)+(arr8[1]*0x10000)+(arr8[2]*0x100)+arr8[3]){
    case 0x12345678: return BIG_ENDIAN;
    case 0x78563412: return LITTLE_ENDIAN;
    default: throw new Error("unknow Endianness");
  }
}

//æ–¹æ³•2
window.isLittleEndian = (function(){
  var buffer = new ArrayBuffer(2);
  new DataView(buffer).setInt16(0, 256, true);
  return new Int16Array(buffer)[0] === 256;
}());
```

## æ­£åˆ™è¡¨è¾¾å¼æ‰©å±•

- æ„é€ å‡½æ•°æ”¯æŒä¼ å…¥æ­£åˆ™å¾—åˆ°æ‹·è´, åŒæ—¶å¯ä»¥ç”¨ç¬¬äºŒå‚ä¿®æ”¹ä¿®é¥°ç¬¦
```js
var reg = /^abc/ig;
var newReg_ig = new RegExp(reg);      //newReg_ig = /^abc/ig;
var newReg_g = new RegExp(reg, 'g');      //newReg_g = /^abc/g;
```

- å¼•å…¥æ–°çš„ä¿®é¥°ç¬¦
ES5ä¸­çš„ä¿®é¥°ç¬¦æœ‰3ä¸ª, åŠ ä¸Š ES6 çš„ä¿®é¥°ç¬¦, ä¸€å…±5ä¸ª:

ä¿®é¥°ç¬¦ | æè¿° | æè¿°
--- | --- | ---
m | multiline | å¤šè¡Œæ¨¡å¼
i | ignore case | å¿½ç•¥å¤§å°å†™æ¨¡å¼
g | global match | å…¨å±€åŒ¹é…æ¨¡å¼
u | unicode | unicodeæ¨¡å¼
y | sticky | ç²˜è¿æ¨¡å¼

unicode æ¨¡å¼
ä¸ºäº†å…¼å®¹ 4 è‡ªå·± unicode, æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸‹æƒ…å†µä½¿ç”¨è¯¥æ¨¡å¼
```js
//æƒ…å†µ1:
/^\uD83D/.test("\uD83D\uDC2A");   //true, å¾ˆæ˜æ˜¾è¿™ä¸ªæ˜¯ä¸å¯¹çš„, å› ä¸º \uD83D\uDC2A æ˜¯ä¸€ä¸ªå­—, ä¸èƒ½æ‹†å¼€
/^\uD83D/u.test("\uD83D\uDC2A");   //false

//æƒ…å†µ2
var s = "ğ ®·";
/^.$/.test(s);     //false, é€šé…ç¬¦ . ä¸èƒ½åŒ¹é…32ä½unicode
/^.$/u.test(s);     //true

//æƒ…å†µ3
var s = "ğ ®·a";
/\u{63}/.test(s);     //false, ä¸èƒ½ä½¿ç”¨{}å½¢å¼çš„ unicode, è¢«ç”µè„‘è®¤ä¸º u å‡ºç°63æ¬¡
/\u{63}/u.test(s);     //false, å³ä½¿ç”¨äº† u ä¹Ÿä¸€æ ·
//ä¸ºäº†é¿å…è¿™ç§è¯¯è§£, åˆç†ä½¿ç”¨ u ä¿®é¥°ç¬¦

//æƒ…å†µ3
var s = "ğ ®·";
/^\S$/.test(s);     //false, \S æ— æ³•ç›‘æµ‹åˆ°32ä½ unicode
/^\S$/u.test(s);     //true
```

å½“ç„¶è¿™ä¸ªé‡Œé¢è¿˜æ˜¯æœ‰å‘çš„, æ¯”å¦‚ä¸‹é¢è¿™ä¸ª:
```js
var k1 = "\u004B";
var k2 = "\u212A";

/[a-z]/i.test(k1);     //true
/[a-z]/iu.test(k1);     //true
/[a-z]/i.test(k2);     //false
/[a-z]/iu.test(k2);     //true
```
ç¬¬ä¸‰ä¸ªè¾“å‡ºå±…ç„¶æ˜¯ falseï¼Ÿæ ¹æœ¬æ²¡æœ‰32ä½ unicode å‘€, å¹²å˜›ç”¨uä¿®é¥°ï¼Ÿ å…¶å® `"\u004B"` å’Œ `"\u212A"` éƒ½æ˜¯ `K`(å‰ä¸€ä¸ªæ˜¯çœŸ K, åä¸€ä¸ªæ˜¯å‡çš„), åšä¸»ä¹Ÿä¸çŸ¥é“ä¸ºå•¥ä¼šè¿™æ ·ï¼

y ä¿®é¥°ç¬¦

å’Œå…¨å±€ä¿®é¥°ç¬¦(g)ç±»ä¼¼, æ‰§è¡Œå…¨å±€åŒ¹é…, ä½† g åªæœ‰å‰©ä½™ä½ç½®å­˜åœ¨åŒ¹é…å³å¯, y åˆ™å¿…é¡»ä¸­ä¸Šæ¬¡åŒ¹é…çš„ä¸‹ä¸€ä¸ªå­—æ¯å¼€å§‹ã€‚
```js
var s = 'aaa_aa_a';
var r1 = /a+/g;
var r2 = /a+/y;

r1.exec(s);  //["aaa"], å‰©ä½™å­—ç¬¦æ˜¯ '_aa_a'
r2.exec(s);  //["aaa"], å‰©ä½™å­—ç¬¦æ˜¯ '_aa_a'

r1.exec(s);  //["aa"], é™å®šèµ·å§‹ç‚¹, å¾—åˆ° aa, å‰©ä½™å­—ç¬¦æ˜¯ '_a'
r2.exec(s);  //null, å¿…é¡»ä»å‰©ä½™å­—ç¬¦çš„ç¬¬ä¸€ä¸ªå°±åŒ¹é…åˆ°, ç›¸å½“äº /^a+/g, ç”±äºåŒ¹é…ä¸åˆ°è¿”å› null, åŒæ—¶å°† lastIndex ç½® 0

r1.exec(s);  //["a"], å‰©ä½™å­—ç¬¦æ˜¯ ''
r2.exec(s);  //["aaa"], å‰©ä½™å­—ç¬¦æ˜¯ '_aa_a'
```
yä¿®é¥°ç¬¦å°±æ˜¯ä¸ºäº†è®©èµ·å§‹ä½ç½®åŒ¹é… ^ åœ¨å…¨å±€æœ‰æ•ˆæ‰è®¾è®¡ä½¿ç”¨çš„ã€‚

ä¸æ­¤åŒæ—¶, es6 ä¸­çš„ `RegExp.prototype` ä¹ŸåŠ å…¥äº†ä¸€äº›æ–°çš„å±æ€§:
```js
var reg = /^abc/uy;
reg.sticky;   //true, åˆ¤æ–­regæ˜¯å¦æ˜¯ç²˜è¿æ¨¡å¼
reg.unicode;  //true, åˆ¤æ–­regæ˜¯å¦æ˜¯unicodeæ¨¡å¼
reg.flags;    //'uy', å¾—åˆ°å…¶å…¨éƒ¨ä¿®é¥°ç¬¦æ„æˆçš„å­—ç¬¦ä¸²
reg.source;   //'^abc' å¾—åˆ°æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²
var str="^abc."
RegExp.escape(str);  //\^abc\. å¾—åˆ°æ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²è½¬è¯‘å†™æ³•
```

## å‡½æ•°çš„æ‰©å±•

### å‚æ•°é»˜è®¤å€¼

ES5ä¸­è®¾ç½®é»˜è®¤å€¼éå¸¸ä¸æ–¹ä¾¿, æˆ‘ä»¬è¿™æ ·å†™:
```js
function fun(a){
  a = a || 2;
  console.log(a);
}
fun();   //2
fun(0);  //2
fun(1);  //1
```
ä»¥ä¸Šå†™æ³•, å¦‚æœä¼ å…¥äº†å‚æ•°, ä½†è¿™ä¸ªå‚æ•°å¯¹åº”å€¼çš„å¸ƒå°”å‹æ˜¯ false, å°±ä¸èµ·ä½œç”¨äº†ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥åˆ¤æ–­ `arguments.length` æ˜¯å¦ä¸º0æ¥é¿å…è¿™ä¸ªé—®é¢˜, ä½†æ¯ä¸ªå‡½æ•°è¿™æ ·å†™å°±å¤ªå•°å—¦äº†, å°¤å…¶å‚æ•°æ¯”è¾ƒå¤šçš„æ—¶å€™ã€‚åœ¨ ES6 ä¸­æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™åœ¨å‚æ•°è¡¨ä¸­, å¦‚æœå®é™…è°ƒç”¨ä¼ é€’äº†å‚æ•°, å°±ç”¨è¿™ä¸ªä¼ è¿‡æ¥çš„å‚æ•°, å¦åˆ™ç”¨é»˜è®¤å‚æ•°ã€‚åƒè¿™æ ·:
```js
function fun(a=2){
  console.log(a);
}
fun();   //2
fun(0);  //0
fun(1);  //1
```
å…¶å®å‡½æ•°é»˜è®¤å‚æ•°è¿™ä¸€ç‚¹æœ€å¼ºå¤§çš„åœ°æ–¹åœ¨äºå¯ä»¥å’Œè§£æ„èµ‹å€¼ç»“åˆä½¿ç”¨:
```js
//å‚æ•°ä¼ é€’
function f([x, y, z=4]){
  return [x+1, y+2, z+3];
}
var [a, b, c] = f([1, 2]);  //a=2, b=4, c=7
[[1, 2], [3, 4]].map(([a, b]) => a + b);   //è¿”å› [3, 7]
```
é€šè¿‡ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸éš¾å‘ç°, ä¸ä»…å¯ä»¥ç”¨è§£æ„çš„æ–¹æ³•è®¾ç½®åˆå§‹å€¼, è¿˜å¯ä»¥è¿›è¡Œå‚æ•°ä¼ é€’ã€‚å½“ç„¶, è¿™é‡Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡å½¢å¼çš„è§£æ„èµ‹å€¼ã€‚å¦‚æœä¼ å…¥çš„å‚æ•°æ— æ³•è§£æ„, å°±ä¼šæŠ¥é”™:
```js
function fun1({a=1, b=5, c='A'}){
  console.log(c + (a + b));
}
fun1({});   //'A6'
fun1();     //TypeError, å› ä¸ºæ— æ³•è§£æ„
//ä½†è¿™æ ·è®¾è®¡å‡½æ•°å¯¹ä½¿ç”¨å‡½æ•°çš„ç å†œå¾ˆä¸å‹å¥½
//æ‰€ä»¥, æŠ€å·§:
function fun2({a=1, b=5, c='A'}={}){
  console.log(c + (a + b));
}
fun2();     //'A6'
```
æ³¨æ„, å…¶å®è¿˜æœ‰ä¸€ç§æ–¹æ³•, ä½†ä¸å¦‚è¿™ä¸ªå¥½, æˆ‘ä»¬æ¯”è¾ƒå¦‚ä¸‹:
```js
//fun1 æ¯” fun2 å¥½, ä¸ä¼šäº§ç”Ÿä»¥å¤–çš„ undefined
function fun1({a=1, b=5, c='A'}={}){
  console.log(c + (a + b));
}
function fun2({a, b, c}={a: 1, b: 5, c: 'A'}){
  console.log(c + (a + b));
}
//ä¼ äº†å‚æ•°, ä½†æ²¡ä¼ å…¨éƒ¨å‚æ•°å°±ä¼šå‡ºé—®é¢˜
fun1({a: 8});     //'A13'
fun2({a: 8});     //NaN
```

ä¸è¿‡è¿™é‡Œå¼ºçƒˆå»ºè®®, å°†å…·æœ‰é»˜è®¤å€¼çš„å‚æ•°æ’åœ¨å‚æ•°åˆ—è¡¨çš„åé¢ã€‚å¦åˆ™è°ƒç”¨æ—¶ä¾ç„¶éœ€è¦ä¼ å‚:
```js
function f1(a=1, b){
  console.log(a + b);
}
function f2(a, b=1){
  console.log(a + b);
}
f2(2);   //3
f1(, 2);  //æŠ¥é”™
f1(undefined, 2);  //3, æ³¨æ„è¿™é‡Œä¸èƒ½ç”¨ null è§¦å‘é»˜è®¤å€¼
```

- å‡½æ•°çš„ length å±æ€§
è¿™ä¸ªå±æ€§ES6 ä¹‹å‰å°±æ˜¯å­˜åœ¨çš„, è®°å¾—lengthè¡¨ç¤ºé¢„è®¡ä¼ å…¥çš„å½¢å‚ä¸ªæ•°, ä¹Ÿå°±æ˜¯æ²¡æœ‰é»˜è®¤å€¼çš„å½¢å‚ä¸ªæ•°:
```js
(function(a){}).length;   //1
(function(a = 5){}).length;   //0
(function(a, b, c=5){}).length;   //2
(function(...args){}).length;   //0, restå‚æ•°ä¹Ÿä¸è®¡å…¥ length
```

## rest å‚æ•°

rest å‚æ•°å½¢å¼ä¸º `...å˜é‡å`, å®ƒä¼šå°†å¯¹åº”çš„å…¨éƒ¨å®é™…ä¼ é€’çš„å˜é‡æ”¾å…¥æ•°ç»„ä¸­, å¯ä»¥ç”¨å®ƒæ¥æ›¿ä»£ arguments:
```js
function f(...val){
  console.log(val.join());
}
f(1, 2);      //[1, 2]
f(1, 2, 3, 4);  //[1, 2, 3, 4]

function g(a, ...val){
  console.log(val.join());
}
g(1, 2);      //[2]
g(1, 2, 3, 4);  //[2, 3, 4]
```
å¦åˆ™è¿™ä¸ªå‡½æ•° g ä½ çš„è¿™æ ·å®šä¹‰å‡½æ•°, æ¯”è¾ƒéº»çƒ¦:
```js
function g(a){
  console.log([].slice.call(arguments, 1).join());
}
```

è¿™é‡Œéœ€è¦æ³¨æ„2ç‚¹:

- restå‚æ•°å¿…é¡»æ˜¯å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°, å®ƒçš„åé¢ä¸èƒ½å†å®šä¹‰å‚æ•°, å¦åˆ™ä¼šæŠ¥é”™ã€‚
- restå‚æ•°ä¸è®¡å…¥å‡½æ•°çš„ length å±æ€§ä¸­

å»ºè®®ï¼š

- æ‰€æœ‰é…ç½®é¡¹éƒ½åº”è¯¥é›†ä¸­åœ¨ä¸€ä¸ªå¯¹è±¡ï¼Œæ”¾åœ¨æœ€åä¸€ä¸ªå‚æ•°ï¼Œå¸ƒå°”å€¼ä¸å¯ä»¥ç›´æ¥ä½œä¸ºå‚æ•°ã€‚è¿™æ ·æ–¹ä¾¿è°ƒç”¨è€…ä»¥ä»»ä½•é¡ºåºä¼ é€’å‚æ•°ã€‚
- ä¸è¦åœ¨å‡½æ•°ä½“å†…ä½¿ç”¨argumentså˜é‡ï¼Œä½¿ç”¨restè¿ç®—ç¬¦ï¼ˆ...ï¼‰ä»£æ›¿ã€‚å› ä¸ºrestè¿ç®—ç¬¦æ˜¾å¼è¡¨æ˜ä½ æƒ³è¦è·å–å‚æ•°ï¼Œè€Œä¸”argumentsæ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œè€Œrestè¿ç®—ç¬¦å¯ä»¥æä¾›ä¸€ä¸ªçœŸæ­£çš„æ•°ç»„ã€‚
- ä½¿ç”¨é»˜è®¤å€¼è¯­æ³•è®¾ç½®å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼ã€‚

### æ‰©å±•è¿ç®—ç¬¦

æ‰©å±•è¿ç®—ç¬¦ç±»ä¼¼ restè¿ç®—ç¬¦çš„é€†è¿ç®—, ç”¨ `...` è¡¨ç¤º, æ”¾åœ¨ä¸€ä¸ª(ç±»)æ•°ç»„å‰, å°†è¯¥æ•°ç»„å±•å¼€æˆç‹¬ç«‹çš„å…ƒç´ åºåˆ—:
```js
console.log(1, ...[2, 3, 4], 5);  //è¾“å‡º1, 2, 3, 4, 5
```

æ‰©å±•è¿ç®—ç¬¦çš„ç”¨å¤„å¾ˆå¤š:
- å¯ä»¥ç”¨äºå¿«é€Ÿæ”¹å˜ç±»æ•°ç»„å¯¹è±¡ä¸ºæ•°ç»„å¯¹è±¡, ä¹Ÿæ˜¯ç”¨äºå…¶ä»–å¯éå†å¯¹è±¡:
```js
[...document.querySelectorAll('li')];   //[<li>, <li>, <li>];
```

- ç»“åˆ rest å‚æ•°ä½¿å‡½æ•°äº‹åŠåŠŸå€:
```js
function push(arr, ...val){
  return arr.push(...val);      //è°ƒç”¨å‡½æ•°æ—¶, å°†æ•°ç»„å˜ä¸ºåºåˆ—
}
```

- æ›¿ä»£ apply å†™æ³•
```js
var arr = [1, 2, 3];
var max = Math.max(...arr);   //3

var arr2 = [4, 5, 6];
arr.push(...arr2);     //[1, 2, 3, 4, 5, 6]

new Date(...[2013, 1, 1]);   //ri Feb 01 2013 00: 00: 00 GMT+0800 (CST)
```

- è¿æ¥, åˆå¹¶æ•°ç»„
```js
var more = [4, 5];
var arr = [1, 2, 3, ...more];    //[1, 2, 3, 4, 5]

var a1 = [1, 2];
var a2 = [3, 4];
var a3 = [5, 6];
var a = [...a1, ...a2, ...a3];     //[1, 2, 3, 4, 5, 6]
```

- è§£æ„èµ‹å€¼
```js
var a = [1, 2, 3, 4, 5];
var [a1, ...more] = a;      //a1 = 1, more = [2, 3, 4, 5]
//æ³¨æ„, æ‰©å±•è¿ç®—ç¬¦å¿…é¡»æ”¾åœ¨è§£æ„èµ‹å€¼çš„ç»“å°¾, å¦åˆ™æŠ¥é”™
```

- å­—ç¬¦ä¸²æ‹†åˆ†
```js
var str = "hello";
var alpha = [...str];    //alpha = ['h', 'e', 'l', 'l', 'o']

[...'x\uD83D\uDE80y'].length;   //3, æ­£ç¡®å¤„ç†32ä½ unicode å­—ç¬¦

```

å»ºè®®ï¼šä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦(...)æ‹·è´æ•°ç»„ã€‚

### name å±æ€§

name å±æ€§è¿”å›å‡½æ•°çš„åå­—, å¯¹äºåŒ¿åå‡½æ•°è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚ä¸è¿‡å¯¹äºè¡¨è¾¾å¼æ³•å®šä¹‰çš„å‡½æ•°, ES5 å’Œ ES6æœ‰å·®åˆ«:
```js
var fun = function(){}
fun.name;     //ES5: "", ES6: "fun"

(function(){}).name;   //""
```

å¯¹äºæœ‰2ä¸ªåå­—çš„å‡½æ•°, è¿”å›åè€…, ES5 å’Œ ES6æ²¡æœ‰å·®åˆ«:
```js
var fun  = function baz(){}
fun.name;        //baz
```

å¯¹äº Function æ„é€ å‡½æ•°å¾—åˆ°çš„å‡½æ•°, è¿”å› `anonymous`:
```js
new Function("fun").name;    //"anonymous"
new Function().name;    //"anonymous"
(new Function).name;    //"anonymous"
```

å¯¹äº bind è¿”å›çš„å‡½æ•°, åŠ ä¸Š `bound ` å‰ç¼€
```js
function f(){}
f.bind({}).name;   //"bound f"

(function(){}).bind({}).name;    //"bound "

(new Function).bind({}).name;    //"bound anonymous"
```

### ç®­å¤´å‡½æ•°

ç®­å¤´å‡½æ•°çš„å½¢å¼å¦‚ä¸‹:
```js
var fun = (å‚æ•°åˆ—è¡¨) => {å‡½æ•°ä½“};
```
å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°(ä¸”ä¸æŒ‡å®šé»˜è®¤å€¼), å‚æ•°åˆ—è¡¨çš„åœ†æ‹¬å·å¯ä»¥çœç•¥; (å¦‚æœæ²¡æœ‰å‚æ•°, åœ†æ‹¬å·ä¸èƒ½çœç•¥)
å¦‚æœåªæœ‰ä¸€ä¸ª return è¯­å¥, é‚£ä¹ˆå‡½æ•°ä½“çš„èŠ±æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥, åŒæ—¶çœç•¥ return å…³é”®å­—ã€‚
```js
var fun = value => value + 1;
//ç­‰åŒäº
var fun = function(value){
  return value + 1;
}
```
```js
var fun = () => 5;
//ç­‰åŒäº
var fun = function(){
  return 5;
}
```
å¦‚æœç®­å¤´å‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼æœ‰å¯¹è±¡, åº”è¯¥ç”¨ `()` æ‹¬èµ·æ¥:
```js
var fun = n => ({name: n});
var fun = ({num1=1, num2=3}={}) => num1 + num2;
```

çœ‹å®Œä¹‹å‰çš„éƒ¨åˆ†, ç®­å¤´å‡½æ•°åº”è¯¥ä¸é™Œç”Ÿäº†:
```js
var warp = (...val) => val;
var arr1 = warp(2, 1, 3);              //[2, 1, 3]
var arr2 = arr1.map(x => x * x);     //[4, 1, 9]
arr2.sort((a, b) => a - b);          //[1, 4, 9]
```

ä½¿ç”¨ç®­å¤´å‡½æ•°åº”æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:
- ä¸å¯ä»¥å°†å‡½æ•°å½“åšæ„é€ å‡½æ•°è°ƒç”¨, å³ä¸èƒ½ä½¿ç”¨ new å‘½ä»¤;
- ä¸å¯ä»¥åœ¨ç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ yield è¿”å›å€¼, æ‰€ä»¥ä¸èƒ½ç”¨è¿‡ Generator å‡½æ•°;
- å‡½æ•°ä½“å†…ä¸å­˜åœ¨ arguments å‚æ•°;
- å‡½æ•°ä½“å†…éƒ¨ä¸æ„æˆç‹¬ç«‹çš„ä½œç”¨åŸŸ, å†…éƒ¨çš„ this å’Œå®šä¹‰æ—¶å€™çš„ä¸Šä¸‹æ–‡ä¸€è‡´; ä½†å¯ä»¥é€šè¿‡ call, apply, bind æ”¹å˜å‡½æ•°ä¸­çš„ thisã€‚å…³äºä½œç”¨åŸŸ, é›†ä¸­åœ¨ES6å‡½æ•°æ‰©å±•çš„æœ€åè®¨è®ºã€‚

ä¸¾å‡ ä¸ªç®­å¤´å‡½æ•°çš„å®ä¾‹:
å®ä¾‹1: å®ç°åŠŸèƒ½å¦‚: `insert(2).into([1, 3]).after(1)`æˆ–`insert(2).into([1, 3]).before(3)`è¿™æ ·çš„å‡½æ•°:
```js
var insert = value => ({
  into: arr => ({
    before: val => {
      arr.splice(arr.indexOf(val), 0, value);
      return arr;
    },
    after: val => {
      arr.splice(arr.indexOf(val) + 1, 0, value);
      return arr;
    }
  })
});
console.log(insert(2).into([1, 3]).after(1));
console.log(insert(2).into([1, 3]).before(3));
```

å®ä¾‹2: æ„å»ºä¸€ä¸ªç®¡é“(å‰ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºæ˜¯åä¸€ä¸ªå‡½æ•°çš„è¾“å…¥):
```js
var pipe = (...funcs) => (init_val) => funcs.reduce((a, b) => b(a), init_val);

//å®ç° 2 çš„ (3+2) æ¬¡æ–¹
var plus = a => a + 2;
pipe(plus, Math.pow.bind(null, 2))(3);         //32
```

å®ä¾‹3: å®ç° ğœ† æ¼”ç®—
```js
//fix = ğœ†f.(ğœ†x.f(ğœ†v.x(x)(v)))(ğœ†x.f(ğœ†v.x(x)(v)))
var fix = f => (x => f(v => x(x)(v)))(x => f(v => x(x)(v)));
```

å»ºè®®ï¼šç®­å¤´å‡½æ•°å–ä»£ Function.prototype.bindï¼Œä¸åº”å†ç”¨ self / _this / that ç»‘å®š thisã€‚å…¶æ¬¡ï¼Œç®€å•çš„ã€ä¸ä¼šå¤ç”¨çš„å‡½æ•°ï¼Œå»ºè®®é‡‡ç”¨ç®­å¤´å‡½æ•°ã€‚å¦‚æœå‡½æ•°ä½“è¾ƒä¸ºå¤æ‚ï¼Œè¡Œæ•°è¾ƒå¤šï¼Œè¿˜æ˜¯åº”è¯¥é‡‡ç”¨ä¼ ç»Ÿçš„å‡½æ•°å†™æ³•ã€‚

è¿™é‡Œéœ€è¦å¼ºè°ƒï¼Œä»¥ä¸‹æƒ…å†µä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼š

1. å®šä¹‰å­—é¢é‡æ–¹æ³•
```js
let calculator = {
  array: [1, 2, 3],
  sum: () => {
    return this.array.reduce((result, item) => result + item);     //è¿™é‡Œçš„ this æˆäº† window
  }
};
calculator.sum();    //"TypeError: Cannot read property 'reduce' of undefined"
```
2. å®šä¹‰åŸå‹æ–¹æ³•
```js
function Cat(name) {
    this.name = name;
}
Cat.prototype.sayCatName = () => {
    return this.name;           //å’Œä¸Šä¸€ä¸ªé—®é¢˜ä¸€æ ·ï¼šè¿™é‡Œçš„ this æˆäº† window
};
let cat = new Cat('Mew');
cat.sayCatName();               //undefined
```
3. ç»‘å®šäº‹ä»¶
```js
const button = document.getElementById('myButton');
button.addEventListener('click', () => {
    this.innerHTML = 'Clicked button';        //è¿™é‡Œçš„ this æœ¬åº”è¯¥æ˜¯ button, ä½†ä¸å¹¸çš„æˆäº† window
});
```
4. å®šä¹‰æ„é€ å‡½æ•°
```js
let Message = (text) => {
    this.text = text;
};
let helloMessage = new Message('Hello World!');         //TypeError: Message is not a constructor
```
5. ä¸è¦ä¸ºäº†è¿½æ±‚ä»£ç çš„ç®€çŸ­ä¸§å¤±å¯è¯»æ€§
```js
let multiply = (a, b) => b === undefined ? b => a * b : a * b;    //è¿™ä¸ªå¤ªéš¾è¯»äº†ï¼Œå¤ªè´¹æ—¶é—´
let double = multiply(2);
double(3);      //6
multiply(2, 3); //6
```
### å‡½æ•°ç»‘å®š

ES7 ä¸­æå‡ºäº†å‡½æ•°ç»‘å®šè¿ç®—, å…å»æˆ‘ä»¬ä½¿ç”¨ call, bind, apply çš„å„ç§ä¸æ–¹ä¾¿, å½¢å¼å¦‚ä¸‹:
```cpp
objName::funcName
```
ä»¥ä¸‹å‡ ç»„è¯­å¥ä¸¤ä¸¤ç­‰åŒ
```js
var newFunc = obj::func;
//ç›¸å½“äº
var newFunc = func.bind(obj);

var result = obj::func(...arguments);
//ç›¸å½“äº
var result = func.apply(obj, arguments);
```

å¦‚æœ `::` å·¦è¾¹çš„å¯¹è±¡åŸæœ¬å°±æ˜¯å³è¾¹æ–¹æ³•ä¸­çš„ this, å·¦è¾¹å¯ä»¥çœç•¥
```js
var fun = obj::obj.func;
//ç›¸å½“äº
var fun = ::obj.func;
//ç›¸å½“äº
var fun = obj.func.bind(obj);
```

`::` è¿ç®—è¿”å›çš„è¿˜æ˜¯å¯¹è±¡, å¯ä»¥è¿›è¡Œé“¾å¼è°ƒç”¨:
```js
$('.my-class')::find('p')::text("new text");
//ç›¸å½“äº
$('.my-class').find('p').text("new text");
```

### å°¾è°ƒç”¨ä¼˜åŒ–

å°¾è°ƒç”¨æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µ, æŒ‡åœ¨å‡½æ•°æœ€åè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚
```js
//æ˜¯å°¾è°ƒç”¨
function a(){
  return g();
}
function b(p){
  if(p>0){
    return m();
  }
  return n();
}
function c(){
  return c();
}

//ä»¥ä¸‹ä¸æ˜¯å°¾è°ƒç”¨
function d(){
  var b1 = g();
  return b1;
}
function e(){
  g();
}
function f(){
  return g() + 1;
}
```

å°¾è°ƒç”¨çš„ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹å°±æ˜¯, æˆ‘ä»¬å¯ä»¥å°†å‡½æ•°å°¾éƒ¨è°ƒç”¨çš„å‡½æ•°æ”¾åœ¨è¯¥å‡½æ•°å¤–é¢(åé¢), è€Œä¸æ”¹å˜ç¨‹åºå®ç°ç»“æœã€‚è¿™æ ·å¯ä»¥å‡å°‘å‡½æ•°è°ƒç”¨æ ˆçš„å¼€é”€ã€‚
è¿™æ ·çš„ä¼˜åŒ–åœ¨ ES6 çš„ä¸¥æ ¼æ¨¡å¼ä¸­è¢«å¼ºåˆ¶å®ç°äº†, æˆ‘ä»¬éœ€è¦åšçš„ä»…ä»…æ˜¯åœ¨ä½¿ç”¨æ—¶å€™åˆ©ç”¨å¥½è¿™ä¸ªä¼˜åŒ–ç‰¹æ€§, æ¯”å¦‚ä¸‹é¢è¿™ä¸ªé˜¶ä¹˜å‡½æ•°:
```js
function factorial(n){
  if(n <= 1) return 1;
  return n * factorial(n - 1);
}
factorial(5);     //120
```
è¿™ä¸ªå‡½æ•°è®¡ç®— n çš„é˜¶ä¹˜, å°±è¦åœ¨å†…å­˜ä¿ç•™ n ä¸ªå‡½æ•°è°ƒç”¨è®°å½•, ç©ºé—´å¤æ‚åº¦ O(n), å¦‚æœ n å¾ˆå¤§å¯èƒ½ä¼šæº¢å‡ºã€‚æ‰€ä»¥è¿›è¡Œä¼˜åŒ–å¦‚ä¸‹:
```js
"use strict";
function factorial(n, result = 1){
  if(n <= 1) return result;
  return factorial(n - 1, n * result);
}
factorial(5);     //120
```
å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æŸ¯é‡ŒåŒ–:
```js
var factorial = (function factor(result, n){
  if(n <= 1) return result;
  return factor(n * result, n - 1);
}).bind(null, 1);
factorial(5);     //120
```

### å‡½æ•°çš„å°¾é€—å·

è¿™ä¸ªä»…ä»…æ˜¯ä¸€ä¸ªææ¡ˆ: ä¸ºäº†æ›´å¥½åœ°è¿›è¡Œç‰ˆæœ¬æ§åˆ¶, åœ¨å‡½æ•°å‚æ•°å°¾éƒ¨åŠ ä¸€ä¸ªé€—å·, è¡¨ç¤ºè¯¥å‡½æ•°æ—¥åä¼šè¢«ä¿®æ”¹, ä¾¿äºç‰ˆæœ¬æ§åˆ¶å™¨è·Ÿè¸ªã€‚ç›®å‰å¹¶æœªå®ç°ã€‚

### ä½œç”¨åŸŸ

è¿™é‡Œä»…ä»…è®¨è®º ES6 ä¸­çš„å˜é‡ä½œç”¨åŸŸã€‚é™¤äº† let å’Œ const å®šä¹‰çš„çš„å˜é‡å…·æœ‰å—çº§ä½œç”¨åŸŸä»¥å¤–, `var` å’Œ `function` ä¾æ—§éµå®ˆè¯æ³•ä½œç”¨åŸŸ, è¯æ³•ä½œç”¨åŸŸå¯ä»¥å‚è€ƒåšä¸»çš„å¦ä¸€ç¯‡æ–‡ç« [javascriptå‡½æ•°ã€ä½œç”¨åŸŸé“¾ä¸é—­åŒ…](http: //blog.csdn.net/faremax/article/details/53201809)

é¦–å…ˆçœ‹ä¸€ä¸ªä¾‹å­:
```js
var x = 1;
function f(x, y=x){
  console.log(y);
}
f(2);    //2
```
è¿™ä¸ªä¾‹å­è¾“å‡ºäº†2, å› ä¸º y åœ¨åˆå§‹åŒ–çš„æ—¶å€™, å‡½æ•°å†…éƒ¨çš„ x å·²ç»å®šä¹‰å¹¶å®Œæˆèµ‹å€¼äº†, æ‰€ä»¥, `y = x` ä¸­çš„ `x` å·²ç»æ˜¯å‡½æ•°çš„å±€éƒ¨å˜é‡ x äº†, è€Œä¸æ˜¯å…¨å±€çš„ xã€‚å½“ç„¶, å¦‚æœå±€éƒ¨ x å˜é‡åœ¨ y å£°æ˜ä¹‹åå£°æ˜å°±æ²¡é—®é¢˜äº†ã€‚
```js
var x = 1;
function f(y=x){
  let x = 2
  console.log(y);
}
f();    //1
```

é‚£å¦‚æœå‡½æ•°çš„é»˜è®¤å‚æ•°æ˜¯å‡½æ•°å‘¢ï¼Ÿçƒ§è„‘çš„è¦æ¥äº†:
```js
var foo = "outer";
function f(x){
  return foo;
}
function fun(foo, func = f){
  console.log(func());
}
fun("inner");   //"outer"
```
å¦‚æœåŸºç¡€å¥½, é‚£å°±æ ¹æœ¬è°ˆä¸ä¸Šä¸çƒ§è„‘ã€‚å› ä¸º, å‡½æ•°ä¸­çš„ä½œç”¨åŸŸå–å†³äºå‡½æ•°å®šä¹‰çš„åœ°æ–¹, å‡½æ•°ä¸­çš„ this å–å†³äºå‡½æ•°è°ƒç”¨çš„æ–¹å¼ã€‚(æ•²é»‘æ¿)
ä½†å¦‚æœè¿™æ ·å†™, å°±æ˜¯ inner äº†, å› ä¸ºfuncé»˜è®¤å‡½æ•°å®šä¹‰çš„æ—¶å€™ funå†…çš„ foo å·²ç»å­˜åœ¨äº†ã€‚
```js
var foo = "outer";
function fun(foo, func = function(x){
  return foo;
}){
  console.log(func());
}
fun("inner");   //"inner"
```

æŠ€å·§: åˆ©ç”¨é»˜è®¤å€¼ä¿è¯å¿…éœ€çš„å‚æ•°è¢«ä¼ å…¥, è€Œå‡å°‘å¯¹å‚æ•°å­˜åœ¨æ€§çš„éªŒè¯:
```js
function throwErr(){
  throw new Error("Missing Parameter");
}
function fun(necessary = throwErr()){
  //...å¦‚æœå‚æ•°necessaryæ²¡æœ‰æ”¶åˆ°å°±ä½¿ç”¨å‚æ•°, ä»è€Œæ‰§è¡Œå‡½æ•°æŠ›å‡ºé”™è¯¯
}

//å½“ç„¶ä¹Ÿå¯ä»¥è¿™æ ·è¡¨ç¤ºä¸€ä¸ªå‚æ•°æ˜¯å¯é€‰çš„
function fun(optional = undefined){
  //...
}
```

ç®­å¤´å‡½æ•°çš„ä½œç”¨åŸŸå’Œå®šä¹‰æ—¶çš„ä¸Šä¸‹æ–‡ä¸€è‡´, ä½†å¯ä»¥é€šè¿‡è°ƒç”¨æ–¹å¼æ”¹å˜:
```js
window && (window.name = "global") || (global.name = "global");
var o = {
  name: 'obj-o',
  foo: function (){
    setTimeout(() => {console.log(this.name); }, 500);
  }
}

var p = {
  name: 'obj-p',
  foo: function (){
    setTimeout(function(){console.log(this.name); }, 1000);
  }
}

o.foo();    //"obj-o"
p.foo();    //"global"

var temp = {
  name: 'obj-temp'
}

o.foo.bind(temp)();     //"obj-temp"
o.foo.call(temp);     //"obj-temp"
o.foo.apply(temp);     //"obj-temp"

p.foo.bind(temp)();     //"global"
p.foo.call(temp);     //"global"
p.foo.apply(temp);     //"global"
```

## å¯¹è±¡çš„æ‰©å±•

- å…è®¸ä½¿ç”¨å·²æœ‰å¯¹è±¡èµ‹å€¼å®šä¹‰å¯¹è±¡å­—é¢é‡, å¹¶ä¸”åªå†™å˜é‡åå³å¯
```js
var name = "Bob";
var getName = function(){console.log(this.name); };

var person = {name, getName};
//ç›¸å½“äº
//var person = {
//name: "Bob",
//getName: function(){console.log(this.name); }
//}
person.getName();   //"Bob"
```

- å¯ä»¥åƒå®šä¹‰å­˜å–å™¨é‚£æ ·å®šä¹‰æ–¹æ³•
```js
var o = {
  _age: 10,
  _score: 60,
  age(num){
    if(num > 0) {
      this._age = num;
      return this;
    }
    return this._age;
  },
  get score(){
    return this._score;
  }
};

console.log(o.age());    //10
o.age(15);
console.log(o.age());    //15
console.log(o.score);    //60
o.score = 100;           //TypeError
```
æ³¨æ„, ä»¥ä¸‹ä»£ç æ˜¯ç­‰åŒçš„:
```js
var obj = {
  class () {}       //å¹¶ä¸ä¼šå› ä¸º class æ˜¯å…³é”®å­—è€Œè§£æé”™è¯¯
};
//ç­‰ä»·äº
var obj = {
  'class': function() {}
};
```
å¦‚æœä¸€ä¸ªæ–¹æ³•æ˜¯ Generator å‡½æ•°, éœ€è¦åœ¨å‰é¢åŠ  `*`:
```js
var obj = {
  time: 1,
  *gen(){
    yield "hello " + time;
    time++;
  }
}
```

- å±æ€§åè¡¨è¾¾å¼
js æœ¬æ¥å¯ä»¥è¿™æ · `obj['k'+'ey']` è®¿é—®ä¸€ä¸ªå¯¹è±¡å±æ€§, ç°åœ¨ä¹Ÿå¯ä»¥è¿™æ ·å®šä¹‰å±æ€§äº†:
```js
var key1 = "name";
var key2 = "age";

var o = {
  [key1]: "Bob",
  [key2]: 18,
  ['first' + key1]: "Ellen"
};
o.name;    //"Bob"
o.age;     //18
o.firstname;   //"Ellen"
```
æ³¨æ„: è¯¥æ–¹æ³•ä¸èƒ½å’Œä¸Šä¸€å°èŠ‚ä½¿ç”¨å·²æœ‰æ ‡è¯†ç¬¦å®šä¹‰å¯¹è±¡å­—é¢é‡çš„æ–¹æ³•æ··åˆä½¿ç”¨, å¦åˆ™ä¼šæŠ¥é”™;
```js
//é”™è¯¯ç”¨æ³•
var foo = 'bar';
var bar = 'abc';
var baz = {[foo]};  //æŠ¥é”™
```

å»ºè®®ï¼šå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œå°½é‡é‡‡ç”¨ç®€æ´è¡¨è¾¾æ³•ï¼Œè¿™æ ·æ˜“äºæè¿°å’Œä¹¦å†™ã€‚

- æ–¹æ³•çš„ name å±æ€§
å‡½æ•°æœ‰ name å±æ€§, æ–¹æ³•ä¹Ÿå°±æœ‰ name å±æ€§ã€‚ä¸€èˆ¬æ–¹æ³• name è¿”å›å‡½æ•°å(ä¸åŒ…æ‹¬å¯¹è±¡å), å¯¹äºå­˜å–å™¨æ–¹æ³•, æ²¡æœ‰ name å±æ€§:
```js
var o = {
  _age: 10,
  _score: 60,
  _name: "Bob",
  _firstname: "Ellen",
  set age(num){
    if(num > 0) {
      this._age = num;
      return this;
    }
  },
  get age(){
    return this._age;
  },
  get score(){
    return this._score;
  },
  name(n){
    if(!n) return this._name + ' ' + this._firstname;
    this._name = n;
    return this;
  },
  set firstname(n){
    if(n) this._firstname = n;
    return this;
  }
};
console.log(o.name.name);      //"name"
console.log(o.age.name);       //undefined
console.log(o.score.name);     //undefined
console.log(o.firstname);      //undefined, æ‰€ä»¥ set å‡½æ•°æ›´ä¸ä¼šæœ‰ name å±æ€§
```
å¦‚æœå¯¹è±¡çš„æ–¹æ³•æ˜¯ä¸ª symbol, name å±æ€§ä¸ºç©ºå­—ç¬¦ä¸² `""` :
```js
var sym1 = new Symbol("description of sym1");
var sym2 = new Symbol();
var o = {
  [sym1](){},
  [sym2](){},
};
o[sym1].name;    //""
o[sym2].name;    //""
```

- é™æ€æ–¹æ³•
1. Object.is(a, b): æ¯”è¾ƒa, bä¸¤ä¸ªå€¼æ˜¯å¦ä¸¥æ ¼ç›¸ç­‰, ç›¸å½“äº `===`, ä½†æœ‰ä¸€ç‚¹ä¸ä¸€æ ·:
```js
-0 === +0;     //true
NaN === NaN;   //false

Object.is(-0, +0);     //false
Object.is(NaN, NaN);   //true
```
2. Object.assign(target, source1, source2, ...): å°†æ¯ä¸ª source å¯¹è±¡è‡ªèº«çš„å¯æšä¸¾å±æ€§å¤åˆ¶åˆ° target å¯¹è±¡ä¸Š, ä¸åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„å±æ€§å’Œä¸å¯æšä¸¾å±æ€§ã€‚åªæœ‰æœ‰ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡, å°±ä¼šæŠ›å‡º TypeError é”™è¯¯ã€‚é‡åˆ°åŒåå±æ€§, æ’åœ¨åé¢çš„ä¼šè¦†ç›–å‰é¢çš„:
```js
var target = {a: 1, b: 2};
var source1 = {a: 3, c: 3};
var source2 = {a: 2, d: 0};
Object.assign(target, source1, source2);
console.log(target);      //{a: 2, b: 2, c: 3, d: 0}
```
å¯¹äºå±æ€§åæ˜¯ symbol çš„å¯æšä¸¾å±æ€§ä¹Ÿä¼šè¢«å¤åˆ¶:
```js
Object.assign({a: 'b'}, {[Symbol('c')]: 'd'});    //{a: "b", Symbol(c): "d"}
```
å¯¹äºåŒåå±æ€§å­˜åœ¨åµŒå¥—å¯¹è±¡, å¤–å±‚ä¼šè¢«ç›´æ¥æ›¿æ¢:
```js
Object.assign({a: {b: 'c', d: 'e'}}, {a: {b: 'hello'}});     //{a: {b: 'hello'}}
```
å¯ä»¥ç”¨ Object.assignå¤„ç†æ•°ç»„, ä½†ä¼šè§†å…¶ä¸ºå¯¹è±¡:
```js
Object.assign([1, 2, 3], [4, 5]);     //[4, 5, 3]
```
æŠ€å·§: ä¸ºå¯¹è±¡æ·»åŠ å±æ€§æ–¹æ³•
```js
Object.assign(String.prototype, {
  newProperty: "value",
  newFunction: function(){}
})
```
æŠ€å·§: å…‹éš†å¯¹è±¡
```js
Object.assign({}, origin);
```
æŠ€å·§: ä¸ºå¯¹è±¡æ·»åŠ å±æ€§æ–¹æ³•
```js
Object.assign(target, ...source);
```
æŠ€å·§: ä¸ºå¯¹è±¡æ·»åŠ å±æ€§æ–¹æ³•
```js
const DEFAULT_OPTION = {   //é»˜è®¤å€¼
  a: 1,
  b: 2
};
function processContent(newOption){
  return Object.assign({}, DEFAULT_OPTION, newOption);
}
//è®¾ç½®å±æ€§åº”è¯¥æ˜¯åŸºæœ¬ç±»å‹, å¦åˆ™ä¼šå› ä¸ºæ·±æ‹·è´å‡ºé—®é¢˜
```

### å¯¹è±¡å±æ€§çš„å¯æšä¸¾æ€§ä¸éå†

ä»¥ä¸‹6ä¸ªæ“ä½œä¼šå¿½ç•¥ä¸å¯æšä¸¾çš„å±æ€§

- for...inå¾ªç¯
- Object.keys()
- JSON.stringify()
- Object.assign()
- Reflect.enumerate()
- æ‰©å±•è¿ç®—ç¬¦ `...`

ä»¥ä¸‹4ä¸ªæ–¹æ³•ä¸å¿½ç•¥ä¸å¯æšä¸¾å±æ€§

- Object.getOwnPropertyNames()
- Object.getOwnPropertySymbols()
- Reflect.ownKeys()

ä»¥ä¸Š9ä¸ªæ–¹æ³•ä¸­, åªæœ‰2ä¸ªä¼šæ“ä½œåŒ…å«ç»§æ‰¿åˆ°çš„å±æ€§

- for...inå¾ªç¯
- Reflect.enumerate()

ä»¥ä¸Š9ä¸ªæ–¹æ³•ä¸­, åªæœ‰1ä¸ªæ–¹æ³•å¯ä»¥è·å¾— Symbol å±æ€§

- Object.getOwnPropertySymbols()

é™¤æ­¤ä¹‹å¤–éœ€è¦å¼ºè°ƒçš„æ˜¯ ES6 ä¸­, æ‰€æœ‰ class çš„åŸå‹æ–¹æ³•éƒ½æ˜¯ä¸å¯æšä¸¾çš„:
```js
Object.getOwnPropertyDescriptor(class{foo(){}}.prototype, foo).enumerable;  //false
```

ES6 èµ·, æœ‰äº†7ä¸­éå†å±æ€§çš„æ–¹æ³•:

- for...in: å¾ªç¯éå†å¯¹è±¡è‡ªèº«å’Œç»§æ‰¿åˆ°çš„å¯æšä¸¾å±æ€§, ä¸åŒ…æ‹¬ Symbol å±æ€§
- Object.keys(obj): è¿”å›åŒ…å«è‡ªèº«å¯æšä¸¾å±æ€§çš„å±æ€§åæ•°ç»„, ä¸åŒ…å« Symbol å±æ€§
- Object.getOwnPropertyNames(obj): åŒä¸Š, ä½†åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§
- Object.getOwnPropertySymbols(obj): è¿”å›è‡ªèº«æ‰€æœ‰ Symbol å±æ€§åçš„æ•°ç»„, åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§
- Reflect.ownKey(obj): è¿”å›è‡ªèº«æ‰€æœ‰å±æ€§åæ•°ç»„, åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§å’Œ Symbol å±æ€§å
- Reflect.enumerate(): è¿”å›ä¸€ä¸ª Iterator, ç”¨æ¥éå†å¯¹è±¡è‡ªèº«åŠç»§æ‰¿åˆ°çš„å¯æšä¸¾å±æ€§, ä¸åŒ…æ‹¬ Symbol å±æ€§; å’Œ for...in ä¸€æ ·
- for...of: åªèƒ½éå†å…·æœ‰ Iterator æ¥å£çš„å¯¹è±¡, å…·ä½“ä½œç”¨èŒƒå›´ç”± iterator å†³å®š, éå†æ²¡æœ‰ iterator çš„å¯¹è±¡ä¼šæŠ¥é”™

ä»¥ä¸Šæ–¹æ³•é™¤äº† for...of ä»¥å¤–, éå†é¡ºåºä¸º:

- é¦–å…ˆéå†æ‰€æœ‰å±æ€§åä¸ºæ•°å­—çš„å±æ€§, æŒ‰æ•°å­—å¤§å°æ’åº;
- å…¶æ¬¡éå†æ‰€æœ‰å±æ€§åä¸ºå­—ç¬¦ä¸²çš„å±æ€§, æŒ‰å±æ€§ç”Ÿæˆæ—¶é—´æ’åº;
- æœ€åéå†æ‰€æœ‰å±æ€§åä¸º Symbol çš„å±æ€§, æŒ‰å±æ€§ç”Ÿæˆæ—¶é—´æ’åº;

### å¯¹è±¡çš„__proto__å±æ€§

è¿™æ˜¯ä¸ªå¾ˆè€å¾ˆè€çš„å±æ€§, åœ¨å¤§å®¶æƒ³æœŸå¾…ä¸‹, ES6ç»ˆäºæŠŠå®ƒå†™è¿›å»äº†, å—¯ï¼Ÿ...æ˜¯å†™è¿›é™„å½•äº†ã€‚è¿™ä¸ªå±æ€§ç”¨æ¥è¯»å†™å½“å‰çš„å¯¹è±¡çš„åŸå‹å¯¹è±¡`obj.constructor.prototype`

ä»æœ¬è´¨ä¸Šæ¥è®², `__proto__` æ˜¯å®šä¹‰åœ¨`Object.prototype` ä¸Šçš„ä¸€ä¸ªå­˜å–å™¨å‡½æ•°:
```js
function isObject(a){
  return Object(a) === a;
}
Object.defineProperty(Object.prototype, '__proto__', {
  get(){
    let _thisObj = Object(this);
    return Object.getPrototypeOf(_thisObj);
  },
  set(proto){
    if(this == null) throw new TypeError();
    if(!isObject(this) || !isObject(proto)) return undefined;
    let status = Object.setPrototypeOf(this, proto);
    if(! status) throw new TypeError();
  }
});
```

ä½†æ˜¯, è¿˜æ˜¯ä¸å»ºè®®ä½¿ç”¨è¿™ä¸ªä¸œè¥¿, æ¯•ç«Ÿçœ‹å®ƒè¿™åå­—å°±æ˜¯ä¸ªå†…éƒ¨å±æ€§, å› ä¸ºå®ƒæœ‰äº†ä¸åŠ , ä½†ä¸ä¿è¯æ‰€ä»¥ç»ˆç«¯éƒ½èƒ½ç”¨, æ‰€ä»¥ES6æ¨èç”¨ä¸‹é¢è¿™ä¸¤ä¸ªå±æ€§:
```js
Object.setPrototypeOf(obj, newProto);   //å†™
Object.getPrototypeOf(obj);   //è¯»
```
ç®€å•ä¸¾ä¸€ä¸ªä¾‹å­:
```js
function Rectangle(){}
var rec = new Rectangle();
Object.getPrototypeOf(rec) === Rectangle.prototype;    //true
Object.setPrototypeOf(rec, Object.prototype);
Object.getPrototypeOf(rec) === Rectangle.prototype;    //false
```

å½“ç„¶å¦‚æœä½ æŠŠä¸€ä¸ªå¯¹è±¡çš„åŸå‹è®¾ç½®æˆäº† null, ä¹Ÿæ˜¯å¯ä»¥çš„, åªæ˜¯, å®ƒä¸å…·å¤‡ä»»ä½•ä½ å¬è¯´è¿‡çš„æ–¹æ³•äº†:
```js
var o = Object.setPrototypeOf({}, null);
//ç­‰ä»·äº var o = {'__proto__': null};
Object.getPrototypeOf(o);                //null
o.toString();                    //TypeError: o.toString is not a function
```

### å¯¹è±¡çš„æ‰©å±•è¿ç®—ç¬¦

è¿™æ˜¯ ES7 çš„ä¸€ä¸ªææ¡ˆ, babelå¯ä»¥ä½¿ç”¨å™¨éƒ¨åˆ†åŠŸèƒ½ä½¿ç”¨ã€‚

- restå‚æ•°
ç”¨æ³•å’Œæ•°ç»„ä¸­å¾ˆç±»ä¼¼, è¿™é‡Œä¸å†è¿‡å¤šèµ˜è¿°, ç›´æ¥çœ‹å‡ ä¸ªä¾‹å­å§:
```js
var {x, y, ...z}  = {x: 1, y: 2, a: 3, d: 4}; //x=1, y=2, z={a: 3, d: 4}
```
å€¼å¾—å¼ºè°ƒçš„æ˜¯, å¯¹è±¡çš„restå‚æ•°å½¢å¼æ‰§è¡Œçš„æ˜¯æµ…æ‹·è´, èµ‹å€¼å¾—åˆ°çš„æ˜¯åŸå¯¹è±¡çš„å¼•ç”¨:
```js
let obj = {a: {b: 1}};
let {...x} = obj;
obj.a.b = 2;
console.log(x.a.b);    //2
```
æ­¤å¤– rest ä¸ä¼šå¤åˆ¶ä¸å¯æšä¸¾å±æ€§å’Œç»§æ‰¿è‡ªåŸå‹çš„å±æ€§:
```js
var p = {a: 0};
var o = {b: 2};
var o = Object.defineProperty(o, "foo", {
  value: 2,
  configurable: true,
  enumerable: false,
  writable: true
});
Object.setPrototypeOf(o, p);
var u = { ...p };
console.log(u);    //{b: 2}
```

- æ‰©å±•è¿ç®—ç¬¦
å¤åˆ¶å‚æ•°å¯¹è±¡æ‰€æœ‰å¯éå†å±æ€§åˆ°å½“å‰å¯¹è±¡ä¸­:
```js
var o1 = {a: 1, b: 2};
var n = { ...o1 };    //n={a: 1, b: 2};
//ç›¸å½“äº
var n = Object.assign({}, o1);
```
å¯ä»¥ç”¨æ‰©å±•è¿ç®—ç¬¦åˆå¹¶å¤šä¸ªå¯¹è±¡, æ’åçš„å±æ€§ä¼šè¦†ç›–ä¹‹å‰çš„å±æ€§:
```js
var source0 = {a: 1, b: 2};
var source1 = {a: 3, c: 3};
var source2 = {a: 2, d: 0};
Object.assign(target, source1, source2);
var target = {...source0, ...source1, ...source2};
console.log(target);      //{a: 2, b: 2, c: 3, d: 0}
```
æ³¨æ„ä¸€ç‚¹: å¦‚æœæ‰©å±•è¿ç®—ç¬¦çš„å‚æ•°å¯¹è±¡æœ‰ get æ–¹æ³•, è¯¥æ–¹æ³•ä¼šè¢«æ‰§è¡Œ:
```js
var a = {o: 1, p: 2, m: 4};
var withoutError = {
  ...a,
  get x(){
    throw new Error();
  }
};           //ä¸æŠ¥é”™
var withError = {
  ...a,
  ...{get x(){
    throw new Error();
  }}
};           //æŠ¥é”™
```
å¦‚æœæ‰©å±•å¯¹è±¡æ˜¯ null æˆ– undefined, ä¼šè¢«å¿½ç•¥, ä¸æŠ¥é”™
```js
var o = { ...null, ...undefined};    //ä¸æŠ¥é”™
console.log(o);    //{}
```

## Symbol

### SymbolåŸºæœ¬ç±»å‹
Symbol æ˜¯ä¸€ç§è§£å†³å‘½åå†²çªçš„å·¥å…·ã€‚è¯•æƒ³æˆ‘ä»¬ä»¥å‰å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ–¹æ³•çš„æ—¶å€™æ€»æ˜¯è¦æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåå˜é‡:
```js
if(String && String.prototype && String.prototype.getCodeWith){
  String.prototype.getCodeWith = function(){};
}
```
å¯æ˜¯è¿™æ ·å†™, å³ä¾¿å·²å­˜åœ¨åŒåæ–¹æ³•, ä½†ä»–ä»¬å®ç°çš„åŠŸèƒ½ä¸ä¸€å®šä¸€æ ·, è€Œä¸”å‡½æ•°çš„æ¥å£ä¹Ÿä¸ä¸€å®šé€‚åˆè‡ªå·±ã€‚è¿™æ ·æˆ‘ä»¬å°±ä¸å¾—ä¸å†ç»™è‡ªå·±çš„å‡½æ•°èµ·ä¸ªå…¶ä»–çš„åå­—, å¯ä»¥ä¸‡ä¸€åˆå­˜åœ¨å‘¢ï¼Ÿ

äºæ˜¯å¼•å…¥äº† Symol, ç”¨æ¥äº§ç”Ÿä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦, ä½ å¯ä»¥æ”¾å¿ƒçš„ä½¿ç”¨å®ƒã€‚
å®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°, ä½œä¸ºè¯¥æ ‡è¯†ç¬¦çš„æè¿°:
```js
var sym = Symbol("Discription");
var temp = Symbol("Discription");
console.log(sym);             //Symbol(Discription)
console.log(sym.valueOf());   //Symbol(Discription)
console.log(sym.toString());  //"Symbol(Discription)""
console.log(sym == temp);     //false
```

æè¿°ç¬¦æ˜¯ç”¨æ¥å¸®åŠ©å¼€å‘äººå‘˜åŒºåˆ«ä¸åŒæ˜¯ symbol, ä¸å…·å¤‡å…¶ä»–æ„ä¹‰, æ‰€ä»¥ symbol å€¼åªæœ‰`toString()`å’Œ`valueOf()` æ–¹æ³•ã€‚
Symbol ä½œä¸ºä¸€ä¸ªåŸºæœ¬ç±»å‹å­˜åœ¨äº js ä¸­ã€‚è¿™æ ·, js å°±æœ‰äº†6ä¸ªåŸºæœ¬ç±»å‹: `null`, `undefined`, `Boolean`, `Number`, `String`, `Symbol` å’Œ1ä¸ªå¤æ‚ç±»å‹: `Object`
ä½¿ç”¨ Symbol éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:
- Symbol å’Œ null, undefined ä¸€æ ·ä¸å…·æœ‰æ„é€ å‡½æ•°, ä¸èƒ½ç”¨ new è°ƒç”¨ã€‚
- Symbol å€¼ä¸èƒ½è½¬ä¸ºæ•°å­—, æ‰€ä»¥ä¸èƒ½å‚ä¸ä»»ä½•ç®—æœ¯, é€»è¾‘è¿ç®—
- Symbol è™½ç„¶æœ‰ toString() ä½† toString å¾—åˆ°çš„ä¸æ˜¯å­—ç¬¦ä¸², æ‰€ä»¥ä¸èƒ½ç”¨äºå­—ç¬¦ä¸²é“¾æ¥, ä¸èƒ½ç”¨äºæ¨¡æ¿å­—ç¬¦ä¸²
- Symbol å¯ä»¥è½¬æ¢ä¸º Boolean, ç”¨åœ¨æ¡ä»¶è¯­å¥ä¸­, ä½†æ‰€æœ‰ Symbol éƒ½æ˜¯é€»è¾‘ true
- Symbol ä½œä¸ºå±æ€§åæ—¶, è¯¥å±æ€§æ˜¯å…¬å¼€çš„, ä¸æ˜¯ç§æœ‰çš„

### Symbolç”¨ä½œå±æ€§å

è¿™ä¸ªåº”è¯¥ä¸é™Œç”Ÿäº†, å’Œæ™®é€šæ ‡è¯†ç¬¦ç”¨æ³•ç±»ä¼¼, åªæ˜¯ä¸èƒ½ä½¿ç”¨`.`è®¿é—®å’Œå®šä¹‰, å¿…é¡»ä½¿ç”¨`[]`:
```js
var sym = Symbol("abc");
var fun = Symbol("getSym");

var a = {};
a[sym] = 1;

var b = {
  [sym]: 1,
  [fun](){
    console.log(this[sym]);
  }
};

var c = Object.defineProperty({}, sym, {value: 1});

a[sym];   //1
b[sym];   //1
c[sym];   //1
b[fun]();  //1
```

å½“ç„¶ä¹Ÿå¯ä»¥å®šä¹‰ä¸€äº›å¸¸é‡, å°±åƒè‹±è¯­ä¸­ Symbol ä»£è¡¨ä¸€ç§è±¡å¾, ä¸€ä¸ªç¬¦å·:
```js
var log = {
  DEBUG: Symbol('debug'),
  ERROR: Symbol('error'),
  WARNING: Symbol('warning'),
}
```
éœ€è¦æ³¨æ„, Symbol å±æ€§åªæœ‰`Object.getOwnPropertySymbols(obj)` å’Œ `Reflect.ownKey(obj)` å¯ä»¥éå†åˆ°:
- Object.getOwnPropertySymbols(obj): è¿”å›è‡ªèº«æ‰€æœ‰ Symbol å±æ€§åçš„æ•°ç»„, åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§
- Reflect.ownKey(obj): è¿”å›è‡ªèº«æ‰€æœ‰å±æ€§åæ•°ç»„, åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§å’Œ Symbol å±æ€§å
```js
var sym = Symbol("pro");
var o = {
  a: 1,
  b: 2,
  [sym]: 3
}
Object.getOwnPropertySymbols(o);     //[Symbol(pro)]
Reflect.ownKeys(o);                  //["a", "b", Symbol(pro)]
```
æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•, æ„é€ ä¸€äº›éç§æœ‰çš„å†…éƒ¨å˜é‡:
```js
var size = Symbol('size');
class Collection{
  constructor(){
    this[size] = 0;
  }
  add(num){
    this[this[size]] = item;
    this[size]++;
  }
  static sizeOf(instance){
    return instance[size];
  }
}
var x = new Collection();
console.log(Collection.sizeOf(x));     //0
x.add("foo");
console.log(Collection.sizeOf(x));     //1

console.log(Object.keys(x));     //['0']
console.log(Object.getOwnPropertyNames(x));   //['0']
console.log(Object.getOwnPropertySymbols(x));   //[Symbol(size)]
```

### Symbolçš„é™æ€æ–¹æ³•

- Symbol.for("string"): ç™»è®°å¹¶é‡ç”¨ä¸€ä¸ª symbol å€¼
```js
Symbol.for("aa") === Symbol.for("aa");    //true
Symbol("aa") === Symbol("aa");            //false
```

- Symbol.keyFor(symbol): è¿”å›ä¸€ä¸ªå·²ç™»è®°çš„ Symbol æè¿°, æœªç™»è®°çš„ Symbol è¿”å› undefined
```js
var s1 = Symbol.for("aa");
var s2 = Symbol("aa");
Symbol.keyFor(s1);    //"aa"
Symbol.keyFor(s2);    //undefined
```
æ³¨æ„ Symbol çš„ç™»è®°æ˜¯å…¨å±€çš„:
```js
iframe = document.createElement('iframe');
iframe.src = String(window.location);
document.body.appendChild(iframe);
iframe.contentWindow.Symbol.for("aa") === Symbol.for("aa");    //true
```

### å†…ç½®çš„ Symbol å€¼

ES6 æä¾›äº†12ä¸ªå†…ç½®çš„ Symbol å€¼, è¿™12ä¸ªå€¼, éƒ½æ˜¯å¯¹è±¡çš„, ä¸”éƒ½ä¸å¯æšä¸¾ã€ä¸å¯é…ç½®ã€ä¸å¯ä¿®æ”¹ã€‚å› ä¸ºå®ƒä»¬å…·æœ‰å…¶ç‰¹æ®Šæ„ä¹‰:

1. Symbol.hasInstance: æŒ‡å‘ä¸€ä¸ªå†…éƒ¨æ–¹æ³•ã€‚åˆ¤æ–­å¯¹è±¡æ˜¯å¦æŸä¸ªæ„é€ å‡½æ•°çš„å®ä¾‹, instanceof è¿ç®—ç¬¦ä¼šè°ƒç”¨å®ƒ
2. Symbol.isConcatSpreadable: æ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡å±æ€§ã€‚å¦‚æœä¸º false è¯¥å±æ€§åœ¨ concat è¿‡ç¨‹ä¸ä¼šè¢«å±•å¼€ã€‚æ•°ç»„å¯¹è±¡è¯¥å±æ€§é»˜è®¤å€¼ä¸º true, ç±»æ•°ç»„å¯¹è±¡è¯¥å±æ€§é»˜è®¤å€¼ä¸º false
```js
var arr = [3, 4];
[1, 2].concat(arr);   //[1, 2, 3, 4]
arr[Symbol.isConcatSpreadable] = false;
[1, 2].concat(arr);   //[1, 2, [3, 4]]
```
<!--å¯¹äºä¸€ä¸ªç±»è€Œè¨€, è¯¥å±æ€§å¿…é¡»è¿”å› boolean ç±»å‹
```js
class A1 extends Array{
  [Symbol.isConcatSpreadable](){
    return true;
  }
}
class A2 extends Array{
  [Symbol.isConcatSpreadable](){
    return false;
  }
}
let a1 = new A1();
a1[0] = 3;
a1[1] = 4;
let a2 = new A2();
a2[0] = 5;
a2[1] = 6;
[1, 2].concat(a1).concat(a2);  //
```
-->
3. Symbol.species: æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ã€‚å°†å¯¹è±¡ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶, ç³»ç»Ÿå†…éƒ¨ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å³, å½“ this.constructor[Symbol.species]å­˜åœ¨æ—¶, ä»¥æ­¤ä¸ºæ„é€ å‡½æ•°æ„å»ºå¯¹è±¡ã€‚
4. Symbol.match: æŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å½“æ‰§è¡Œ `str.match(obj)` çš„æ—¶å€™, å¦‚æœ obj å­˜åœ¨è¯¥å±æ€§, è°ƒç”¨è¯¥æ–¹æ³•å¹¶è¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼
```js
String.prototype.match(searchValue);
//ç›¸å½“äº
SearchValue[Symbol.match](this);
//å®ä¾‹
class myMatch{
  constructor(str){
    this.content = str;
  }
  [Symbol.match](str){
    return this.content.indexOf(str);
  }
}
'e'.match(new myMatch("Hello"));    //1
```

5. Symbol.replace: æŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å’Œä¸Šä¸€ä¸ªæ–¹æ³•ç±»ä¼¼çš„, å½“æ‰§è¡Œ `str.replace(obj, replaceValue)` çš„æ—¶å€™, å¦‚æœ obj å­˜åœ¨è¯¥å±æ€§, è°ƒç”¨è¯¥æ–¹æ³•å¹¶è¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼
```js
String.prototype.replace(searchValue, replaceValue);
//ç›¸å½“äº
SearchValue[Symbol.replace](this, replaceValue);
```
6. Symbol.search: æŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å’Œä¸Šä¸€ä¸ªæ–¹æ³•ç±»ä¼¼çš„, å½“æ‰§è¡Œ `str.search(obj)` çš„æ—¶å€™, å¦‚æœ obj å­˜åœ¨è¯¥å±æ€§, è°ƒç”¨è¯¥æ–¹æ³•å¹¶è¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼
```js
String.prototype.search(searchValue);
//ç›¸å½“äº
SearchValue[Symbol.search](this);
```
7. Symbol.split: æŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å’Œä¸Šä¸€ä¸ªæ–¹æ³•ç±»ä¼¼çš„, å½“æ‰§è¡Œ `str.split(obj, limit)` çš„æ—¶å€™, å¦‚æœ obj å­˜åœ¨è¯¥å±æ€§, è°ƒç”¨è¯¥æ–¹æ³•å¹¶è¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼
```js
String.prototype.split(seperator, limit);
//ç›¸å½“äº
seperator[Symbol.split](this, limit);
```
8. Symbol.iterator: æŒ‡å‘é»˜è®¤çš„éå†å™¨æ–¹æ³•ã€‚å¯¹è±¡åœ¨ for...of ä¸­é»˜è®¤è°ƒç”¨è¯¥æ–¹æ³•ã€‚
```js
class Collector{
  constructor(...vals){
    this.nums = vals;
  }
  *[Symbol.iterator](){
    let i = this.nums.length;
    while(i){
      i--;
      yield this.nums[i];
    }
  }
}
var collector = new Collector(1, 2, 3, 4, 5);
for(let value of collector){
  console.log(value);        //ä¾æ¬¡è¾“å‡º 5 4 3 2 1
}
```
9. Symbol.toPrimitive: æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ã€‚å¯¹è±¡è¢«è½¬ä¸ºåŸå§‹ç±»å‹å€¼æ—¶ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä»‹ç»ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°, å¯é€‰å‚æ•°:

- "number": æ­¤æ—¶è½¬æ¢æˆæ•°å€¼, åº”è¿”å›æ•°å€¼ç±»å‹
- "string": æ­¤æ—¶è½¬æ¢æˆå­—ç¬¦ä¸², åº”è¿”å›å­—ç¬¦ä¸²ç±»å‹
- "default": æ­¤æ—¶è½¬æ¢æˆæ•°å€¼æˆ–å­—ç¬¦ä¸², åº”è¿”å›æ•°å€¼æˆ–å­—ç¬¦ä¸²ç±»å‹

```js
var obj = {
  [Symbol.toPrimitive](hint){
    switch(hint){
      case 'number': return 1234;
      case 'string': return 'hello';
      case 'default': return 'default';
      default: throw new Error();
    }
  }
};
console.log(obj.toString());     //[object Object]
console.log(obj.valueOf());      //{
console.log(2 * obj);            //2468
console.log(2 + obj);            //2default
console.log(obj === "hello");    //false
console.log(String(obj));        //hello
```
10. Symbol.unscopables: è¯¥è¯»å–å™¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ã€‚æŒ‡å®šäº†åœ¨ä½¿ç”¨ withè¯­å¥ æ—¶, é‚£äº›å±æ€§è¢« with ç¯å¢ƒæ’é™¤(æ— æ³•è®¿é—®)
```js
//ä¾‹1
console.log(Array.prototype[Symbol.unscopables]);    //è¾“å‡ºå¦‚ä¸‹, æ•°ç»„å¯¹è±¡åœ¨ with ä¸­ä¸èƒ½è®¿é—®è¿™äº›å±æ€§æ–¹æ³•
//{
//copyWithin: true,
//entries: true,
//fill: true,
//find: true,
//findIndex: true,
//includes: true,
//keys: true
//}
```
```js
//ä¾‹2
//æ²¡æœ‰ unscopables æ—¶
class MyClass{
  foo(){return 1}
}
var foo = () => 2;
with(MyClass.prototype){
  foo();    //1
}

//æœ‰ unscopable æ—¶
var foo = () => 2;
class MyClass{
  foo(){return 1; }
  get [Symbol.unscopables](){
    return {foo: true};
  }
}
with(MyClass.prototype){
  foo();    //2
}
```
11. Symbol.toStringTag: æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ã€‚è¯¥æ–¹æ³•æŒ‡å‘å‡½æ•°åæ˜¯å¯¹è±¡ toString è¿”å›å€¼ `[object Array]` ä¸­ `Array` éƒ¨åˆ†ã€‚
```js
var b = {
  [Symbol.toStringTag]: "Hello"
};
console.log(b.toString());    //"[object Hello]"
```
ES6 æ–°å¢çš„ Symbol.toStringTag å¦‚ä¸‹:

- JSON["Symbol.toStringTag"]: 'JSON'
- Math["Symbol.toStringTag"]: 'Math'
- Moduleå¯¹è±¡ M["Symbol.toStringTag"]: 'Module'
- ArrayBuffer.prototype["Symbol.toStringTag"]: 'ArrayBuffer'
- DataView.prototype["Symbol.toStringTag"]: 'DataView'
- Map.prototype["Symbol.toStringTag"]: 'Map'
- Promise.prototype["Symbol.toStringTag"]: 'Promise'
- Set.prototype["Symbol.toStringTag"]: 'Set'
- %TypedArray%.prototype["Symbol.toStringTag"]: 'Uint8Array'ç­‰9ç§
- WeakMap.prototype["Symbol.toStringTag"]: 'WeakMap'
- WeakSet.prototype["Symbol.toStringTag"]: 'WeakSet'
- %MapIteratorPrototype%["Symbol.toStringTag"]: 'Map Iterator'
- %SetIteratorPrototype%["Symbol.toStringTag"]: 'Set Iterator'
- %StringIteratorPrototype%["Symbol.toStringTag"]: 'String Iterator'
- Symbol.prototype["Symbol.toStringTag"]: 'Symbol'
- Generator.prototype["Symbol.toStringTag"]: 'Generator'
- GeneratorFunction.prototype["Symbol.toStringTag"]: 'GeneratorFunction'

## Reflect å¯¹è±¡

Reflect å¯¹è±¡æœ‰ä¸€ä¸‹ä½œç”¨:
1. å°† Objectå¯¹è±¡çš„ä¸€äº›æ˜æ˜¾å±äºè¯­è¨€å±‚é¢çš„æ–¹æ³•éƒ¨ç½²åœ¨ Reflect ä¸Š
2. ä¿®æ”¹æŸäº› Object å¯¹è±¡çš„æ–¹æ³•ä½¿å…¶æ›´åˆç†ã€‚æ¯”å¦‚ `Object.defineProperty` é‡åˆ°æ— æ³•å®šä¹‰å±æ€§æ—¶ä¼šæŠ›å‡ºé”™è¯¯, è€Œ `Reflect.defineProperty` ä¼šè¿”å› false
3. æŠŠæ‰€ä»¥ object çš„æ“ä½œéƒ½æ›¿æ¢æˆå‡½æ•°è¡Œä¸º, æ¯”å¦‚ç”¨ `Reflect.has(obj, name)` æ›¿æ¢ `name in obj`
4. ä¿è¯åªè¦æ˜¯ Proxy æœ‰çš„æ–¹æ³•å°±ä¸€å®šå¯ä»¥åœ¨ Reflect ä¸Šæ‰¾åˆ°ç›¸åŒçš„æ–¹æ³•, è¿™æ ·å¯ä»¥åœ¨å®ç° proxy æ—¶æ–¹ä¾¿çš„å®Œæˆé»˜è®¤è¡Œä¸ºã€‚æ¢è¨€ä¹‹, æ— è®º proxy æ€ä¹ˆä¿®æ”¹é»˜è®¤è¡Œä¸º, ä½ æ€»å¯ä»¥åœ¨ Reflect ä¸Šæ‰¾åˆ°çœŸæ­£é»˜è®¤çš„è¡Œä¸º

ä»£ç†åœ¨æ·»åŠ é¢å¤–çš„åŠŸèƒ½æ—¶, åˆ©ç”¨ Reflect ä¿è¯äº†åŸå§‹åŠŸèƒ½çš„å®ç°ã€‚ä¸¾ä¸ªä¾‹å­:
```js
var loggedObj = new Proxy({}, {
  get(target, propKey){
    console.log(`getting ${target}.${propKey}`);  //å½“ç„¶ä½ æœ€å¥½æŠŠæ“ä½œè®°å½•åˆ°ä¸€ä¸ª log ä¸­
    return Reflect.get(target, propKey);
  }
});
```

Reflectæœ‰ä»¥ä¸‹æ–¹æ³•:

- Reflect.getOwnPropertyDescriptor(target, propKey)
ç­‰åŒäº `ObjectgetOwnPropertyDescriptor(target, propKey)`
- Reflect.defineProperty(target, propKey, desc)
ç­‰åŒäº `Object.defineProperty(target, propKey, desc)`
- Reflect.getOwnPropertyNames(target)
ç­‰åŒäº `Object.getOwnPropertyNames(target)`
- Reflect.getPrototypeOf(target)
ç­‰åŒäº `Object.getPrototypeOf(target)`
- Reflect.setPrototypeOf(target, proto)
ç­‰åŒäº `Object.setPrototypeOf(target, proto)`
- Reflect.deleteProperty(target, propKey)
ç­‰åŒäº `delete target.propKey`
- Reflect.enumerate(target)
ç­‰åŒäº `for ... in target`
- Reflect.freeze(target)
ç­‰åŒäº `Object.freeze(target)`
- Reflect.seal(target)
ç­‰åŒäº `Object.seal(target)`
- Reflect.preventExtensions(target)
ç­‰åŒäº `Object.preventExtensions(target)`
- Reflect.isFrozen(target)
ç­‰åŒäº `Object.isFrozen(target)`
- Reflect.isSealed(target)
ç­‰åŒäº `Object.isSealed(target)`
- Reflect.isExtensible(target)
ç­‰åŒäº `Object.isExtensible(target)`
- Reflect.has(target, propKey)
ç­‰åŒäº `propkey in object`
- Reflect.hasOwn(target, propKey)
ç­‰åŒäº `target.hasOwnProperty(propKey)`
- Reflect.ownKeys(target)
éå†å¾—åˆ°targetè‡ªèº«æ‰€æœ‰å±æ€§, åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§, ä¸åŒ…æ‹¬ Symbol å±æ€§
- Reflect.get(target, propKey, receiver = target)
å¦‚æœ propKey æ˜¯ä¸ªè¯»å–å™¨, åˆ™è¯»å–å™¨ä¸­çš„ this ç»‘å®šåˆ° receiver
```js
var per = {
  bar: function(){console.log("per-bar")}
}
var obj = {
  get foo(){ this.bar(); },
  bar: function (){console.log("obj-bar")}
};
Reflect.get(obj, "foo", per);    //"per-bar"
```
- Reflect.set(target, propKey, value, receiver = target)
å¦‚æœ propKey æ˜¯ä¸ªè¯»å–å™¨, åˆ™è¯»å–å™¨ä¸­çš„ this ç»‘å®šåˆ° receiver
- Reflect.apply(target, thisArg, args)
ç­‰åŒäº `Function.prototype.apply.call(target, thisArg, args)` å³ `thisArg.target(args)`
- Reflect.construct(target, args)
ç­‰åŒäº `new target(...args)`

æ³¨æ„ä»¥ä¸Šæ–¹æ³•ä¸­, `Reflect.set()`, `Reflect.defineProperty()`, `Reflect.freeze()`, `Reflect.seal()`, `Reflect.preventExtensions()` åœ¨æˆåŠŸæ—¶è¿”å› true, å¤±è´¥æ—¶è¿”å› falseã€‚å¯¹åº”çš„ Object æ–¹æ³•å¤±è´¥æ—¶ä¼šæŠ›å‡ºé”™è¯¯ã€‚

## Proxy å¯¹è±¡

Proxy ç”¨æ¥ä¿®æ”¹æŸäº›é»˜è®¤æ“ä½œ, ç­‰åŒäºåœ¨è¯­è¨€å±‚é¢åšå‡ºä¿®æ”¹ã€‚æ‰€ä»¥å±äºä¸€ç§å…ƒç¼–ç¨‹(meta programming), å³å¯¹ç¼–ç¨‹è¯­è¨€è¿›è¡Œç¼–ç¨‹ã€‚å­—é¢ç†è§£ä¸ºProxyä»£ç†äº†æŸäº›é»˜è®¤çš„æ“ä½œã€‚
å…¶ä½¿ç”¨æ ¼å¼å¦‚ä¸‹:
```js
var proxy = new Proxy(target, handler);
```
targetæ˜¯è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡, handlerä¹Ÿæ˜¯ä¸ªå¯¹è±¡, ç”¨æ¥å®šåˆ¶æ‹¦æˆªè¡Œä¸º, å†…éƒ¨å®šä¹‰æ¯ä¸ªè¢«ä»£ç†çš„è¡Œä¸ºã€‚
æ³¨æ„:

- å¦‚æœå¸Œæœ›è¿™ä¸ªä»£ç†æœ‰æ•ˆ, éœ€è¦åœ¨ proxy å¯¹è±¡ä¸Šè°ƒç”¨å±æ€§æ–¹æ³•, è€Œä¸æ˜¯åœ¨ target ä¸Šè°ƒç”¨
- å¦‚æœæŒ‡å®š handler ä¸ºç©ºå¯¹è±¡, é‚£ä¹ˆå¾—åˆ°å¯¹è±¡å’ŒåŸå¯¹è±¡ä¸€æ ·
- å¾—åˆ°çš„ proxy æ˜¯ target çš„å¼•ç”¨, å¦‚æœæ²¡æœ‰ä»£ç†, åœ¨ proxy ä¸Šçš„ä¿®æ”¹å’Œåœ¨ target ä¸Šçš„ä¿®æ”¹ç­‰åŒ

çœ‹ä¸€ä¸ªç®€å•çš„å®ä¾‹
```js
var proxy = new Proxy({}, {
  get: function(target, key){
    return 35;
  }
});
console.log(proxy.time);    //35
console.log(proxy.name);    //35
console.log(proxy.title);    //35
//è¢«ä»£ç†çš„å¯¹è±¡æ— è®ºè¾“å…¥ä»€ä¹ˆå±æ€§éƒ½è¿”å›35
```

å®é™…ä¸Š, proxy å¯¹è±¡ä¹Ÿå¯ä»¥è¢«ç»§æ‰¿:
```js
var proxy = new Proxy({}, {
  get: function(target, key){
    return 35;
  }
});
var obj = Object.create(proxy);
obj.time = 20;
console.log(obj.time);    //20
console.log(obj.name);    //35
```

æ„Ÿå—ä¸€ä¸‹å®ƒçš„å¨åŠ›:
```js
var obj = new Proxy({}, {
  get: function(target, key, receiver){
    console.log(`getting ${key} ...`);
    return Reflect.get(target, key, receiver);
  },
  set: function(target, key, value, receiver){
    console.log(`setting ${key} ...`);
    return Reflect.set(target, key, value, receiver);
  }
});

obj.count = 1;            //setting count ...
++obj.count;              //getting count ...
                          //setting count ...
console.log(obj.count);   //getting count ...
                          //2
```
å¯ä»¥çœ‹å‡ºæ¥, handlerå¯¹è±¡ä¸­ get æ–¹æ³•è¡¨ç¤ºå±æ€§çš„è®¿é—®è¯·æ±‚, set æ–¹æ³•è¡¨ç¤ºå±æ€§çš„å†™å…¥è¯·æ±‚ã€‚
å½“ç„¶ä¸ä»…ä»… get å’Œ set, æˆ‘ä»¬å¯ä»¥å®šä¹‰ä»¥ä¸‹æ‹¦æˆªå‡½æ•°:

- get(target, propKey, receiver = target)
æ‹¦æˆªå¯¹è±¡çš„è¯»å–å±æ€§ã€‚å½“ target å¯¹è±¡è®¾ç½®äº† propKey å±æ€§çš„ get å‡½æ•°æ—¶, receiver ç»‘å®š get å‡½æ•°çš„ thisã€‚è¿”å›å€¼ä»»æ„
- set(target, propKey, value, receiver = target)
æ‹¦æˆªå¯¹è±¡çš„å†™å…¥å±æ€§ã€‚è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- has(target, propKey)
æ‹¦æˆª propKey in proxy æ“ä½œç¬¦, è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- deleteProperty(target, propKey)
æ‹¦æˆª delete proxy[propKey] æ“ä½œç¬¦, è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- enumerate(target)
æ‹¦æˆª for(let i in proxy) éå†å™¨, è¿”å›ä¸€ä¸ªéå†å™¨
- hasOwn(target, propKey)
æ‹¦æˆª proxy.hasOwnProperty('foo'), è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- ownKeys(target)
æ‹¦æˆª Object.getOwnPropertyNames(proxy), Object.getOwnPropertySymbols(proxy), Object.keys(proxy), è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›å¯¹è±¡æ‰€æœ‰è‡ªèº«å±æ€§, åŒ…æ‹¬ä¸å¯éå†å±æ€§, ä¸åŒ…æ‹¬ Symbolå±æ€§, ä½†æ˜¯`Object.keys(proxy)`ä¸åº”è¯¥åŒ…æ‹¬ä¸å¯éå†å±æ€§
- getOwnPropertyDescriptor(target, propKey)
æ‹¦æˆª Object.getOwnPropertyDescriptor(proxy, propKey), è¿”å›å…¶å±æ€§æè¿°ç¬¦
- defineProperty(target, propKey, propDesc)
æ‹¦æˆª Object.defineProperty(proxy, propKey, propDesc), Object.defineProperties(proxy, propDesc), è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- preventExtensions(target)
æ‹¦æˆª Object.preventExtensions(proxy), è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- getPrototypeOf(target)
æ‹¦æˆª Object.getPrototypeOf(proxy), è¿”å›ä¸€ä¸ªå¯¹è±¡
- isExtensible(target)
æ‹¦æˆª Object.isExtensible(proxy), è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- setPrototypeOf(target, proto)
æ‹¦æˆª Object.setPrototypeOf(proxy, proto), è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- apply(target, object, args)
æ‹¦æˆªå¯¹ proxy å®ä¾‹çš„å‡½æ•°æ“ä½œ, åŒ…æ‹¬ proxy(...args), proxy.call(object, ...args), proxy.apply(object, args)
- construct(target, args, proxy)
æ‹¦æˆªç”¨ new è°ƒç”¨ proxy å‡½æ•°çš„æ“ä½œ, construct()è¿”å›çš„ä¸æ˜¯å¯¹è±¡ä¼šæŠ¥é”™

ä»¥ä¸‹åˆ—ä¸¾ä¸€äº› Proxy çš„å®ä¾‹

è®¿é—®å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§æŠ¥é”™
```js
var obj = new Proxy({}, {
  get: function(target, key){
    if(key in target){
      return Reflect.get(target, key);
    } else {
      throw new ReferenceError(`"${key}" is not in object`);
    }
  }
});
obj.look = "picture";
console.log(obj.look);     //"picture"
console.log(obj.sleep);    //ReferenceError: "sleep" is not in object
```

æ•°ç»„ç´¢å¼•ä¸ºè´Ÿæ—¶è¿”å›å€’æ•°ä½ç½®çš„å€¼
```js
var origin = [10, 20];
var arr = new Proxy(origin, {
  get(target, key){
    let index = parseInt(key);
    if(index < 0){
      index = target.length + index;
      if(index < 0) return undefined;
    }
    return Reflect.get(target, index);
  }
});
console.log(arr[0]);     //10
console.log(arr[1]);     //20
console.log(arr[2]);     //undefined
console.log(arr[-1]);    //20
console.log(arr[-4]);    //undefined
```

ä¿æŠ¤å¯¹è±¡å†…ä»¥ "_" å¼€å¤´çš„å±æ€§ä¸ºç§æœ‰å±æ€§:
```js
var o = {
  "_name": "Bob",
  "age": 13,
  "_fun": function(){
    console.log("_fun is called");
  }
};
var obj = new Proxy(o, {
  get(target, key){
    if(key.charAt(0) === '_'){
      return undefined;
    }
    return Reflect.get(target, key);
  },
  set(target, key, value){
    if(key.charAt(0) === '_'){
      throw new Error('Cannot define a property begin with "_"');
    }
    return  Reflect.set(target, key, value);
  },
  has(target, key){
    if(key.charAt(0) === '_'){
      return false;
    }
    return Reflect.has(target, key);
  },
  deleteProperty(target, key){
    if(key.charAt(0) === '_'){
      return false;
    } else {
      Reflect.deleteProperty(..arguments);
    }
  },
  apply(target, ctx, args){
    if(target.name.charAt(0) === '_'){
      throw new TypeError(`${target.name} is not defined`);
    } else {
      Reflect apply(...arguments);
    }
  },
  defineProperty(target, key, desc){
    if(key.charAt(0) === '_'){
      return new Error(`cannot define property begin with "_"`);
    } else {
      Reflect.defineProperty(..arguments);
    }
  },
  setPrototypeOf(target, proto){
    throw new TypeError(`Cannot change the proto of ${target}`);
  },
  construct(target, ctx, args){
    if(target.name.charAt(0) === '_'){
      throw new TypeError(`${target.name} is not defined`);
    } else {
      Reflect construct(...arguments);
    }
  }
});

console.log(obj.age);    //13
obj.age = 20;
console.log(obj.age);    //20
console.log(obj._name);  //undefined
obj._hobby = "Coding";   //Error: Cannot define a property begin with "_"
_name in key             //false
delete obj._name;
Object.defineProperty(obj, "_hobby", {
  value: "Coding"
});
Object.defineProperties(obj, {
  '_hobby': {
    value: "Coding"
  }
});
obj._fun();
var a = new obj._fun();
obj.__proto__ = {};     //Cannot define a property begin with "_"
Object.setPrototypeOf(obj, {})    //Cannot change the proto of obj
```

å½“ç„¶ä¸æ˜¯æ‰€æœ‰ proxy ä»£ç†éƒ½ä¸å¯å–æ¶ˆ, ä¸‹é¢æ–¹æ³•è®¾ç½®çš„ä»£ç†æ˜¯å¯ä»¥é€šè¿‡å®šä¹‰ä»£ç†æ—¶è¿”å›çš„revokeå‡½æ•°å–æ¶ˆ:
```js
var a = {
  name: "Bob"
};
var {proxy, revoke} = Proxy.revocable(a, {
  get(target, key){
    return undefined;
  }
});
proxy.name;   //undefined;
revoke();
proxy.name;   //TypeError: Cannot perform 'get' on a proxy that has been revoked
```

## Set ä¸ Map

### Set

Set æ˜¯ä¸€ç§é›†åˆç»“æ„, ç‰¹å¾å’Œæ•°å­¦ä¸­çš„ä¸€è‡´, å…·æœ‰ä»¥ä¸‹ç‰¹å¾:

- åŒä¸€ä¸ªé›†åˆä¸­ä¸èƒ½æœ‰ç›¸åŒå…ƒç´ 
- set å¯ä»¥å­˜æ”¾ä¸åŒç±»å‹çš„æ•°æ®

ä½†ä½¿ç”¨è¿‡ç¨‹ä¸­è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:

- å­˜å…¥ set çš„æ•°æ®ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢, å³'5'å’Œ 5 æ˜¯ä¸ä¸€æ ·çš„
- å†…éƒ¨é‡‡ç”¨ä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒå…ƒç´ , ä½†-0ç­‰äº+0, NaNä¹Ÿç­‰äºNaN

å®šä¹‰èšåˆå’Œå®šä¹‰å…¶ä»–æ•°æ®ç»“æ„ä¸€æ ·, å…¶æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªæ•°ç»„, é›†åˆæˆ–ç±»æ•°ç»„å¯¹è±¡åˆå§‹åŒ–:
```js
var set1 = new Set();
var set2 = new Set([1, 2, 3, 3, 4, 4, 5]);
console.log(set1);   //Set(0) {}
console.log(set2);   //Set(5) {1, 2, 3, 4, 5}
```

Setç»“æ„å…·æœ‰ä»¥ä¸‹å±æ€§å’Œæ–¹æ³•, ç”±äºå’Œæ•°ç»„æ–¹æ³•åŸºæœ¬ä¸€è‡´, ä¸ç»†ç»†åˆ—ä¸¾

- sizeå±æ€§: å½“å‰é›†åˆçš„å…ƒç´ æ•°é‡, ç›¸å½“äºæ•°ç»„ç†Ÿæ‚‰çš„length
- add()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„push()æ–¹æ³•, ä½†åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°
- delete()æ–¹æ³•: åˆ é™¤é›†åˆä¸­çš„ä¸€ä¸ªå€¼
- has()æ–¹æ³•: åˆ¤æ–­æ•°ç»„çš„ä¸­æ˜¯å¦å«æœ‰æŸä¸ªå€¼
- clear()æ–¹æ³•: æ¸…ç©ºå½“å‰æ•°ç»„
- keys()æ–¹æ³•: è¿”å›é”®åçš„éå†å™¨, å’Œæ•°ç»„keys()æ–¹æ³•ä¸€æ ·
- values()æ–¹æ³•: è¿”å›å€¼çš„éå†å™¨, å’Œæ•°ç»„values()æ–¹æ³•ä¸€æ ·
- entires()æ–¹æ³•: è¿”å›é”®å€¼å¯¹çš„éå†å™¨, å’Œæ•°ç»„entires()æ–¹æ³•ä¸€æ ·
- forEach()æ–¹æ³•: ä½¿ç”¨å›è°ƒå‡½æ•°éå†é›†åˆæˆå‘˜, å’Œæ•°ç»„forEach()æ–¹æ³•ä¸€æ ·
- map()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„map()æ–¹æ³•
- filter()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„filter()æ–¹æ³•

Setçš„é»˜è®¤éå†å™¨éå†çš„æ˜¯å€¼:
```js
Set.prototype[Symbol.iterator] === Set.prototype.values;   //true
```

é›†åˆè¿ç®—:

- å¹¶é›†
```js
var a = new Set([1, 2, 3]);
var b = new Set([2, 4, 5]);
var union = new Set([...a, ...b]);    //[1, 2, 3, 4, 5]
```
- äº¤é›†
```js
var a = new Set([1, 2, 3]);
var b = new Set([2, 4, 5]);
var intersect = new Set([...a].filter(item => b.has(item)));  //[2]
```
- å·®é›†
```js
var a = new Set([1, 2, 3]);
var b = new Set([2, 4, 5]);
var diffsect = new Set([...a].filter(item => !b.has(item)));  //[1, 3]
```
### WeakSet

WeakSet å’Œ Setç±»ä¼¼, ä½†æ˜¯å…·æœ‰ä»¥ä¸‹åŒºåˆ«:

- WeakSet çš„å…ƒç´ åªèƒ½æ˜¯å¯¹è±¡, ä¸èƒ½æ˜¯åˆ«çš„ç±»å‹
- WeakSet çš„å…ƒç´ æ— æ³•è¢«å¼•ç”¨, å…¶å…ƒç´ ä¸å…·æœ‰åˆ«çš„å¼•ç”¨æ—¶, GC ä¼šç«‹åˆ»é‡Šæ”¾å¯¹è±¡çš„å†…å­˜èµ„æº, å› æ­¤ WeakSet ä¸èƒ½è¢«éå†ã€‚

å®šä¹‰WeakSetå’Œå®šä¹‰å…¶ä»–æ•°æ®ç»“æ„ä¸€æ ·, å…¶æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªæ•°ç»„, é›†åˆæˆ–ç±»æ•°ç»„å¯¹è±¡åˆå§‹åŒ–:
```js
var set1 = new WeakSet();
var set2 = new WeakSet([[1, 2], [3, 3], [4, 4, 5]]);
console.log(set1);   //WeakSet(0) {}
console.log(set2);   //WeakSet {(2) [1, 2], (2) [3, 3], (3) [4, 4, 5]}
```

WeakSet æ²¡æœ‰ size å±æ€§, æœ‰å¦‚ä¸‹3ä¸ªæ–¹æ³•:

- add()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„push()æ–¹æ³•, ä½†åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°
- delete()æ–¹æ³•: åˆ é™¤é›†åˆä¸­çš„ä¸€ä¸ªå€¼
- has()æ–¹æ³•: åˆ¤æ–­æ•°ç»„çš„ä¸­æ˜¯å¦å«æœ‰æŸä¸ªå€¼
- clear()æ–¹æ³•: æ¸…ç©ºå½“å‰æ•°ç»„
- keys()æ–¹æ³•: è¿”å›é”®åçš„éå†å™¨, å’Œæ•°ç»„keys()æ–¹æ³•ä¸€æ ·, ç”¨äº for...of å¾ªç¯
- values()æ–¹æ³•: è¿”å›å€¼çš„éå†å™¨, å’Œæ•°ç»„values()æ–¹æ³•ä¸€æ ·, ç”¨äº for...of å¾ªç¯
- entires()æ–¹æ³•: è¿”å›é”®å€¼å¯¹çš„éå†å™¨, å’Œæ•°ç»„entires()æ–¹æ³•ä¸€æ ·, ç”¨äº for...of å¾ªç¯
- forEach()æ–¹æ³•: ä½¿ç”¨å›è°ƒå‡½æ•°éå†é›†åˆæˆå‘˜, å’Œæ•°ç»„forEach()æ–¹æ³•ä¸€æ ·
- map()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„map()æ–¹æ³•
- filter()æ–¹æ³•: ç›¸å½“äºæ•°ç»„çš„filter()æ–¹æ³•

WeakSet ä¸èƒ½éå†, å®ƒçš„ä½œç”¨æ˜¯ä¸´æ—¶å­˜å‚¨DOMèŠ‚ç‚¹, è¿™æ ·ä¸å¿…æ‹…å¿ƒå†…å­˜æ³„æ¼:
```js
//ä¾‹
const foos = new WeakSet();
class Foo{
  constructor(){
    foos.add(this);
  }
  method(){
    if(!foos.has(this)){
      throw new TypeError(`"foo.prototype.method" is only called by object of Foo`);
    }
    console.log(`"Foo.prototype.method" has been called`);
  }
}
var obj = new Foo();
obj.method();          //Foo.prototype.method" has been called
obj.method.call({});   //typeError: "foo.prototype.method" is only called by object of Foo
```

### Map

js ä¸­çš„å¯¹è±¡æ˜¯é”®å€¼å¯¹çš„é›†åˆ, ä½†æ˜¯é”®åªèƒ½æ˜¯å­—ç¬¦ä¸²å…¶å®å¹¶ä¸æ–¹ä¾¿ã€‚Mapç»“æ„æœ¬è´¨å’Œå¯¹è±¡ä¸€æ ·, åªæ˜¯é”®åå¯ä»¥ä½¿ç”¨å„ç§ç±»å‹çš„å€¼ã€‚å¦‚æœè¿™ä¹ˆç†è§£, é‚£ä¹ˆMapå°±æ˜¯ä¸€ç§å€¼-å€¼å¯¹è€Œä¸æ˜¯é”®-å€¼å¯¹, è¿™ä¸€ç‚¹ç±»ä¼¼hashç»“æ„:
```js
var o = {name: "Bob"};
var map = new Map();
map.set(o, "hello");
console.log(map.get(o));   //"hello"
```

æ„é€  Map ç»“æ„çš„æ„é€ å‡½æ•°æ¥å—æ•°ç»„, å¯¹è±¡ç­‰ç±»å‹ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°:
```js
var map = new Map([["name", "Bob"], ["age", 12]]);
map.get("name");    //"Bob"
map.get("age");     //12
```

mapå…·æœ‰å¦‚ä¸‹å±æ€§å’Œæ–¹æ³•:

- size å±æ€§: è¿”å› map ä¸­å…ƒç´ çš„æ•°é‡, ç±»ä¼¼æ•°ç»„çš„ length
- set(key, value)æ–¹æ³•: å‘mapä¸­æ·»åŠ å€¼-å€¼å¯¹
- get(key)æ–¹æ³•: è¯»å–mapä¸­çš„å€¼
- delete(key, value)æ–¹æ³•: åˆ é™¤mapä¸­çš„å€¼-å€¼å¯¹
- has(key)æ–¹æ³•: åˆ¤æ–­æŸä¸ªé”®åæ˜¯å¦å­˜åœ¨
- clear()æ–¹æ³•: æ¸…ç©ºå½“å‰ map ä¸­æ‰€ä»¥æ•°æ®
- keys()æ–¹æ³•: è¿”å›é”®åçš„éå†å™¨, å’Œæ•°ç»„keys()æ–¹æ³•ç±»ä¼¼, ç”¨äº for...of å¾ªç¯
- values()æ–¹æ³•: è¿”å›å€¼çš„éå†å™¨, å’Œæ•°ç»„values()æ–¹æ³•ç±»ä¼¼, ç”¨äº for...of å¾ªç¯
- entires()æ–¹æ³•: è¿”å›å€¼-å€¼å¯¹çš„éå†å™¨, å’Œæ•°ç»„entires()æ–¹æ³•ç±»ä¼¼, ç”¨äº for...of å¾ªç¯
- forEach()æ–¹æ³•: ä½¿ç”¨å›è°ƒå‡½æ•°éå†é›†åˆæˆå‘˜, å’Œæ•°ç»„forEach()æ–¹æ³•ç±»ä¼¼

```js
var o = {name: "Bob"};
var map = new Map();
map.set(o, "hello");
console.log(map.get(o));   //"hello"
map.set(o, "world");       //é‡å¤å®šä¹‰, è¦†ç›–ä¹‹å‰çš„å®šä¹‰
console.log(map.get(o));   //"world"
console.log(map.get({name: "Bob"}));   //undefined, ä¸åŒçš„å¯¹è±¡å¼•ç”¨ä¸è®¤ä¸ºæ˜¯åŒä¸€ä¸ªå¯¹è±¡
map.delete(o);             //åˆ é™¤å¯¹è±¡å±æ€§ o
console.log(map.get(o));   //undefined
```

ä»ä¸Šæ–¹çš„ä¾‹å­ä¸éš¾å‘ç°, ä¸åŒçš„å¯¹è±¡å±æ€§å¯¹äº map æ¥è¯´å°±æ˜¯ä¸åŒçš„, ä¸ç®¡å†…éƒ¨çš„å†…å®¹æ˜¯å¦ä¸€è‡´ã€‚è¿™å’Œå¯¹è±¡çš„ === æ¯”è¾ƒæ˜¯ä¸€æ ·çš„é“ç†, å¸¦æ¥çš„å¥½å¤„æ˜¯æˆ‘ä»¬ä¸ç”¨æ‹…å¿ƒå’Œä¼š map åŸæœ‰å±æ€§é‡å, è€Œç›´æ¥å‘ map æ·»åŠ å¯¹è±¡å±æ€§å³å¯ã€‚

æ³¨æ„ undefined, NaNå’Œ null ä¹Ÿå¯ä»¥ä½œä¸º map çš„é”®å
```js
var map = new Map();
map.set(undefined, 1);
map.set(null, 2);
map.set(NaN, 3);
console.log(map.get(undefined));        //1
console.log(map.get(null));        //2
console.log(map.get(NaN));        //3
```

ä½†ä½¿ç”¨è¿‡ç¨‹ä¸­è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:

- å­˜å…¥ map çš„æ•°æ®ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢, å³'5'å’Œ 5 æ˜¯ä¸ä¸€æ ·çš„, {} å’Œ {}ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚
- å†…éƒ¨é‡‡ç”¨ä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒå…ƒç´ , ä½†-0ç­‰äº+0, NaNä¹Ÿç­‰äºNaNã€‚

map çš„é»˜è®¤éå†å™¨æ˜¯ entries()
```js
Map.prototype[Symbol.iterator] === Map.prototype.entries;   //true
```

å¦å¤–è¿™é‡Œéœ€è¦æ ¼å¤–å¼ºè°ƒçš„æ˜¯:

- Setä¸­çš„ has æ–¹æ³•æ˜¯åˆ¤æ–­**é”®å€¼**æ˜¯å¦å­˜åœ¨çš„, å¦‚ ` Set.prototype.has(value)`, `WeakSet.prototype.has(value)`
- Mapä¸­çš„ has æ–¹æ³•æ˜¯åˆ¤æ–­**é”®å**æ˜¯å¦å­˜åœ¨çš„, å¦‚ ` Map.prototype.has(key)`, `WeakMap.prototype.has(key)`, `Reflect.has(target, propertyKey)`

Mapè§£æ„è½¬æ¢æŠ€å·§:

- Map è½¬ Array
```js
var map = new Map([[1, 'one'], [2, 'two'], [3, 'three']]);
var keyArr = [...map.keys()];          //[1, 2, 3]
var valueArr = [...map.values()];      //['one', 'two', 'three']
var entriesArr = [...map.entries()];   //[[1, 'one'], [2, 'two'], [3, 'three']]
var arr = [...map];                    //[[1, 'one'], [2, 'two'], [3, 'three']]
```
- Map è½¬ Object(ä¸ºé˜²æ­¢ä¸å¿…è¦çš„é”™è¯¯, ç›´æ¥ä¸¢å¼ƒä¸æ˜¯å­—ç¬¦ä¸²ä¸ºé”®çš„å±æ€§)
```js
function map2arr(map){
  var o = {};
  for(let [key, value] of map.entries()){
    if(typeof key === 'string'){
      o[key] = value;
    }
  }
  return o;
}
var map = new Map([[1, 'one'], [2, 'two'], ['three', 3], ['four', 4]]);
map2arr(map);    //Object {three: 3, four: 4}
```
- Map è½¬ JSON
```js
var map = new Map([[1, 'one'], [2, 'two'], ['three', 3], ['four', 4]]);
JSON.stringify([...map]);    //"[[1, "one"], [2, "two"], ["three", 3], ["four", 4]]"
```

å»ºè®®ï¼šåªæœ‰æ¨¡æ‹Ÿç°å®ä¸–ç•Œçš„å®ä½“å¯¹è±¡æ—¶ï¼Œæ‰ä½¿ç”¨Objectã€‚å¦‚æœåªæ˜¯éœ€è¦`key: value`çš„æ•°æ®ç»“æ„ï¼Œä½¿ç”¨Mapç»“æ„ã€‚å› ä¸ºMapæœ‰å†…å»ºçš„éå†æœºåˆ¶ã€‚

### WeakMap

WeakMap å’Œ map ç±»ä¼¼, ä¸è¿‡å®ƒåªæ¥å—å¯¹è±¡ä½œä¸ºé”®å, nullé™¤å¤–ã€‚è¯•æƒ³, å¦‚æœå¯¹è±¡ o æ˜¯ä¸€ä¸ª mapçš„å±æ€§, å¦‚æœè¯¥å¯¹è±¡è¢«é‡Šæ”¾äº†, é‚£è¿™ä¸ª map å±æ€§ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚è§£å†³è¿™ä¸ªé—®é¢˜å°±æ˜¯ä½¿ç”¨ WeakMap:
```js
var o = {name: "Bob"};
var map = new WeakMap();
map.set(o, 12);
console.log(map.get(o));    //12
o = null;
console.log(map.get(o));    //undefined
```

WeakMapçš„å¯¹è±¡å±æ€§å, ä¸è®¡å…¥ GC, æ‰€ä»¥å½“å¯¹è±¡ä¸å­˜åœ¨çš„æ—¶å€™, è¿™ä¸ª weakmap ä¸­ç›¸åº”çš„é”®å€¼å¯¹å°±è¢«åˆ é™¤äº†ã€‚å€¼å¾—ä¸€æçš„æ˜¯, ä»£ç å¯¹äº map å¯ä»¥å¾—åˆ°ä¸€æ ·çš„è¾“å‡ºã€‚é‚£æ˜¯å› ä¸ºæœ€åä¸€è¡Œç›¸å½“äº`console.log(map.get(null))`, æˆ‘ä»¬æ²¡æœ‰å®šä¹‰ null å¯¹åº”çš„å€¼, æ‰€ä»¥å¾—åˆ° undefined, å…¶å®å†…å­˜æ³„éœ²çš„éšæ‚£ä¾ç„¶å­˜åœ¨:
```js
var o = {name: "Bob"};
var map = new Map();
map.set(o, 12);
console.log(map.get(o));    //12
o = null;
console.log(map.size);      //1
```

WeakMap å’Œ WeakSet ç±»ä¼¼, ç”±äºä¸è®¡å…¥ GC å›æ”¶æœºåˆ¶, æ‰€ä»¥ä¸æ”¯æŒéå†æ“ä½œ, ä¹Ÿä¸æ”¯æŒè¢«æ¸…ç©º, æ‰€ä»¥ WeakMap åªæœ‰ä»¥ä¸‹ 4 ä¸ªæ–¹æ³•, æ²¡æœ‰ size å±æ€§:

- set(key, value)æ–¹æ³•: å‘weakMapä¸­æ·»åŠ å€¼-å€¼å¯¹
- get(key)æ–¹æ³•: è¯»å–mapä¸­çš„å€¼
- delete(key, value)æ–¹æ³•: åˆ é™¤weakMapä¸­çš„å€¼-å€¼å¯¹
- has(key)æ–¹æ³•: åˆ¤æ–­æŸä¸ªé”®åæ˜¯å¦å­˜åœ¨

## iterator

ç”±äº ES6 ä¸­å¼•å…¥äº†è®¸å¤šæ•°æ®ç»“æ„, ç®—ä¸ŠåŸæœ‰çš„åŒ…æ‹¬Object, Array, TypedArray, DataView, buffer, Map, WeakMap, Set, WeakSetç­‰ç­‰, æ•°ç»„éœ€è¦ä¸€ä¸ªä¸œè¥¿æ¥ç®¡ç†ä»–ä»¬, è¿™å°±æ˜¯éå†å™¨(iterator)ã€‚

### for...of

éå†å™¨è°ƒç”¨é€šå¸¸ä½¿ç”¨ for...of å¾ªç¯, `for...of` å¯ä»¥éå†å…·æœ‰ iterator çš„å¯¹è±¡, ES6ä¸­é»˜è®¤åªæœ‰æ•°ç»„, Set, Map, String, Generatorå’Œä¸€äº›ç±»æ•°ç»„å¯¹è±¡(arguments, DOM NodeList)å¸¦æœ‰éå†å™¨, å…¶ä»–çš„æ•°æ®ç»“æ„éœ€è¦è‡ªå·±å®šä¹‰éå†å™¨ã€‚

- æ•°ç»„
é»˜è®¤ for...of éå†å™¨éå†å€¼
```js
var arr = ["red", "green", "blue"];
for(let v of arr){    //ç›¸å½“äº for(let i in arr.values())
  console.log(v);     //ä¾æ¬¡è¾“å‡º "red", "green", "blue"
}
for(let i in arr){
  console.log(i);     //ä¾æ¬¡è¾“å‡º 0, 1, 2
}
for(let [key, value] of arr.entries()){
  console.log(key + ": " + value);      //ä¾æ¬¡è¾“å‡º 0: "red", 1: "green", 2: blue"
}
for(let key of arr.keys()){
  console.log(key);     //ä¾æ¬¡è¾“å‡º 0, 1, 2
}
```
ä¸éš¾çœ‹å‡º for...of é»˜è®¤å¾—åˆ°å€¼, è€Œ for...in åªèƒ½å¾—åˆ°ç´¢å¼•ã€‚å½“ç„¶æ•°ç»„çš„ for...of åªè¿”å›æ•°å­—ç´¢å¼•çš„å±æ€§, è€Œ for...in æ²¡æœ‰é™åˆ¶:
```js
var arr = ["red", "green", "blue"];
arr.name = "color";
for(let v of arr){
  console.log(v);     //ä¾æ¬¡è¾“å‡º "red", "green", "blue"
}
for(let i in arr){
  console.log(arr[i]);     //ä¾æ¬¡è¾“å‡º "red", "green", "blue", "color"
}
```

- Set
é»˜è®¤ for...of éå†å™¨éå†å€¼
```js
var set = new Set(["red", "green", "blue"]);
for(let v of set){    //ç›¸å½“äº for(let i in arr.values())
  console.log(v);     //ä¾æ¬¡è¾“å‡º "red", "green", "blue"
}
for(let [key, value] of set.entries()){
  console.log(key + ": " + value);      //ä¾æ¬¡è¾“å‡º "red: red", "green: green", "blue: blue"
}
for(let key of set.keys()){
  console.log(key);     //ä¾æ¬¡è¾“å‡º "red", "green", "blue"
}
```

- map
é»˜è®¤ for...of éå†å™¨éå†é”®å€¼å¯¹
```js
var map = new Map();
map.set("red", "#ff0000");
map.set("green", "#00ff00");
map.set("blue", "#0000ff");
for(let [key, value] of map){    //ç›¸å½“äº for(let i in arr.entries())
  console.log(key + ": " + value);      //ä¾æ¬¡è¾“å‡º "red: #ff0000", "green: #00ff00", "blue: #0000ff"
}
for(let value of map.values()){
  console.log(value);     //æ¬¡è¾“å‡º "#ff0000", "#00ff00", "#0000ff"
}
for(let key of map.keys()){
  console.log(key);     //æ¬¡è¾“å‡º "red", "green", "blue"
}
```

- å­—ç¬¦ä¸²
for...ofå¯ä»¥å¾ˆå¥½çš„å¤„ç†åŒºåˆ†32ä½ Unicode å­—ç¬¦ä¸²
```js
var str = "Hello";
for(let v of str){
  console.log(v);     //ä¾æ¬¡è¾“å‡º "H", "e", "l", "l", "o"
}
```

- ç±»æ•°ç»„å¯¹è±¡
```js
// DOM NodeList
var lis = document.getElementById("li");
for(let li of lis){
  console.log(li.innerHTML);   //éå†æ¯ä¸ªèŠ‚ç‚¹
}

//arguments
function fun(){
  for(let arg of arguments){
    console.log(arg);          //éå†æ¯ä¸ªå‚æ•°
  }
}
```
ä¸æ˜¯æ‰€æœ‰ç±»æ•°ç»„å¯¹è±¡éƒ½æœ‰ iterator, å¦‚æœæ²¡æœ‰, å¯ä»¥å…ˆç”¨`Array.from()`è¿›è¡Œè½¬æ¢:
```js
var o = {0: "red", 1: "green", 2: "blue", length: 3};
var o_arr = Array.from(o);
for(let v of o_arr){
  console.log(v);        //ä¾æ¬¡è¾“å‡º "red", "green", "blue"
}
```

> æŠ€å·§1: æ·»åŠ ä»¥ä¸‹ä»£ç , ä½¿ for...of å¯ä»¥éå† jquery å¯¹è±¡:
```js
$.fn[Symbol.iterator] = [][Symbol.iterator];
```
> æŠ€å·§2: åˆ©ç”¨ Generator é‡æ–°åŒ…è£…å¯¹è±¡:
```js
function* entries(obj){
  for(let key of Object.keys(obj)){
    yield [key, obj[key]];
  }
}
var obj = {
  red: "#ff0000",
  green: "#00ff00",
  blue: "#0000ff"
};
for(let [key, value] of entries(obj)){
  console.log(`${key}: ${value}`);        //ä¾æ¬¡è¾“å‡º "red: #ff0000", "green: #00ff00", "blue: #0000ff"
}
```

### å‡ ç§éå†æ–¹æ³•çš„æ¯”è¾ƒ

- for å¾ªç¯: ä¹¦å†™æ¯”è¾ƒéº»çƒ¦
- forEachæ–¹æ³•: æ— æ³•ç»ˆæ­¢éå†
- for...in: ä»…éå†ç´¢å¼•, ä½¿ç”¨ä¸ä¾¿æ·; ä¼šéå†åŸå‹é“¾ä¸Šçš„å±æ€§, ä¸å®‰å…¨; ä¼šéå†éæ•°å­—ç´¢å¼•çš„æ•°ç»„å±æ€§;
- for...of:

### iterator ä¸ [Symbol.iterator]

iterator éå†è¿‡ç¨‹æ˜¯è¿™æ ·çš„:
1. åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡, æŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®ã€‚å³éå†å™¨çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚
2. è°ƒç”¨ä¸€æ¬¡æŒ‡é’ˆçš„ next æ–¹æ³•, æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€æ•°æ®æˆå‘˜ã€‚ä¹‹åæ¯æ¬¡è°ƒç”¨ next æ–¹æ³•éƒ½ä¼šå°†ä¹‹åå‘åç§»åŠ¨ä¸€ä¸ªæ•°æ®ã€‚
3. çŸ¥é“éå†ç»“æŸã€‚

æˆ‘ä»¬å®ç°ä¸€ä¸ªæ•°ç»„çš„éå†å™¨è¯•è¯•:
```js
var arr = [1, 3, 6, 5, 2];
var it = makeIterator(arr);
console.log(it.next());       //Object {value: 1, done: false}
console.log(it.next());       //Object {value: 3, done: false}
console.log(it.next());       //Object {value: 6, done: false}
console.log(it.next());       //Object {value: 5, done: false}
console.log(it.next());       //Object {value: 2, done: false}
console.log(it.next());       //Object {value: undefined, done: true}

function makeIterator(arr){
  var nextIndex = 0;
  return {
    next: function(){
      return nextIndex < arr.length ?
        {value: arr[nextIndex++], done: false} :
        {value: undefined, done: true}
    }
  };
}
```
ç”±è¿™ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºä»¥ä¸‹å‡ ç‚¹:

- è¿­ä»£å™¨å…·æœ‰ next() æ–¹æ³•, ç”¨æ¥è·å–ä¸‹ä¸€å…ƒç´ 
- next() æ–¹æ³•å…·æœ‰è¿”å›å€¼, è¿”å›ä¸€ä¸ªå¯¹è±¡, å¯¹è±¡ value å±æ€§ä»£è¡¨ä¸‹ä¸€ä¸ªå€¼, done å±æ€§è¡¨ç¤ºæ˜¯å¦éå†æ˜¯å¦ç»“æŸ
- å¦‚æœä¸€ä¸ªæ•°æ®ç»“æ„æœ¬èº«ä¸å…·å¤‡éå†å™¨, æˆ–è€…è‡ªå¸¦çš„éå†å™¨ä¸ç¬¦åˆä½¿ç”¨è¦æ±‚, è¯·æŒ‰æ­¤ä¾‹æ ¼å¼è‡ªå®šä¹‰ä¸€ä¸ªéå†å™¨ã€‚

å…¶å®ä¸€ä¸ª id ç”Ÿæˆå™¨å°±å¾ˆç±»ä¼¼ä¸€ä¸ªéå†å™¨:
```js
function idGen(){
  var id = 0;
  return {
    next: function(){ return id++; }
  };
}
var id = idGen();
console.log(id.next());   //0
console.log(id.next());   //1
console.log(id.next());   //2
//...
```

å¯¹äºå¤§å¤šæ•°æ•°æ®ç»“æ„, æˆ‘ä»¬ä¸éœ€è¦å†åƒè¿™æ ·å†™éå†å™¨å‡½æ•°äº†ã€‚å› ä¸ºä»–ä»¬å·²ç»æœ‰éå†å™¨å‡½æ•°`[Symbol.iterator]`, æ¯”å¦‚`Array.prototype[Symbol.iterator]` æ˜¯æ•°ç»„ç»“æ„çš„é»˜è®¤éå†å™¨ã€‚

ä¸‹é¢å®šä¹‰ä¸€ä¸ªä¸å®Œæ•´(ä»…åŒ…å«add()æ–¹æ³•)çš„é“¾è¡¨ç»“æ„çš„å®ä¾‹:
```js
function Node(value){
  this.value = value;
  this.next = null;
}
function LinkedList(LLName){
  this.head = new Node(LLName);
  this.tail = this.head;
}
var proto = {
  add: function(value){
    var newNode = new Node(value);
    this.tail = this.tail.next = newNode;
    return this;
  }
}
LinkedList.prototype = proto;
LinkedList.prototype.constructor = LinkedList;
LinkedList.prototype[Symbol.iterator] = function(){
  var cur = this.head;
  var curValue;
  return {
    next: function(){
      if(cur !== null){
        curValue = cur.value;
        cur = cur.next;
        return {value: curValue, done: false}
      } else {
        return {value: undefined, done: true}
      }
    }
  };
}

var ll = new LinkedList("prime");
ll.add(1).add(2).add(3).add(5).add(7).add(11);
for(let val of ll){
  console.log(val);    //ä¾æ¬¡è¾“å‡º 1, 2, 3, 5, 7, 11
}
```

æ³¨æ„, å¦‚æœéå†å™¨å‡½æ•°`[Symbol.iterator]`è¿”å›çš„ä¸æ˜¯å¦‚ä¸Šä¾‹æ‰€ç¤ºç»“æ„çš„å¯¹è±¡, ä¼šæŠ¥é”™ã€‚
å½“ç„¶, å¦‚æœä¸ä¸å–œæ¬¢ç”¨for...of(åº”è¯¥é²œæœ‰è¿™æ ·çš„äººå§), å¯ä»¥ç”¨ while éå†:
```js
var arr = [1, 2, 3, 5, 7];
var it = arr[Symbol.iterator];
var cur = it.next();
while(!cur.done){
  console.log(cur.value);
  cur = it.next();
}
```

ä»¥ä¸‹æ“ä½œä¼šåœ¨å†…éƒ¨è°ƒç”¨ç›¸åº”çš„ iterator:

- æ•°ç»„çš„è§£æ„èµ‹å€¼
- å±•å¼€è¿ç®—ç¬¦
- `yield*` åé¢å¸¦æœ‰ä¸€ä¸ªå¯éå†ç»“æ„
- for...of
- Array.from() å°†ç±»æ•°ç»„å¯¹è±¡è½¬æ¢ä¸ºæ•°ç»„
- Map(), Set(), WeakMap(), WeakSet() ç­‰æ„é€ å‡½æ•°ä¼ è¾“åˆå§‹å‚æ•°æ—¶
- Promise.all()
- Promise.race()

### Generator ä¸éå†å™¨

iterator ä½¿ç”¨ Generator å®ç°ä¼šæ›´ç®€å•:
```js
var it = {};
it[Symbol.iterator] = function* (){
  var a = 1, b = 1;
  var n = 10;
  while(n){
    yield a;
    [a, b] = [b, a + b];
    n--;
  }
}
console.log([...it]); //1, 1, 2, 3, 5, 8, 13, 21, 34, 55]
```
å½“ç„¶, ä»¥ä¸Šä»£ç è¿˜å¯ä»¥è¿™æ ·å†™:
```js
var it = {
  *[Symbol.iterator](){
    var a = 1, b = 1;
    var n = 10;
    while(n){
      yield a;
      [a, b] = [b, a + b];
      n--;
    }
  }
}
console.log([...it]); //[1, 1, 2, 3, 5, 8, 13, 21, 34, 55]
```

### éå†å™¨å¯¹è±¡çš„å…¶ä»–æ–¹æ³•

ä»¥ä¸Šçš„éå†å™¨å¯¹è±¡åªæåˆ°äº† next() æ–¹æ³•, å…¶å®éå†å™¨è¿˜æœ‰ throw() æ–¹æ³•å’Œ return() æ–¹æ³•:

- å¦‚æœéå†ç»ˆæ­¢(break, continue, returnæˆ–è€…å‡ºé”™), ä¼šè°ƒç”¨ return() æ–¹æ³•
- Generator è¿”å›çš„éå†å™¨å¯¹è±¡å…·throw() æ–¹æ³•, ä¸€èˆ¬çš„éå†å™¨ç”¨ä¸åˆ°è¿™ä¸ªæ–¹æ³•ã€‚å…·ä½“åœ¨ Generator ä¸­è§£é‡Šã€‚

```js
function readlineSync(file){
  return {
    next(){
      if(file.isAtEndOfFile()){
        file.close();
        return {done: true};
      }
    },
    return(){
      file.close();
      return {done: true};
    }
  }
}
```
ä¸Šé¢å®ç°äº†ä¸€ä¸ªè¯»å–æ–‡ä»¶å†…æ•°æ®çš„å‡½æ•°, å½“è¯»å–åˆ°æ–‡ä»¶ç»“å°¾è·³å‡ºå¾ªç¯, ä½†æ˜¯å½“å¾ªç¯è·³å‡ºå, éœ€è¦åšä¸€äº›äº‹æƒ…(å…³é—­æ–‡ä»¶), ä»¥é˜²å†…å­˜æ³„éœ²ã€‚è¿™ä¸ªå’Œ C++ ä¸­çš„ææ„å‡½æ•°ååˆ†ç±»ä¼¼, åè€…æ˜¯åœ¨å¯¹è±¡åˆ é™¤ååšä¸€äº›é‡Šæ”¾å†…å­˜çš„å·¥ä½œ, é˜²æ­¢å†…å­˜æ³„éœ²ã€‚

## Generator å‡½æ•°

### Generator

Generator å‡½æ•°æ˜¯ es6 ä¸­çš„æ–°çš„å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œæœ¬èŠ‚ä»…è®¨è®º Generator å‡½æ•°æœ¬èº«ï¼Œå¼‚æ­¥ç¼–ç¨‹æ”¾åœ¨åé¢çš„éƒ¨åˆ†ã€‚
Generator å‡½æ•°ä¹‹å‰ä¹Ÿæåˆ°è¿‡ï¼Œæè¿°å†…éƒ¨å°è£…çš„å¤šä¸ªçŠ¶æ€ï¼Œç±»ä¼¼ä¸€ä¸ªçŠ¶æ€æœºï¼Œå½“ç„¶ä¹Ÿæ˜¯å¾ˆå¥½çš„ iterator ç”Ÿæˆå™¨ã€‚Generator å‡½æ•°çš„åŸºæœ¬å½¢å¼å¦‚ä¸‹ï¼š
```js
function* gen(){
  yield status1;
  yield status2;
  //...
}
```
ä¸éš¾çœ‹å‡ºï¼ŒGenerator å‡½æ•°åœ¨ function å…³é”®å­—å’Œå‡½æ•°åä¹‹é—´åŠ äº†ä¸€ä¸ªæ˜Ÿå·"*", å†…éƒ¨ç”¨ yield è¿”å›æ¯ä¸€ä¸ªçŠ¶æ€ã€‚

å½“ç„¶è¿˜æœ‰å…¶ä»–æ ¼å¼çš„å®šä¹‰ï¼š
```js
//å‡½æ•°è¡¨è¾¾å¼
var gen = function*(){
  yield status1;
  //...
};

//å¯¹è±¡æ–¹æ³•
var obj = {
  *gen(){
    yield status1;
    //...
  }
};
```

Generator å‡½æ•°è°ƒç”¨æ—¶ï¼Œå†™æ³•å’Œæ™®é€šå‡½æ•°ä¸€æ ·ã€‚ä½†å‡½æ•°å¹¶ä¸æ‰§è¡Œæ‰§è¡Œæ—¶ï¼Œè¿”å›å†…éƒ¨è‡ªå¸¦ iteratorï¼Œä¹‹åè°ƒç”¨è¯¥ iterator çš„ next() æ–¹æ³•, å‡½æ•°ä¼šå¼€å§‹æ‰§è¡Œï¼Œå‡½æ•°æ¯æ¬¡æ‰§è¡Œé‡åˆ° yield å…³é”®å­—è¿”å›å¯¹åº”çŠ¶æ€ï¼Œå¹¶è·³å‡ºå‡½æ•°ï¼Œå½“ä¸‹ä¸€æ¬¡å†æ¬¡è°ƒç”¨ next() çš„æ—¶å€™ï¼Œå‡½æ•°ä¼šç»§ç»­ä»ä¸Šä¸€æ¬¡ yield è·³å‡ºçš„ä¸‹ä¸€è·³è¯­å¥ç»§ç»­æ‰§è¡Œã€‚å½“ç„¶ Generator å‡½æ•°ä¹Ÿå¯ä»¥ç”¨ return è¿”å›çŠ¶æ€ï¼Œä¸è¿‡æ­¤æ—¶ï¼Œå‡½æ•°å°±çœŸçš„è¿è¡Œç»“æŸäº†ï¼Œè¯¥éå†å™¨å°±ä¸å†å·¥ä½œäº†ï¼›å¦‚æœå‡½æ•°å†…éƒ¨æ‰€ä»¥çš„ yield éƒ½æ‰§è¡Œå®Œäº†ï¼Œè¯¥éå†å™¨ä¸€æ ·ä¸å†å·¥ä½œäº†ï¼š
```js
function* gen(){
  yield "hello";
  yield "world";
  return "ending";
}
var it = gen();
console.log(it.next());      //{value: "hello", done: false}
console.log(it.next());      //{value: "world", done: false}
console.log(it.next());      //{value: "ending", done: true}
console.log(it.next());      //{value: undefined, done: true}
```
æ³¨æ„:
- return è¿”å›çš„å€¼ï¼Œå¯¹åº”çš„ done å±æ€§æ˜¯ trueã€‚è¯´æ˜ returnè¯­å¥ç»“æŸäº†éå†ï¼Œiterator ä¸å†ç»§ç»­éå†ï¼Œå³ä¾¿åé¢è¿˜æœ‰ä»£ç å’Œ yieldã€‚
- Generator å‡½æ•°å¯ä»¥æ²¡æœ‰ yield è¿”å›å€¼ï¼Œæ­¤æ—¶å®ƒä¾ç„¶è¿”å›ä¸€ä¸ª iterator, å¹¶ä¸”åœ¨ iterator è°ƒç”¨ next æ–¹æ³•æ—¶ä¸€æ¬¡è¡Œæ‰§è¡Œå®Œå‡½æ•°å†…å…¨éƒ¨ä»£ç ï¼Œè¿”å›`{value: undefined, done: true}`ã€‚ å¦‚æœæœ‰ return è¯­å¥ï¼Œè¯¥è¿”å›å€¼å¯¹åº”çš„ value å±æ€§å€¼ä¸º return è¡¨è¾¾å¼çš„å€¼ã€‚
- æ™®é€šå‡½æ•°ä½¿ç”¨ yield è¯­å¥ä¼šæŠ¥é”™
- yield å¯ä»¥ç”¨ä½œå‡½æ•°å‚æ•°ï¼Œè¡¨è¾¾å¼å‚æ•°ï¼š
```js
function* gen(){
  console.log("hello" + (yield));    //yield ç”¨ä½œè¡¨è¾¾å¼å‚æ•°å¿…é¡»åŠ ()
  let input = yield;
  foo(yield 'a', yield 'b');
}
```
- Generator å‡½æ•°çš„é»˜è®¤éå†å™¨`[Symbol.iterator]`æ˜¯å‡½æ•°è‡ªå·±ï¼š
```js
function* gen(){}
var g = gen()
g[Symbol.iterator]() === g;    //true
```

### next() å‚æ•°

yield è¯­å¥æœ¬èº«å…·æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼æ˜¯ä¸‹ä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•æ˜¯ä¼ å…¥çš„å€¼ã€‚next æ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œé»˜è®¤ undefinedï¼š
```js
function* f(){
  for(let i = 0; true; i++){
    var reset = yield i;
    if(reset) i = -1;
  }
}
var g = f();
console.log(g.next().value)          //0
console.log(g.next().value)          //1
console.log(g.next().value)          //2
console.log(g.next(true).value)      //0
```
ä¸Šé¢ ä»£ç ç¬¬3è¡Œ`var reset =  yield i`ç­‰å·å³ä¾§æ˜¯åˆ©ç”¨ yield è¿”å›i, ç”±äºèµ‹å€¼è¿ç®—æ—¶å³ç»“åˆçš„ï¼Œè¿”å› i ä»¥åï¼Œå‡½æ•°æš‚åœæ‰§è¡Œï¼Œèµ‹å€¼å·¥ä½œæ²¡æœ‰å®Œæˆã€‚ä¹‹åå†æ¬¡è°ƒç”¨ next æ–¹æ³•æ—¶ï¼Œå°†è¿™æ¬¡ä¼ å…¥å‚æ•°ä½œä¸ºåˆšæ‰è¿™ä¸ª yield çš„è¿”å›å€¼èµ‹ç»™äº† reset, å› æ­¤è®¡æ•°å™¨è¢«é‡ç½®ã€‚
```js
function* foo(x){
  var y = 2 * (yield (x + 1));
  var z = yield (y / 3);
  return (x + y + z);
}
var g = foo(5);
console.log(g.next());          //{value: 6, done: false}
console.log(g.next(12));        //{value: 8, done: false}
console.log(g.next(13));        //{value: 42, done: true}
```
ç¬¬ä¸€æ¬¡è°ƒç”¨ next å‡½æ•°ä¸éœ€è¦å‚æ•°ï¼Œä½œä¸º Generator å¯åŠ¨ï¼Œå¦‚æœå¸¦äº†å‚æ•°ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚å½“ç„¶ï¼Œå¦‚æœä¸€å®šæƒ³åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ next æ—¶å€™å°±èµ‹å€¼ï¼Œå¯ä»¥å°† Generator å‡½æ•°å°è£…ä¸€ä¸‹ï¼š
```js
//ä¸€ç§ä¸å®Œå–„çš„æ€è·¯ï¼Œé€šå¸¸ä¸å¼ºæ±‚è¿™æ ·åš
function wrapper(gen){
  return function(){
    let genObj = gen(...arguments);
    genObj.next();       //æå‰å…ˆå¯åŠ¨ä¸€æ¬¡ï¼Œä½†å¦‚æœæ­¤æ—¶å¸¦æœ‰è¿”å›å€¼ï¼Œè¯¥å€¼å°±ä¸¢äº†ï¼
    return genObj;
  }
}
var gen = wrapper(function*(){
  console.log(`first input: "${yield}"`);
});
var it = gen();
it.next("Bye-Bye");       //first input: "Bye-Bye"
```

### for...of

æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œä¹‹å‰åœ¨ iterator ä¸­ï¼Œè¿­ä»£å™¨æœ€åè¿”å›`{value: undefined, done: true}`ï¼Œå…¶ä¸­å€¼ä¸º undefined å’Œ done ä¸º true æ˜¯åŒæ—¶å‡ºç°çš„ï¼Œè€Œéå†ç»“æœä¸åŒ…å« done ä¸º true æ—¶å¯¹åº”çš„ value å€¼ï¼Œæ‰€ä»¥ Generator çš„ for...of å¾ªç¯æœ€å¥½ä¸è¦ç”¨ return è¿”å›å€¼ï¼Œå› ä¸ºè¯¥å€¼å°†ä¸ä¼šè¢«éå†ï¼š
```js
function* gen(){
  for(var i = 0; i < 5; i++){
    yield i;
  }
  return 5;
}
for(let v of gen()){
  console.log(v);       //ä¾æ¬¡è¾“å‡º 0, 1, 2, 3, 4, æ²¡æœ‰ 5
}
```

é™¤äº† for...of, Generator è¿˜æœ‰å¾ˆå¤šç®€å•ç”¨æ³•ã€‚ä¸‹é¢åˆ©ç”¨ fibonacci æ•°åˆ—ï¼Œæ¼”ç¤ºå‡ ç§ä¸åŒçš„ Generator ç”¨æ³•:

- å±•å¼€è¿ç®—ç¬¦
```js
function* fib(n = Infinity){
  var a = 1, b = 1;
  while(n){
    yield a;
    [a, b] = [b, a + b];
    n--;
  }
}
console.log([...fib(10)]); //1, 1, 2, 3, 5, 8, 13, 21, 34, 55]
```
- è§£æ„èµ‹å€¼
```js
function* fib(n = Infinity){
  var a = 1, b = 1;
  while(n){
    yield a;
    [a, b] = [b, a + b];
    n--;
  }
}
var [a, b, c, d, e, f] = fib();  //a=1, b=1, c=2, d=3, e=5, f=8
```
- æ„é€ å‡½æ•°å‚æ•°
```js
function* fib(n = Infinity){
  var a = 1, b = 1;
  while(n){
    yield a;
    [a, b] = [b, a + b];
    n--;
  }
}
var set = new Set(fib(n));
console.log(set);  //Set(9) [1, 2, 3, 5, 8, 13, 21, 34, 55]
```
- Array.fromæ–¹æ³•
```js
function* fib(n = Infinity){
  var a = 1, b = 1;
  var n = 10;
  while(n){
    yield a;
    [a, b] = [b, a + b];
    n--;
  }
}
var arr = Array.from(fib(10));
console.log(arr);    //[1, 1, 2, 3, 5, 8, 13, 21, 34, 55]
```
- éå†å¯¹è±¡
```js
function* entries(obj){
  for(let key of Object.keys(obj)){
    yield [key, obj[key]];
  }
}
var obj = {
  red: "#ff0000",
  green: "#00ff00",
  blue: "#0000ff"
};
for(let [key, value] of entries(obj)){
  console.log(`${key}: ${value}`);        //ä¾æ¬¡è¾“å‡º "red: #ff0000", "green: #00ff00", "blue: #0000ff"
}
```

### throw() æ–¹æ³•å’Œ return() æ–¹æ³•

Generator è¿”å›çš„éå†å™¨å¯¹è±¡å…·throw() æ–¹æ³•, ä¸€èˆ¬çš„éå†å™¨ç”¨ä¸åˆ°è¿™ä¸ªæ–¹æ³•ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°ä½œä¸ºæŠ›å‡ºçš„é”™è¯¯ï¼Œè¯¥é”™è¯¯å¯ä»¥åœ¨ Generator å†…éƒ¨æ•è·ï¼š
```js
function* gen(){
  while(1){
    try{
      yield "OK";
    } catch(e) {
      if(e === 'a') console.log(`å†…éƒ¨æ•è·: ${e}`);    //å†…éƒ¨æ•è·: a
      else throw e;
    }
  }
}
var it = gen();
it.next();              //å¦‚æœæ²¡æœ‰è¿™ä¸€è¡Œå¯åŠ¨ç”Ÿæˆå™¨ï¼Œç»“æœä»…è¾“å‡ºï¼šå¤–éƒ¨æ•è·: a
try{
  it.throw('a');
  it.throw('b');
  it.next();            //ä¸Šä¸€è¡Œé”™è¯¯ä¸ºå¤–éƒ¨æ•è·ï¼Œtry ä¸­çš„ä»£ç ä¸åœ¨ç»§ç»­æ‰§è¡Œï¼Œæ•…è¿™ä¸€è¡Œä¸æ‰§è¡Œ
} catch(e) {
  console.log(`å¤–éƒ¨æ•è·: ${e}`)    //å¤–éƒ¨æ•è·: b
}
```
throwå‚æ•°åœ¨ä¼ é€’è¿‡ç¨‹ä¸­å’Œ next å‚æ•°ç±»ä¼¼ï¼Œéœ€è¦å…ˆè°ƒç”¨ä¸€æ¬¡ next æ–¹æ³•å¯åŠ¨ç”Ÿæˆå™¨ï¼Œä¹‹åæŠ›å‡ºçš„é”™è¯¯ä¼šåœ¨å‰ä¸€ä¸ª yield çš„ä½ç½®è¢«æ•è·:
```js
function* gen(){
  yield "OK";             //é”™è¯¯è¢«æŠ›åˆ°è¿™é‡Œï¼Œä¸åœ¨å†…éƒ¨ try è¯­å¥å†…æ— æ³•æ•è·
  while(1){
    try{
      yield "OK";
    } catch(e) {
      console.log(`å†…éƒ¨æ•è·: ${e}`);
    }
  }
}
var it = gen();
it.next();
try{
  it.throw('a');
} catch(e) {
  console.log(`å¤–éƒ¨æ•è·: ${e}`)    //å¤–éƒ¨æ•è·: a
}
```
æ³¨æ„: ä¸è¦æ··ç”¨ throw() æ–¹æ³•å’Œ throw è¯­å¥ï¼Œåè€…æ— æ³•å°†é”™è¯¯æŠ›åˆ°ç”Ÿæˆå™¨å†…éƒ¨ã€‚å…¶æ¬¡ï¼Œthrow ä¼šç»ˆæ­¢éå†å™¨ï¼Œä¸èƒ½ç»§ç»­å·¥ä½œï¼Œè€Œ throw ä¸ä¼šç»ˆæ­¢éå†å™¨ï¼š
```js
function* gen(){
  yield console.log("hello");
  yield console.log("world");
}

//throw è¯­å¥
var it1 = gen();
it1.next();           //hello
try{
  throw new Error();
} catch(e) {
  it1.next()         //world
}

//throw() æ–¹æ³•
var it2 = gen();
it2.next();           //hello
try{
  it2.throw();
} catch(e) {
  it2.next()         //éå†å™¨è¢«å…³é—­æ— æ³•æ‰§è¡Œ, é™é»˜å¤±è´¥
}
```

å¦‚æœåœ¨éå†å™¨å†…éƒ¨æŠ›å‡ºé”™è¯¯ï¼Œéå†å™¨ä¸­æ­¢ï¼Œç»§ç»­è°ƒç”¨ next() æ–¹æ³•å°†å¾—åˆ°`{value: undefined, done: true}`:
```js
function* gen(){
  var x = yield "ok";
  var y = yield x.toUpperCase();
  var z = yield (x + y + z);
}

//throw è¯­å¥
var it = gen();
it.next();           //"ok"
try{
  it.next();
} catch(e) {
  console.log("Error Caught");   //Error Caught
} finally {
  it.next();         //{value: undefined, done: true}
}
```

return() æ–¹æ³•è¿”å›æŒ‡å®šçš„å€¼ï¼Œå¹¶ç»ˆæ­¢è¿­ä»£å™¨:
```js
var it = (function* gen(){
  yield 1;
  yield 2;
  yield 3;
}());
console.log(it.next());           //{value: 1, done: false}
console.log(it.next());           //{value: 2, done: false}
console.log(it.return("end"));    //{value: "end", done: true}
console.log(it.next());           //{value: undefined, done: true}
```
å¦‚æœä¸ç»™ return() æ–¹æ³•æä¾›å‚æ•°ï¼Œé»˜è®¤æ˜¯ undefined
å¦‚æœ Generator ä¸­æœ‰ try...finally è¯­å¥ï¼Œreturn ä¼šåœ¨ finally æ‰§è¡Œå®Œå†æ‰§è¡Œï¼š
```js
function* numbers(){
  yield 1;
  try{
    yield 2;
    yield 3;
  } finally {
    yield 4;
    yield 5;
  }
  yield 6;
}
var g = numbers();
console.log(g.next().value);          //1
console.log(g.next().value);          //2
console.log(g.return("end").value);   //å»¶è¿Ÿåˆ° finally ä¹‹åè¾“å‡º -----
console.log(g.next().value);          //4                         |
console.log(g.next().value);          //5                         |
                                      //"end" <-------------------
console.log(g.next().value);          //undefined
```

### yield* è¯­å¥

åœ¨ä¸€ä¸ª Generator ä¸­è°ƒç”¨å¦ä¸€ä¸ª Generator å‡½æ•°é»˜è®¤æ˜¯æ²¡æœ‰æ•ˆæœçš„:
```js
function* gen(){
  yield 3;
  yield 2;
}
function* fun(){
  yield gen();
  yield 1;
}
var it = fun();
console.log(it.next().value);    //gen å‡½æ•°è¿”å›çš„éå†å™¨
console.log(it.next().value);    //1
console.log(it.next().value);    //undefined
```
æ˜¾ç„¶ç¬¬ä¸€æ¬¡è¿”å›çš„ç»“æœä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚éœ€è¦ä½¿ç”¨ yield* è§£å†³è¿™ä¸ªé—®é¢˜ã€‚yield* å°†ä¸€ä¸ªå¯éå†ç»“æ„è§£æ„ï¼Œå¹¶é€ä¸€è¿”å›å…¶ä¸­çš„æ•°æ®ã€‚
```js
function* gen(){
  yield 3;
  yield 2;
}
function* fun(){
  yield* gen();
  yield 1;
}
var it = fun();
console.log(it.next().value);    //3
console.log(it.next().value);    //2
console.log(it.next().value);    //1
```
```js
function* fun(){
  yield* [4,3,2];
  yield 1;
}
var it = fun();
console.log(it.next().value);    //4
console.log(it.next().value);    //3
console.log(it.next().value);    //2
console.log(it.next().value);    //1
```

è¢«ä»£ç†çš„ Generator å¯ä»¥ç”¨returnå‘ä»£ç†å®ƒçš„ Generator è¿”å›å€¼ï¼š
```js
function* gen(){
  yield "Bye";
  yield* "Hi"
  return 2;
}
function* fun(){
  if((yield* gen()) === 2) yield* "ok";
  else yield "ok";
}
var it = fun();
console.log(it.next().value);    //Bye
console.log(it.next().value);    //H
console.log(it.next().value);    //i
console.log(it.next().value);    //o
console.log(it.next().value);    //k
console.log(it.next().value);    //undefined
```

ä¸¾ä¾‹ï¼š
1. æ•°ç»„æ‰å¹³åŒ–
```js
//æ–¹æ³•1ï¼š
var arr = [1,2,[2,[3,4],2],[3,4,[3,[6]]]];
function plat(arr){
  var temp = [];
  for(let v of arr){
    if(Array.isArray(v)){
      plat(v);
    } else {
      temp.push(v);
    }
  }
  return temp;
}
console.log(plat(arr));              //[1, 2, 2, 3, 4, 2, 3, 4, 3, 6]

//æ–¹æ³•2ï¼š
function* plat2(arr){
  for(let v of arr){
    if(Array.isArray(v)){
      yield* plat2(v);
    } else {
      yield v;
    }
  }
}
var temp = [];
for(let x of plat2(arr)){
  temp.push(x);
}
console.log(temp);                    //[1, 2, 2, 3, 4, 2, 3, 4, 3, 6]
```
2. éå†äºŒå‰æ ‘
```js
//èŠ‚ç‚¹
function Node(value, left, right){
  this.value = value;
  this.left = left;
  this.right = right;
}

//äºŒå‰æ ‘
function Tree(arr){
  if(arr.length === 1){
    return new Node(arr[0], null, null);
  } else {
    return new Node(arr[1], Tree(arr[0]), Tree(arr[2]));
  }
}
var tree = Tree([[[1], 4, [5]], 2, [[[0], 6, [9]], 8, [7]]]);

//å‰åºéå†
function* preorder(tree){
  if(tree){
    yield tree.value;
    yield* preorder(tree.left);
    yield* preorder(tree.right);
  }
}
//ä¸­åºéå†
function* inorder(tree){
  if(tree){
    yield* inorder(tree.left);
    yield tree.value;
    yield* inorder(tree.right);
  }
}
//ååºéå†
function* postorder(tree){
  if(tree){
    yield* postorder(tree.left);
    yield* postorder(tree.right);
    yield tree.value;
  }
}

var _pre = [], _in = [], _post = [];
for(let v of preorder(tree)){
  _pre.push(v);
}
for(let v of inorder(tree)){
  _in.push(v);
}
for(let v of postorder(tree)){
  _post.push(v);
}
console.log(_pre);     //[2, 4, 1, 5, 8, 6, 0, 9, 7]
console.log(_in);      //[1, 4, 5, 2, 0, 6, 9, 8, 7]
console.log(_post);    //[1, 5, 4, 0, 9, 6, 7, 8, 2]
```
3. Generator å®ç°çŠ¶æ€æœº:
```js
//ä¼ ç»Ÿå®ç°æ–¹æ³•
var clock1 = function(){
  var ticking = false;
  return {
    next: function(){
      ticking = !ticking;
      if(ticking){
        return "Tick";
      }else{
        return "Tock";
      }
    }
  }
};
var ck1 = clock1();
console.log(ck1.next());      //Tick
console.log(ck1.next());      //Tock
console.log(ck1.next());      //Tick

//Generator æ–¹æ³•
var clock2 = function*(){
  while(1){
    yield "Tick";
    yield "Tock";
  }
};
var ck2 = clock2();
console.log(ck2.next().value);      //Tick
console.log(ck2.next().value);      //Tock
console.log(ck2.next().value);      //Tick
```
### Generator å‡½æ•°ä¸­çš„ this

åœ¨ES6ä¸­, è§„å®šäº†æ‰€æœ‰ iterator æ˜¯ Generator å‡½æ•°çš„å®ä¾‹ï¼š
```js
function* gen(){}
var it = gen();
it instanceof gen;                                  //true
console.log(gen.__proto__);                         //GeneratorFunction
console.log(gen.__proto__.__proto__);               //Function
console.log(gen.constructor);                       //GeneratorFunction
console.log(gen.__proto__.constructor);             //GeneratorFunction
gen.prototype.sayHello = function(){
  console.log("hello");
}
it.sayHello();     //"hello"
```

ä½†æ˜¯ Generator å‡½æ•°ä¸­çš„ this å¹¶ä¸æŒ‡å‘ç”Ÿæˆçš„ iteratorï¼š
```js
function* gen(){
  this.num = 11;
  console.log(this);
}
var it = gen();
console.log(it.num);     //undefined
it.next();               //Window

var obj = {
  * fun(){
    console.log(this);
  }
}
var o_it = obj.fun();
o_it.next();              //obj
```
ç”±ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸éš¾çœ‹å‡ºï¼ŒGenerator å‡½æ•°ä¸­çš„ this å’Œæ™®é€šå‡½æ•°æ˜¯ä¸€æ ·çš„ã€‚ä¸è¿‡ï¼Œå¯ä¸å¯ä»¥æŠŠ Generator å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°å‘¢ï¼Ÿæ˜¾ç„¶æ˜¯ä¸è¡Œçš„:
```js
function* gen(){
  this.num = 11;
}
gen.prototype.say = function(){console.log("hello")}
var a = new gen();    //TypeError: gen is not a constructor
```

### Generator å‡½æ•°æ¨å¯¼

ES7 åœ¨æ•°ç»„æ¨å¯¼çš„åŸºç¡€ä¸Šæå‡ºäº† Generator å‡½æ•°æ¨å¯¼ï¼Œå¯æƒœè¿™ä¸ªåŠŸèƒ½ç›®å‰è¿˜ä¸èƒ½ä½¿ç”¨ï¼š
```js
let gen = function*(){
  for(let i = 0; i < 6; i++){
    yield i;
  }
};
let arr = [for(let n of gen()) n * n];
//ç›¸å½“äºï¼š
let arr = Array.from(gen()).map(n => n * n);
console.log(arr); [0,1,4,9,16,25]
```
Generator æ•°ç»„æ¨å¯¼ï¼Œåˆ©ç”¨æƒ°æ€§æ±‚å€¼ä¼˜åŒ–ç³»ç»Ÿèµ„æºåˆ©ç”¨ï¼š
```js
var bigArr = new Array(10000);
for(let i = 0; i < 10000; i++){
  bigArr.push(i);
}
//....å…¶ä»–ä»£ç 
//ä½¿ç”¨ bigArr ä¹‹å‰å¾ˆä¹…å°±åˆ†é…äº†å†…å­˜
console.log(bigArr[100]);

var gen = function*(){
  for(let i = 0; i < 10000; i++){
    yield i;
  }
};
//....å…¶ä»–ä»£ç 
//ä½¿ç”¨ bigArr æ—¶æ‰åˆ†é…å†…å­˜
var bigArr = [for(let n of gen()) n];
console.log(bigArr[100]);
```

### åº”ç”¨ä¸¾ä¾‹

ä¼˜åŒ–å›è°ƒå‡½æ•°
```js
//ä¼ªä»£ç 
function* main(){
  var result = yield request("http://url.com");
  var res = JSON.parse(result);
  console.log(res.value);
}
function request(url){
  var xhr = new XMLHttpRequest();
  xhr.open("GET", url);
  xhr.onreadystatechange = function(){
    if(xhr.readyState == 4 && xhr.status == 200){
      it.next(xhr.response);
    }
  }
  xhr.send();
}
var it = main();
it.next();
```
å¦ä¸€ä¸ªä¾‹å­ï¼š
```js
//ä¼ªä»£ç 
//é‡åˆ°å¤šé‡å›è°ƒå‡½æ•°ï¼Œä¼ ç»Ÿå†™æ³•ï¼š
step1(function(value1){
  step2(value1, function(value2){
    step3(value2, function(value3){
      step4(value3, function(value4){
        //do something
      });
    });
  });
});
//åˆ©ç”¨ Generator å†™ï¼š
function* gen(){
  try{
    var value1 = yield step1();
    var value2 = yield step2(value1);
    var value3 = yield step3(value2);
    var value4 = yield step4(value3);
  } catch(e) {
    //Handle the error form step1 to step4
  }
}
```

## Promise å¯¹è±¡

### Promise å»ºç«‹

Promise å¯¹è±¡ç”¨æ¥ä¼ é€’å¼‚æ­¥æ“ä½œæ¶ˆæ¯ï¼Œä»£è¡¨ä¸€ä¸ªæœªæ¥æ‰ä¼šçŸ¥é“ç»“æœçš„äº‹ä»¶ï¼Œå¹¶ä¸”å¯¹ä¸åŒäº‹ä»¶æä¾›ç»Ÿä¸€çš„ API ä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†ã€‚Promise å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- ç”±å¼‚æ­¥æ“ä½œç»“æœå†³å®šæ”¹çŠ¶æ€ï¼Œå…¶ä»–æ“ä½œç»ä¸å½±å“è¯¥çŠ¶æ€ï¼›
- å¯¹è±¡çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ï¼šPromise ä»£è¡¨çš„å¼‚æ­¥æ“ä½œæœ‰ä¸‰ä¸ªçŠ¶æ€ï¼š
1. Pending: è¿›è¡Œä¸­
2. Resolved: å·²å®Œæˆ(Fulfilled)
3. Rejected: å·²å¤±è´¥
- ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼šPromise çš„çŠ¶æ€åªæœ‰2ç§å¯èƒ½ï¼š
1. ä» Pending åˆ° Resolved
2. ä» Pending åˆ° Rejected

å¯¹äºåŒä¸€ä¸ª promise, å½“ä»¥ä¸ŠçŠ¶æ€å‘ç”Ÿä¸€ä¸ª(åªèƒ½å‘ç”Ÿå…¶ä¸€)ï¼Œå°±ä¸ä¼šå†æ”¹å˜äº†ã€‚ä¹‹åä»»ä½•æ—¶é—´ä½ éƒ½èƒ½å¾—åˆ°è¿™ä¸ªçŠ¶æ€ï¼Œä¸”æ°¸ä¸æ”¹å˜ã€‚
æœ‰äº† Promise å°±å¯ä»¥å°†å±‚å±‚çš„å›è°ƒå†™ä¸ºåŒæ­¥çš„æ ·å­ï¼Œè¡¨ç¤ºèµ·æ¥æ›´æ¸…æ™°ã€‚ä¸è¿‡éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

- Promise ä¸€æ—¦å»ºç«‹å°±ç«‹å³æ‰§è¡Œï¼Œå¹¶ä¸”æ— æ³•ä¸­æ–­æˆ–å–æ¶ˆ
- å¦‚æœæ²¡æœ‰è®¾ç½®å›è°ƒå‡½æ•°ï¼Œé‚£ä¹ˆ Promise ä¸­çš„äº§ç”Ÿçš„é”™è¯¯ä¸ä¼šæŠ›åˆ°å¤–éƒ¨
- Pending çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬æ— æ³•çŸ¥é“å…¶å…·ä½“è¿›åº¦

Promise çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š
```js
var promise = new Promise(function(resolve, reject){
  if(/*å¼‚æ­¥æ“ä½œæˆåŠŸ*/){
    resolve(value);
  } else {
    reject(error);
  }
});
```
æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸ºå‚æ•°ï¼Œå›è°ƒå‡½æ•°å…·æœ‰2ä¸ªå‚æ•°ï¼Œä¹Ÿéƒ½æ˜¯å‡½æ•°ï¼Œresolve åœ¨ Promise çŠ¶æ€å˜ä¸º resolved æ—¶è°ƒç”¨ï¼Œreject åœ¨  Promise çŠ¶æ€å˜ä¸º rejected æ—¶è°ƒç”¨ã€‚resolve çš„æ¥å—ä¸€ä¸ªå‚æ•°â€”â€”å€¼æˆ–å¦ä¸€ä¸ª promise å¯¹è±¡ï¼› rejectjæ¥å—ä¸€ä¸ªå‚æ•°â€”â€”é”™è¯¯ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™é‡Œçš„ resole å’Œ reject å‡½æ•°å·²ç»ç”±ç³»ç»Ÿéƒ¨ç½²å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å†™ã€‚

promise æ„å»ºå¥½ä»¥åæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨å®ƒçš„`then()`æ–¹æ³•ï¼Œ`then(resolve(value){},reject(value){})`æ–¹æ³•æ¥å—2ä¸ªå‡½æ•°å‚æ•°ï¼Œresolve åœ¨ Promise çŠ¶æ€å˜ä¸º resolved æ—¶è°ƒç”¨ï¼Œreject åœ¨  Promise çŠ¶æ€å˜ä¸º rejected æ—¶è°ƒç”¨ã€‚å…¶ä¸­ reject å‚æ•°æ˜¯å¯é€‰çš„ã€‚å’Œæ„é€ å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œthen æ–¹æ³•çš„ reject å’Œ resolve éƒ½ä½¿ç”¨ promise ä¼ å‡ºçš„å€¼ä½œä¸ºå…¶å”¯ä¸€çš„å‚æ•°ã€‚

è¿™é‡Œå†™ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç†è§£ä¸€ä¸‹ï¼š
```js
function timeout(ms){
  return new Promise((resolve, reject) => {
    console.log("promise");            //"promise"
    setTimeout(resolve, ms, 'done');
  });
}
timeout(2000).then((value) => {
  console.log(value);                  //2ç§’åå¾—åˆ° "done"
});
```

åˆ©ç”¨ Promise å¼‚æ­¥åŠ è½½å›¾ç‰‡ï¼š
```js
function loadImageAsync(url){
  return new Promise(function(resole, reject){
    var image = new Image();
    image.onload = function(){
      resolve(image);
    };
    image.onerror = function(){
      reject(new Error(`Could not load image at ${url}`));
    };
    image.src = url;
  });
}
```

åˆ©ç”¨ Promise å®ç° Ajaxï¼š
```js
  var id = document.getElementById("primary");
  var getJSON = function(url){
    var promise = new Promise(function(resolve, reject){
      var client = new XMLHttpRequest();
      client.open("GET", url);
      client.onreadystatechange = handler;
      client.response = "json";
      client.setRequestHeader("Accept", "application/json");
      client.send();

      function handler(){
        if(client.readyState !== 4) return;
        if(this.status === 200){
          resolve(client.response);
        } else {
          reject(new Error(this.statusText));
        }
      }
    });
    return promise;
  }
  getJSON('info.json').then(
    json => id.innerHTML = "<pre>" + json + "</pre>",
    err => id.innerHTML = err
  );
```

å¦‚æœ resolve çš„å‚æ•°æ˜¯ä¸€ä¸ªpromiseï¼š
```js
var p1 = new Promise(function(resolve, reject){
  //...
});
var p2 = new Promise(function(resolve, reject){
  //...
  resolve(p1);
});
```
ä¸Šé¢ä»£ç ä¸­ p1 çš„çŠ¶æ€ä¼ ç»™äº† p2ï¼Œä¹Ÿå°±æ˜¯p1è¿è¡Œå®Œæˆ(çŠ¶æ€ä¸º resolve æˆ– reject)å p2 çš„å›è°ƒå‡½æ•°ä¼šç«‹åˆ»å¼€å§‹æ‰§è¡Œï¼š
```js
var p1 = new Promise(function(resolve, reject){
  setTimeout(() => reject(new Error('failed')), 3000);
});
var p2 = new Promise(function(resolve, reject){
  setTimeout(() => resolve(p1), 1000);
});
p2.then(result => console.log(result));
p2.catch(error => console.log(error));
```
p1 å»ºç«‹ï¼Œè¿›å…¥ setTimeout å¼‚æ­¥è®¡æ—¶å™¨ã€‚ä¹‹å p2 å»ºç«‹ï¼Œè¿›å…¥ setTimeout å¼‚æ­¥è®¡æ—¶å™¨ã€‚1s å p2 å‡†å¤‡æ‰§è¡Œ resolve, ä½†æ˜¯ resolve çš„å‚æ•°æ˜¯ p1, æ­¤æ—¶ p1 è¿˜æ˜¯ Pending çŠ¶æ€ï¼Œæ‰€ä»¥ p2 å¼€å§‹ç­‰å¾…ã€‚åˆè¿‡äº† 2s, p1 çš„ reject æ‰§è¡Œï¼Œå˜ä¸º rejected çŠ¶æ€ï¼Œéšå³ p2 ä¹Ÿè·Ÿç€å˜æˆ rejected çŠ¶æ€ã€‚

### Promise å¯¹è±¡æ–¹æ³•

- then() æ–¹æ³•
`then(resolve(value){},reject(value){})`æ–¹æ³•æ¥å—2ä¸ªå‡½æ•°å‚æ•°ï¼Œresolve åœ¨ Promise çŠ¶æ€å˜ä¸º resolved æ—¶è°ƒç”¨ï¼Œreject åœ¨  Promise çŠ¶æ€å˜ä¸º rejected æ—¶è°ƒç”¨ã€‚å…¶ä¸­ reject å‚æ•°æ˜¯å¯é€‰çš„ã€‚å’Œæ„é€ å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œthen æ–¹æ³•çš„ reject å’Œ resolve éƒ½ä½¿ç”¨ promise ä¼ å‡ºçš„å€¼ä½œä¸ºå…¶å”¯ä¸€çš„å‚æ•°ã€‚
`then()` æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼Œæ³¨æ„ï¼Œä¸æ˜¯ä¹‹å‰é‚£ä¸ªã€‚å› æ­¤å¯ä»¥ç”¨é“¾å¼è°ƒç”¨ï¼Œä¸æ–­æ·»åŠ "å›è°ƒ"å‡½æ•°ã€‚ then çš„è¿”å›å€¼æˆäº†ä¸‹ä¸€ä¸ª then ä¸­å›è°ƒå‡½æ•°çš„å‚æ•°ï¼š
```js
var p = new Promise(function(resolve, reject){
  resolve("from new Promise");
}).then(function (value){
  console.log(value);     //from new Promise    å…¶æ¬¡è¾“å‡ºè¿™ä¸ª
  return "from the first 'then'";
}).then(function(value){
  console.log(value);     //from the first 'then'    æœ€åè¾“å‡ºè¿™ä¸ª
  return "from the second 'then'";
});
console.log(p);           //Promise{...}    å…ˆè¾“å‡ºè¿™ä¸ª
```
æ³¨æ„ï¼Œå¦‚æœ promise çš„çŠ¶æ€æ˜¯ resolved åˆ™æ‰§è¡Œ thenå‚æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼›å¦‚æœ promise çš„çŠ¶æ€æ˜¯ rejected åˆ™æ‰§è¡Œ thenå‚æ•°ä¸­çš„ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ã€‚è¿™ä¸ªçŠ¶æ€æ˜¯ä¸æ–­ä¼ é€’ä¸‹æ¥çš„ï¼Œè¿™ä¸€ç‚¹å’Œä¹‹å‰çš„ä¾‹å­ç±»ä¼¼ã€‚

- catch() æ–¹æ³•:
catch(reject) æ–¹æ³•æ˜¯ `then(null, reject)` çš„åˆ«åï¼Œåœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æ‰§è¡Œå…¶å‚æ•°å‡½æ•°:
```js
new Promise(function(resolve, reject){
  resolve("resolved");
}).then(function(val){
  console.log(val);           //resolved
  throw new Error("man-made Error");
}).catch(function(err){
  console.log(err.message);   //man-made Error
});
```
é”™è¯¯ä¼šä»æœ€åˆçš„è¯·æ±‚æ²¿ç€å›è°ƒå‡½æ•°ï¼Œä¸€ç›´è¢«ä¼ é€’ä¸‹æ¥ã€‚è¿™ä¸€ç‚¹å’Œä¼ ç»Ÿçš„é”™è¯¯å†’æ³¡ç±»ä¼¼ï¼Œæ— è®ºå“ªé‡Œæœ‰é”™è¯¯éƒ½å¯ä»¥è¢«æ•è·åˆ°ï¼š
```js
new Promise(function(resolve, reject){
  reject(new Error("original Error"));
}).then(function(val){
  console.log(val);           //ä¸æ‰§è¡Œ
  throw new Error("man-made Error");
}).catch(function(err){
  console.log(err.message);   //original Error
});
```
å½“ç„¶ä¹Ÿå¯ä»¥åœ¨åŠè·¯æˆªä½é”™è¯¯ï¼š
```js
new Promise(function(resolve, reject){
  reject(new Error("original Error"));
}).then(function(val){
  console.log(val);           //ä¸æ‰§è¡Œ
  throw new Error("man-made Error");
}, function(err){
  console.log(`Uncaught Error: ${err.message}`);  //Uncaught Error: original Error
}).catch(function(err){
  console.log(err.message);   //ä¸æ‰§è¡Œ
});
```
è¿™é‡Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š
1. reject å’Œ throw ä¸€æ ·å¯ä»¥æŠ›å‡ºé”™è¯¯ã€‚
2. åœ¨ Promise çŠ¶æ€å˜ä¸º resolved æˆ– rejected ä¹‹åæŠ›å‡ºçš„é”™è¯¯ä¼šè¢«å¿½ç•¥ã€‚
3. å»ºè®®æ€»æ˜¯ä½¿ç”¨ catch() æ–¹æ³•ï¼Œè€Œä¸è¦åœ¨ then() æ–¹æ³•ä¸­å®šä¹‰ reject å‡½æ•°ã€‚
4. å¦‚æœä¸€ä¸ª promise æ—¢æ²¡æœ‰ catchæ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰å¯ä»¥æ•è·åˆ°é”™è¯¯çš„ then æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªé”™è¯¯å°±æ¶ˆå¤±äº†ã€‚å®ƒä¸ä¼šåˆ° promise å¤–é¢æ¥ã€‚
5. try...catch... åªèƒ½æ•è·åŒæ­¥ä»£ç çš„é”™è¯¯ï¼Œä¸èƒ½æ•è·å¼‚æ­¥ä»£ç çš„é”™è¯¯(è¿™ä¸ªæ˜¯ ES5 å°±æœ‰çš„)ã€‚
6. catch() æ–¹æ³•å¯ä»¥ç»§ç»­æŠ›å‡ºé”™è¯¯ï¼Œå°±åƒ try...catch ä¸­çš„ catch ä¸€æ ·å¯ä»¥æŠ›å‡ºé”™è¯¯ã€‚
è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ç¬¬4æ¡ï¼šé”™è¯¯ä¸ä¼šåˆ° Promise å¤–é¢æ˜¯ ES6 è§„èŒƒçš„è¯´æ³•ã€‚å…·ä½“ç†è§£(æµè§ˆå™¨ç¯å¢ƒ)ï¼šæ§åˆ¶å°ä¾æ—§ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¸å½±å“ promise è¯­å¥ä¹‹åç»­ä»£ç æ‰§è¡Œã€‚æ­¤å¤–ï¼Œpromise è¯­å¥å†…çš„å¼‚æ­¥è¯­å¥(å¦‚äº‹ä»¶ï¼Œå®šæ—¶å™¨ç­‰ç­‰)æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸å±äº promise å†…éƒ¨ï¼Œå‘ç”Ÿé”™è¯¯ä¼šä¼ æ’­å‡ºå»ï¼š
```js
var p = new Promise(function(resolve, reject){
  resolve("ok");
  setTimeout(function(){throw new Error("setTimeout error")},0);
});
p.then(function(val){console.log(val);});     //ok
//Uncaught Error: setTimeout error
```
å…¶æ¬¡ï¼Œå°±ä»¥ä¸Šå‰ä¸¤ä¸ªæ³¨æ„äº‹é¡¹ä¸¾ä¸€ä¾‹è¯´æ˜ï¼š
```js
new Promise(function(resolve, reject){
  resolve("resolved");
  throw "original Error";     //è¢«å¿½ç•¥
}).then(function(val){
  console.log(val);           //resolved
  throw (new Error("man-made Error"));
}).catch(function(err){
  console.log(err.message);   //man-made Error
});
```
catch æ–¹æ³•çš„è¿”å›å€¼è¿˜æ˜¯ä¸€ä¸ªæ–°çš„ promise å¯¹è±¡ï¼Œå¯ä»¥ç»§ç»­è°ƒç”¨ then ç­‰å…¶ä»–æ–¹æ³•:
```js
new Promise(function(resolve, reject){
  reject(new Error("reject"));
}).catch(function(err){
  console.log("1st catch");   //è¢«è·³è¿‡
  return "continue";
}).then(function(val){
  console.log(val);           //continue
});
```
å¦‚æœ catchä¹‹å‰æ²¡æœ‰é”™è¯¯ï¼Œè¯¥ catch ä¼šè¢«è·³è¿‡ã€‚è¿™æ„å‘³ç€ï¼Œcatch ä¸èƒ½æ•è·åœ¨å…¶åé¢çš„è¯­å¥ä¸­å‡ºç°çš„é”™è¯¯ï¼š
```js
new Promise(function(resolve, reject){
  resolve("resolved");
}).catch(function(err){
  console.log("1st catch");   //è¢«è·³è¿‡
}).then(function(val){
  console.log(val);           //resolved
  throw (new Error());
}).catch(function(err){
  console.log("2nd catch");   //2nd catch
});
```

- finally() æ–¹æ³•

finally() æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°(æ— å‚æ•°)ä¸ºå‚æ•°ï¼Œå’Œ try...catch...finally ä¸­çš„ finally ç±»ä¼¼ï¼Œä¸è®º promise æ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Œè¯¥å›è°ƒå‡½æ•°éƒ½ä¸€å®šä¼šè¿è¡Œã€‚å¯ä»¥ç”¨å®ƒå…³é—­æ–‡ä»¶ï¼Œæˆ–è€…å…³é—­æœåŠ¡å™¨ç­‰:
```js
server.listen(0).then(function(){
  //do sth.
}).finally(server.stop);
```
finally() å†…éƒ¨å®ç°å¦‚ä¸‹ï¼š
```js
Promise.prototype.finally = function(callback){
  return this.then(
    value => {Promise.resolve(callback()).then(() => value)},
    error => {Promise.resolve(callback()).then(() => {throw error})}
  );
};
```


- done() æ–¹æ³•

done() æ–¹æ³•ç”¨åœ¨ promise å¤„ç†è¯­å¥çš„æœ«ç«¯ï¼Œç”¨æ¥å¤„ç†å¯èƒ½æœªæ•è·çš„é”™è¯¯ï¼Œå¹¶æŠ›å‘å…¨å±€ã€‚å¦‚æœå…¶å¸¦æœ‰å‚æ•°ï¼Œå¯ä»¥ç­‰æ•ˆä¸º done() ä¹‹å‰å¤šäº†ä¸€ä¸ª then():
```js
p.done(fun1, fun2);
//ç›¸å½“äº
p.then(fun1,fun2).done();
```
done() å†…éƒ¨å®ç°å¦‚ä¸‹ï¼š
```js
Promise.prototype.done = function(onResolve, onRejected){
  this.then(onResolve, onRejected).catch(function(err){
    setTimeout(() => {throw err}, 0);
  });
};
```

### Promise é™æ€æ–¹æ³•

- Promise.all()
å°†å¤šä¸ª promise å¯¹è±¡åˆå¹¶æˆä¸€ä¸ªæ–°çš„ promise å®ä¾‹ã€‚å…¶æ¥å—ä¸€ä¸ªè£…ä»…æœ‰ promise å¯¹è±¡çš„å¯éå†ç»“æ„ä¸ºå‚æ•°ï¼Œå¦‚æœä¸æ˜¯ promise å¯¹è±¡ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ `Promise.resolve()` è¿›è¡Œç±»å‹è½¬æ¢ã€‚
promise.all() æ–¹æ³•å¾—åˆ°çš„æ–°çš„ promise å¯¹è±¡çŠ¶æ€ç”±æ„æˆå®ƒçš„æ‰€æœ‰ promise å¯¹è±¡å†³å®šï¼Œå…·ä½“åˆ†ä¸º2ç§æƒ…å†µ:
1. å½“æ‰€æœ‰æ„æˆå®ƒçš„ promise å¯¹è±¡çš„çŠ¶æ€éƒ½å˜æˆ resolvedï¼Œè¿™ä¸ªæ–°çš„å¯¹è±¡çŠ¶æ€æ‰å˜ä¸º resolvedã€‚æ­¤æ—¶æ„æˆå®ƒæ‰€æœ‰çš„ Promise çš„è¿”å›å€¼æ„æˆä¸€ä¸ªæ•°ç»„ä½œä¸ºæ–°çš„ promise å¯¹è±¡çš„å›è°ƒå‡½æ•°å‚æ•°ï¼›
2. å½“æ‰€æœ‰æ„æˆå®ƒçš„ promise å¯¹è±¡çš„çŠ¶æ€æœ‰ä¸€ä¸ªå˜æˆ rejectedï¼Œè¿™ä¸ªæ–°çš„å¯¹è±¡çŠ¶æ€å°±å˜ä¸º rejectedã€‚æ­¤æ—¶ç¬¬ä¸€ä¸ªè¢« reject çš„ Promise çš„è¿”å›å€¼ä½œä¸ºæ–°çš„ promise å¯¹è±¡çš„å›è°ƒå‡½æ•°å‚æ•°ï¼›
```js
//ä¼ªä»£ç , ç”±äºæ²¡æœ‰æ­£ç¡®çš„ url
var getJSON = function(url){
  var promise = new Promise(function(resolve, reject){
    var client = new XMLHttpRequest();
    client.open("GET", url);
    client.onreadystatechange = handler;
    client.response = "json";
    client.setRequestHeader("Accept", "application/json");
    client.send();
    function handler(){
      if(client.readyState !== 4) return;
      if(this.status === 200){
        resolve(client.response);
      } else {
        reject(new Error(this.statusText));
      }
    }
  });
  return promise;
}
var pros = ['url1', 'url2', 'url3'].map(url => getJSON(url));
Promise.all(pros).then(function(){
  console.log("all successful");
}, function(){
  console.log("one rejected");       //one rejected, ç”±äºæ²¡æœ‰æ­£ç¡®çš„ url
});
```


- Promise.race()
å°†å¤šä¸ª promise å¯¹è±¡åˆå¹¶æˆä¸€ä¸ªæ–°çš„ promise å®ä¾‹ã€‚å…¶æ¥å—ä¸€ä¸ªè£…ä»…æœ‰ promise å¯¹è±¡çš„å¯éå†ç»“æ„ä¸ºå‚æ•°ï¼Œå¦‚æœä¸æ˜¯ promise å¯¹è±¡ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ `Promise.resolve()` è¿›è¡Œç±»å‹è½¬æ¢ã€‚
å’Œ promise.all() ä¸åŒçš„æ˜¯ Promise.race() æ–¹æ³•å¾—åˆ°çš„æ–°çš„ promise å¯¹è±¡çŠ¶æ€ç”±æ„æˆå®ƒçš„ promise å¯¹è±¡ä¸­æœ€å…ˆæ”¹å˜çŠ¶æ€çš„é‚£ä¸€ä¸ªå†³å®šã€‚
```js
//ä¼ªä»£ç , ç”±äºæ²¡æœ‰æ­£ç¡®çš„ url
var getJSON = function(url){
  var promise = new Promise(function(resolve, reject){
    var client = new XMLHttpRequest();
    client.open("GET", url);
    client.onreadystatechange = handler;
    client.response = "json";
    client.setRequestHeader("Accept", "application/json");
    client.send();
    function handler(){
      if(client.readyState !== 4) return;
      if(this.status === 200){
        resolve(client.response);
      } else {
        reject(new Error(this.statusText));
      }
    }
  });
  return promise;
}
//å¦‚æœ5sä¸èƒ½è·å¾—æ•°æ®å°±æŠ¥é”™
var p = Promise.race([
  getJSON("url"),
  new Promise(function(resolve, reject){
    setTimeout(() => reject(new Error("Timeout")), 5000);
  })
]).then(res => console.log(res))
.catch(err => console.log(err));    //Error, ç”±äºæ²¡æœ‰æ­£ç¡®çš„ url
```

- Promise.resolve()
å°†ç°æœ‰å¯¹è±¡è½¬åŒ–ä¸º promise å¯¹è±¡ï¼š
```js
var p = Promise.resolve($.ajax('url'));  //jQueryçš„ $.ajax æ–¹æ³•
//ç­‰åŒäºï¼š
var p = new Promise(function(resolve){
  resolve($.ajax('url'));
});
```
å¦‚æœä¼ å…¥ Promise.resolve() çš„å¯¹è±¡ä¸å…·æœ‰ then æ–¹æ³•(ie. unthenable), åˆ™è¿”å›ä¸€ä¸ªçŠ¶æ€ä¸º resolved çš„æ–° promise å¯¹è±¡ã€‚
```js
Promise.resolve("hello").then(function(val){
  console.log(val);                             //hello
});
```
å¦‚æœä½ ä»…ä»…æƒ³å¾—åˆ°ä¸€ä¸ª promise å¯¹è±¡ï¼Œé‚£åˆ©ç”¨ resolve() æ–¹æ³•æ˜¯æœ€ç®€å•çš„ï¼š
```js
var promise = Promise.resolve();
```

- Promise.reject()
`Promise.reject(reason)`, è¿”å›ä¸€ä¸ªçŠ¶æ€ä¸º rejected çš„ promise å®ä¾‹ã€‚å‚æ•° reason ä¼šè¢«ä¼ é€’è¢«å®ä¾‹çš„å›è°ƒå‡½æ•°ã€‚
```js
Promise.reject(new Error("error occured")).catch(err => console.log(err.message));  //error occured
```

### åº”ç”¨ä¸¾ä¾‹

1. åŠ è½½å›¾ç‰‡ï¼š
```js
var preloadImage = function(url){
  return new Promise(function(resolve, reject){
    var image = new Image();
    image.onload = resolve;
    image.onerror = reject;
    image.src = url;
  });
};
```
2. ä½¿ç”¨ Generator ç®¡ç†æµç¨‹ï¼Œç”¨ promise è¿›è¡Œå¼‚æ­¥æ“ä½œ
```js
function getFoo(){
  return new Promise(function(resolve){
    resolve("foo");
  });
}
function* gen(){
  try{
    var foo = yield getFoo();
    console.log(foo);
  } catch(e) {
    console.log(e);
  }
}

var it = gen();
(function go(result){
  if(result.done) return result.value;
  return result.value.then(function(value){
    return go(it.next(value));
  }, function(err){
    return go(it.throw(error));
  });
})(it.next());      //foo
```

## å¼‚æ­¥ç¼–ç¨‹

### å¼‚æ­¥ç¼–ç¨‹

ç¨‹åºæ‰§è¡Œåˆ†ä¸ºåŒæ­¥å’Œå¼‚æ­¥ï¼Œå¦‚æœç¨‹åºæ¯æ‰§è¡Œä¸€æ­¥éƒ½éœ€è¦ç­‰å¾…ä¸Šä¸€æ­¥å®Œæˆæ‰èƒ½å¼€å§‹ï¼Œæ­¤æ‰€è°“åŒæ­¥ã€‚å¦‚æœç¨‹åºåœ¨æ‰§è¡Œä¸€æ®µä»£ç çš„åŒæ—¶å¯ä»¥å»æ‰§è¡Œå¦ä¸€æ®µä»£ç ï¼Œç­‰åˆ°è¿™æ®µä»£ç æ‰§è¡Œå®Œæ¯•å†å§ç»“æœäº¤ç»™å¦ä¸€æ®µä»£ç ï¼Œæ­¤æ‰€è°“å¼‚æ­¥ã€‚
æ¯”å¦‚æˆ‘ä»¬éœ€è¦è¯·æ±‚ä¸€ä¸ªç½‘ç»œèµ„æºï¼Œç”±äºç½‘é€Ÿæ¯”è¾ƒæ…¢ï¼ŒåŒæ­¥ç¼–ç¨‹å°±æ„å‘³ç€ç”¨æˆ·å¿…é¡»ç­‰å¾…ä¸‹è½½å¤„ç†ç»“æŸæ‰èƒ½ç»§ç»­æ“ä½œï¼Œæ‰€ä»¥ç”¨æˆ·ä½“éªŒæä¸ºä¸å¥½ï¼›å¦‚æœé‡‡ç”¨å¼‚æ­¥ï¼Œä¸‹è½½è¿›è¡Œä¸­ç”¨æˆ·ç»§ç»­æ“ä½œï¼Œå½“ä¸‹è½½ç»“æŸäº†ï¼Œå‘Šè¯‰ç”¨æˆ·ä¸‹è½½çš„æ•°æ®ï¼Œè¿™æ ·ä½“æ£€å°±æå‡äº†å¾ˆå¤šã€‚å› æ­¤å¼‚æ­¥ç¼–ç¨‹ååˆ†é‡è¦ã€‚
ä»è®¡ç®—æœºçš„è§’åº¦æ¥è®²ï¼Œjs åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰å¼‚æ­¥ç¼–ç¨‹é‚£ä¸€å®šä¼šå¡æ­»çš„ï¼å¼‚æ­¥ç¼–ç¨‹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š

- å›è°ƒå‡½æ•°
- äº‹ä»¶ç›‘å¬
- å‘å¸ƒ/è®¢é˜…æ¨¡å‹
- Promiseå¯¹è±¡
- ES6å¼‚æ­¥ç¼–ç¨‹

### å›è°ƒå‡½æ•° å’Œ Promise

å›è°ƒå‡½æ•°åº”è¯¥æ˜¯ js ä¸­ååˆ†åŸºç¡€å’Œç®€å•çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬åœ¨å®šä¹‰äº‹ä»¶ï¼Œåœ¨è®¡æ—¶å™¨ç­‰ç­‰ä½¿ç”¨è¿‡ç¨‹ä¸­éƒ½ä½¿ç”¨è¿‡ï¼š
```js
fs.readFile('/etc/passwd', function(err, data){
  if(err) throw err;
  console.log(data);
});
```
æ¯”å¦‚è¿™é‡Œçš„è¿™ä¸ªæ–‡ä»¶è¯»å–ï¼Œå®šä¹‰äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨è¯»å–æ–‡ä»¶æˆåŠŸæˆ–å¤±è´¥æ˜¯è°ƒç”¨ï¼Œå¹¶ä¸ä¼šç«‹åˆ»è°ƒç”¨ã€‚

å¦‚åŒä¹‹å‰åœ¨ Promise ä¸­æåˆ°çš„ï¼Œå½“æˆ‘æƒ³ä¸æ–­çš„è¯»å…¥å¤šä¸ªæ–‡ä»¶ï¼Œå°±ä¼šé‡åˆ°å›è°ƒå‡½æ•°åµŒå¥—ï¼Œä¹¦å†™ä»£ç åŠå…¶çš„ä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º"å›è°ƒåœ°ç‹±"ã€‚å› æ­¤ ES6 ä¸­å¼•å…¥æ˜¯äº† Promise è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å…·ä½“è¡¨ç°å‚çœ‹ä¹‹å‰çš„ Promise éƒ¨åˆ†ã€‚ä½†æ˜¯ Promise ä¹Ÿå¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼Œå°±æ˜¯ä»£ç å†—ä½™å¾ˆä¸¥é‡ï¼Œä¸€å¤§å †çš„ then ä½¿å¾—å›è°ƒçš„è¯­ä¹‰ä¸æ˜ç¡®ã€‚

### åç¨‹

æ‰€è°“åç¨‹å°±æ˜¯å‡ ä¸ªç¨‹åºäº¤æ›¿æ‰§è¡Œï¼šAå¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œä¸€æ®µæ—¶é—´å B æ‰§è¡Œï¼Œæ‰§è¡Œä¸€æ®µæ—¶é—´åå† A ç»§ç»­æ‰§è¡Œï¼Œå¦‚æ­¤åå¤ã€‚
```js
function* asyncJob(){
  //...
  var f = yield readFile(fileA);
  //...
}
```

é€šè¿‡ä¸€ä¸ª Generator å‡½æ•°çš„ yieldï¼Œ å¯ä»¥å°†ä¸€ä¸ªåç¨‹ä¸­æ–­ï¼Œå»æ‰§è¡Œå¦ä¸€ä¸ªåç¨‹ã€‚æˆ‘ä»¬å¯ä»¥æ¢ä¸€ä¸ªè§’åº¦ç†è§£ Generator å‡½æ•°ï¼šå®ƒæ˜¯åç¨‹åœ¨ ES6 ä¸­çš„å…·ä½“ä½“ç°ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•å†™ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„å°è£…ï¼š
```js
var fetch = require('node-fetch');
function* gen(){
  var url = 'http://api.github.com/users/github';
  var result = yield fetch(url);
  console.log(result.bio);
}

var g = gen();
var result = g.next();    //è¿”å›çš„ value æ˜¯ä¸€ä¸ª Promise å¯¹è±¡
result.value.then(function(data){
  return data.json;
}).then(function(data){
  g.next(data);
});
```

### Thunk å‡½æ•°

åœ¨å‡½æ•°ä¼ å‚æ•°æ—¶æˆ‘ä»¬è€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š
```js
function fun(x){
  return x + 5;
}
var a = 10;
fun(a + 10);
```
è¿™ä¸ªå‡½æ•°è¿”å›25è‚¯å®šæ²¡é”™ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¼ ç»™å‡½æ•° fun çš„å‚æ•°åœ¨ç¼–è¯‘æ—¶åˆ°åº•ä¿ç•™ `a + 10` è¿˜æ˜¯ç›´æ¥ä¼ å…¥ `20`ï¼Ÿæ˜¾ç„¶å‰è€…æ²¡æœ‰äº‹å…ˆè®¡ç®—ï¼Œå¦‚æœå‡½æ•°å†…å¤šæ¬¡ä½¿ç”¨è¿™ä¸ªå‚æ•°ï¼Œå°±ä¼šäº§ç”Ÿå¤šæ¬¡è®¡ç®—ï¼Œå½±å“æ€§èƒ½ï¼›è€Œåè€…äº‹å…ˆè®¡ç®—äº†ï¼Œä½†å¦‚æœå‡½æ•°é‡Œä¸ä½¿ç”¨è¿™ä¸ªå˜é‡å°±ç™½æµªè´¹äº†æ€§èƒ½ã€‚é‡‡ç”¨æŠŠå‚æ•°åŸå°ä¸åŠ¨çš„æ”¾å…¥ä¸€ä¸ªå‡½æ•°(æˆ‘ä»¬å°†è¿™ä¸ªå‡½æ•°ç§°ä¸º Thunk å‡½æ•°)ï¼Œç”¨çš„ä½¿ç”¨è°ƒç”¨è¯¥å‡½æ•°çš„æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯ä¸Šé¢çš„å‰ä¸€ç§æ–¹å¼ä¼ å€¼ã€‚æ‰€ä»¥ä¸Šé¢ä»£ç ç­‰ä»·äºï¼š
```js
function fun(x){
  return x() + 5;
}
var a = 10;
var thunk = function(){ return a + 10};
fun(thunk);
```

**ä½†æ˜¯ js ä¸æ˜¯è¿™æ ·çš„ï¼**js ä¼šæŠŠå¤šå‚æ•°å‡½æ•°ç»™ Thunk äº†ï¼Œä»¥å‡å°‘å‚æ•°ï¼š
```js
var fs = require('fs');
fs.readFile(fileName, callback);
var readFileThunk = Thunk(fileName);
readFileThunk(callback);

var Thunk = function(fileName){
  return function(callback){
    return fs.readFile(fileName,callback);
  };
};
```

è¿™é‡Œä»»ä½•å…·æœ‰å›è°ƒå‡½æ•°çš„å‡½æ•°éƒ½å¯ä»¥å†™æˆè¿™æ ·çš„ Thunk å‡½æ•°ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š
```js
function Thunk(fn){
  return function(){
    var args = Array.prototype.slice.call(arguments);
    return function (callback){
      args.push(callback);
      return fn.apply(this, args);
    }
  }
}

//è¿™æ ·fs.readFile(fileName, callback); å†™ä½œå¦‚ä¸‹å½¢å¼

Thunk(fs.readFile)(fileName)(callback);
```

å…³äº Thunk å‡½æ•°, å¯ä»¥ç›´æ¥ä½¿ç”¨ thunkify æ¨¡å—ï¼š
```js
npm install thunkify
```

ä½¿ç”¨æ ¼å¼å’Œä¸Šé¢çš„`Thunk(fs.readFile)(fileName)(callback);`ä¸€è‡´ï¼Œä½†ä½¿ç”¨è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ï¼Œå…¶å†…éƒ¨åŠ å…¥äº†æ£€æŸ¥æœºåˆ¶ï¼Œåªå…è®¸ callback è¢«å›è°ƒä¸€æ¬¡ï¼

ç»“åˆ Thunk å‡½æ•°å’Œåç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è‡ªåŠ¨æµç¨‹ç®¡ç†ã€‚ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨ Generator æ—¶å€™ä½¿ç”¨ `yield` å…³é”®å­—å°† cpu èµ„æºé‡Šæ”¾ï¼Œæ‰§è¡Œç§»å‡º Generator å‡½æ•°ã€‚å¯ä»¥æ€ä¹ˆç§»å›æ¥å‘¢ï¼Ÿä¹‹å‰æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨ Generator è¿”å›çš„è¿­ä»£å™¨çš„ next() æ–¹æ³•ï¼Œå¯è¿™æ¯•ç«Ÿæ˜¯æ‰‹åŠ¨çš„ï¼Œç°åœ¨æˆ‘ä»¬å°±åˆ©ç”¨ Thunk å‡½æ•°å®ç°ä¸€ä¸ªè‡ªåŠ¨çš„ï¼š
```js
var fs = require('fs');
var thunkify = require('thunkify');
var readFile = thunkify(fs.readFile);

var gen = function*(...args){    //args æ˜¯æ–‡ä»¶è·¯å¾„æ•°ç»„
  for(var i = 0, len = args.length; i < len; i++){
    var r = yield readFile(args[i]);
    console.log(r.toString());
  }
};

(function run(fn){
  var gen = fn();
  function next(err, data){
    if(err) throw err;
    var result =  gen.next(data);
    if(result.done) return;    //é€’å½’ç›´åˆ°æ‰€ä»¥æ–‡ä»¶è¯»å–å®Œæˆ
    result.value(next);    //é€’å½’æ‰§è¡Œ
  }
  next();
})(gen);

//ä¹‹åå¯ä»¥ä½¿ç”¨ run å‡½æ•°ç»§ç»­è¯»å–å…¶ä»–æ–‡ä»¶æ“ä½œ
```

å¦‚æœè¯´ Thunk å¯ä»¥æœ‰ç°æˆçš„åº“ä½¿ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªè‡ªåŠ¨æ‰§è¡Œçš„ Generator å‡½æ•°ä¹Ÿæœ‰ç°æˆçš„åº“å¯ä»¥ä½¿ç”¨â€”â€”coæ¨¡å—([https://github.com/tj/co](https://github.com/tj/co))ã€‚ç”¨æ³•ä¸ä¸Šé¢ç±»ä¼¼ï¼Œä¸è¿‡ co æ¨¡å—è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
```js
var co = require('co');
var fs = require('fs');
var thunkify = require('thunkify');
var readFile = thunkify(fs.readFile);

var gen = function*(...args){    //args æ˜¯æ–‡ä»¶è·¯å¾„æ•°ç»„
  for(var i = 0, len = args.length; i < len; i++){
    var r = yield readFile(args[i]);
    console.log(r.toString());
  }
};
co(gen).then(function(){
  console.log("files loaded");
}).catch(function(err){
  console.log("load fail");
});
```
è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šyield åé¢åªèƒ½è·Ÿä¸€ä¸ª thunk å‡½æ•°æˆ– promise å¯¹è±¡ã€‚ä¸Šä¾‹ä¸­ç¬¬8è¡Œ yield åé¢çš„ readFile æ˜¯ä¸€ä¸ª thunk å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ã€‚
ä¸Šé¢å·²ç»è®²è§£äº† thunk å‡½æ•°å®ç°è‡ªåŠ¨æµç¨‹ç®¡ç†ï¼Œä¸‹é¢ä½¿ç”¨ Promise å®ç°ä¸€ä¸‹ï¼š
```js
var fs = require('fs');
var readFile = function(fileName){
  return new Promise(function(resolve, reject){
    fs.readFile(fileName, function(error,data){
      if(error) reject(error);
      resolve(data);
    });
  });
};

var gen = function*(){
  for(var i = 0, len = args.length; i < len; i++){
    var r = yield readFile(args[i]);
    console.log(r.toString());
  }
};

(function run(gen){
  var g = gen();

  var resolve = function(data){
    var result = g.next(data);
    if(result.done) return result.value;
    result.value.then(resolve);
  }
  g.next().value.then(function(data){
    resolve(data);
  });
  resolve();
})(gen);
//ä¹‹åå¯ä»¥ä½¿ç”¨ run å‡½æ•°ç»§ç»­è¯»å–å…¶ä»–æ–‡ä»¶æ“ä½œ
```

# async å‡½æ•°

ES7 ä¸­æå‡ºäº† async å‡½æ•°ï¼Œä½†æ˜¯ç°åœ¨å·²ç»å¯ä»¥ç”¨äº†ï¼å¯è¿™ä¸ªåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®å°±æ˜¯ Generator å‡½æ•°çš„æ”¹è¿›,æˆ‘ä»¬ä¸Šæ–‡å†™è¿‡ä¸€ä¸ªè¿™æ ·çš„ Generator å‡½æ•°ï¼š
```js
var gen = function*(){
  for(var i = 0, len = args.length; i < len; i++){
    var r = yield readFile(args[i]);
    console.log(r.toString());
  }
};
```
æˆ‘ä»¬æŠŠå®ƒæ”¹å†™æˆ async å‡½æ•°ï¼š
```js
var asyncReadFiles = async function(){    //* æ›¿æ¢ä¸º async
  for(var i = 0, len = args.length; i < len; i++){
    var r = await readFile(args[i]);   //yield æ›¿æ¢ä¸º await
    console.log(r.toString());
  }
};
```

async å‡½æ•°å¯¹ Generator å‡½æ•°åšäº†ä¸€ä¸‹æ”¹è¿›ï¼š

- Generator å‡½æ•°éœ€è¦æ‰‹åŠ¨é€šè¿‡è¿”å›å€¼çš„ next æ–¹æ³•æ‰§è¡Œï¼Œè€Œ async å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œæ–¹å¼å’Œæ™®é€šå‡½æ•°å®Œå…¨ä¸€æ ·ã€‚
```js
var result = asyncReadFiles(fileA, fileB, fileC);
```
- è¯­ä¹‰æ˜ç¡®ï¼Œasync è¡¨ç¤ºå¼‚æ­¥ï¼Œawait è¡¨ç¤ºåç»­è¡¨è¾¾å¼éœ€è¦ç­‰å¾…è§¦å‘çš„å¼‚æ­¥æ“ä½œç»“æŸ
- co æ¨¡å—ä¸­ yield åé¢åªèƒ½è·Ÿä¸€ä¸ª thunk å‡½æ•°æˆ– promise å¯¹è±¡ï¼Œè€Œ await åé¢å¯ä»¥æ˜¯ä»»ä½•ç±»å‹(ä¸æ˜¯ Promise å¯¹è±¡å°±åŒæ­¥æ‰§è¡Œ)
- è¿”å›å€¼æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œä¸æ˜¯ Iterator ï¼Œæ¯” Generator æ–¹ä¾¿

æˆ‘ä»¬å¯ä»¥å®ç°è¿™æ ·çš„ä¸€ä¸ª async å‡½æ•°:
```js
async function asyncFun(){
  //code here
}
//equal to...
function asyncFun(args){
  return fun(function*(){
    //code here...
  });
  function fun(genF){
    return new Promise(function(resolve, reject){
      var gen = genF();
      function step(nextF){
        try{
          var next = nextF();
        } catch(e) {
          return reject(e);
        }
        if(next.done){
          return resolve(next.value);
        }
        Promise.resolve(next.value).then(function(data){
          step(function(){ return gen.next(data); });
        }, function(e){
          step(function(){ return gen.throw(e); });
        });
      }
      step(function() { return gen.next(undefined); });
    });
  }
}
```

æˆ‘ä»¬ä½¿ç”¨ async å‡½æ•°åšç‚¹ç®€å•çš„äº‹æƒ…ï¼š
```js
function timeout(ms){
  return new Promise((resolve) => {
    setTimeout(resolve, ms);
  });
}

async function delay(nap, ...values){
  while(1){
    try{
      await timeout(nap);
    } catch(e) {
      console.log(e);
    }
    var val = values.shift();
    if(val)
      console.log(val)
    else
      break;
  }
}
delay(600,1,2,3,4);   //æ¯éš” 600ms è¾“å‡ºä¸€ä¸ªæ•°
```
è¿™é‡Œéœ€è¦æ³¨æ„ï¼šåº”è¯¥æŠŠåé¢è·Ÿ promiseå¯¹è±¡çš„ await æ”¾åœ¨ä¸€ä¸ª try ä¸­ï¼Œé˜²æ­¢å…¶è¢« rejectedã€‚å½“ç„¶ä¸Šé¢çš„ try è¯­å¥ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š
```js
var ms = await timeout(nap).catch((e) => console.log(e));
```

å¯¹äºå‡½æ•°å‚æ•°ä¸­çš„å›è°ƒå‡½æ•°ä¸å»ºè®®ä½¿ç”¨ï¼Œé¿å…å‡ºç°ä¸åº”è¯¥çš„é”™è¯¯
```js
//åä¾‹: ä¼šå¾—åˆ°é”™è¯¯ç»“æœ
async function fun(db){
  let docs = [{},{},{}];

  docs.forEach(async function(doc){   //ReferenceError: Invalid left-hand side in assignment
    await db.post(doc);
  });
}

//æ”¹å†™, ä½†ä¾ç„¶é¡ºåºæ‰§è¡Œ
async function fun(db){
  let docs = [{},{},{}];

  for(let doc of docs){
    await db.post(doc);
  }
}

//æ”¹å†™, å¹¶å‘æ‰§è¡Œ
async function fun(db){
  let docs = [{},{},{}];
  let promises = docs.map((doc) => db.post(doc));
  let result = await Promise.all(promises)
  console.log(result);
}

//æ”¹å†™, å¹¶å‘æ‰§è¡Œ
async function fun(db){
  let docs = [{},{},{}];
  let promises = docs.map((doc) => db.post(doc));
  let result = [];
  for(let promise of promises){
    result.push(await promise);
  }
  console.log(result);
}
```

### Promiseï¼ŒGenerator å’Œ async å‡½æ•°æ¯”è¾ƒ

è¿™é‡Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„åŠŸèƒ½ï¼Œå¯ä»¥ç›´è§‚çš„æ¯”è¾ƒä¸€ä¸‹ã€‚å®ç°å¦‚ä¸‹åŠŸèƒ½ï¼š

> åœ¨ä¸€ä¸ª DOM å…ƒç´ ä¸Šç»‘å®šä¸€ç³»åˆ—åŠ¨ç”»ï¼Œæ¯ä¸€ä¸ªåŠ¨ç”»å®Œæˆæ‰å¼€å§‹ä¸‹ä¸€ä¸ªï¼Œå¦‚æœæŸä¸ªåŠ¨ç”»æ‰§è¡Œå¤±è´¥ï¼Œè¿”å›æœ€åä¸€ä¸ªæ‰§è¡ŒæˆåŠŸçš„åŠ¨ç”»çš„è¿”å›å€¼

- Promise æ–¹æ³•
```js
function chainAnimationPromise(ele, animations){
  var ret = null;  //å­˜æ”¾ä¸Šä¸€ä¸ªåŠ¨ç”»çš„è¿”å›å€¼
  var p = Promise.resolve();
  for(let anim of animations){
    p = p.then(function(val){
      ret = val;
      return anim(ele);
    });
  }
  return p.catch(function(e){
    /*å¿½ç•¥é”™è¯¯*/
  }).then(function(){
    return ret;  //è¿”å›æœ€åä¸€ä¸ªæ‰§è¡ŒæˆåŠŸçš„åŠ¨ç”»çš„è¿”å›å€¼
  });
}
```

- Generator æ–¹æ³•
```js
function chainAnimationGenerator(ele, animations){
  return fun(function*(){
    var ret = null;
    try{
      for(let anim of animations){
        ret = yield anim(ele);
      }
    } catch(e) {
      /*å¿½ç•¥é”™è¯¯*/
    }
    return ret;
  });

  function fun(genF){
    return new Promise(function(resolve, reject){
      var gen = genF();
      function step(nextF){
        try{
          var next = nextF();
        } catch(e) {
          return reject(e);
        }
        if(next.done){
          return resolve(next.value);
        }
        Promise.resolve(next.value).then(function(data){
          step(function(){ return gen.next(data); });
        }, function(e){
          step(function(){ return gen.throw(e); });
        });
      }
      step(function() { return gen.next(undefined); });
    });
  }
}
```

- async å‡½æ•°æ–¹æ³•
```js
async function chainAnimationAsync(ele, animations){
  var ret = null;
  try{
    for(let anim of animations){
      ret = await anim(elem);
    }
  } catch(e){
    /*å¿½ç•¥é”™è¯¯*/
  }
  return ret;
}
```

## Class

### classå£°æ˜

class æ˜¯ ES6 æ¨¡ä»¿é¢å‘å¯¹è±¡è¯­è¨€(C++, Java)æå‡ºçš„å®šä¹‰ç±»çš„æ–¹æ³•ã€‚å½¢å¼ç±»ä¼¼ C++ å’Œ Java (å„å–æ‰€é•¿), ä¸‹é¢ä¾‹å­å±•ç¤ºäº† class æ˜¯å¦‚ä½•å®šä¹‰æ„é€ å‡½æ•°ã€å¯¹è±¡å±æ€§å’Œå¯¹è±¡åŠ¨/é™æ€æ–¹æ³•çš„ï¼š
```js
class Point{
  constructor(x, y){    //å®šä¹‰æ„é€ å‡½æ•°
    this.x = x;         //å®šä¹‰å±æ€§x
    this.y = y;         //å®šä¹‰å±æ€§y
  }                     //è¿™é‡Œæ²¡æœ‰é€—å·
  toString(){           //å®šä¹‰åŠ¨æ€æ–¹æ³•ï¼Œä¸éœ€è¦ function å…³é”®å­—
    return `(${this.x},${this.y})`;
  }
  static show(){        //åˆ©ç”¨ static å…³é”®å­—å®šä¹‰é™æ€æ–¹æ³•
    console.log("Static function!");
  }
}

var p = new Point(1,4);
console.log(p+"");               //(1,4)
console.log(typeof Point);       //"function"
console.log(Point.prototype.constructor === Point);    //true
console.log(Point.prototype.constructor === p.constructor);    //true
Point.show();      //"Static function!"
```
ç›¸å½“äºä¼ ç»Ÿå†™æ³•ï¼š
```js
function Point(x, y){
  this.x = x;
  this.y = y;
}
Point.prototype.toString = function(){
  return `(${this.x},${this.y})`;
}
Point.show = function(){
  console.log("Static function!");
}
var p = new Point(1,4);
console.log(p+"");   //(1,4)
```

è¿™é‡Œä¸éš¾çœ‹å‡ºï¼Œclass çš„ç±»åå°±æ˜¯ ES5 ä¸­çš„æ„é€ å‡½æ•°åï¼Œé™æ€æ–¹æ³•å°±å®šä¹‰åœ¨å…¶ä¸Šï¼Œè€Œç±»çš„æœ¬è´¨ä¾ç„¶æ˜¯ä¸ªå‡½æ•°ã€‚è€Œ class ä¸­é™¤äº† constructor æ˜¯å®šä¹‰çš„æ„é€ å‡½æ•°ä»¥å¤–ï¼Œå…¶ä»–çš„æ–¹æ³•éƒ½å®šä¹‰åœ¨ç±»çš„ prototype ä¸Šï¼Œè¿™éƒ½å’Œ ES5 æ˜¯ä¸€è‡´çš„ï¼Œè¿™å°±æ„å‘³ç€ï¼ŒES5 ä¸­åŸæœ‰çš„é‚£äº›æ–¹æ³•éƒ½å¯ä»¥ç”¨, åŒ…æ‹¬ä½†ä¸é™äº:

- `Object.keys()`, `Object.assign()` ç­‰ç­‰
- è€Œä¸” class ä¹ŸåŒæ ·æ”¯æŒè¡¨è¾¾å¼åšå±æ€§åï¼Œæ¯”å¦‚ Symbol
- ES5 å‡½æ•°å…·æœ‰çš„å±æ€§/æ–¹æ³•ï¼šlengthã€nameã€applyã€callã€bindã€arguments ç­‰ç­‰

ä½†æœ‰äº›ç»†èŠ‚è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œæ¯”å¦‚ï¼š
```js
class Point{
  constructor(x, y){    //å®šä¹‰æ„é€ å‡½æ•°
    this.x = x;         //å®šä¹‰å±æ€§x
    this.y = y;         //å®šä¹‰å±æ€§y
  }                     //è¿™é‡Œæ²¡æœ‰é€—å·
  toString(){           //å®šä¹‰åŠ¨æ€æ–¹æ³•ï¼Œä¸éœ€è¦ function å…³é”®å­—
    return `(${this.x},${this.y})`;
  }
  getX(){
    return this.x;
  }
  getY(){
    return this.y;
  }
}
var p = new Point(1,4);
var keys = Object.keys(Point.prototype);
var ownKeys = Object.getOwnPropertyNames(Point.prototype);
console.log(keys);        //[]
console.log(ownKeys);     //["constructor", "toString", "getX", "getY"]
console.log(p.hasOwnProperty("toString"));                  //fales
console.log(p.__proto__.hasOwnProperty("toString"));        //true
```
```js
//ES5
function Point(x, y){
  this.x = x;
  this.y = y;
}
Point.prototype = {
  toString(){
    return `(${this.x},${this.y})`;
  },
  getX(){
    return this.x;
  },
  getY(){
    return this.y;
  }
}
var p = new Point(1,4);
var keys = Object.keys(Point.prototype);
var ownKeys = Object.getOwnPropertyNames(Point.prototype);
console.log(keys);        //["toString", "getX", "getY"]
console.log(ownKeys);     //["toString", "getX", "getY"]
console.log(p.hasOwnProperty("toString"));                  //fales
console.log(p.__proto__.hasOwnProperty("toString"));        //true
```
è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œclass ä¸­å®šä¹‰çš„åŠ¨æ€æ–¹æ³•æ˜¯ä¸å¯æšä¸¾çš„ï¼Œå¹¶ä¸” constructor ä¹Ÿæ˜¯å…¶è‡ªæœ‰æ–¹æ³•ä¸­çš„ä¸€ä¸ªã€‚

ä½¿ç”¨ class æ³¨æ„ä¸€ä¸‹å‡ ç‚¹ï¼š

- class ä¸­é»˜è®¤æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œå³ä½¿ä¸å†™`"use strict`ã€‚å…³äºä¸¥æ ¼æ¨¡å¼å¯ä»¥çœ‹ï¼š[JavascriptåŸºç¡€(2) - ä¸¥æ ¼æ¨¡å¼ç‰¹ç‚¹](http://blog.csdn.net/faremax/article/details/56289671)
- åŒå class ä¸å¯é‡å¤å£°æ˜
- class ç›¸å½“äº object è€Œä¸æ˜¯ mapï¼Œä¸å…·æœ‰ map å±æ€§ï¼Œä¹Ÿä¸å…·æœ‰é»˜è®¤çš„ Iteratorã€‚
- constructor æ–¹æ³•åœ¨ class ä¸­æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœæ²¡æœ‰è®¤ä¸ºæŒ‡å®šï¼Œç³»ç»Ÿä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªç©ºçš„ constructor
- è°ƒç”¨ class å®šä¹‰çš„ç±»å¿…é¡»æœ‰ new å…³é”®å­—ï¼Œåƒæ™®é€šå‡½æ•°é‚£æ ·è°ƒç”¨ä¼šæŠ¥é”™ã€‚ES5 ä¸é™åˆ¶è¿™ä¸€ç‚¹ã€‚
```js
TypeError: Class constructor Point cannot be invoked without 'new'
```
- constructor æ–¹æ³•é»˜è®¤è¿”å›å€¼ä¸º thisï¼Œå¯ä»¥è®¤ä¸ºä¿®æ”¹è¿”å›å…¶ä»–çš„å€¼ï¼Œä½†è¿™ä¼šå¯¼è‡´ä¸€ç³»åˆ—å¥‡æ€ªçš„é—®é¢˜ï¼š
```js
class Point{
  constructor(x,y){
    return [x, y];
  }
}
new Point() instanceof Point;    //false
```
- class å£°æ˜ç±»ä¸å­˜åœ¨å˜é‡æå‡
```js
new Point();     //ReferenceError: Point is not defined
class Point{}
```

### class è¡¨è¾¾å¼

è¿™ä¸ªå’Œé¢å‘å¯¹è±¡ä¸ä¸€æ ·äº†ï¼Œjs ä¸­å‡½æ•°å¯ä»¥æœ‰å‡½æ•°å£°æ˜å½¢å¼å’Œå‡½æ•°è¡¨è¾¾å¼2ç§æ–¹å¼å®šä¹‰ï¼Œé‚£ä¹ˆ class ä¸€æ ·æœ‰ç¬¬äºŒç§2ç§å®šä¹‰æ–¹å¼ï¼šclass è¡¨è¾¾å¼
```js
var className1 = class innerName{
  //...
};
let className2 = class innerName{
  //...
};
const className3 = class innerName{
  //...
};
```
class è¡¨è¾¾å¼ç”±å¾ˆå¤šç‰¹æ€§å’Œ ES5 ä¸€æ ·ï¼š

- å’Œå‡½æ•°è¡¨è¾¾å¼ç±»ä¼¼ï¼Œè¿™é‡Œçš„innerNameå¯ä»¥çœç•¥ï¼Œè€Œä¸”innerNameåªæœ‰ç±»å†…éƒ¨å¯è§ï¼Œå®é™…çš„ç±»åæ˜¯èµ‹å€¼å·å‰é¢çš„ classNameã€‚
- è¿™æ ·å®šä¹‰çš„ç±»çš„ä½œç”¨åŸŸï¼Œç”±å…¶æ‰€åœ¨ä½ç½®å’Œå£°æ˜å…³é”®å­—(var, let, const)å†³å®š
- constç”³æ˜çš„ç±»æ˜¯ä¸ªå¸¸é‡ï¼Œä¸èƒ½ä¿®æ”¹ã€‚
- å…¶å˜é‡å£°æ˜å­˜åœ¨æå‡ï¼Œä½†åˆå§‹åŒ–ä¸æå‡
- class è¡¨è¾¾å¼ä¹Ÿä¸èƒ½å’Œ class ç”³æ˜é‡å

ES5 ä¸­æœ‰ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œç±»ä¼¼çš„ï¼Œè¿™é‡Œä¹Ÿæœ‰ç«‹å³æ‰§è¡Œç±»ï¼š
```js
var p = new class {
  constructor(x, y){
    this.x = x;
    this.y = y;
  }
  toString(){
    return `(${this.x},${this.y})`;
  }
}(1,5);   //ç«‹å³ç”Ÿæˆä¸€ä¸ªå¯¹è±¡
console.log(p+"");    //(1,5)
```

### getter, setter å’Œ Generator æ–¹æ³•

getter å’Œ setter ä½¿ç”¨æ–¹å¼å’Œ ES5 ä¸€æ ·, è¿™é‡Œä¸å¤šè¯´äº†ï¼Œä¸¾ä¸ªä¾‹å­ä¸€çœ‹å°±æ‡‚ï¼š
```js
class Person{
  constructor(name, age, tel){
    this.name = name;
    this.age = age;
    this.tel = tel;
    this._self = {};
  }
  get id(){
    return this._self.id;
  }
  set id(str){
    if(this._self.id){
      throw new TypeError("Id is read-only");
    } else {
      this._self.id = str;
    }
  }
}
var p = new Person("Bob", 18, "13211223344");
console.log(p.id);                //undefined
p.id = '30010219900101009X';
console.log(p.id);                //'30010219900101009X'

var descriptor = Object.getOwnPropertyDescriptor(Person.prototype, 'id');
console.log('set' in descriptor);       //true
console.log('get' in descriptor);       //true

p.id = '110';                     //TypeError: Id is read-only
```

Generator ç”¨æ³•ä¹Ÿå’Œ ES6 Generator éƒ¨åˆ†ä¸€æ ·ï¼š
```js
class Person{
  constructor(name, age, tel){
    this.name = name;
    this.age = age;
    this.tel = tel;
    this._self = {};
  }
  *[Symbol.iterator](){
    var keys = Object.keys(this);
    keys = keys.filter(function(item){
      if(/^_/.test(item)) return false;
      else return true;
    });
    for(let item of keys){
      yield this[item];
    }
  }
  get id(){
    return this._self.id;
  }
  set id(str){
    if(this._self.id){
      throw new TypeError("Id is read-only");
    } else {
      this._self.id = str;
    }
  }
}
var p = new Person("Bob", 18, "13211223344");
p.id = '30010219900101009X';
for(let info of p){
  console.log(info);   //ä¾æ¬¡è¾“å‡º: "Bob", 18, "13211223344"
}
```

### class çš„ç»§æ‰¿

è¿™é‡Œæˆ‘ä»¬åªé‡ç‚¹è®²ç»§æ‰¿ï¼Œå…³äºå¤šæ€æ²¡æœ‰æ–°çš„ä¿®æ”¹ï¼Œå’Œ ES5 ä¸­ä¸€æ ·ï¼Œåœ¨å‡½æ•°å†…åˆ¤æ–­å‚æ•°å³å¯ã€‚å…³äºå¤šæ€å¯ä»¥é˜…è¯»[Javascriptå¯¹è±¡(1) - å¯¹è±¡ã€ç±»ä¸åŸå‹é“¾](http://blog.csdn.net/faremax/article/details/53525721)ä¸­å…³äº`å¤šæ€é‡æ„`çš„éƒ¨åˆ†ã€‚

æ­¤å¤–ï¼Œclass ç»§æ‰¿å±äº ES5 ä¸­å¤šç§ç»§æ‰¿æ–¹å¼çš„å…±äº«åŸå‹ï¼Œå…³äºå…±äº«åŸå‹ä¹Ÿåœ¨ä¸Šé¢è¿™ç¯‡æ–‡ç« ä¸­è®²è§£è¿‡ã€‚

class å®ç°ç»§æ‰¿å¯ä»¥ç®€å•çš„é€šè¿‡ extends å…³é”®å­—å®ç°, è€Œä½¿ç”¨ super å…³é”®å­—è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼š
```js
//å®šä¹‰ 'æœ‰è‰²ç‚¹'' ç»§æ‰¿è‡ª 'ç‚¹'
class ColorPoint extends Point{    //è¿™é‡Œå»¶ç”¨äº†ä¸Šé¢å®šä¹‰çš„ Point ç±»
  constructor(x, y, color){
    super(x, y);     //åˆ©ç”¨ super å‡½æ•°è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°
    this.color = color;
  }
  toString(){
    return `${super.toString()},${this.color}`;     //åˆ©ç”¨ super è°ƒç”¨çˆ¶ç±»çš„åŠ¨æ€æ–¹æ³•
  }
}
var cp = new ColorPoint(1, 5, '#ff0000');
console.log(cp+"");      //(1,5),#ff0000
ColorPoint.show();       //"Static function!"     é™æ€æ–¹æ³•åŒæ ·è¢«ç»§æ‰¿äº†
cp instanceof ColorPoint;   //true
cp instanceof Point;   //true
```

ä½¿ç”¨ extends ç»§æ‰¿çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç‚¹ï¼š

- super ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œä¸èƒ½è®¿é—®çˆ¶ç±»å±æ€§ï¼Œåªèƒ½æ–¹æ³•çˆ¶ç±»æ–¹æ³•å’Œæ„é€ å‡½æ•°(superæœ¬èº«)
- å­ç±»æ²¡æœ‰è‡ªå·±çš„ thisï¼Œéœ€è¦å€ŸåŠ© super è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ååŠ å·¥å¾—åˆ°ä»çˆ¶ç±»å¾—åˆ°çš„ thisï¼Œå­ç±»æ„é€ å‡½æ•°å¿…é¡»è°ƒç”¨ super å‡½æ•°ã€‚è¿™ä¸€ç‚¹å’Œ ES5 å®Œå…¨ä¸åŒã€‚
- å­ç±»å¦‚æœæ²¡æœ‰æ‰‹åŠ¨å®šä¹‰æ„é€ å‡½æ•°ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š
```js
constructor(...args){
  super(...args);
}
```
- å­ç±»ä¸­ä½¿ç”¨ this å…³é”®å­—ä¹‹å‰ï¼Œå¿…é¡»å…ˆè°ƒç”¨ super æ„é€ å‡½æ•°
- ç”±äºç»§æ‰¿å±äºå…±äº«åŸå‹çš„æ–¹å¼ï¼Œæ‰€ä»¥ä¸è¦åœ¨å®ä¾‹å¯¹è±¡ä¸Šä¿®æ”¹åŸå‹(`Object.setPrototypeOf`, `obj.__proto__`ç­‰)
- super ä¹Ÿå¯ä»¥ç”¨åœ¨æ™®é€šæ˜¯å¯¹è±¡å­—é¢é‡ä¸­ï¼š
```js
var obj = {
  toString(){
    return `MyObj ${super.toString()}`;
  }
}
console.log(obj+"");    //MyObj [object Object]
```

### `prototype` å’Œ `__proto__`

åœ¨ class çš„ç»§æ‰¿ä¸­

- å­ç±»çš„ `__proto__` æŒ‡å‘å…¶çˆ¶ç±»
- å­ç±» prototype çš„ `__proto__` æŒ‡å‘å…¶çˆ¶ç±»çš„ prototype
```js
class Point{
  constructor(x, y){
    this.x = x;
    this.y = y;
  }
}
class ColorPoint extends Point{
  constructor(x, y, color){
    super(x, y);
    this.color = color;
  }
}
ColorPoint.__proto__  === Point;   //true
ColorPoint.prototype.__proto__ === Point.prototype;   //true
```
å…¶ç­‰ä»·çš„ ES5 æ˜¯è¿™æ ·çš„ï¼š
```js
function Point(){
  this.x = x;
  this.y = y;
}
function ColorPoint(){
  this.x = x;
  this.y = y;
  this.color = color;
}
Object.setPrototypeOf(ColorPoint.prototype, Point.prototype);    //ç»§æ‰¿åŠ¨æ€æ–¹æ³•å±æ€§
Object.setPrototypeOf(ColorPoint, Point);                        //ç»§æ‰¿é™æ€æ–¹æ³•å±æ€§

ColorPoint.__proto__  === Point;                      //true
ColorPoint.prototype.__proto__ === Point.prototype;   //true
```

è¿™é‡Œæˆ‘ä»¬åº”è¯¥ç†è§£ä¸€ä¸‹3ç§ç»§æ‰¿çš„ prototype å’Œ `__proto__`ï¼š

1. æ²¡æœ‰ç»§æ‰¿
```js

class A{}
A.__proto__  === Function.prototype;          //true
A.prototype.__proto__ === Object.prototype;   //true
```
2. ç»§æ‰¿è‡ª Object
```js
class A extends Object{}
A.__proto__  === Object;                      //true
A.prototype.__proto__ === Object.prototype;   //true
```
3. ç»§æ‰¿è‡ª null
```js
class A extends null{}
A.__proto__  === Function.prototype;        //true
A.prototype.__proto__ === undefined;        //true
```

åˆ¤æ–­ç±»çš„ç»§æ‰¿å…³ç³»ï¼š
```js
class A{}
class B extends A{}
Object.getPrototypeOf(B) === A;     //true
```

å­ç±»çš„å®ä¾‹çš„ `__proto__` çš„ `__proto__` æŒ‡å‘å…¶çˆ¶ç±»å®ä¾‹çš„ `__proto__`
```js
class A{}
class B extends A{}
var a = new A();
var b = new B();
B.__proto__.__proto__ === A.__proto__;        //true
```
å› æ­¤ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å­ç±»å®ä¾‹çš„ `__proto__.__proto__` æ”¹å˜çˆ¶ç±»å®ä¾‹çš„è¡Œä¸ºã€‚å»ºè®®ï¼š

- æ€»æ˜¯ç”¨ class å–ä»£éœ€è¦ prototype çš„æ“ä½œã€‚å› ä¸º class çš„å†™æ³•æ›´ç®€æ´ï¼Œæ›´æ˜“äºç†è§£ã€‚
- ä½¿ç”¨ extends å®ç°ç»§æ‰¿ï¼Œå› ä¸ºè¿™æ ·æ›´ç®€å•ï¼Œä¸ä¼šæœ‰ç ´å instanceof è¿ç®—çš„å±é™©ã€‚

æ­¤å¤–å­˜å–å™¨å’Œ Generator å‡½æ•°éƒ½å¯ä»¥å¾ˆç†æƒ³çš„è¢«ç»§æ‰¿ï¼š
```js
class Person{
  constructor(name, age, tel){
    this.name = name;
    this.age = age;
    this.tel = tel;
    this._self = {};
  }
  *[Symbol.iterator](){
    var keys = Object.keys(this);
    keys = keys.filter(function(item){
      if(/^_/.test(item)) return false;
      else return true;
    });
    for(let item of keys){
      yield this[item];
    }
  }
  get id(){
    return this._self.id;
  }
  set id(str){
    if(this._self.id){
      throw new TypeError("Id is read-only");
    } else {
      this._self.id = str;
    }
  }
}

class Coder extends Person{
  constructor(name, age, tel, lang){
    super(name, age, tel);
    this.lang = lang;
  }
}

var c = new Coder("Bob", 18, "13211223344", "javascript");
c.id = '30010219900101009X';
for(let info of c){
  console.log(info);   //ä¾æ¬¡è¾“å‡º: "Bob", 18, "13211223344", "javascript"
}
console.log(c.id);     //'30010219900101009X'
c.id = "110";          //TypeError: Id is read-only
```

### å¤šç»§æ‰¿

å¤šç»§æ‰¿æŒ‡çš„æ˜¯ä¸€ä¸ªæ–°çš„ç±»ç»§æ‰¿è‡ªå·²æœ‰çš„å¤šä¸ªç±»ï¼ŒJavaScript æ²¡æœ‰æä¾›å¤šç»§æ‰¿çš„æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ Mixin æ¨¡å¼æ‰‹åŠ¨å®ç°ï¼š
```js
function mix(...mixins){
  class Mix{}
  for(let mixin of mixins){
    copyProperties(Mix, mixin);                         //ç»§æ‰¿é™æ€æ–¹æ³•å±æ€§
    copyProperties(Mix.prototype, mixin.prototype);     //ç»§æ‰¿åŠ¨æ€æ–¹æ³•å±æ€§
  }

  return Mix;

  function copyProperties(target, source){
    for(let key of Reflect.ownKeys(source)){
      if(key !== 'constructor' && key !== "prototype" && key !== "name"){
        if(Object(source[key]) === source[key]){
          target[key] = {};
          copyProperties(target[key], source[key]);       //é€’å½’å®ç°æ·±æ‹·è´
        } else {
          let desc = Object.getOwnPropertyDescriptor(source, key);
          Object.defineProperty(target, key, desc);
        }
      }
    }
  }
}

//ä½¿ç”¨æ–¹æ³•ï¼š
class MultiClass extends mix(superClass1, superClass2, /*...*/){
  //...
}
```
ç”±äº mixin æ¨¡å¼ä½¿ç”¨äº†æ‹·è´æ„é€ ï¼Œæ„é€ å‡ºçš„å­ç±»çš„çˆ¶ç±»æ˜¯ mix å‡½æ•°è¿”å›çš„ class, å› æ­¤ prototype å’Œ `__proto__` ä¸ä»»ä¸€ superClass éƒ½æ²¡æœ‰ç›´æ¥çš„è”ç³»ï¼Œinstanceof åˆ¤æ–­å…¶å±äº mix å‡½æ•°è¿”å›ç±»çš„å®ä¾‹ï¼ŒåŒæ ·å’Œä»»ä¸€ superClass éƒ½æ²¡æœ‰å…³ç³»ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼šæˆ‘ä»¬ä¸ºäº†å®ç°åŠŸèƒ½ç ´åäº†ç†è®ºåº”è¯¥å…·æœ‰çš„åŸå‹é“¾ã€‚

### åŸç”Ÿæ„é€ å‡½æ•°ç»§æ‰¿

åœ¨ ES5 ä¸­ï¼ŒåŸç”Ÿæ„é€ å‡½æ•°æ˜¯ä¸èƒ½ç»§æ‰¿çš„ï¼ŒåŒ…æ‹¬ï¼š Boolean(), Number(), Date(), String(), Object(), Error(), Function(), RegExp()ç­‰ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™æ ·å®ç°ï¼š
```js
function SubArray(){}
Object.setPrototypeOf(SubArray.prototype, Array.prototype);    //ç»§æ‰¿åŠ¨æ€æ–¹æ³•
Object.setPrototypeOf(SubArray, Array);                        //ç»§æ‰¿é™æ€æ–¹æ³•

var arr = new SubArray();
arr.push(5);
arr[1] = 10;
console.log(arr.length);     //1  åº”è¯¥æ˜¯2
arr.length = 0;
console.log(arr);            //[0:5,1:10]  åº”è¯¥ä¸ºç©º
```
å¾ˆæ˜æ˜¾è¿™å·²ç»ä¸æ˜¯é‚£ä¸ªæˆ‘ä»¬ç†Ÿæ‚‰çš„æ•°ç»„äº†ï¼æˆ‘ä»¬å¯ä»¥ç”¨ class è¯•è¯•ï¼š
```js
class SubArray extends Array{}
var arr = new SubArray();
arr.push(5);
arr[1] = 10;
console.log(arr.length);     //2
arr.length = 0;
console.log(arr);            //[]
```
è¿˜æ˜¯ç†Ÿæ‚‰çš„å‘³é“ï¼Œå¯¹å§ï¼è¿™å°±å’Œä¹‹å‰æåˆ°çš„ç»§æ‰¿å·®å¼‚æœ‰å…³äº†ï¼Œå­ç±»æ²¡æœ‰è‡ªå·±çš„ thisï¼Œéœ€è¦å€ŸåŠ© super è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ååŠ å·¥å¾—åˆ°ä»çˆ¶ç±»å¾—åˆ°çš„ thisï¼Œå­ç±»æ„é€ å‡½æ•°å¿…é¡»è°ƒç”¨ super å‡½æ•°ã€‚è€Œ ES5 ä¸­å…ˆç”Ÿæˆå­ç±»çš„ thisï¼Œç„¶åæŠŠçˆ¶ç±»çš„ this ä¸­çš„å±æ€§æ–¹æ³•æ‹·è´è¿‡æ¥ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæœ‰çš„å±æ€§æ˜¯ä¸å¯æšä¸¾çš„ï¼Œè€Œæœ‰çš„å±æ€§æ˜¯ Symbol åçš„ï¼Œè¿™äº›å±æ€§ä¸èƒ½å¾ˆå¥½çš„å®Œæˆæ‹·è´ï¼Œå°±ä¼šå¯¼è‡´é—®é¢˜ï¼Œæ¯”å¦‚ Array æ„é€ å‡½æ•°çš„å†…éƒ¨å±æ€§ `[[DefineOwnProperty]]`ã€‚

åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è‡ªå·±çš„åˆé€‚çš„ç±», æ¯”å¦‚ä¸€ä¸ªæ–°çš„é”™è¯¯ç±»ï¼š
```js
class ExtendableError extends Error{
  constructor(message){
    super(message);
    this.stack = new Error().stack;
    this.name = this.constructor.name;
  }
}
throw new ExtendableError("test new Error");   //ExtendableError: test new Error
```

### é™æ€å±æ€§

ä¸ºä½•é™æ€å±æ€§éœ€è¦å•ç‹¬å†™ï¼Œè€Œé™æ€æ–¹æ³•ç›´æ¥ç®€å•å¸¦è¿‡ã€‚å› ä¸ºè¿™æ˜¯ä¸ªå…¼å®¹æ€§é—®é¢˜ï¼Œç›®å‰ ES6 çš„é™æ€æ–¹æ³•ç”¨ static å…³é”®å­—ï¼Œä½†æ˜¯é™æ€å±æ€§å’Œ ES5 ä¸€æ ·ï¼Œéœ€è¦å•ç‹¬å®šä¹‰:
```js
class A{}
A.staticProperty = "staticProperty";
console.log(A.staticProperty);      //"staticProperty"
```

ä¸è¿‡ ES7 æå‡ºå¯ä»¥åœ¨ class å†…éƒ¨å®ç°å®šä¹‰ï¼Œå¯æƒœç›®å‰ä¸æ”¯æŒï¼Œä½†æ˜¯è¿˜å¥½æœ‰ babel æ”¯æŒï¼š
```js
class A{
  static staticProperty = "staticProperty";   //ES7 é™æ€å±æ€§
  instanceProperty = 18;                      //ES7 å®ä¾‹å±æ€§
}
console.log(A.staticProperty);                //"staticProperty"
console.log(new A().instanceProperty);        //18
```

### new.target å±æ€§

new æœ¬æ¥æ˜¯ä¸ªå…³é”®å­—ï¼Œä½† ES6 ç»™å®ƒæ·»åŠ äº†å±æ€§â€”â€”`target`ã€‚è¯¥å±æ€§åªèƒ½åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ï¼Œç”¨æ¥åˆ¤æ–­æ„é€ å‡½æ•°æ˜¯å¦ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„, å¦‚æœæ„é€ å‡½æ•°è¢« new è°ƒç”¨è¿”å›æ„é€ å‡½æ•°æœ¬èº«ï¼Œå¦åˆ™è¿”å› undefinedï¼š
```js
function Person(){
  if(new.target){
    console.log("constructor has called");
  } else {
    console.log("function has called");
  }
}

new Person();     //"constructor has called"
Person();         //"function has called"
```
è¿™æ ·æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåªèƒ½ä½¿ç”¨ new è°ƒç”¨ï¼š
```js
function Person(name){
  if(new.target === Person){
    this.name = name;
  } else {
    throw new TypeError("constructor must be called by 'new'");
  }
}

new Person('Bob');     //"constructor has called"
Person();              //TypeError: constructor must be called by 'new'
Person.call({});       //TypeError: constructor must be called by 'new'
```

è¿™é‡Œéœ€è¦æ³¨æ„ï¼šçˆ¶ç±»æ„é€ å‡½æ•°ä¸­çš„ new.target ä¼šåœ¨è°ƒç”¨å­ç±»æ„é€ å‡½æ•°æ—¶è¿”å›å­ç±»ï¼Œå› æ­¤ä½¿ç”¨äº†è¯¥å±æ€§çš„ç±»ä¸åº”è¯¥è¢«å®ä¾‹åŒ–ï¼Œåªç”¨äºç»§æ‰¿ï¼Œç±»ä¼¼äº C++ ä¸­çš„æŠ½è±¡ç±»ã€‚
```js
class Person{
  constructor(name){
    if(new.target === Person){
      this.name = name;
    } else {
      throw new TypeError("constructor must be called by 'new'");
    }
  }
}
class Coder extends Person{}
new Coder('Bob');     //TypeError: constructor must be called by 'new' è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„
```
```js
//æŠ½è±¡ç±»å®ç°
class Person{
  constructor(name){
    if(new.target === Person){
      throw new TypeError("This class cannot be instantiated");
    }
    this.name = name;
  }
}
class Coder extends Person{}
var c = new Coder('Bob');
console.log(c.name);   //'Bob'
new Person('Bob');     //TypeError: This class cannot be instantiated
```

å…³äºæŠ½è±¡ç±»è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œè¦ä¸€ä¸ªç±»ä¸èƒ½å®ä¾‹åŒ–åªèƒ½ç»§æ‰¿ç”¨ä»€ä¹ˆç”¨ï¼Ÿ

>åœ¨ç»§æ‰¿ä¸­äº§ç”Ÿæ­§ä¹‰çš„åŸå› æœ‰å¯èƒ½æ˜¯ç»§æ‰¿ç±»ç»§æ‰¿äº†åŸºç±»å¤šæ¬¡ï¼Œä»è€Œäº§ç”Ÿäº†å¤šä¸ªæ‹·è´ï¼Œå³ä¸æ­¢ä¸€æ¬¡çš„é€šè¿‡å¤šä¸ªè·¯å¾„ç»§æ‰¿ç±»åœ¨å†…å­˜ä¸­åˆ›å»ºäº†åŸºç±»æˆå‘˜çš„å¤šä»½æ‹·è´ã€‚æŠ½è±¡ç±»çš„åŸºæœ¬åŸåˆ™æ˜¯åœ¨å†…å­˜ä¸­åªæœ‰åŸºç±»æˆå‘˜çš„ä¸€ä»½æ‹·è´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç±»å«"åŠ¨ç‰©"ï¼Œå¦æœ‰å¤šå„ç±»ç»§æ‰¿è‡ªåŠ¨ç‰©ï¼Œæ¯”å¦‚"èƒç”ŸåŠ¨ç‰©"ã€"åµç”ŸåŠ¨ç‰©"ï¼Œåˆæœ‰å¤šä¸ªç±»ç»§æ‰¿è‡ªå“ºä¹³åŠ¨ç‰©, æ¯”å¦‚"äºº", "çŒ«", "ç‹—"ï¼Œè¿™ä¸ªä¾‹å­å¥½åƒå¤æ‚äº†ï¼Œä¸è¿‡å¾ˆæ˜æ˜¾ï¼Œè¢«å®ä¾‹åŒ–çš„ä¸€å®šæ˜¯ä¸€ä¸ªä¸ªä½“ï¼Œæ¯”å¦‚"äºº", "çŒ«", "ç‹—"ã€‚è€Œ"èƒç”ŸåŠ¨ç‰©"ï¼Œä¸åº”è¯¥è¢«å®ä¾‹åŒ–ä¸ºä¸€ä¸ªä¸ªä½“ï¼Œå®ƒä»…ä»…æ˜¯äººç±»åœ¨çŸ¥è¯†é¢†åŸŸï¼Œä¸ºäº†åˆ†ç±»ä¸–é—´ä¸‡ç‰©è€ŒæŠ½è±¡çš„ä¸€ä¸ªåˆ†ç±»ã€‚ä½†æ˜¯é¢å‘å¯¹è±¡è®¾è®¡è¦æ±‚æˆ‘ä»¬æŠŠå…±æ€§æ”¾åœ¨ä¸€èµ·ä»¥å‡å°‘ä»£ç ï¼Œå› æ­¤å°±æœ‰äº†æŠ½è±¡ç±»ã€‚æ‰€ä»¥èƒç”ŸåŠ¨ç‰©éƒ½ä¼šè¿åŠ¨ï¼Œéƒ½å¯ä»¥å‘å‡ºå£°éŸ³ï¼Œè¿™äº›å°±åº”è¯¥æ˜¯å…±æ€§æ”¾åœ¨"èƒç”ŸåŠ¨ç‰©"ç±»ä¸­ï¼Œè€Œæ‰€ä»¥åŠ¨ç‰©éƒ½ä¼šå‘¼å¸ï¼Œä¼šæ–°é™ˆä»£è°¢ï¼Œè¿™äº›å…±æ€§å°±æ”¾åœ¨åŠ¨ç‰©é‡Œé¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨"äºº", "çŒ«", "ç‹—"è¿™æ ·çš„å…·ä½“ç±»ä¸­ä¸€ééçš„å®ç°è¿™äº›å…±æœ‰çš„æ–¹æ³•å’Œå±æ€§ã€‚

## ä¿®é¥°å™¨

### ä¿®é¥°å™¨

ä¿®é¥°å™¨æ˜¯ ES7 æå‡ºçš„ä¸€ä¸ªææ¡ˆï¼Œç”¨æ¥ä¿®æ”¹ç±»çš„è¡Œä¸ºã€‚ç›®å‰éœ€è¦ babel æ‰å¯ä»¥ä½¿ç”¨ã€‚å®ƒæœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼šå¯ä»¥åœ¨ç¼–è¯‘æœŸè¿è¡Œä»£ç ï¼å…¶æœ¬è´¨ä¹Ÿå°±æ˜¯åœ¨ç¼–è¯‘å™¨æ‰§è¡Œçš„å‡½æ•°ã€‚å…¶æ‰§è¡Œæ ¼å¼å¦‚ä¸‹ï¼š
```js
@decorator    //decorator æ˜¯ä¿®é¥°å™¨åï¼Œå³å‡½æ•°å
class A{}
//ç›¸å½“äº
class A{}
A = decorator(A) || A;
```
ä¿®é¥°å™¨å‡½æ•°æ¥å—3ä¸ªå‚æ•°ï¼Œä¾æ¬¡æ˜¯ç›®æ ‡å‡½æ•°ã€å±æ€§å(å¯å¿½ç•¥)ã€è¯¥å±æ€§çš„æè¿°å¯¹è±¡(å¯å¿½ç•¥)ã€‚
```js
function test(target){
  target.isTestable = true;               //åˆ©ç”¨ä¿®é¥°å™¨ç»™ç±»æ·»åŠ é™æ€å±æ€§
  target.prototype.isTestable = true;     //åˆ©ç”¨ä¿®é¥°å™¨ç»™ç±»æ·»åŠ åŠ¨æ€å±æ€§
}

@test
class A{}

console.log(A.isTestable);       //true
console.log(new A().isTestable);   //true
```

ä¾‹å¦‚ä¹‹å‰çš„ mixin å¯ä»¥ç”¨ä¿®é¥°å™¨å®ç°ä¸€ä¸ªç®€å•çš„ç‰ˆæœ¬ï¼š
```js
function mixins(...list){
  return function(target){
    Object.assign(target.prototype, ...list);
  }
}
var Foo = {
  foo(){console.log("foo");}
};
@mixins(Foo)
class Cla{}
let obj = new Cla();
obj.foo();     //"foo"
```

ä¿®é¥°å™¨ä¸ä»…ä»…å¯ä»¥ä¿®é¥°ç±»ï¼Œè¿˜å¯ä»¥ä¿®é¥°ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼š
```js
function readonly(target, name, descriptor){
  descriptor.writable = false;
  return descriptor;
}

class Person{
  constructor(name, age, tel){
    this.name = name;
    this.id = id;
  }
  @readonly
  id(){return this.id};
}
```
å½“ç„¶ä¹Ÿå¯ä»¥åŒæ—¶è°ƒç”¨2ä¸ªä¿®é¥°å™¨ï¼š
```js
function readonly(target, name, descriptor){
  descriptor.writable = false;
  return descriptor;
}
function nonenumerable(target, name, descriptor){
  descriptor.enumerable = false;
  return descriptor;
}

class Person{
  constructor(name, age, tel){
    this.name = name;
    this.id = id;
  }
  @readonly
  @nonenumerable
  id(){return this.id};
}
```

ä½¿ç”¨ä¿®é¥°å™¨åº”è¯¥æ³¨æ„ï¼šè™½ç„¶ç±»æœ¬è´¨æ˜¯ä¸ªå‡½æ•°ï¼Œä½†ä¿®é¥°å™¨ä¸èƒ½ç”¨äºå‡½æ•°ï¼Œå› ä¸ºå‡½æ•°å…·æœ‰å£°æ˜æå‡ã€‚

### core-decroators.js

è¿™æ˜¯ä¸ªä¸‰æ–¹æ¨¡å—ï¼Œä½¿ç”¨`import {function Namelist} from 'core-decroators';`å¼•å…¥ã€‚å®ƒæä¾›äº†å‡ ä¸ªå¸¸è§çš„ä¿®é¥°å™¨ï¼š

- @autobind
æ˜¯å¯¹è±¡ä¸­çš„ this å§‹ç»ˆç»‘å®šåŸå§‹å¯¹è±¡ï¼š
```js
class Person{
  @autobind
  whoami(){
    return this;
  }
}
let person = new Person();
let getPerson = person.getPerson;

getPerson() === person;    //true
```

- @readonly
ä½¿å¾—å±æ€§æ–¹æ³•åªè¯»
```js
class Person{
  @readonly
  id = gen();     //gen æ˜¯ä¸€ä¸ªè®¡æ•°å™¨
}
var p = new Person()
p.id = 123;   //Cannot assign to read only property 'id' of [object Object]
```

- @override
æ£€æŸ¥å­ç±»æ–¹æ³•æ˜¯å¦æ­£ç¡®çš„è¦†ç›–äº†çˆ¶ç±»çš„åŒåæ–¹æ³•ï¼Œå¦‚æœä¸æ­£ç¡®ä¼šæŠ¥é”™
```js
class Person{
  work(){console.log("I am working");}
}
class Coder extends Person{
  @override
  work(){console.log("I am coding");}   //å¦‚æœä¸æ­£ç¡®ä¼šåœ¨è¿™é‡ŒæŠ¥é”™
}
```

- @deprecate(ä¹Ÿä½œ: @deprecated)
åœ¨æ§åˆ¶å°æ˜¾ç¤ºä¸€æ¡ warningï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•ä¸ä¹…åå°†è¢«åºŸé™¤ï¼Œæ¥å—ä¸€ä¸ªå¯é€‰çš„å‚æ•°ä½œä¸ºè­¦å‘Šå†…å®¹, æ¥å—ç¬¬äºŒä¸ªå‚æ•°(å¯¹è±¡)è¡¨ç¤ºæ›´å¤šä¿¡æ¯
```js
class Person{
  @deprecate
  facepalm(){}

  @deprecate('We stopped facepalming')
  facepalmHard(){}

  @deprecate('We stopped facepalming', {url:'http://balabala.com'})
  facepalmHarder(){}
}
```

- @suppressWarnings
æŠ‘åˆ¶ deprecate ä¿®é¥°å™¨å¯¼è‡´è°ƒç”¨ console.warn(), ä½†å¼‚æ­¥ä»£ç å‘å‡ºçš„é™¤å¤–ã€‚
```js
class Person{
  @deprecate
  facepalm(){}

  @supressWarnings
  facepalmWithoutWarning(){
    this.facepalm();
  }
}
let p = new Person();
p.facepalm();    //æ§åˆ¶å°æ˜¾ç¤ºè­¦å‘Š
p.facepalmWithoutWarning();    //æ²¡æœ‰è­¦å‘Š
```

### å…¶å®ƒç¬¬ä¸‰æ–¹ä¿®é¥°å™¨

æ­¤å¤–è¿˜æœ‰ä¸€äº›åº“æä¾›ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚ Postal.js([Github](https://github.com/postaljs/postal.js))ä¸­çš„ `@publish`, å¯ä»¥åœ¨å‡½æ•°è°ƒç”¨æ—¶å‘å¸ƒä¸€ä¸ªäº‹ä»¶ï¼š
```js
import publish from "../to/decorators/publish";

class FooComponent{
  @publish("foo.some.message", "component")
  someMethod(){}

  @publish("foo.some.other", "")
  anotherMethod(){}
}
```

å†æ¯”å¦‚ Trait([Github](https://github.com/CkcktailJS/traits-decorator)), å’Œ mixin åŠŸèƒ½ç±»ä¼¼ï¼Œæä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼šé˜²æ­¢åŒåå†²çªï¼Œæ’é™¤æ··å…¥æŸäº›æ–¹æ³•ï¼Œä¸ºæ··å…¥æ–¹æ³•èµ·åˆ«åç­‰
```js
import {traits} from 'traits-decorator'

class TFoo{
  foo(){console.log("foo1")}
}
class TBar{
  bar(){console.log("bar")}
  foo(){console.log("foo2")}
}

@traits(TFoo, TBar)       //ä¼šæŠ¥é”™ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªç±»ä¸­æœ‰åŒåæ–¹æ³•
class MyClass{}

let obj = new MyClass();
//å¦‚æœæ²¡æœ‰ç¬¬å…«è¡Œçš„åŒåæ–¹æ³•ï¼Œè¾“å‡ºå¦‚ä¸‹
obj.foo();   //"foo1"
obj.bar();   //"bar"
```
ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸Šé¢ç¬¬11è¡Œæ’é™¤è¿™ä¸ª fooï¼Œè®©å®ƒå¯ä»¥è¢«è¦†ç›–ï¼š
```js
@traits(TFoo, TBar::excludes('foo'))
class MyClass{}
```
ä¹Ÿå¯é‡å‘½ååŒåæ–¹æ³•ï¼š
```js
@traits(TFoo, TBar::alias(foo:'aliasFoo'))
class MyClass{}
```
å½“ç„¶ç»‘å®šè¿ç®—ç¬¦å¯ä»¥é“¾å¼è°ƒç”¨ï¼š
```js
//å‡è®¾è¿˜æœ‰ä¸ªåŒåçš„ baz æ–¹æ³•
@traits(TFoo, TBar::excludes('foo')::alias(baz:'aliasBaz'))
class MyClass{}

//å¦ä¸€ç§å†™æ³•
@traits(TFoo, TBar::as({excludes: ['foo'], alias: {baz:'aliasBaz'}}))
class MyClass{}
```

## Module

### è®¤è¯†æ¨¡å—

JS ä½œä¸ºä¸€åç¼–ç¨‹è¯­è¨€ï¼Œä¸€ç›´ä»¥æ¥æ²¡æœ‰æ¨¡å—çš„æ¦‚å¿µã€‚ä¸¥é‡å¯¼è‡´å¤§å‹é¡¹ç›®å¼€å‘å—é˜»ï¼Œjs æ–‡ä»¶è¶Šå†™è¶Šå¤§ï¼Œä¸æ–¹ä¾¿ç»´æŠ¤ã€‚å…¶ä»–è¯­è¨€éƒ½æœ‰æ¨¡å—çš„æ¥å£ï¼Œæ¯”å¦‚ Ruby çš„ requireï¼Œpython çš„ importï¼ŒC++ å¤©ç”Ÿçš„ #includeï¼Œç”šè‡³ CSS éƒ½æœ‰ @importã€‚åœ¨ ES6 ä¹‹å‰ï¼Œæœ‰ä¸»è¦çš„2ä¸ªæ¨¡å—åŒ–æ–¹æ¡ˆï¼šCommonJS å’Œ AMDã€‚å‰è€…ç”¨äºæœåŠ¡å™¨ï¼Œåè€…ç”¨äºæµè§ˆå™¨ã€‚CommonJS è¿™æ ·å¼•å…¥æ¨¡å—ï¼š
```js
let {stat, exists, readFile} = require('fs');
```

AMD å’Œ CommonJS å¼•å…¥æ¨¡å—æ–¹æ³•å·®ä¸å¤šï¼Œå…¶ä»£è¡¨æ˜¯ require.jsã€‚è¿™é‡Œæˆ‘ä»¬ä¸»è¦ç ”ç©¶ ES6 æä¾›çš„æ–¹æ³•ï¼š
```js
import {stat, exists, readFile} from 'fs'
```
è¿™ä¸ªæ–¹æ³•ç›¸æ¯”ä¹‹å‰çš„æ–¹æ¡ˆï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š

- æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ç¼–è¯‘çš„æ—¶å€™å®Œæˆæ¨¡å—åŠ è½½ï¼Œç§°ä¹‹ä¸º"ç¼–è¯‘æ—¶åŠ è½½", è€Œ CommonJS ä½¿ç”¨çš„æ˜¯ "è¿è¡Œæ—¶åŠ è½½"ã€‚æ˜æ˜¾ ES6 æ•ˆç‡æ›´é«˜
- ä¸å†éœ€è¦ UMD æ¨¡å—æ ¼å¼ï¼Œæœªæ¥æœåŠ¡å™¨å’Œæµè§ˆå™¨ä¸€å®šéƒ½èƒ½æ”¯æŒè¿™ç§æ–¹æ³•
- å°†æ¥æµè§ˆå™¨ API å¯ä»¥ç”¨æ¨¡å—çš„æ ¼å¼æä¾›ï¼Œä¸éœ€è¦åšæˆå…¨å±€å˜é‡æˆ– navigator çš„å±æ€§
- ä¸éœ€è¦åå¤çš„å°è£…å’Œå®šä¹‰å‘½åç©ºé—´ï¼Œç›´æ¥ä»¥æ¨¡å—å½¢å¼æä¾›å³å¯
- æ¨¡å—é»˜è®¤å·¥ä½œåœ¨ä¸¥æ ¼æ¨¡å¼ï¼Œå³ä½¿æ²¡æœ‰æŒ‡å®š"use strict", å…³äºä¸¥æ ¼æ¨¡å¼å¯ä»¥çœ‹ï¼š[JavascriptåŸºç¡€(2) - ä¸¥æ ¼æ¨¡å¼ç‰¹ç‚¹](http://blog.csdn.net/faremax/article/details/56289671)
- ä¸€ä¸ªæ¨¡å—å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæœ‰æ•ˆåœ°å‡å°‘äº†å…¨å±€å˜é‡æ±¡æŸ“

### export å’Œ import

æ¨¡å—åŠŸèƒ½ä¸»è¦ç”±2ä¸ªå‘½ä»¤ç»„æˆï¼šexport å’Œ importã€‚export å…³é”®å­—ç”¨äºè§„å®šæ¨¡å—çš„å¯¹å¤–æ¥å£ï¼Œimport å…³é”®å­—ç”¨äºè¾“å…¥å…¶ä»–æ¨¡å—æä¾›çš„åŠŸèƒ½ã€‚è¿™é‡Œéœ€è¦çŸ¥é“çš„æ˜¯ï¼ŒES6 ä¸­æ¨¡å—å¯¼å‡ºçš„éƒ½ä¼šæ„æˆä¸€ä¸ªå¯¹è±¡ã€‚

- export å¯¼å‡ºæ¨¡å—çš„éƒ¨åˆ†æ–¹æ³•å±æ€§æˆ–ç±»
```js
export var a = 1;
export var b = 2;
export var c = 3;
```
ä¸Šé¢å¯¼å‡ºäº†3ä¸ªå˜é‡ï¼Œå’Œä¸‹é¢çš„ä¸‹æ³•ç­‰ä»·ï¼š
```js
var a = 1;
var b = 2;
var c = 3;
export {a, b, c};    //è¿™ç§å†™æ³•æ›´å¥½ï¼Œåœ¨æ–‡ä»¶ç»“å°¾ç»Ÿä¸€å¯¼å‡ºï¼Œæ¸…æ™°æ˜äº†
```
å½“ç„¶è¿˜å¯ä»¥å¯¼å‡ºå‡½æ•°å’Œç±»
```js
//å¯¼å‡ºä¸€ä¸ªå‡½æ•° add
export function add(x,y){
  return x + y;
}
//å¯¼å‡ºä¸€ä¸ªç±»
export default class Person{}
```
è¿˜å¯ä»¥åœ¨å¯¼å‡ºæ—¶å€™å¯¹å‚æ•°é‡å‘½åï¼š
```js
function foo(){}
function bar(){}

export {foo, bar as bar2, bar as bar3}     //bar è¢«é‡å‘½åä¸º bar2,bar3è¾“å‡ºäº†2æ¬¡
```

- import å¯¼å…¥å‘½ä»¤å¯ä»¥å¯¼å…¥å…¶ä»–æ¨¡å—é€šè¿‡ export å¯¼å‡ºçš„éƒ¨åˆ†
```js
// abc.js
var a = 1;
var b = 2;
var c = 3;
export {a, b, c}

//main.js
import {a, b, c} from './abc';      //æ¥å—çš„å˜é‡ç”¨å¤§æ‹¬å·è¡¨ç¤ºï¼Œä»¥è§£æ„èµ‹å€¼çš„å½¢å¼è·å–
console.log(a, b, c);
```
å¯¼å…¥çš„æ—¶å€™ä¹Ÿå¯ä»¥ä¸ºå˜é‡é‡æ–°å–ä¸€ä¸ªåå­—
```js
import {a as aa, b, c};
console.log(aa, b, c)
```
å¦‚æœæƒ³åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å…ˆè¾“å…¥åè¾“å‡ºåŒä¸€ä¸ªæ¨¡å—ï¼Œimportè¯­å¥å¯ä»¥å’Œexportè¯­å¥å†™åœ¨ä¸€èµ·ã€‚
```js
// æ­£å¸¸å†™æ³•
import {a, b, c} form './abc';
export {a, b, c}

// ä½¿ç”¨ç®€å†™, å¯è¯»æ€§ä¸å¥½ï¼Œä¸å»ºè®®
export {a, b, c} from './abc';

//ES7 æè®®ï¼Œåœ¨ç®€åŒ–å…ˆè¾“å…¥åè¾“å‡ºçš„å†™æ³•ã€‚ç°åœ¨ä¸èƒ½ä½¿ç”¨ï¼Œä¹Ÿä¸å»ºè®®ä½¿ç”¨ï¼Œå¯è¯»æ€§ä¸å¥½
export a, b, c from './abc'
```

ä½¿ç”¨ import å’Œ export éœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

- export å¿…é¡»å†™åœ¨æ‰€åœ¨æ¨¡å—ä½œç”¨äºçš„é¡¶å±‚ã€‚å¦‚æœå†™åœ¨äº†å†…éƒ¨ä½œç”¨äºä¼šæŠ¥é”™
- export è¾“å‡ºçš„å€¼æ˜¯åŠ¨æ€ç»‘å®šçš„ï¼Œç»‘å®šåœ¨å…¶æ‰€åœ¨çš„æ¨¡å—ã€‚
```js
// foo.js
export var foo = 'foo';

setTimeout(function() {
  foo = 'foo2';
}, 500);

// main.js
import * as m from './foo';
console.log(m.foo); // foo
setTimeout(() => console.log(m.foo), 500); //foo2            500ms ååŒæ ·ä¼šè¢«ä¿®æ”¹
```
- import å…·æœ‰å£°æ˜æå‡ï¼Œè€Œä¸”ä¼šæå‡åˆ°æ•´ä¸ªæ–‡ä»¶æœ€ä¸Šé¢
- import è·å¾—çš„å˜é‡éƒ½æ˜¯åªè¯»çš„ï¼Œä¿®æ”¹å®ƒä»¬ä¼šæŠ¥é”™
- åœ¨ export è¾“å‡ºå†…å®¹æ—¶ï¼Œå¦‚æœåŒæ—¶è¾“å‡ºå¤šä¸ªå˜é‡ï¼Œéœ€è¦ä½¿ç”¨å¤§æ‹¬å·{}ï¼ŒåŒæ—¶ import å¯¼å…¥å¤šä¸ªå˜é‡ä¹Ÿéœ€è¦å¤§æ‹¬å·
- import å¼•å…¥æ¨¡å—çš„é»˜è®¤åç¼€æ˜¯ .js, æ‰€ä»¥å†™çš„æ—¶å€™å¯ä»¥å¿½ç•¥ js æ–‡ä»¶æ‰©å±•å
- import ä¼šæ‰§è¡Œè¦æ‰€åŠ è½½çš„æ¨¡å—ã€‚å¦‚ä¸‹å†™æ³•ä»…ä»…æ‰§è¡Œä¸€ä¸ªæ¨¡å—ï¼Œä¸å¼•å…¥ä»»ä½•å€¼
```js
import './foo';    //æ‰§è¡Œ foo.js ä½†ä¸å¼•å…¥ä»»ä½•å€¼
```

### æ¨¡å—æ•´ä½“åŠ è½½

å½“ç„¶æ¨¡å—å¯ä»¥ä½œä¸ºæ•´ä½“åŠ è½½ï¼Œä½¿ç”¨*å…³é”®å­—ï¼Œå¹¶åˆ©ç”¨ as é‡å‘½åå¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰è·å¾—çš„ export çš„å‡½æ•°ã€å€¼å’Œç±»éƒ½æ˜¯è¯¥å¯¹è±¡çš„æ–¹æ³•ï¼š
```js
// abc.js
export var a = 1;
export var b = 2;
export var c = 3;

// main.js
import * as abc from './abc';
console.log(abc.a, abc.b, abc.c);
```
ä¸Šé¢ main.js ä¸­çš„æ•´ä½“åŠ è½½å¯ä»¥ç”¨ module å…³é”®å­—å®ç°ï¼š
```js
//æš‚æ—¶æ— æ³•å®ç°
module abc from './abc';
console.log(abc.a, abc.b, abc.c);   //1 2 3
```

æ³¨æ„ï¼Œä»¥ä¸Š2ç§æ–¹å¼è·å¾—çš„æ¥å£ï¼Œä¸åŒ…æ‹¬ export default å®šä¹‰çš„é»˜è®¤æ¥å£ã€‚

### export default

ä¸ºäº†ä½¿æ¨¡å—çš„ç”¨æˆ·å¯ä»¥ä¸çœ‹æ–‡æ¡£ï¼Œæˆ–è€…å°‘çœ‹æ–‡æ¡£ï¼Œè¾“å‡ºæ¨¡å—çš„æ—¶å€™åˆ©ç”¨ export default æŒ‡å®šé»˜è®¤è¾“å‡ºçš„æ¥å£ã€‚ä½¿ç”¨ export defalut è¾“å‡ºæ—¶ï¼Œä¸éœ€è¦å¤§æ‹¬å·ï¼Œè€Œ import è¾“å…¥å˜é‡æ—¶ï¼Œä¹Ÿä¸éœ€è¦å¤§æ‹¬å·(æ²¡æœ‰å¤§æ‹¬å·å³è¡¨ç¤ºè·å¾—é»˜è®¤è¾“å‡º)
```js
// abc.js
var a = 1, b = 2, c = 3;
export {a, b};
export default c;     //ç­‰ä»·äº export default 3;

// main.js
import {a, b} from './abc';
import num from './abc';        // ä¸éœ€è¦å¤§æ‹¬å·, è€Œä¸”å¯ä»¥ç›´æ¥æ”¹å(å¦‚æœå¿…é¡»ç”¨åŸåä¸è¿˜å¾—çœ‹æ‰‹å†Œä¹ˆ?)
console.log(a, b, num)            // 1 2 3
```
æœ¬è´¨ä¸Šï¼Œexport defaultè¾“å‡ºçš„æ˜¯ä¸€ä¸ªå«åšdefaultçš„å˜é‡æˆ–æ–¹æ³•ï¼Œè¾“å…¥è¿™ä¸ªdefaultå˜é‡æ—¶ä¸éœ€è¦å¤§æ‹¬å·ã€‚
```js
// abc.js
var a = 20;
export {a as default};

// main.js
import a from './abc'; // è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„
console.log(a);        // 20

// è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„
import {default as aa} from './abc';
console.log(aa);       // 20
```

å¦‚æœéœ€è¦åŒæ—¶è¾“å…¥é»˜è®¤æ–¹æ³•å’Œå…¶ä»–å˜é‡å¯ä»¥è¿™æ ·å†™ import:
```js
import customNameAsDefaultExport, {otherMethod}, from './export-default';
```

è¿™é‡Œéœ€è¦æ³¨æ„ï¼šä¸€ä¸ªæ¨¡å—åªèƒ½æœ‰ä¸€ä¸ªé»˜è®¤è¾“å‡ºï¼Œæ‰€ä»¥ export default åªèƒ½ç”¨ä¸€æ¬¡

### æ¨¡å—çš„ç»§æ‰¿

æ‰€è°“æ¨¡å—çš„ç»§æ‰¿ï¼Œå°±æ˜¯ä¸€ä¸ªæ¨¡å— B è¾“å‡ºäº†æ¨¡å— A å…¨éƒ¨çš„æ¥å£ï¼Œå°±ä»¿ä½›æ˜¯ B ç»§æ‰¿äº† Aã€‚åˆ©ç”¨ `export *` å®ç°ï¼š
```js
// circleplus.js
export * from 'circle';            //å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥é€‰æ‹©åªç»§æ‰¿å…¶éƒ¨åˆ†æ¥å£ï¼Œç”šè‡³å¯ä»¥å¯¹æ¥å£æ”¹å
export var e = 2.71828182846;
export default function(x){        //é‡æ–°å®šä¹‰äº†é»˜è®¤è¾“å‡ºï¼Œå¦‚æœä¸æƒ³é‡æ–°å®šä¹‰å¯ä»¥ï¼šexport customNameAsDefaultExport from 'circle';
  return Math.exp(x);
}

//main.js
import * from 'circleplus';        //åŠ è½½å…¨éƒ¨æ¥å£
import exp from 'circleplus';      //åŠ è½½é»˜è®¤æ¥å£
//...use module here
```
ä¸Šé¢è¿™ä¸ªä¾‹å­ circleplus ç»§æ‰¿äº† circleã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ`export *` ä¸ä¼šå†æ¬¡è¾“å‡º circle ä¸­çš„é»˜è®¤è¾“å‡º(export default)ã€‚

åœ¨ä½¿ç”¨å’Œå®šä¹‰æ¨¡å—æ—¶ï¼Œå¸Œæœ›å¯ä»¥åšåˆ°ä»¥ä¸‹å‡ ä¸ªå»ºè®®ï¼š

- Module è¯­æ³•æ˜¯ JavaScript æ¨¡å—çš„æ ‡å‡†å†™æ³•ï¼ŒåšæŒä½¿ç”¨è¿™ç§å†™æ³•ã€‚ä½¿ç”¨ import å–ä»£ require, ä½¿ç”¨ export å–ä»£module.exports
- å¦‚æœæ¨¡å—åªæœ‰ä¸€ä¸ªè¾“å‡ºå€¼ï¼Œå°±ä½¿ç”¨ export defaultï¼Œå¦‚æœæ¨¡å—æœ‰å¤šä¸ªè¾“å‡ºå€¼ï¼Œå°±ä¸ä½¿ç”¨ export default
- å°½é‡ä¸è¦ export default ä¸æ™®é€šçš„ export åŒæ—¶ä½¿ç”¨
- ä¸è¦åœ¨æ¨¡å—è¾“å…¥ä¸­ä½¿ç”¨é€šé…ç¬¦ã€‚å› ä¸ºè¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„æ¨¡å—ä¹‹ä¸­ï¼Œæœ‰ä¸€ä¸ªé»˜è®¤è¾“å‡º(export default)
- å¦‚æœæ¨¡å—é»˜è®¤è¾“å‡ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°åçš„é¦–å­—æ¯åº”è¯¥å°å†™ï¼›å¦‚æœæ¨¡å—é»˜è®¤è¾“å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡åçš„é¦–å­—æ¯åº”è¯¥å¤§å†™

### ES6 æ¨¡å—åŠ è½½çš„å®è´¨

ES6 æ¨¡å—åŠ è½½çš„æœºåˆ¶æ˜¯å€¼çš„åº”ç”¨ï¼Œè€Œ CommonJS æ˜¯å€¼çš„æ‹·è´ã€‚è¿™æ„å‘³ç€ï¼Œ ES6 æ¨¡å—å†…çš„å€¼çš„å˜æ¢ä¼šå½±å“æ¨¡å—å¤–å¯¹åº”çš„å€¼ï¼Œè€Œ CommonJS ä¸ä¼šã€‚ ES6 é‡åˆ° import æ—¶ä¸ä¼šç«‹åˆ»æ‰§è¡Œè¿™ä¸ªæ¨¡å—ï¼Œåªç”Ÿæˆä¸€ä¸ªåŠ¨æ€å¼•ç”¨ï¼Œéœ€è¦ç”¨çš„æ—¶å€™å†å»é‡Œé¢æ‰¾å€¼ã€‚æœ‰ç‚¹åƒ Unix ä¸­çš„ç¬¦å·é“¾æ¥ã€‚æ‰€ä»¥è¯´ ES6çš„æ¨¡å—æ˜¯åŠ¨æ€å¼•ç”¨ï¼Œä¸ä¼šç¼“å­˜å€¼ã€‚ä¹‹å‰çš„è¿™ä¸ªä¾‹å­å°±å¯ä»¥è¯´æ˜é—®é¢˜ï¼š
```js
// foo.js
export let counter = 3;
export function inc(){
  counter++;
}

// main.js
import {counter, inc} from './foo';
console.log(counter);    //3
inc();
console.log(counter);    //4
```
æˆ‘ä»¬çœ‹ä¸€ä¸ª CommonJS çš„æƒ…å†µ
```js
// foo.js
let counter = 3;
function inc(){
  counter++;
}
module.exports = {
  counter: counter,
  inc: inc
}

// main.js
let foo = require('./foo')
let counter = foo.counter;
let inc = foo.inc;

console.log(counter);    //3
inc();
console.log(counter);    //3
```

### å¾ªç¯åŠ è½½

ä¸çŸ¥é“ä½ ä»¬åªä¸çŸ¥é“å¾ªç¯å¼•ç”¨ï¼Œåœ¨ [js åƒåœ¾å›æ”¶æœºåˆ¶](http://blog.csdn.net/faremax/article/details/58086991)ä¸­æåˆ°è¿‡ï¼šå¦‚æœ A å¯¹è±¡çš„ä¸€ä¸ªå±æ€§å€¼æ˜¯ B å¯¹è±¡ï¼Œè€Œ B å¯¹è±¡çš„ä¸€ä¸ªå±æ€§å€¼æ˜¯ A å¯¹è±¡ï¼Œå°±ä¼šå½¢æˆå¾ªç¯å¼•ç”¨ï¼Œæ— æ³•é‡Šæ”¾ä»–ä»¬çš„å†…å­˜ã€‚è€Œæ¨¡å—ä¸­ä¹Ÿä¼šå‡ºç°å¾ªç¯åŠ è½½çš„æƒ…å†µï¼šå¦‚æœ A æ¨¡å—çš„æ‰§è¡Œä¾èµ– B æ¨¡å—ï¼Œè€Œ B æ¨¡å—çš„æ‰§è¡Œä¾èµ– A æ¨¡å—ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªå¾ªç¯åŠ è½½ï¼Œç»“æœç¨‹åºä¸èƒ½å·¥ä½œï¼Œæˆ–è€…æ­»æœºã€‚ç„¶è€Œï¼Œè¿™æ ·çš„å…³ç³»å¾ˆéš¾é¿å…ï¼Œå› ä¸ºå¼€å‘è€…ä¼—å¤šï¼Œè°éƒ½ä¼šåœ¨å¼€å‘è‡ªå·±çš„æ¨¡å—æ—¶ä½¿ç”¨åˆ«äººçš„å‡ ä¸ªæ¨¡å—ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œå°±è¡Œäº’è”ç½‘ä¸€æ ·ï¼Œè¿™æ ·çš„ä¾èµ–ä¹Ÿç»‡æˆäº†ä¸€ä¸ªç½‘ã€‚

ES6 å’Œ CommonJS å¤„ç†å¾ªç¯åŠ è½½åˆä¸ä¸€æ ·ï¼Œä» CommonJS å¼€å§‹ç ”ç©¶

- CommonJS
CommonJS æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªæ¨¡å—å¯¹åº”çš„ js æ–‡ä»¶ååœ¨å†…å­˜ä¸­å°±ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼š
```json
{
  id: '...',           //è¡¨ç¤ºå±æ€§çš„æ¨¡å—å
  exports: {...};      //æ¨¡å—è¾“å‡ºçš„å„ä¸ªæ¥å£
  loaded: true,        //è¡¨ç¤ºæ˜¯å¦åŠ è½½å®Œæ¯•
  //...å†…å®¹å¾ˆå¤šï¼Œä¸ä¸€ä¸€åˆ—ä¸¾äº†
}
```
ä¹‹åä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼Œå³ä½¿åœ¨å†™ä¸€é requrieï¼Œéƒ½ä¸ä¼šå†æ‰§è¡Œå¯¹åº” js æ–‡ä»¶äº†ï¼Œä¼šç›´æ¥åœ¨è¿™ä¸ªå¯¹è±¡ä¸­å–å€¼ã€‚
CommonJS å¦‚æœé‡åˆ°å¾ªç¯åŠ è½½ï¼Œå°±è¾“å‡ºå·²æ‰§è¡Œçš„éƒ¨åˆ†ï¼Œä¹‹åçš„ä¸å†æ‰§è¡Œï¼Œæ‰§è¡Œé¡ºåºä»¥æ³¨é‡Šåºå·ä¸ºå‡†(ä»0å¼€å§‹)ï¼š
```js
// a.js
exports.done = false;         //1. å…ˆè¾“å‡º done
var b = require('./b.js');    //2. è¿›å…¥ b.js æ‰§è¡Œ b.js    //5. å‘ç° a.js æ²¡æ‰§è¡Œå®Œï¼Œé‚£å°±é‡å¤ä¸æ‰§è¡Œ a.jsï¼Œè¿”å›å·²ç»æ‰§è¡Œçš„ exports
console.log(`In a.js, b.done = ${b.done}`);     //10. ç¬¬2æ­¥çš„ b.js æ‰§è¡Œå®Œäº†ï¼Œç»§ç»­æ‰§è¡Œ a.js å¾—åˆ°æ§åˆ¶å°è¾“å‡ºï¼š'In a.js, b.done = true'
exports.done = true;          //11
console.log('a.js executed');  //12. å¾—åˆ°æ§åˆ¶å°è¾“å‡ºï¼š"a.js executed"

// b.js
exports.done = false;         //3. å…ˆè¾“å‡º done
var a = require('./a.js');    //4. æ‰§è¡Œåˆ°è¿™é‡Œå‘ç”Ÿå¾ªç¯åŠ è½½ï¼Œå» a.js æ‰§è¡Œ a.js     //6. åªå¾—åˆ°äº† a.js ä¸­çš„ done ä¸º false
console.log(`In b.js, a.done = ${a.done}`);       //7. å¾—åˆ°æ§åˆ¶å°è¾“å‡ºï¼š"In b.js, a.done = false"
exports.done = true;     //8. è¾“å‡º done, è¦†ç›–äº†ç¬¬3æ­¥çš„è¾“å‡º
console.log('b.js executed');     //9. å¾—åˆ°æ§åˆ¶å°è¾“å‡ºï¼š"b.js executed"

//main.js
var a = require("./a.js");    //0. å» a.js æ‰§è¡Œ a.js
var b = require("./b.js");    //13. b.js å·²ç»æ‰§è¡Œè¿‡äº†ï¼Œç›´æ¥å»å†…å­˜ä¸­çš„å¯¹è±¡å–å€¼
console.log(`In mainï¼Œa.done = ${a.done}, b.done = ${b.done}`)    //å¾—åˆ°æ§åˆ¶å°è¾“å‡ºï¼š'In mainï¼Œa.done = true, b.done = true'
```

- ES6
ç”±äº ES6 ä½¿ç”¨çš„æ˜¯åŠ¨æ€å¼•ç”¨ï¼Œé‡åˆ° import æ—¶ä¸ä¼šæ‰§è¡Œæ¨¡å—ã€‚æ‰€ä»¥å’Œ CommonJS æœ‰æœ¬è´¨çš„åŒºåˆ«ã€‚åŒæ ·æˆ‘ä»¬çœ‹ä¸ªä¾‹å­ï¼š
```js
// a.js
import {bar} from './b.js';
export function foo(){
  bar();
  console.log("finished")
}

// b.js
import {foo} from './a.js';
export function bar(){
  foo();
}

//main.js
import * from './a.js';
import * from './b.js';
//...
```
ä¸Šé¢è¿™æ®µä»£ç å†™æˆ CommonJS å½¢å¼æ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œåº”ä¸º a è¾“å‡ºåˆ° b çš„æ¥å£ä¸ºç©º(null), æ‰€ä»¥åœ¨ b ä¸­è°ƒç”¨ foo() è¦æŠ¥é”™çš„ã€‚ä½†æ˜¯ ES6 å¯ä»¥æ‰§è¡Œï¼Œå¾—åˆ°æ§åˆ¶å°è¾“å‡º"finished"

å¦ä¸€ä¸ªä¾‹å­æ˜¯è¿™æ ·çš„ã€‚æ‰§è¡Œé¡ºåºä»¥æ³¨é‡Šåºå·ä¸ºå‡†(ä»0å¼€å§‹)ï¼š
```js
// even.js
import {odd} from './odd';         //2. å¾—åˆ° odd.js åŠ¨æ€å¼•ç”¨ï¼Œä½†ä¸æ‰§è¡Œ
export var counter = 0;            //3. è¾“å‡º counter çš„å¼•ç”¨
export function even(n){           //4. è¾“å‡º even å‡½æ•°çš„å¼•ç”¨
  counter++;                       //6
  return n === 0 || odd(n - 1);    //7. n ä¸æ˜¯ 0, å» odd.js æ‰¾ odd() å‡½æ•°    //10. æ‰§è¡Œ odd å‡½æ•°ï¼Œä¼ å…¥9
}

// odd.js
import {even} from './even';       //8. å¾—åˆ° even.js åŠ¨æ€å¼•ç”¨ï¼Œä½†ä¸æ‰§è¡Œ
export function odd(n){            //9. è¾“å‡º odd å‡½æ•°
  return n !== 0 && even(n - 1);   //11. å›åˆ°ç¬¬2æ­¥ï¼Œæ‰¾åˆ° even å‡½æ•°ï¼Œå›æ¥æ‰§è¡Œï¼Œä¼ å…¥8ï¼Œç›´åˆ° n ä¸º 0 ç»“æŸ
}

// main.js
import * as m from './even';    //0. å¾—åˆ° even.js åŠ¨æ€å¼•ç”¨ï¼Œä½†ä¸æ‰§è¡Œ
console.log(m.even(10));     //1. å» even.js æ‰¾ even å‡½æ•°ã€‚ //5. æ‰§è¡Œå‡½æ•°ï¼Œä¼ å…¥10   //æœ€ç»ˆå¾—åˆ°æ§åˆ¶å°è¾“å‡ºï¼štrue
console.log(m.counter);      //ç”±äº ES6 æ¨¡å—ä¼ å€¼æ˜¯åŠ¨æ€ç»‘å®šçš„(ä¸‹åŒ)ï¼Œæ‰€ä»¥å¾—åˆ°æ§åˆ¶å°è¾“å‡ºï¼š6
console.log(m.even(20));     //åˆ†æåŒä¸Šï¼Œå¾—åˆ°æ§åˆ¶å°è¾“å‡ºï¼štrue
console.log(m.counter);      //å¾—åˆ°æ§åˆ¶å°è¾“å‡ºï¼š17
```
ä¸Šé¢å†™äº†11æ­¥ï¼Œä¹‹åæ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œæ²¡æœ‰ç»§ç»­å†™ã€‚ä½†ä¸éš¾çœ‹å‡º ES6 æ ¹æœ¬ä¸æ€•å¾ªç¯å¼•ç”¨ï¼Œåªè¦æ¨¡å—æ–‡ä»¶çš„åŠ¨æ€å¼•ç”¨åœ¨ï¼Œå°±å¯ä»¥è®¡ç®—å®Œæˆã€‚ä¸è¿‡ï¼Œåˆ«çœ‹è¿™ä¸ªè¿‡ç¨‹æ¯” CommonJS å¤æ‚ï¼Œæ¯æ¬¡éƒ½æœ‰é‡æ–°è¿è¡Œæ¨¡å—æ–‡ä»¶ï¼Œè€Œä¸ç›´æ¥è¯»å–ç¼“å­˜ï¼Œä½† ES6 çš„è¿™äº›å·¥ä½œåœ¨ç¼–è¯‘æœŸé—´å°±å®Œæˆäº†ï¼Œæ¯” CommonJS åœ¨è¿è¡Œæ—¶é—´å¤„ç†æ¨¡å—è¦æ•ˆç‡æ›´é«˜ï¼Œä½“éªŒæ›´å¥½ã€‚

